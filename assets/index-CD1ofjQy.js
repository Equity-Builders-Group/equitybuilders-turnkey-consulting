var Dm=n=>{throw TypeError(n)};var eu=(n,e,t)=>e.has(n)||Dm("Cannot "+t);var G=(n,e,t)=>(eu(n,e,"read from private field"),t?t.call(n):e.get(n)),he=(n,e,t)=>e.has(n)?Dm("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),oe=(n,e,t,r)=>(eu(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),it=(n,e,t)=>(eu(n,e,"access private method"),t);var fa=(n,e,t,r)=>({set _(s){oe(n,e,s,t)},get _(){return G(n,e,r)}});function l1(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function av(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lv={exports:{}},hc={},cv={exports:{}},de={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xo=Symbol.for("react.element"),c1=Symbol.for("react.portal"),u1=Symbol.for("react.fragment"),d1=Symbol.for("react.strict_mode"),f1=Symbol.for("react.profiler"),h1=Symbol.for("react.provider"),m1=Symbol.for("react.context"),p1=Symbol.for("react.forward_ref"),g1=Symbol.for("react.suspense"),v1=Symbol.for("react.memo"),y1=Symbol.for("react.lazy"),Nm=Symbol.iterator;function x1(n){return n===null||typeof n!="object"?null:(n=Nm&&n[Nm]||n["@@iterator"],typeof n=="function"?n:null)}var uv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dv=Object.assign,fv={};function Bi(n,e,t){this.props=n,this.context=e,this.refs=fv,this.updater=t||uv}Bi.prototype.isReactComponent={};Bi.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Bi.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function hv(){}hv.prototype=Bi.prototype;function Gf(n,e,t){this.props=n,this.context=e,this.refs=fv,this.updater=t||uv}var Vf=Gf.prototype=new hv;Vf.constructor=Gf;dv(Vf,Bi.prototype);Vf.isPureReactComponent=!0;var Om=Array.isArray,mv=Object.prototype.hasOwnProperty,Hf={current:null},pv={key:!0,ref:!0,__self:!0,__source:!0};function gv(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)mv.call(e,r)&&!pv.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Xo,type:n,key:i,ref:o,props:s,_owner:Hf.current}}function E1(n,e){return{$$typeof:Xo,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Kf(n){return typeof n=="object"&&n!==null&&n.$$typeof===Xo}function S1(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Mm=/\/+/g;function tu(n,e){return typeof n=="object"&&n!==null&&n.key!=null?S1(""+n.key):e.toString(36)}function el(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Xo:case c1:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+tu(o,0):r,Om(s)?(t="",n!=null&&(t=n.replace(Mm,"$&/")+"/"),el(s,e,t,"",function(c){return c})):s!=null&&(Kf(s)&&(s=E1(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Mm,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Om(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+tu(i,a);o+=el(i,e,t,l,s)}else if(l=x1(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+tu(i,a++),o+=el(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ha(n,e,t){if(n==null)return n;var r=[],s=0;return el(n,r,"","",function(i){return e.call(t,i,s++)}),r}function T1(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var vt={current:null},tl={transition:null},b1={ReactCurrentDispatcher:vt,ReactCurrentBatchConfig:tl,ReactCurrentOwner:Hf};function vv(){throw Error("act(...) is not supported in production builds of React.")}de.Children={map:ha,forEach:function(n,e,t){ha(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ha(n,function(){e++}),e},toArray:function(n){return ha(n,function(e){return e})||[]},only:function(n){if(!Kf(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};de.Component=Bi;de.Fragment=u1;de.Profiler=f1;de.PureComponent=Gf;de.StrictMode=d1;de.Suspense=g1;de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b1;de.act=vv;de.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=dv({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Hf.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)mv.call(e,l)&&!pv.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Xo,type:n.type,key:s,ref:i,props:r,_owner:o}};de.createContext=function(n){return n={$$typeof:m1,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:h1,_context:n},n.Consumer=n};de.createElement=gv;de.createFactory=function(n){var e=gv.bind(null,n);return e.type=n,e};de.createRef=function(){return{current:null}};de.forwardRef=function(n){return{$$typeof:p1,render:n}};de.isValidElement=Kf;de.lazy=function(n){return{$$typeof:y1,_payload:{_status:-1,_result:n},_init:T1}};de.memo=function(n,e){return{$$typeof:v1,type:n,compare:e===void 0?null:e}};de.startTransition=function(n){var e=tl.transition;tl.transition={};try{n()}finally{tl.transition=e}};de.unstable_act=vv;de.useCallback=function(n,e){return vt.current.useCallback(n,e)};de.useContext=function(n){return vt.current.useContext(n)};de.useDebugValue=function(){};de.useDeferredValue=function(n){return vt.current.useDeferredValue(n)};de.useEffect=function(n,e){return vt.current.useEffect(n,e)};de.useId=function(){return vt.current.useId()};de.useImperativeHandle=function(n,e,t){return vt.current.useImperativeHandle(n,e,t)};de.useInsertionEffect=function(n,e){return vt.current.useInsertionEffect(n,e)};de.useLayoutEffect=function(n,e){return vt.current.useLayoutEffect(n,e)};de.useMemo=function(n,e){return vt.current.useMemo(n,e)};de.useReducer=function(n,e,t){return vt.current.useReducer(n,e,t)};de.useRef=function(n){return vt.current.useRef(n)};de.useState=function(n){return vt.current.useState(n)};de.useSyncExternalStore=function(n,e,t){return vt.current.useSyncExternalStore(n,e,t)};de.useTransition=function(){return vt.current.useTransition()};de.version="18.3.1";cv.exports=de;var w=cv.exports;const z=av(w),Wf=l1({__proto__:null,default:z},[w]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w1=w,A1=Symbol.for("react.element"),L1=Symbol.for("react.fragment"),I1=Object.prototype.hasOwnProperty,R1=w1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C1={key:!0,ref:!0,__self:!0,__source:!0};function yv(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)I1.call(e,r)&&!C1.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:A1,type:n,key:i,ref:o,props:s,_owner:R1.current}}hc.Fragment=L1;hc.jsx=yv;hc.jsxs=yv;lv.exports=hc;var y=lv.exports,xv={exports:{}},Gt={},Ev={exports:{}},Sv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,D){var j=k.length;k.push(D);e:for(;0<j;){var $=j-1>>>1,F=k[$];if(0<s(F,D))k[$]=D,k[j]=F,j=$;else break e}}function t(k){return k.length===0?null:k[0]}function r(k){if(k.length===0)return null;var D=k[0],j=k.pop();if(j!==D){k[0]=j;e:for(var $=0,F=k.length,Y=F>>>1;$<Y;){var Q=2*($+1)-1,ee=k[Q],te=Q+1,ne=k[te];if(0>s(ee,j))te<F&&0>s(ne,ee)?(k[$]=ne,k[te]=j,$=te):(k[$]=ee,k[Q]=j,$=Q);else if(te<F&&0>s(ne,j))k[$]=ne,k[te]=j,$=te;else break e}}return D}function s(k,D){var j=k.sortIndex-D.sortIndex;return j!==0?j:k.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,f=3,h=!1,m=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(k){for(var D=t(c);D!==null;){if(D.callback===null)r(c);else if(D.startTime<=k)r(c),D.sortIndex=D.expirationTime,e(l,D);else break;D=t(c)}}function T(k){if(p=!1,E(k),!m)if(t(l)!==null)m=!0,B(b);else{var D=t(c);D!==null&&H(T,D.startTime-k)}}function b(k,D){m=!1,p&&(p=!1,v(I),I=-1),h=!0;var j=f;try{for(E(D),d=t(l);d!==null&&(!(d.expirationTime>D)||k&&!_());){var $=d.callback;if(typeof $=="function"){d.callback=null,f=d.priorityLevel;var F=$(d.expirationTime<=D);D=n.unstable_now(),typeof F=="function"?d.callback=F:d===t(l)&&r(l),E(D)}else r(l);d=t(l)}if(d!==null)var Y=!0;else{var Q=t(c);Q!==null&&H(T,Q.startTime-D),Y=!1}return Y}finally{d=null,f=j,h=!1}}var L=!1,A=null,I=-1,C=5,R=-1;function _(){return!(n.unstable_now()-R<C)}function O(){if(A!==null){var k=n.unstable_now();R=k;var D=!0;try{D=A(!0,k)}finally{D?V():(L=!1,A=null)}}else L=!1}var V;if(typeof x=="function")V=function(){x(O)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,K=M.port2;M.port1.onmessage=O,V=function(){K.postMessage(null)}}else V=function(){g(O,0)};function B(k){A=k,L||(L=!0,V())}function H(k,D){I=g(function(){k(n.unstable_now())},D)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){m||h||(m=!0,B(b))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(f){case 1:case 2:case 3:var D=3;break;default:D=f}var j=f;f=D;try{return k()}finally{f=j}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,D){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var j=f;f=k;try{return D()}finally{f=j}},n.unstable_scheduleCallback=function(k,D,j){var $=n.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?$+j:$):j=$,k){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=j+F,k={id:u++,callback:D,priorityLevel:k,startTime:j,expirationTime:F,sortIndex:-1},j>$?(k.sortIndex=j,e(c,k),t(l)===null&&k===t(c)&&(p?(v(I),I=-1):p=!0,H(T,j-$))):(k.sortIndex=F,e(l,k),m||h||(m=!0,B(b))),k},n.unstable_shouldYield=_,n.unstable_wrapCallback=function(k){var D=f;return function(){var j=f;f=D;try{return k.apply(this,arguments)}finally{f=j}}}})(Sv);Ev.exports=Sv;var k1=Ev.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _1=w,jt=k1;function W(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Tv=new Set,So={};function Ps(n,e){Ii(n,e),Ii(n+"Capture",e)}function Ii(n,e){for(So[n]=e,n=0;n<e.length;n++)Tv.add(e[n])}var ar=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fd=Object.prototype.hasOwnProperty,P1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Fm={},Bm={};function D1(n){return fd.call(Bm,n)?!0:fd.call(Fm,n)?!1:P1.test(n)?Bm[n]=!0:(Fm[n]=!0,!1)}function N1(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function O1(n,e,t,r){if(e===null||typeof e>"u"||N1(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yt(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){rt[n]=new yt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];rt[e]=new yt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){rt[n]=new yt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){rt[n]=new yt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){rt[n]=new yt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){rt[n]=new yt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){rt[n]=new yt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){rt[n]=new yt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){rt[n]=new yt(n,5,!1,n.toLowerCase(),null,!1,!1)});var zf=/[\-:]([a-z])/g;function Yf(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(zf,Yf);rt[e]=new yt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(zf,Yf);rt[e]=new yt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(zf,Yf);rt[e]=new yt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){rt[n]=new yt(n,1,!1,n.toLowerCase(),null,!1,!1)});rt.xlinkHref=new yt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){rt[n]=new yt(n,1,!1,n.toLowerCase(),null,!0,!0)});function qf(n,e,t,r){var s=rt.hasOwnProperty(e)?rt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(O1(e,t,s,r)&&(t=null),r||s===null?D1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var mr=_1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ma=Symbol.for("react.element"),Ws=Symbol.for("react.portal"),zs=Symbol.for("react.fragment"),Qf=Symbol.for("react.strict_mode"),hd=Symbol.for("react.profiler"),bv=Symbol.for("react.provider"),wv=Symbol.for("react.context"),Xf=Symbol.for("react.forward_ref"),md=Symbol.for("react.suspense"),pd=Symbol.for("react.suspense_list"),Zf=Symbol.for("react.memo"),Ir=Symbol.for("react.lazy"),Av=Symbol.for("react.offscreen"),$m=Symbol.iterator;function Ki(n){return n===null||typeof n!="object"?null:(n=$m&&n[$m]||n["@@iterator"],typeof n=="function"?n:null)}var Pe=Object.assign,nu;function no(n){if(nu===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);nu=e&&e[1]||""}return`
`+nu+n}var ru=!1;function su(n,e){if(!n||ru)return"";ru=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{ru=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?no(n):""}function M1(n){switch(n.tag){case 5:return no(n.type);case 16:return no("Lazy");case 13:return no("Suspense");case 19:return no("SuspenseList");case 0:case 2:case 15:return n=su(n.type,!1),n;case 11:return n=su(n.type.render,!1),n;case 1:return n=su(n.type,!0),n;default:return""}}function gd(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case zs:return"Fragment";case Ws:return"Portal";case hd:return"Profiler";case Qf:return"StrictMode";case md:return"Suspense";case pd:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case wv:return(n.displayName||"Context")+".Consumer";case bv:return(n._context.displayName||"Context")+".Provider";case Xf:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Zf:return e=n.displayName||null,e!==null?e:gd(n.type)||"Memo";case Ir:e=n._payload,n=n._init;try{return gd(n(e))}catch{}}return null}function F1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gd(e);case 8:return e===Qf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Lv(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function B1(n){var e=Lv(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function pa(n){n._valueTracker||(n._valueTracker=B1(n))}function Iv(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Lv(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Al(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vd(n,e){var t=e.checked;return Pe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Um(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=qr(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Rv(n,e){e=e.checked,e!=null&&qf(n,"checked",e,!1)}function yd(n,e){Rv(n,e);var t=qr(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?xd(n,e.type,t):e.hasOwnProperty("defaultValue")&&xd(n,e.type,qr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function jm(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function xd(n,e,t){(e!=="number"||Al(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ro=Array.isArray;function ii(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+qr(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Ed(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(W(91));return Pe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Gm(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(W(92));if(ro(t)){if(1<t.length)throw Error(W(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:qr(t)}}function Cv(n,e){var t=qr(e.value),r=qr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Vm(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function kv(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sd(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?kv(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ga,_v=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ga=ga||document.createElement("div"),ga.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ga.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function To(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ao={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$1=["Webkit","ms","Moz","O"];Object.keys(ao).forEach(function(n){$1.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ao[e]=ao[n]})});function Pv(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ao.hasOwnProperty(n)&&ao[n]?(""+e).trim():e+"px"}function Dv(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Pv(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var U1=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Td(n,e){if(e){if(U1[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(W(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(W(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(W(61))}if(e.style!=null&&typeof e.style!="object")throw Error(W(62))}}function bd(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wd=null;function Jf(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ad=null,oi=null,ai=null;function Hm(n){if(n=ea(n)){if(typeof Ad!="function")throw Error(W(280));var e=n.stateNode;e&&(e=yc(e),Ad(n.stateNode,n.type,e))}}function Nv(n){oi?ai?ai.push(n):ai=[n]:oi=n}function Ov(){if(oi){var n=oi,e=ai;if(ai=oi=null,Hm(n),e)for(n=0;n<e.length;n++)Hm(e[n])}}function Mv(n,e){return n(e)}function Fv(){}var iu=!1;function Bv(n,e,t){if(iu)return n(e,t);iu=!0;try{return Mv(n,e,t)}finally{iu=!1,(oi!==null||ai!==null)&&(Fv(),Ov())}}function bo(n,e){var t=n.stateNode;if(t===null)return null;var r=yc(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(W(231,e,typeof t));return t}var Ld=!1;if(ar)try{var Wi={};Object.defineProperty(Wi,"passive",{get:function(){Ld=!0}}),window.addEventListener("test",Wi,Wi),window.removeEventListener("test",Wi,Wi)}catch{Ld=!1}function j1(n,e,t,r,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var lo=!1,Ll=null,Il=!1,Id=null,G1={onError:function(n){lo=!0,Ll=n}};function V1(n,e,t,r,s,i,o,a,l){lo=!1,Ll=null,j1.apply(G1,arguments)}function H1(n,e,t,r,s,i,o,a,l){if(V1.apply(this,arguments),lo){if(lo){var c=Ll;lo=!1,Ll=null}else throw Error(W(198));Il||(Il=!0,Id=c)}}function Ds(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function $v(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Km(n){if(Ds(n)!==n)throw Error(W(188))}function K1(n){var e=n.alternate;if(!e){if(e=Ds(n),e===null)throw Error(W(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Km(s),n;if(i===r)return Km(s),e;i=i.sibling}throw Error(W(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(W(189))}}if(t.alternate!==r)throw Error(W(190))}if(t.tag!==3)throw Error(W(188));return t.stateNode.current===t?n:e}function Uv(n){return n=K1(n),n!==null?jv(n):null}function jv(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=jv(n);if(e!==null)return e;n=n.sibling}return null}var Gv=jt.unstable_scheduleCallback,Wm=jt.unstable_cancelCallback,W1=jt.unstable_shouldYield,z1=jt.unstable_requestPaint,Be=jt.unstable_now,Y1=jt.unstable_getCurrentPriorityLevel,eh=jt.unstable_ImmediatePriority,Vv=jt.unstable_UserBlockingPriority,Rl=jt.unstable_NormalPriority,q1=jt.unstable_LowPriority,Hv=jt.unstable_IdlePriority,mc=null,Un=null;function Q1(n){if(Un&&typeof Un.onCommitFiberRoot=="function")try{Un.onCommitFiberRoot(mc,n,void 0,(n.current.flags&128)===128)}catch{}}var yn=Math.clz32?Math.clz32:J1,X1=Math.log,Z1=Math.LN2;function J1(n){return n>>>=0,n===0?32:31-(X1(n)/Z1|0)|0}var va=64,ya=4194304;function so(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Cl(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=so(a):(i&=o,i!==0&&(r=so(i)))}else o=t&~s,o!==0?r=so(o):i!==0&&(r=so(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-yn(e),s=1<<t,r|=n[t],e&=~s;return r}function eb(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tb(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-yn(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=eb(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function Rd(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Kv(){var n=va;return va<<=1,!(va&4194240)&&(va=64),n}function ou(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Zo(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-yn(e),n[e]=t}function nb(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-yn(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function th(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-yn(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var pe=0;function Wv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var zv,nh,Yv,qv,Qv,Cd=!1,xa=[],jr=null,Gr=null,Vr=null,wo=new Map,Ao=new Map,_r=[],rb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zm(n,e){switch(n){case"focusin":case"focusout":jr=null;break;case"dragenter":case"dragleave":Gr=null;break;case"mouseover":case"mouseout":Vr=null;break;case"pointerover":case"pointerout":wo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ao.delete(e.pointerId)}}function zi(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ea(e),e!==null&&nh(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function sb(n,e,t,r,s){switch(e){case"focusin":return jr=zi(jr,n,e,t,r,s),!0;case"dragenter":return Gr=zi(Gr,n,e,t,r,s),!0;case"mouseover":return Vr=zi(Vr,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return wo.set(i,zi(wo.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ao.set(i,zi(Ao.get(i)||null,n,e,t,r,s)),!0}return!1}function Xv(n){var e=fs(n.target);if(e!==null){var t=Ds(e);if(t!==null){if(e=t.tag,e===13){if(e=$v(t),e!==null){n.blockedOn=e,Qv(n.priority,function(){Yv(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function nl(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=kd(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);wd=r,t.target.dispatchEvent(r),wd=null}else return e=ea(t),e!==null&&nh(e),n.blockedOn=t,!1;e.shift()}return!0}function Ym(n,e,t){nl(n)&&t.delete(e)}function ib(){Cd=!1,jr!==null&&nl(jr)&&(jr=null),Gr!==null&&nl(Gr)&&(Gr=null),Vr!==null&&nl(Vr)&&(Vr=null),wo.forEach(Ym),Ao.forEach(Ym)}function Yi(n,e){n.blockedOn===e&&(n.blockedOn=null,Cd||(Cd=!0,jt.unstable_scheduleCallback(jt.unstable_NormalPriority,ib)))}function Lo(n){function e(s){return Yi(s,n)}if(0<xa.length){Yi(xa[0],n);for(var t=1;t<xa.length;t++){var r=xa[t];r.blockedOn===n&&(r.blockedOn=null)}}for(jr!==null&&Yi(jr,n),Gr!==null&&Yi(Gr,n),Vr!==null&&Yi(Vr,n),wo.forEach(e),Ao.forEach(e),t=0;t<_r.length;t++)r=_r[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<_r.length&&(t=_r[0],t.blockedOn===null);)Xv(t),t.blockedOn===null&&_r.shift()}var li=mr.ReactCurrentBatchConfig,kl=!0;function ob(n,e,t,r){var s=pe,i=li.transition;li.transition=null;try{pe=1,rh(n,e,t,r)}finally{pe=s,li.transition=i}}function ab(n,e,t,r){var s=pe,i=li.transition;li.transition=null;try{pe=4,rh(n,e,t,r)}finally{pe=s,li.transition=i}}function rh(n,e,t,r){if(kl){var s=kd(n,e,t,r);if(s===null)gu(n,e,r,_l,t),zm(n,r);else if(sb(s,n,e,t,r))r.stopPropagation();else if(zm(n,r),e&4&&-1<rb.indexOf(n)){for(;s!==null;){var i=ea(s);if(i!==null&&zv(i),i=kd(n,e,t,r),i===null&&gu(n,e,r,_l,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else gu(n,e,r,null,t)}}var _l=null;function kd(n,e,t,r){if(_l=null,n=Jf(r),n=fs(n),n!==null)if(e=Ds(n),e===null)n=null;else if(t=e.tag,t===13){if(n=$v(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return _l=n,null}function Zv(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y1()){case eh:return 1;case Vv:return 4;case Rl:case q1:return 16;case Hv:return 536870912;default:return 16}default:return 16}}var Br=null,sh=null,rl=null;function Jv(){if(rl)return rl;var n,e=sh,t=e.length,r,s="value"in Br?Br.value:Br.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return rl=s.slice(n,1<r?1-r:void 0)}function sl(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Ea(){return!0}function qm(){return!1}function Vt(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ea:qm,this.isPropagationStopped=qm,this}return Pe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ea)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ea)},persist:function(){},isPersistent:Ea}),e}var $i={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ih=Vt($i),Jo=Pe({},$i,{view:0,detail:0}),lb=Vt(Jo),au,lu,qi,pc=Pe({},Jo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oh,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==qi&&(qi&&n.type==="mousemove"?(au=n.screenX-qi.screenX,lu=n.screenY-qi.screenY):lu=au=0,qi=n),au)},movementY:function(n){return"movementY"in n?n.movementY:lu}}),Qm=Vt(pc),cb=Pe({},pc,{dataTransfer:0}),ub=Vt(cb),db=Pe({},Jo,{relatedTarget:0}),cu=Vt(db),fb=Pe({},$i,{animationName:0,elapsedTime:0,pseudoElement:0}),hb=Vt(fb),mb=Pe({},$i,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),pb=Vt(mb),gb=Pe({},$i,{data:0}),Xm=Vt(gb),vb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eb(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=xb[n])?!!e[n]:!1}function oh(){return Eb}var Sb=Pe({},Jo,{key:function(n){if(n.key){var e=vb[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=sl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yb[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oh,charCode:function(n){return n.type==="keypress"?sl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?sl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Tb=Vt(Sb),bb=Pe({},pc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zm=Vt(bb),wb=Pe({},Jo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oh}),Ab=Vt(wb),Lb=Pe({},$i,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ib=Vt(Lb),Rb=Pe({},pc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Cb=Vt(Rb),kb=[9,13,27,32],ah=ar&&"CompositionEvent"in window,co=null;ar&&"documentMode"in document&&(co=document.documentMode);var _b=ar&&"TextEvent"in window&&!co,ey=ar&&(!ah||co&&8<co&&11>=co),Jm=" ",ep=!1;function ty(n,e){switch(n){case"keyup":return kb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ny(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ys=!1;function Pb(n,e){switch(n){case"compositionend":return ny(e);case"keypress":return e.which!==32?null:(ep=!0,Jm);case"textInput":return n=e.data,n===Jm&&ep?null:n;default:return null}}function Db(n,e){if(Ys)return n==="compositionend"||!ah&&ty(n,e)?(n=Jv(),rl=sh=Br=null,Ys=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ey&&e.locale!=="ko"?null:e.data;default:return null}}var Nb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Nb[n.type]:e==="textarea"}function ry(n,e,t,r){Nv(r),e=Pl(e,"onChange"),0<e.length&&(t=new ih("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var uo=null,Io=null;function Ob(n){my(n,0)}function gc(n){var e=Xs(n);if(Iv(e))return n}function Mb(n,e){if(n==="change")return e}var sy=!1;if(ar){var uu;if(ar){var du="oninput"in document;if(!du){var np=document.createElement("div");np.setAttribute("oninput","return;"),du=typeof np.oninput=="function"}uu=du}else uu=!1;sy=uu&&(!document.documentMode||9<document.documentMode)}function rp(){uo&&(uo.detachEvent("onpropertychange",iy),Io=uo=null)}function iy(n){if(n.propertyName==="value"&&gc(Io)){var e=[];ry(e,Io,n,Jf(n)),Bv(Ob,e)}}function Fb(n,e,t){n==="focusin"?(rp(),uo=e,Io=t,uo.attachEvent("onpropertychange",iy)):n==="focusout"&&rp()}function Bb(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return gc(Io)}function $b(n,e){if(n==="click")return gc(e)}function Ub(n,e){if(n==="input"||n==="change")return gc(e)}function jb(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var En=typeof Object.is=="function"?Object.is:jb;function Ro(n,e){if(En(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!fd.call(e,s)||!En(n[s],e[s]))return!1}return!0}function sp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function ip(n,e){var t=sp(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=sp(t)}}function oy(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?oy(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ay(){for(var n=window,e=Al();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Al(n.document)}return e}function lh(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Gb(n){var e=ay(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&oy(t.ownerDocument.documentElement,t)){if(r!==null&&lh(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=ip(t,i);var o=ip(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Vb=ar&&"documentMode"in document&&11>=document.documentMode,qs=null,_d=null,fo=null,Pd=!1;function op(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Pd||qs==null||qs!==Al(r)||(r=qs,"selectionStart"in r&&lh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),fo&&Ro(fo,r)||(fo=r,r=Pl(_d,"onSelect"),0<r.length&&(e=new ih("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=qs)))}function Sa(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Qs={animationend:Sa("Animation","AnimationEnd"),animationiteration:Sa("Animation","AnimationIteration"),animationstart:Sa("Animation","AnimationStart"),transitionend:Sa("Transition","TransitionEnd")},fu={},ly={};ar&&(ly=document.createElement("div").style,"AnimationEvent"in window||(delete Qs.animationend.animation,delete Qs.animationiteration.animation,delete Qs.animationstart.animation),"TransitionEvent"in window||delete Qs.transitionend.transition);function vc(n){if(fu[n])return fu[n];if(!Qs[n])return n;var e=Qs[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in ly)return fu[n]=e[t];return n}var cy=vc("animationend"),uy=vc("animationiteration"),dy=vc("animationstart"),fy=vc("transitionend"),hy=new Map,ap="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ts(n,e){hy.set(n,e),Ps(e,[n])}for(var hu=0;hu<ap.length;hu++){var mu=ap[hu],Hb=mu.toLowerCase(),Kb=mu[0].toUpperCase()+mu.slice(1);ts(Hb,"on"+Kb)}ts(cy,"onAnimationEnd");ts(uy,"onAnimationIteration");ts(dy,"onAnimationStart");ts("dblclick","onDoubleClick");ts("focusin","onFocus");ts("focusout","onBlur");ts(fy,"onTransitionEnd");Ii("onMouseEnter",["mouseout","mouseover"]);Ii("onMouseLeave",["mouseout","mouseover"]);Ii("onPointerEnter",["pointerout","pointerover"]);Ii("onPointerLeave",["pointerout","pointerover"]);Ps("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ps("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ps("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ps("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ps("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ps("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wb=new Set("cancel close invalid load scroll toggle".split(" ").concat(io));function lp(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,H1(r,e,void 0,n),n.currentTarget=null}function my(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;lp(s,a,c),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;lp(s,a,c),i=l}}}if(Il)throw n=Id,Il=!1,Id=null,n}function Te(n,e){var t=e[Fd];t===void 0&&(t=e[Fd]=new Set);var r=n+"__bubble";t.has(r)||(py(e,n,2,!1),t.add(r))}function pu(n,e,t){var r=0;e&&(r|=4),py(t,n,r,e)}var Ta="_reactListening"+Math.random().toString(36).slice(2);function Co(n){if(!n[Ta]){n[Ta]=!0,Tv.forEach(function(t){t!=="selectionchange"&&(Wb.has(t)||pu(t,!1,n),pu(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Ta]||(e[Ta]=!0,pu("selectionchange",!1,e))}}function py(n,e,t,r){switch(Zv(e)){case 1:var s=ob;break;case 4:s=ab;break;default:s=rh}t=s.bind(null,e,t,n),s=void 0,!Ld||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function gu(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=fs(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}Bv(function(){var c=i,u=Jf(t),d=[];e:{var f=hy.get(n);if(f!==void 0){var h=ih,m=n;switch(n){case"keypress":if(sl(t)===0)break e;case"keydown":case"keyup":h=Tb;break;case"focusin":m="focus",h=cu;break;case"focusout":m="blur",h=cu;break;case"beforeblur":case"afterblur":h=cu;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Qm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=ub;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Ab;break;case cy:case uy:case dy:h=hb;break;case fy:h=Ib;break;case"scroll":h=lb;break;case"wheel":h=Cb;break;case"copy":case"cut":case"paste":h=pb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Zm}var p=(e&4)!==0,g=!p&&n==="scroll",v=p?f!==null?f+"Capture":null:f;p=[];for(var x=c,E;x!==null;){E=x;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,v!==null&&(T=bo(x,v),T!=null&&p.push(ko(x,T,E)))),g)break;x=x.return}0<p.length&&(f=new h(f,m,null,t,u),d.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==wd&&(m=t.relatedTarget||t.fromElement)&&(fs(m)||m[lr]))break e;if((h||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,h?(m=t.relatedTarget||t.toElement,h=c,m=m?fs(m):null,m!==null&&(g=Ds(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(h=null,m=c),h!==m)){if(p=Qm,T="onMouseLeave",v="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(p=Zm,T="onPointerLeave",v="onPointerEnter",x="pointer"),g=h==null?f:Xs(h),E=m==null?f:Xs(m),f=new p(T,x+"leave",h,t,u),f.target=g,f.relatedTarget=E,T=null,fs(u)===c&&(p=new p(v,x+"enter",m,t,u),p.target=E,p.relatedTarget=g,T=p),g=T,h&&m)t:{for(p=h,v=m,x=0,E=p;E;E=Fs(E))x++;for(E=0,T=v;T;T=Fs(T))E++;for(;0<x-E;)p=Fs(p),x--;for(;0<E-x;)v=Fs(v),E--;for(;x--;){if(p===v||v!==null&&p===v.alternate)break t;p=Fs(p),v=Fs(v)}p=null}else p=null;h!==null&&cp(d,f,h,p,!1),m!==null&&g!==null&&cp(d,g,m,p,!0)}}e:{if(f=c?Xs(c):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var b=Mb;else if(tp(f))if(sy)b=Ub;else{b=Bb;var L=Fb}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=$b);if(b&&(b=b(n,c))){ry(d,b,t,u);break e}L&&L(n,f,c),n==="focusout"&&(L=f._wrapperState)&&L.controlled&&f.type==="number"&&xd(f,"number",f.value)}switch(L=c?Xs(c):window,n){case"focusin":(tp(L)||L.contentEditable==="true")&&(qs=L,_d=c,fo=null);break;case"focusout":fo=_d=qs=null;break;case"mousedown":Pd=!0;break;case"contextmenu":case"mouseup":case"dragend":Pd=!1,op(d,t,u);break;case"selectionchange":if(Vb)break;case"keydown":case"keyup":op(d,t,u)}var A;if(ah)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Ys?ty(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(ey&&t.locale!=="ko"&&(Ys||I!=="onCompositionStart"?I==="onCompositionEnd"&&Ys&&(A=Jv()):(Br=u,sh="value"in Br?Br.value:Br.textContent,Ys=!0)),L=Pl(c,I),0<L.length&&(I=new Xm(I,n,null,t,u),d.push({event:I,listeners:L}),A?I.data=A:(A=ny(t),A!==null&&(I.data=A)))),(A=_b?Pb(n,t):Db(n,t))&&(c=Pl(c,"onBeforeInput"),0<c.length&&(u=new Xm("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=A))}my(d,e)})}function ko(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Pl(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=bo(n,t),i!=null&&r.unshift(ko(n,i,s)),i=bo(n,e),i!=null&&r.push(ko(n,i,s))),n=n.return}return r}function Fs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function cp(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,s?(l=bo(t,i),l!=null&&o.unshift(ko(t,l,a))):s||(l=bo(t,i),l!=null&&o.push(ko(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var zb=/\r\n?/g,Yb=/\u0000|\uFFFD/g;function up(n){return(typeof n=="string"?n:""+n).replace(zb,`
`).replace(Yb,"")}function ba(n,e,t){if(e=up(e),up(n)!==e&&t)throw Error(W(425))}function Dl(){}var Dd=null,Nd=null;function Od(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Md=typeof setTimeout=="function"?setTimeout:void 0,qb=typeof clearTimeout=="function"?clearTimeout:void 0,dp=typeof Promise=="function"?Promise:void 0,Qb=typeof queueMicrotask=="function"?queueMicrotask:typeof dp<"u"?function(n){return dp.resolve(null).then(n).catch(Xb)}:Md;function Xb(n){setTimeout(function(){throw n})}function vu(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Lo(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Lo(e)}function Hr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function fp(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ui=Math.random().toString(36).slice(2),On="__reactFiber$"+Ui,_o="__reactProps$"+Ui,lr="__reactContainer$"+Ui,Fd="__reactEvents$"+Ui,Zb="__reactListeners$"+Ui,Jb="__reactHandles$"+Ui;function fs(n){var e=n[On];if(e)return e;for(var t=n.parentNode;t;){if(e=t[lr]||t[On]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=fp(n);n!==null;){if(t=n[On])return t;n=fp(n)}return e}n=t,t=n.parentNode}return null}function ea(n){return n=n[On]||n[lr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Xs(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(W(33))}function yc(n){return n[_o]||null}var Bd=[],Zs=-1;function ns(n){return{current:n}}function be(n){0>Zs||(n.current=Bd[Zs],Bd[Zs]=null,Zs--)}function Ee(n,e){Zs++,Bd[Zs]=n.current,n.current=e}var Qr={},ut=ns(Qr),It=ns(!1),ws=Qr;function Ri(n,e){var t=n.type.contextTypes;if(!t)return Qr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Rt(n){return n=n.childContextTypes,n!=null}function Nl(){be(It),be(ut)}function hp(n,e,t){if(ut.current!==Qr)throw Error(W(168));Ee(ut,e),Ee(It,t)}function gy(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(W(108,F1(n)||"Unknown",s));return Pe({},t,r)}function Ol(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Qr,ws=ut.current,Ee(ut,n),Ee(It,It.current),!0}function mp(n,e,t){var r=n.stateNode;if(!r)throw Error(W(169));t?(n=gy(n,e,ws),r.__reactInternalMemoizedMergedChildContext=n,be(It),be(ut),Ee(ut,n)):be(It),Ee(It,t)}var nr=null,xc=!1,yu=!1;function vy(n){nr===null?nr=[n]:nr.push(n)}function ew(n){xc=!0,vy(n)}function rs(){if(!yu&&nr!==null){yu=!0;var n=0,e=pe;try{var t=nr;for(pe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}nr=null,xc=!1}catch(s){throw nr!==null&&(nr=nr.slice(n+1)),Gv(eh,rs),s}finally{pe=e,yu=!1}}return null}var Js=[],ei=0,Ml=null,Fl=0,Yt=[],qt=0,As=null,sr=1,ir="";function cs(n,e){Js[ei++]=Fl,Js[ei++]=Ml,Ml=n,Fl=e}function yy(n,e,t){Yt[qt++]=sr,Yt[qt++]=ir,Yt[qt++]=As,As=n;var r=sr;n=ir;var s=32-yn(r)-1;r&=~(1<<s),t+=1;var i=32-yn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,sr=1<<32-yn(e)+s|t<<s|r,ir=i+n}else sr=1<<i|t<<s|r,ir=n}function ch(n){n.return!==null&&(cs(n,1),yy(n,1,0))}function uh(n){for(;n===Ml;)Ml=Js[--ei],Js[ei]=null,Fl=Js[--ei],Js[ei]=null;for(;n===As;)As=Yt[--qt],Yt[qt]=null,ir=Yt[--qt],Yt[qt]=null,sr=Yt[--qt],Yt[qt]=null}var Bt=null,Ft=null,Ie=!1,gn=null;function xy(n,e){var t=Qt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function pp(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Bt=n,Ft=Hr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Bt=n,Ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=As!==null?{id:sr,overflow:ir}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Qt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Bt=n,Ft=null,!0):!1;default:return!1}}function $d(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Ud(n){if(Ie){var e=Ft;if(e){var t=e;if(!pp(n,e)){if($d(n))throw Error(W(418));e=Hr(t.nextSibling);var r=Bt;e&&pp(n,e)?xy(r,t):(n.flags=n.flags&-4097|2,Ie=!1,Bt=n)}}else{if($d(n))throw Error(W(418));n.flags=n.flags&-4097|2,Ie=!1,Bt=n}}}function gp(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Bt=n}function wa(n){if(n!==Bt)return!1;if(!Ie)return gp(n),Ie=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Od(n.type,n.memoizedProps)),e&&(e=Ft)){if($d(n))throw Ey(),Error(W(418));for(;e;)xy(n,e),e=Hr(e.nextSibling)}if(gp(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(W(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ft=Hr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ft=null}}else Ft=Bt?Hr(n.stateNode.nextSibling):null;return!0}function Ey(){for(var n=Ft;n;)n=Hr(n.nextSibling)}function Ci(){Ft=Bt=null,Ie=!1}function dh(n){gn===null?gn=[n]:gn.push(n)}var tw=mr.ReactCurrentBatchConfig;function Qi(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(W(309));var r=t.stateNode}if(!r)throw Error(W(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(W(284));if(!t._owner)throw Error(W(290,n))}return n}function Aa(n,e){throw n=Object.prototype.toString.call(e),Error(W(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function vp(n){var e=n._init;return e(n._payload)}function Sy(n){function e(v,x){if(n){var E=v.deletions;E===null?(v.deletions=[x],v.flags|=16):E.push(x)}}function t(v,x){if(!n)return null;for(;x!==null;)e(v,x),x=x.sibling;return null}function r(v,x){for(v=new Map;x!==null;)x.key!==null?v.set(x.key,x):v.set(x.index,x),x=x.sibling;return v}function s(v,x){return v=Yr(v,x),v.index=0,v.sibling=null,v}function i(v,x,E){return v.index=E,n?(E=v.alternate,E!==null?(E=E.index,E<x?(v.flags|=2,x):E):(v.flags|=2,x)):(v.flags|=1048576,x)}function o(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,x,E,T){return x===null||x.tag!==6?(x=Au(E,v.mode,T),x.return=v,x):(x=s(x,E),x.return=v,x)}function l(v,x,E,T){var b=E.type;return b===zs?u(v,x,E.props.children,T,E.key):x!==null&&(x.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Ir&&vp(b)===x.type)?(T=s(x,E.props),T.ref=Qi(v,x,E),T.return=v,T):(T=dl(E.type,E.key,E.props,null,v.mode,T),T.ref=Qi(v,x,E),T.return=v,T)}function c(v,x,E,T){return x===null||x.tag!==4||x.stateNode.containerInfo!==E.containerInfo||x.stateNode.implementation!==E.implementation?(x=Lu(E,v.mode,T),x.return=v,x):(x=s(x,E.children||[]),x.return=v,x)}function u(v,x,E,T,b){return x===null||x.tag!==7?(x=Ts(E,v.mode,T,b),x.return=v,x):(x=s(x,E),x.return=v,x)}function d(v,x,E){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Au(""+x,v.mode,E),x.return=v,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ma:return E=dl(x.type,x.key,x.props,null,v.mode,E),E.ref=Qi(v,null,x),E.return=v,E;case Ws:return x=Lu(x,v.mode,E),x.return=v,x;case Ir:var T=x._init;return d(v,T(x._payload),E)}if(ro(x)||Ki(x))return x=Ts(x,v.mode,E,null),x.return=v,x;Aa(v,x)}return null}function f(v,x,E,T){var b=x!==null?x.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return b!==null?null:a(v,x,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ma:return E.key===b?l(v,x,E,T):null;case Ws:return E.key===b?c(v,x,E,T):null;case Ir:return b=E._init,f(v,x,b(E._payload),T)}if(ro(E)||Ki(E))return b!==null?null:u(v,x,E,T,null);Aa(v,E)}return null}function h(v,x,E,T,b){if(typeof T=="string"&&T!==""||typeof T=="number")return v=v.get(E)||null,a(x,v,""+T,b);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ma:return v=v.get(T.key===null?E:T.key)||null,l(x,v,T,b);case Ws:return v=v.get(T.key===null?E:T.key)||null,c(x,v,T,b);case Ir:var L=T._init;return h(v,x,E,L(T._payload),b)}if(ro(T)||Ki(T))return v=v.get(E)||null,u(x,v,T,b,null);Aa(x,T)}return null}function m(v,x,E,T){for(var b=null,L=null,A=x,I=x=0,C=null;A!==null&&I<E.length;I++){A.index>I?(C=A,A=null):C=A.sibling;var R=f(v,A,E[I],T);if(R===null){A===null&&(A=C);break}n&&A&&R.alternate===null&&e(v,A),x=i(R,x,I),L===null?b=R:L.sibling=R,L=R,A=C}if(I===E.length)return t(v,A),Ie&&cs(v,I),b;if(A===null){for(;I<E.length;I++)A=d(v,E[I],T),A!==null&&(x=i(A,x,I),L===null?b=A:L.sibling=A,L=A);return Ie&&cs(v,I),b}for(A=r(v,A);I<E.length;I++)C=h(A,v,I,E[I],T),C!==null&&(n&&C.alternate!==null&&A.delete(C.key===null?I:C.key),x=i(C,x,I),L===null?b=C:L.sibling=C,L=C);return n&&A.forEach(function(_){return e(v,_)}),Ie&&cs(v,I),b}function p(v,x,E,T){var b=Ki(E);if(typeof b!="function")throw Error(W(150));if(E=b.call(E),E==null)throw Error(W(151));for(var L=b=null,A=x,I=x=0,C=null,R=E.next();A!==null&&!R.done;I++,R=E.next()){A.index>I?(C=A,A=null):C=A.sibling;var _=f(v,A,R.value,T);if(_===null){A===null&&(A=C);break}n&&A&&_.alternate===null&&e(v,A),x=i(_,x,I),L===null?b=_:L.sibling=_,L=_,A=C}if(R.done)return t(v,A),Ie&&cs(v,I),b;if(A===null){for(;!R.done;I++,R=E.next())R=d(v,R.value,T),R!==null&&(x=i(R,x,I),L===null?b=R:L.sibling=R,L=R);return Ie&&cs(v,I),b}for(A=r(v,A);!R.done;I++,R=E.next())R=h(A,v,I,R.value,T),R!==null&&(n&&R.alternate!==null&&A.delete(R.key===null?I:R.key),x=i(R,x,I),L===null?b=R:L.sibling=R,L=R);return n&&A.forEach(function(O){return e(v,O)}),Ie&&cs(v,I),b}function g(v,x,E,T){if(typeof E=="object"&&E!==null&&E.type===zs&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case ma:e:{for(var b=E.key,L=x;L!==null;){if(L.key===b){if(b=E.type,b===zs){if(L.tag===7){t(v,L.sibling),x=s(L,E.props.children),x.return=v,v=x;break e}}else if(L.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Ir&&vp(b)===L.type){t(v,L.sibling),x=s(L,E.props),x.ref=Qi(v,L,E),x.return=v,v=x;break e}t(v,L);break}else e(v,L);L=L.sibling}E.type===zs?(x=Ts(E.props.children,v.mode,T,E.key),x.return=v,v=x):(T=dl(E.type,E.key,E.props,null,v.mode,T),T.ref=Qi(v,x,E),T.return=v,v=T)}return o(v);case Ws:e:{for(L=E.key;x!==null;){if(x.key===L)if(x.tag===4&&x.stateNode.containerInfo===E.containerInfo&&x.stateNode.implementation===E.implementation){t(v,x.sibling),x=s(x,E.children||[]),x.return=v,v=x;break e}else{t(v,x);break}else e(v,x);x=x.sibling}x=Lu(E,v.mode,T),x.return=v,v=x}return o(v);case Ir:return L=E._init,g(v,x,L(E._payload),T)}if(ro(E))return m(v,x,E,T);if(Ki(E))return p(v,x,E,T);Aa(v,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,x!==null&&x.tag===6?(t(v,x.sibling),x=s(x,E),x.return=v,v=x):(t(v,x),x=Au(E,v.mode,T),x.return=v,v=x),o(v)):t(v,x)}return g}var ki=Sy(!0),Ty=Sy(!1),Bl=ns(null),$l=null,ti=null,fh=null;function hh(){fh=ti=$l=null}function mh(n){var e=Bl.current;be(Bl),n._currentValue=e}function jd(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ci(n,e){$l=n,fh=ti=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(At=!0),n.firstContext=null)}function Zt(n){var e=n._currentValue;if(fh!==n)if(n={context:n,memoizedValue:e,next:null},ti===null){if($l===null)throw Error(W(308));ti=n,$l.dependencies={lanes:0,firstContext:n}}else ti=ti.next=n;return e}var hs=null;function ph(n){hs===null?hs=[n]:hs.push(n)}function by(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,ph(e)):(t.next=s.next,s.next=t),e.interleaved=t,cr(n,r)}function cr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Rr=!1;function gh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wy(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function or(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Kr(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,fe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,cr(n,t)}return s=r.interleaved,s===null?(e.next=e,ph(r)):(e.next=s.next,s.next=e),r.interleaved=e,cr(n,t)}function il(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,th(n,t)}}function yp(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ul(n,e,t,r){var s=n.updateQueue;Rr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,u=c=l=null,a=i;do{var f=a.lane,h=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,p=a;switch(f=e,h=t,p.tag){case 1:if(m=p.payload,typeof m=="function"){d=m.call(h,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=p.payload,f=typeof m=="function"?m.call(h,d,f):m,f==null)break e;d=Pe({},d,f);break e;case 2:Rr=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=h,l=d):u=u.next=h,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Is|=o,n.lanes=o,n.memoizedState=d}}function xp(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(W(191,s));s.call(r)}}}var ta={},jn=ns(ta),Po=ns(ta),Do=ns(ta);function ms(n){if(n===ta)throw Error(W(174));return n}function vh(n,e){switch(Ee(Do,e),Ee(Po,n),Ee(jn,ta),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sd(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Sd(e,n)}be(jn),Ee(jn,e)}function _i(){be(jn),be(Po),be(Do)}function Ay(n){ms(Do.current);var e=ms(jn.current),t=Sd(e,n.type);e!==t&&(Ee(Po,n),Ee(jn,t))}function yh(n){Po.current===n&&(be(jn),be(Po))}var ke=ns(0);function jl(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xu=[];function xh(){for(var n=0;n<xu.length;n++)xu[n]._workInProgressVersionPrimary=null;xu.length=0}var ol=mr.ReactCurrentDispatcher,Eu=mr.ReactCurrentBatchConfig,Ls=0,_e=null,Ke=null,Ze=null,Gl=!1,ho=!1,No=0,nw=0;function ot(){throw Error(W(321))}function Eh(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!En(n[t],e[t]))return!1;return!0}function Sh(n,e,t,r,s,i){if(Ls=i,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ol.current=n===null||n.memoizedState===null?ow:aw,n=t(r,s),ho){i=0;do{if(ho=!1,No=0,25<=i)throw Error(W(301));i+=1,Ze=Ke=null,e.updateQueue=null,ol.current=lw,n=t(r,s)}while(ho)}if(ol.current=Vl,e=Ke!==null&&Ke.next!==null,Ls=0,Ze=Ke=_e=null,Gl=!1,e)throw Error(W(300));return n}function Th(){var n=No!==0;return No=0,n}function Cn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ze===null?_e.memoizedState=Ze=n:Ze=Ze.next=n,Ze}function Jt(){if(Ke===null){var n=_e.alternate;n=n!==null?n.memoizedState:null}else n=Ke.next;var e=Ze===null?_e.memoizedState:Ze.next;if(e!==null)Ze=e,Ke=n;else{if(n===null)throw Error(W(310));Ke=n,n={memoizedState:Ke.memoizedState,baseState:Ke.baseState,baseQueue:Ke.baseQueue,queue:Ke.queue,next:null},Ze===null?_e.memoizedState=Ze=n:Ze=Ze.next=n}return Ze}function Oo(n,e){return typeof e=="function"?e(n):e}function Su(n){var e=Jt(),t=e.queue;if(t===null)throw Error(W(311));t.lastRenderedReducer=n;var r=Ke,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((Ls&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,_e.lanes|=u,Is|=u}c=c.next}while(c!==null&&c!==i);l===null?o=r:l.next=a,En(r,e.memoizedState)||(At=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,_e.lanes|=i,Is|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Tu(n){var e=Jt(),t=e.queue;if(t===null)throw Error(W(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);En(i,e.memoizedState)||(At=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Ly(){}function Iy(n,e){var t=_e,r=Jt(),s=e(),i=!En(r.memoizedState,s);if(i&&(r.memoizedState=s,At=!0),r=r.queue,bh(ky.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Ze!==null&&Ze.memoizedState.tag&1){if(t.flags|=2048,Mo(9,Cy.bind(null,t,r,s,e),void 0,null),Je===null)throw Error(W(349));Ls&30||Ry(t,e,s)}return s}function Ry(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Cy(n,e,t,r){e.value=t,e.getSnapshot=r,_y(e)&&Py(n)}function ky(n,e,t){return t(function(){_y(e)&&Py(n)})}function _y(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!En(n,t)}catch{return!0}}function Py(n){var e=cr(n,1);e!==null&&xn(e,n,1,-1)}function Ep(n){var e=Cn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:n},e.queue=n,n=n.dispatch=iw.bind(null,_e,n),[e.memoizedState,n]}function Mo(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Dy(){return Jt().memoizedState}function al(n,e,t,r){var s=Cn();_e.flags|=n,s.memoizedState=Mo(1|e,t,void 0,r===void 0?null:r)}function Ec(n,e,t,r){var s=Jt();r=r===void 0?null:r;var i=void 0;if(Ke!==null){var o=Ke.memoizedState;if(i=o.destroy,r!==null&&Eh(r,o.deps)){s.memoizedState=Mo(e,t,i,r);return}}_e.flags|=n,s.memoizedState=Mo(1|e,t,i,r)}function Sp(n,e){return al(8390656,8,n,e)}function bh(n,e){return Ec(2048,8,n,e)}function Ny(n,e){return Ec(4,2,n,e)}function Oy(n,e){return Ec(4,4,n,e)}function My(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Fy(n,e,t){return t=t!=null?t.concat([n]):null,Ec(4,4,My.bind(null,e,n),t)}function wh(){}function By(n,e){var t=Jt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Eh(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function $y(n,e){var t=Jt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Eh(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Uy(n,e,t){return Ls&21?(En(t,e)||(t=Kv(),_e.lanes|=t,Is|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,At=!0),n.memoizedState=t)}function rw(n,e){var t=pe;pe=t!==0&&4>t?t:4,n(!0);var r=Eu.transition;Eu.transition={};try{n(!1),e()}finally{pe=t,Eu.transition=r}}function jy(){return Jt().memoizedState}function sw(n,e,t){var r=zr(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Gy(n))Vy(e,t);else if(t=by(n,e,t,r),t!==null){var s=pt();xn(t,n,r,s),Hy(t,e,r)}}function iw(n,e,t){var r=zr(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Gy(n))Vy(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,En(a,o)){var l=e.interleaved;l===null?(s.next=s,ph(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=by(n,e,s,r),t!==null&&(s=pt(),xn(t,n,r,s),Hy(t,e,r))}}function Gy(n){var e=n.alternate;return n===_e||e!==null&&e===_e}function Vy(n,e){ho=Gl=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Hy(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,th(n,t)}}var Vl={readContext:Zt,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useInsertionEffect:ot,useLayoutEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useMutableSource:ot,useSyncExternalStore:ot,useId:ot,unstable_isNewReconciler:!1},ow={readContext:Zt,useCallback:function(n,e){return Cn().memoizedState=[n,e===void 0?null:e],n},useContext:Zt,useEffect:Sp,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,al(4194308,4,My.bind(null,e,n),t)},useLayoutEffect:function(n,e){return al(4194308,4,n,e)},useInsertionEffect:function(n,e){return al(4,2,n,e)},useMemo:function(n,e){var t=Cn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Cn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=sw.bind(null,_e,n),[r.memoizedState,n]},useRef:function(n){var e=Cn();return n={current:n},e.memoizedState=n},useState:Ep,useDebugValue:wh,useDeferredValue:function(n){return Cn().memoizedState=n},useTransition:function(){var n=Ep(!1),e=n[0];return n=rw.bind(null,n[1]),Cn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=_e,s=Cn();if(Ie){if(t===void 0)throw Error(W(407));t=t()}else{if(t=e(),Je===null)throw Error(W(349));Ls&30||Ry(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Sp(ky.bind(null,r,i,n),[n]),r.flags|=2048,Mo(9,Cy.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Cn(),e=Je.identifierPrefix;if(Ie){var t=ir,r=sr;t=(r&~(1<<32-yn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=No++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=nw++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},aw={readContext:Zt,useCallback:By,useContext:Zt,useEffect:bh,useImperativeHandle:Fy,useInsertionEffect:Ny,useLayoutEffect:Oy,useMemo:$y,useReducer:Su,useRef:Dy,useState:function(){return Su(Oo)},useDebugValue:wh,useDeferredValue:function(n){var e=Jt();return Uy(e,Ke.memoizedState,n)},useTransition:function(){var n=Su(Oo)[0],e=Jt().memoizedState;return[n,e]},useMutableSource:Ly,useSyncExternalStore:Iy,useId:jy,unstable_isNewReconciler:!1},lw={readContext:Zt,useCallback:By,useContext:Zt,useEffect:bh,useImperativeHandle:Fy,useInsertionEffect:Ny,useLayoutEffect:Oy,useMemo:$y,useReducer:Tu,useRef:Dy,useState:function(){return Tu(Oo)},useDebugValue:wh,useDeferredValue:function(n){var e=Jt();return Ke===null?e.memoizedState=n:Uy(e,Ke.memoizedState,n)},useTransition:function(){var n=Tu(Oo)[0],e=Jt().memoizedState;return[n,e]},useMutableSource:Ly,useSyncExternalStore:Iy,useId:jy,unstable_isNewReconciler:!1};function dn(n,e){if(n&&n.defaultProps){e=Pe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Gd(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Pe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Sc={isMounted:function(n){return(n=n._reactInternals)?Ds(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=pt(),s=zr(n),i=or(r,s);i.payload=e,t!=null&&(i.callback=t),e=Kr(n,i,s),e!==null&&(xn(e,n,s,r),il(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=pt(),s=zr(n),i=or(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Kr(n,i,s),e!==null&&(xn(e,n,s,r),il(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=pt(),r=zr(n),s=or(t,r);s.tag=2,e!=null&&(s.callback=e),e=Kr(n,s,r),e!==null&&(xn(e,n,r,t),il(e,n,r))}};function Tp(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Ro(t,r)||!Ro(s,i):!0}function Ky(n,e,t){var r=!1,s=Qr,i=e.contextType;return typeof i=="object"&&i!==null?i=Zt(i):(s=Rt(e)?ws:ut.current,r=e.contextTypes,i=(r=r!=null)?Ri(n,s):Qr),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Sc,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function bp(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Sc.enqueueReplaceState(e,e.state,null)}function Vd(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},gh(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Zt(i):(i=Rt(e)?ws:ut.current,s.context=Ri(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Gd(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Sc.enqueueReplaceState(s,s.state,null),Ul(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Pi(n,e){try{var t="",r=e;do t+=M1(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function bu(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Hd(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var cw=typeof WeakMap=="function"?WeakMap:Map;function Wy(n,e,t){t=or(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Kl||(Kl=!0,ef=r),Hd(n,e)},t}function zy(n,e,t){t=or(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Hd(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Hd(n,e),typeof r!="function"&&(Wr===null?Wr=new Set([this]):Wr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function wp(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new cw;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=bw.bind(null,n,e,t),e.then(n,n))}function Ap(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Lp(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=or(-1,1),e.tag=2,Kr(t,e,1))),t.lanes|=1),n)}var uw=mr.ReactCurrentOwner,At=!1;function ft(n,e,t,r){e.child=n===null?Ty(e,null,t,r):ki(e,n.child,t,r)}function Ip(n,e,t,r,s){t=t.render;var i=e.ref;return ci(e,s),r=Sh(n,e,t,r,i,s),t=Th(),n!==null&&!At?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ur(n,e,s)):(Ie&&t&&ch(e),e.flags|=1,ft(n,e,r,s),e.child)}function Rp(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!Ph(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Yy(n,e,i,r,s)):(n=dl(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Ro,t(o,r)&&n.ref===e.ref)return ur(n,e,s)}return e.flags|=1,n=Yr(i,r),n.ref=e.ref,n.return=e,e.child=n}function Yy(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Ro(i,r)&&n.ref===e.ref)if(At=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(At=!0);else return e.lanes=n.lanes,ur(n,e,s)}return Kd(n,e,t,r,s)}function qy(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ee(ri,Dt),Dt|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ee(ri,Dt),Dt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ee(ri,Dt),Dt|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ee(ri,Dt),Dt|=r;return ft(n,e,s,t),e.child}function Qy(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Kd(n,e,t,r,s){var i=Rt(t)?ws:ut.current;return i=Ri(e,i),ci(e,s),t=Sh(n,e,t,r,i,s),r=Th(),n!==null&&!At?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ur(n,e,s)):(Ie&&r&&ch(e),e.flags|=1,ft(n,e,t,s),e.child)}function Cp(n,e,t,r,s){if(Rt(t)){var i=!0;Ol(e)}else i=!1;if(ci(e,s),e.stateNode===null)ll(n,e),Ky(e,t,r),Vd(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Zt(c):(c=Rt(t)?ws:ut.current,c=Ri(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&bp(e,o,r,c),Rr=!1;var f=e.memoizedState;o.state=f,Ul(e,r,o,s),l=e.memoizedState,a!==r||f!==l||It.current||Rr?(typeof u=="function"&&(Gd(e,t,u,r),l=e.memoizedState),(a=Rr||Tp(e,t,a,r,f,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,wy(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:dn(e.type,a),o.props=c,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Zt(l):(l=Rt(t)?ws:ut.current,l=Ri(e,l));var h=t.getDerivedStateFromProps;(u=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&bp(e,o,r,l),Rr=!1,f=e.memoizedState,o.state=f,Ul(e,r,o,s);var m=e.memoizedState;a!==d||f!==m||It.current||Rr?(typeof h=="function"&&(Gd(e,t,h,r),m=e.memoizedState),(c=Rr||Tp(e,t,c,r,f,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Wd(n,e,t,r,i,s)}function Wd(n,e,t,r,s,i){Qy(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&mp(e,t,!1),ur(n,e,i);r=e.stateNode,uw.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=ki(e,n.child,null,i),e.child=ki(e,null,a,i)):ft(n,e,a,i),e.memoizedState=r.state,s&&mp(e,t,!0),e.child}function Xy(n){var e=n.stateNode;e.pendingContext?hp(n,e.pendingContext,e.pendingContext!==e.context):e.context&&hp(n,e.context,!1),vh(n,e.containerInfo)}function kp(n,e,t,r,s){return Ci(),dh(s),e.flags|=256,ft(n,e,t,r),e.child}var zd={dehydrated:null,treeContext:null,retryLane:0};function Yd(n){return{baseLanes:n,cachePool:null,transitions:null}}function Zy(n,e,t){var r=e.pendingProps,s=ke.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Ee(ke,s&1),n===null)return Ud(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=wc(o,r,0,null),n=Ts(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Yd(t),e.memoizedState=zd,n):Ah(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return dw(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Yr(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Yr(a,i):(i=Ts(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Yd(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=zd,r}return i=n.child,n=i.sibling,r=Yr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Ah(n,e){return e=wc({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function La(n,e,t,r){return r!==null&&dh(r),ki(e,n.child,null,t),n=Ah(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function dw(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=bu(Error(W(422))),La(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=wc({mode:"visible",children:r.children},s,0,null),i=Ts(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ki(e,n.child,null,o),e.child.memoizedState=Yd(o),e.memoizedState=zd,i);if(!(e.mode&1))return La(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(W(419)),r=bu(i,r,void 0),La(n,e,o,r)}if(a=(o&n.childLanes)!==0,At||a){if(r=Je,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,cr(n,s),xn(r,n,s,-1))}return _h(),r=bu(Error(W(421))),La(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=ww.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Ft=Hr(s.nextSibling),Bt=e,Ie=!0,gn=null,n!==null&&(Yt[qt++]=sr,Yt[qt++]=ir,Yt[qt++]=As,sr=n.id,ir=n.overflow,As=e),e=Ah(e,r.children),e.flags|=4096,e)}function _p(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),jd(n.return,e,t)}function wu(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function Jy(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ft(n,e,r.children,t),r=ke.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&_p(n,t,e);else if(n.tag===19)_p(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ee(ke,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&jl(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),wu(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&jl(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}wu(e,!0,t,null,i);break;case"together":wu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ll(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ur(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Is|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(W(153));if(e.child!==null){for(n=e.child,t=Yr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Yr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function fw(n,e,t){switch(e.tag){case 3:Xy(e),Ci();break;case 5:Ay(e);break;case 1:Rt(e.type)&&Ol(e);break;case 4:vh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ee(Bl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ee(ke,ke.current&1),e.flags|=128,null):t&e.child.childLanes?Zy(n,e,t):(Ee(ke,ke.current&1),n=ur(n,e,t),n!==null?n.sibling:null);Ee(ke,ke.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Jy(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ee(ke,ke.current),r)break;return null;case 22:case 23:return e.lanes=0,qy(n,e,t)}return ur(n,e,t)}var ex,qd,tx,nx;ex=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};qd=function(){};tx=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,ms(jn.current);var i=null;switch(t){case"input":s=vd(n,s),r=vd(n,r),i=[];break;case"select":s=Pe({},s,{value:void 0}),r=Pe({},r,{value:void 0}),i=[];break;case"textarea":s=Ed(n,s),r=Ed(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Dl)}Td(t,r);var o;t=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(So.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(So.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Te("scroll",n),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};nx=function(n,e,t,r){t!==r&&(e.flags|=4)};function Xi(n,e){if(!Ie)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function at(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function hw(n,e,t){var r=e.pendingProps;switch(uh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(e),null;case 1:return Rt(e.type)&&Nl(),at(e),null;case 3:return r=e.stateNode,_i(),be(It),be(ut),xh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(wa(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,gn!==null&&(rf(gn),gn=null))),qd(n,e),at(e),null;case 5:yh(e);var s=ms(Do.current);if(t=e.type,n!==null&&e.stateNode!=null)tx(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(W(166));return at(e),null}if(n=ms(jn.current),wa(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[On]=e,r[_o]=i,n=(e.mode&1)!==0,t){case"dialog":Te("cancel",r),Te("close",r);break;case"iframe":case"object":case"embed":Te("load",r);break;case"video":case"audio":for(s=0;s<io.length;s++)Te(io[s],r);break;case"source":Te("error",r);break;case"img":case"image":case"link":Te("error",r),Te("load",r);break;case"details":Te("toggle",r);break;case"input":Um(r,i),Te("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Te("invalid",r);break;case"textarea":Gm(r,i),Te("invalid",r)}Td(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&ba(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&ba(r.textContent,a,n),s=["children",""+a]):So.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Te("scroll",r)}switch(t){case"input":pa(r),jm(r,i,!0);break;case"textarea":pa(r),Vm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Dl)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=kv(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[On]=e,n[_o]=r,ex(n,e,!1,!1),e.stateNode=n;e:{switch(o=bd(t,r),t){case"dialog":Te("cancel",n),Te("close",n),s=r;break;case"iframe":case"object":case"embed":Te("load",n),s=r;break;case"video":case"audio":for(s=0;s<io.length;s++)Te(io[s],n);s=r;break;case"source":Te("error",n),s=r;break;case"img":case"image":case"link":Te("error",n),Te("load",n),s=r;break;case"details":Te("toggle",n),s=r;break;case"input":Um(n,r),s=vd(n,r),Te("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Pe({},r,{value:void 0}),Te("invalid",n);break;case"textarea":Gm(n,r),s=Ed(n,r),Te("invalid",n);break;default:s=r}Td(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Dv(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&_v(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&To(n,l):typeof l=="number"&&To(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(So.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Te("scroll",n):l!=null&&qf(n,i,l,o))}switch(t){case"input":pa(n),jm(n,r,!1);break;case"textarea":pa(n),Vm(n);break;case"option":r.value!=null&&n.setAttribute("value",""+qr(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?ii(n,!!r.multiple,i,!1):r.defaultValue!=null&&ii(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Dl)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return at(e),null;case 6:if(n&&e.stateNode!=null)nx(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(W(166));if(t=ms(Do.current),ms(jn.current),wa(e)){if(r=e.stateNode,t=e.memoizedProps,r[On]=e,(i=r.nodeValue!==t)&&(n=Bt,n!==null))switch(n.tag){case 3:ba(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ba(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[On]=e,e.stateNode=r}return at(e),null;case 13:if(be(ke),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ie&&Ft!==null&&e.mode&1&&!(e.flags&128))Ey(),Ci(),e.flags|=98560,i=!1;else if(i=wa(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(W(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(W(317));i[On]=e}else Ci(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;at(e),i=!1}else gn!==null&&(rf(gn),gn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ke.current&1?ze===0&&(ze=3):_h())),e.updateQueue!==null&&(e.flags|=4),at(e),null);case 4:return _i(),qd(n,e),n===null&&Co(e.stateNode.containerInfo),at(e),null;case 10:return mh(e.type._context),at(e),null;case 17:return Rt(e.type)&&Nl(),at(e),null;case 19:if(be(ke),i=e.memoizedState,i===null)return at(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Xi(i,!1);else{if(ze!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=jl(n),o!==null){for(e.flags|=128,Xi(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ee(ke,ke.current&1|2),e.child}n=n.sibling}i.tail!==null&&Be()>Di&&(e.flags|=128,r=!0,Xi(i,!1),e.lanes=4194304)}else{if(!r)if(n=jl(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Xi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ie)return at(e),null}else 2*Be()-i.renderingStartTime>Di&&t!==1073741824&&(e.flags|=128,r=!0,Xi(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Be(),e.sibling=null,t=ke.current,Ee(ke,r?t&1|2:t&1),e):(at(e),null);case 22:case 23:return kh(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Dt&1073741824&&(at(e),e.subtreeFlags&6&&(e.flags|=8192)):at(e),null;case 24:return null;case 25:return null}throw Error(W(156,e.tag))}function mw(n,e){switch(uh(e),e.tag){case 1:return Rt(e.type)&&Nl(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return _i(),be(It),be(ut),xh(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return yh(e),null;case 13:if(be(ke),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(W(340));Ci()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return be(ke),null;case 4:return _i(),null;case 10:return mh(e.type._context),null;case 22:case 23:return kh(),null;case 24:return null;default:return null}}var Ia=!1,ct=!1,pw=typeof WeakSet=="function"?WeakSet:Set,X=null;function ni(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Oe(n,e,r)}else t.current=null}function Qd(n,e,t){try{t()}catch(r){Oe(n,e,r)}}var Pp=!1;function gw(n,e){if(Dd=kl,n=ay(),lh(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,f=null;t:for(;;){for(var h;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++c===s&&(a=o),f===i&&++u===r&&(l=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Nd={focusedElem:n,selectionRange:t},kl=!1,X=e;X!==null;)if(e=X,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,X=n;else for(;X!==null;){e=X;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var p=m.memoizedProps,g=m.memoizedState,v=e.stateNode,x=v.getSnapshotBeforeUpdate(e.elementType===e.type?p:dn(e.type,p),g);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(W(163))}}catch(T){Oe(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,X=n;break}X=e.return}return m=Pp,Pp=!1,m}function mo(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Qd(e,t,i)}s=s.next}while(s!==r)}}function Tc(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Xd(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function rx(n){var e=n.alternate;e!==null&&(n.alternate=null,rx(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[On],delete e[_o],delete e[Fd],delete e[Zb],delete e[Jb])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function sx(n){return n.tag===5||n.tag===3||n.tag===4}function Dp(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||sx(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Zd(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Dl));else if(r!==4&&(n=n.child,n!==null))for(Zd(n,e,t),n=n.sibling;n!==null;)Zd(n,e,t),n=n.sibling}function Jd(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Jd(n,e,t),n=n.sibling;n!==null;)Jd(n,e,t),n=n.sibling}var et=null,pn=!1;function Er(n,e,t){for(t=t.child;t!==null;)ix(n,e,t),t=t.sibling}function ix(n,e,t){if(Un&&typeof Un.onCommitFiberUnmount=="function")try{Un.onCommitFiberUnmount(mc,t)}catch{}switch(t.tag){case 5:ct||ni(t,e);case 6:var r=et,s=pn;et=null,Er(n,e,t),et=r,pn=s,et!==null&&(pn?(n=et,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):et.removeChild(t.stateNode));break;case 18:et!==null&&(pn?(n=et,t=t.stateNode,n.nodeType===8?vu(n.parentNode,t):n.nodeType===1&&vu(n,t),Lo(n)):vu(et,t.stateNode));break;case 4:r=et,s=pn,et=t.stateNode.containerInfo,pn=!0,Er(n,e,t),et=r,pn=s;break;case 0:case 11:case 14:case 15:if(!ct&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Qd(t,e,o),s=s.next}while(s!==r)}Er(n,e,t);break;case 1:if(!ct&&(ni(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Oe(t,e,a)}Er(n,e,t);break;case 21:Er(n,e,t);break;case 22:t.mode&1?(ct=(r=ct)||t.memoizedState!==null,Er(n,e,t),ct=r):Er(n,e,t);break;default:Er(n,e,t)}}function Np(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new pw),e.forEach(function(r){var s=Aw.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function on(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:et=a.stateNode,pn=!1;break e;case 3:et=a.stateNode.containerInfo,pn=!0;break e;case 4:et=a.stateNode.containerInfo,pn=!0;break e}a=a.return}if(et===null)throw Error(W(160));ix(i,o,s),et=null,pn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){Oe(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ox(e,n),e=e.sibling}function ox(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(on(e,n),Ln(n),r&4){try{mo(3,n,n.return),Tc(3,n)}catch(p){Oe(n,n.return,p)}try{mo(5,n,n.return)}catch(p){Oe(n,n.return,p)}}break;case 1:on(e,n),Ln(n),r&512&&t!==null&&ni(t,t.return);break;case 5:if(on(e,n),Ln(n),r&512&&t!==null&&ni(t,t.return),n.flags&32){var s=n.stateNode;try{To(s,"")}catch(p){Oe(n,n.return,p)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Rv(s,i),bd(a,o);var c=bd(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?Dv(s,d):u==="dangerouslySetInnerHTML"?_v(s,d):u==="children"?To(s,d):qf(s,u,d,c)}switch(a){case"input":yd(s,i);break;case"textarea":Cv(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?ii(s,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?ii(s,!!i.multiple,i.defaultValue,!0):ii(s,!!i.multiple,i.multiple?[]:"",!1))}s[_o]=i}catch(p){Oe(n,n.return,p)}}break;case 6:if(on(e,n),Ln(n),r&4){if(n.stateNode===null)throw Error(W(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(p){Oe(n,n.return,p)}}break;case 3:if(on(e,n),Ln(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Lo(e.containerInfo)}catch(p){Oe(n,n.return,p)}break;case 4:on(e,n),Ln(n);break;case 13:on(e,n),Ln(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Rh=Be())),r&4&&Np(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(ct=(c=ct)||u,on(e,n),ct=c):on(e,n),Ln(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(X=n,u=n.child;u!==null;){for(d=X=u;X!==null;){switch(f=X,h=f.child,f.tag){case 0:case 11:case 14:case 15:mo(4,f,f.return);break;case 1:ni(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(p){Oe(r,t,p)}}break;case 5:ni(f,f.return);break;case 22:if(f.memoizedState!==null){Mp(d);continue}}h!==null?(h.return=f,X=h):Mp(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Pv("display",o))}catch(p){Oe(n,n.return,p)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(p){Oe(n,n.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:on(e,n),Ln(n),r&4&&Np(n);break;case 21:break;default:on(e,n),Ln(n)}}function Ln(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(sx(t)){var r=t;break e}t=t.return}throw Error(W(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(To(s,""),r.flags&=-33);var i=Dp(n);Jd(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Dp(n);Zd(n,a,o);break;default:throw Error(W(161))}}catch(l){Oe(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function vw(n,e,t){X=n,ax(n)}function ax(n,e,t){for(var r=(n.mode&1)!==0;X!==null;){var s=X,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Ia;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ct;a=Ia;var c=ct;if(Ia=o,(ct=l)&&!c)for(X=s;X!==null;)o=X,l=o.child,o.tag===22&&o.memoizedState!==null?Fp(s):l!==null?(l.return=o,X=l):Fp(s);for(;i!==null;)X=i,ax(i),i=i.sibling;X=s,Ia=a,ct=c}Op(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,X=i):Op(n)}}function Op(n){for(;X!==null;){var e=X;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ct||Tc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ct)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:dn(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&xp(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}xp(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Lo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(W(163))}ct||e.flags&512&&Xd(e)}catch(f){Oe(e,e.return,f)}}if(e===n){X=null;break}if(t=e.sibling,t!==null){t.return=e.return,X=t;break}X=e.return}}function Mp(n){for(;X!==null;){var e=X;if(e===n){X=null;break}var t=e.sibling;if(t!==null){t.return=e.return,X=t;break}X=e.return}}function Fp(n){for(;X!==null;){var e=X;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Tc(4,e)}catch(l){Oe(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Oe(e,s,l)}}var i=e.return;try{Xd(e)}catch(l){Oe(e,i,l)}break;case 5:var o=e.return;try{Xd(e)}catch(l){Oe(e,o,l)}}}catch(l){Oe(e,e.return,l)}if(e===n){X=null;break}var a=e.sibling;if(a!==null){a.return=e.return,X=a;break}X=e.return}}var yw=Math.ceil,Hl=mr.ReactCurrentDispatcher,Lh=mr.ReactCurrentOwner,Xt=mr.ReactCurrentBatchConfig,fe=0,Je=null,je=null,nt=0,Dt=0,ri=ns(0),ze=0,Fo=null,Is=0,bc=0,Ih=0,po=null,bt=null,Rh=0,Di=1/0,Jn=null,Kl=!1,ef=null,Wr=null,Ra=!1,$r=null,Wl=0,go=0,tf=null,cl=-1,ul=0;function pt(){return fe&6?Be():cl!==-1?cl:cl=Be()}function zr(n){return n.mode&1?fe&2&&nt!==0?nt&-nt:tw.transition!==null?(ul===0&&(ul=Kv()),ul):(n=pe,n!==0||(n=window.event,n=n===void 0?16:Zv(n.type)),n):1}function xn(n,e,t,r){if(50<go)throw go=0,tf=null,Error(W(185));Zo(n,t,r),(!(fe&2)||n!==Je)&&(n===Je&&(!(fe&2)&&(bc|=t),ze===4&&Pr(n,nt)),Ct(n,r),t===1&&fe===0&&!(e.mode&1)&&(Di=Be()+500,xc&&rs()))}function Ct(n,e){var t=n.callbackNode;tb(n,e);var r=Cl(n,n===Je?nt:0);if(r===0)t!==null&&Wm(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Wm(t),e===1)n.tag===0?ew(Bp.bind(null,n)):vy(Bp.bind(null,n)),Qb(function(){!(fe&6)&&rs()}),t=null;else{switch(Wv(r)){case 1:t=eh;break;case 4:t=Vv;break;case 16:t=Rl;break;case 536870912:t=Hv;break;default:t=Rl}t=px(t,lx.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function lx(n,e){if(cl=-1,ul=0,fe&6)throw Error(W(327));var t=n.callbackNode;if(ui()&&n.callbackNode!==t)return null;var r=Cl(n,n===Je?nt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=zl(n,r);else{e=r;var s=fe;fe|=2;var i=ux();(Je!==n||nt!==e)&&(Jn=null,Di=Be()+500,Ss(n,e));do try{Sw();break}catch(a){cx(n,a)}while(!0);hh(),Hl.current=i,fe=s,je!==null?e=0:(Je=null,nt=0,e=ze)}if(e!==0){if(e===2&&(s=Rd(n),s!==0&&(r=s,e=nf(n,s))),e===1)throw t=Fo,Ss(n,0),Pr(n,r),Ct(n,Be()),t;if(e===6)Pr(n,r);else{if(s=n.current.alternate,!(r&30)&&!xw(s)&&(e=zl(n,r),e===2&&(i=Rd(n),i!==0&&(r=i,e=nf(n,i))),e===1))throw t=Fo,Ss(n,0),Pr(n,r),Ct(n,Be()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(W(345));case 2:us(n,bt,Jn);break;case 3:if(Pr(n,r),(r&130023424)===r&&(e=Rh+500-Be(),10<e)){if(Cl(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){pt(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Md(us.bind(null,n,bt,Jn),e);break}us(n,bt,Jn);break;case 4:if(Pr(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-yn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Be()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yw(r/1960))-r,10<r){n.timeoutHandle=Md(us.bind(null,n,bt,Jn),r);break}us(n,bt,Jn);break;case 5:us(n,bt,Jn);break;default:throw Error(W(329))}}}return Ct(n,Be()),n.callbackNode===t?lx.bind(null,n):null}function nf(n,e){var t=po;return n.current.memoizedState.isDehydrated&&(Ss(n,e).flags|=256),n=zl(n,e),n!==2&&(e=bt,bt=t,e!==null&&rf(e)),n}function rf(n){bt===null?bt=n:bt.push.apply(bt,n)}function xw(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!En(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Pr(n,e){for(e&=~Ih,e&=~bc,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-yn(e),r=1<<t;n[t]=-1,e&=~r}}function Bp(n){if(fe&6)throw Error(W(327));ui();var e=Cl(n,0);if(!(e&1))return Ct(n,Be()),null;var t=zl(n,e);if(n.tag!==0&&t===2){var r=Rd(n);r!==0&&(e=r,t=nf(n,r))}if(t===1)throw t=Fo,Ss(n,0),Pr(n,e),Ct(n,Be()),t;if(t===6)throw Error(W(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,us(n,bt,Jn),Ct(n,Be()),null}function Ch(n,e){var t=fe;fe|=1;try{return n(e)}finally{fe=t,fe===0&&(Di=Be()+500,xc&&rs())}}function Rs(n){$r!==null&&$r.tag===0&&!(fe&6)&&ui();var e=fe;fe|=1;var t=Xt.transition,r=pe;try{if(Xt.transition=null,pe=1,n)return n()}finally{pe=r,Xt.transition=t,fe=e,!(fe&6)&&rs()}}function kh(){Dt=ri.current,be(ri)}function Ss(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,qb(t)),je!==null)for(t=je.return;t!==null;){var r=t;switch(uh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Nl();break;case 3:_i(),be(It),be(ut),xh();break;case 5:yh(r);break;case 4:_i();break;case 13:be(ke);break;case 19:be(ke);break;case 10:mh(r.type._context);break;case 22:case 23:kh()}t=t.return}if(Je=n,je=n=Yr(n.current,null),nt=Dt=e,ze=0,Fo=null,Ih=bc=Is=0,bt=po=null,hs!==null){for(e=0;e<hs.length;e++)if(t=hs[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}hs=null}return n}function cx(n,e){do{var t=je;try{if(hh(),ol.current=Vl,Gl){for(var r=_e.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Gl=!1}if(Ls=0,Ze=Ke=_e=null,ho=!1,No=0,Lh.current=null,t===null||t.return===null){ze=1,Fo=e,je=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=nt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var h=Ap(o);if(h!==null){h.flags&=-257,Lp(h,o,a,i,e),h.mode&1&&wp(i,c,e),e=h,l=c;var m=e.updateQueue;if(m===null){var p=new Set;p.add(l),e.updateQueue=p}else m.add(l);break e}else{if(!(e&1)){wp(i,c,e),_h();break e}l=Error(W(426))}}else if(Ie&&a.mode&1){var g=Ap(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Lp(g,o,a,i,e),dh(Pi(l,a));break e}}i=l=Pi(l,a),ze!==4&&(ze=2),po===null?po=[i]:po.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=Wy(i,l,e);yp(i,v);break e;case 1:a=l;var x=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Wr===null||!Wr.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=zy(i,a,e);yp(i,T);break e}}i=i.return}while(i!==null)}fx(t)}catch(b){e=b,je===t&&t!==null&&(je=t=t.return);continue}break}while(!0)}function ux(){var n=Hl.current;return Hl.current=Vl,n===null?Vl:n}function _h(){(ze===0||ze===3||ze===2)&&(ze=4),Je===null||!(Is&268435455)&&!(bc&268435455)||Pr(Je,nt)}function zl(n,e){var t=fe;fe|=2;var r=ux();(Je!==n||nt!==e)&&(Jn=null,Ss(n,e));do try{Ew();break}catch(s){cx(n,s)}while(!0);if(hh(),fe=t,Hl.current=r,je!==null)throw Error(W(261));return Je=null,nt=0,ze}function Ew(){for(;je!==null;)dx(je)}function Sw(){for(;je!==null&&!W1();)dx(je)}function dx(n){var e=mx(n.alternate,n,Dt);n.memoizedProps=n.pendingProps,e===null?fx(n):je=e,Lh.current=null}function fx(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=mw(t,e),t!==null){t.flags&=32767,je=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ze=6,je=null;return}}else if(t=hw(t,e,Dt),t!==null){je=t;return}if(e=e.sibling,e!==null){je=e;return}je=e=n}while(e!==null);ze===0&&(ze=5)}function us(n,e,t){var r=pe,s=Xt.transition;try{Xt.transition=null,pe=1,Tw(n,e,t,r)}finally{Xt.transition=s,pe=r}return null}function Tw(n,e,t,r){do ui();while($r!==null);if(fe&6)throw Error(W(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(W(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(nb(n,i),n===Je&&(je=Je=null,nt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Ra||(Ra=!0,px(Rl,function(){return ui(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Xt.transition,Xt.transition=null;var o=pe;pe=1;var a=fe;fe|=4,Lh.current=null,gw(n,t),ox(t,n),Gb(Nd),kl=!!Dd,Nd=Dd=null,n.current=t,vw(t),z1(),fe=a,pe=o,Xt.transition=i}else n.current=t;if(Ra&&(Ra=!1,$r=n,Wl=s),i=n.pendingLanes,i===0&&(Wr=null),Q1(t.stateNode),Ct(n,Be()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Kl)throw Kl=!1,n=ef,ef=null,n;return Wl&1&&n.tag!==0&&ui(),i=n.pendingLanes,i&1?n===tf?go++:(go=0,tf=n):go=0,rs(),null}function ui(){if($r!==null){var n=Wv(Wl),e=Xt.transition,t=pe;try{if(Xt.transition=null,pe=16>n?16:n,$r===null)var r=!1;else{if(n=$r,$r=null,Wl=0,fe&6)throw Error(W(331));var s=fe;for(fe|=4,X=n.current;X!==null;){var i=X,o=i.child;if(X.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(X=c;X!==null;){var u=X;switch(u.tag){case 0:case 11:case 15:mo(8,u,i)}var d=u.child;if(d!==null)d.return=u,X=d;else for(;X!==null;){u=X;var f=u.sibling,h=u.return;if(rx(u),u===c){X=null;break}if(f!==null){f.return=h,X=f;break}X=h}}}var m=i.alternate;if(m!==null){var p=m.child;if(p!==null){m.child=null;do{var g=p.sibling;p.sibling=null,p=g}while(p!==null)}}X=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,X=o;else e:for(;X!==null;){if(i=X,i.flags&2048)switch(i.tag){case 0:case 11:case 15:mo(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,X=v;break e}X=i.return}}var x=n.current;for(X=x;X!==null;){o=X;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,X=E;else e:for(o=x;X!==null;){if(a=X,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Tc(9,a)}}catch(b){Oe(a,a.return,b)}if(a===o){X=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,X=T;break e}X=a.return}}if(fe=s,rs(),Un&&typeof Un.onPostCommitFiberRoot=="function")try{Un.onPostCommitFiberRoot(mc,n)}catch{}r=!0}return r}finally{pe=t,Xt.transition=e}}return!1}function $p(n,e,t){e=Pi(t,e),e=Wy(n,e,1),n=Kr(n,e,1),e=pt(),n!==null&&(Zo(n,1,e),Ct(n,e))}function Oe(n,e,t){if(n.tag===3)$p(n,n,t);else for(;e!==null;){if(e.tag===3){$p(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Wr===null||!Wr.has(r))){n=Pi(t,n),n=zy(e,n,1),e=Kr(e,n,1),n=pt(),e!==null&&(Zo(e,1,n),Ct(e,n));break}}e=e.return}}function bw(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=pt(),n.pingedLanes|=n.suspendedLanes&t,Je===n&&(nt&t)===t&&(ze===4||ze===3&&(nt&130023424)===nt&&500>Be()-Rh?Ss(n,0):Ih|=t),Ct(n,e)}function hx(n,e){e===0&&(n.mode&1?(e=ya,ya<<=1,!(ya&130023424)&&(ya=4194304)):e=1);var t=pt();n=cr(n,e),n!==null&&(Zo(n,e,t),Ct(n,t))}function ww(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),hx(n,t)}function Aw(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(W(314))}r!==null&&r.delete(e),hx(n,t)}var mx;mx=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||It.current)At=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return At=!1,fw(n,e,t);At=!!(n.flags&131072)}else At=!1,Ie&&e.flags&1048576&&yy(e,Fl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ll(n,e),n=e.pendingProps;var s=Ri(e,ut.current);ci(e,t),s=Sh(null,e,r,n,s,t);var i=Th();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Rt(r)?(i=!0,Ol(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,gh(e),s.updater=Sc,e.stateNode=s,s._reactInternals=e,Vd(e,r,n,t),e=Wd(null,e,r,!0,i,t)):(e.tag=0,Ie&&i&&ch(e),ft(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(ll(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Iw(r),n=dn(r,n),s){case 0:e=Kd(null,e,r,n,t);break e;case 1:e=Cp(null,e,r,n,t);break e;case 11:e=Ip(null,e,r,n,t);break e;case 14:e=Rp(null,e,r,dn(r.type,n),t);break e}throw Error(W(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:dn(r,s),Kd(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:dn(r,s),Cp(n,e,r,s,t);case 3:e:{if(Xy(e),n===null)throw Error(W(387));r=e.pendingProps,i=e.memoizedState,s=i.element,wy(n,e),Ul(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Pi(Error(W(423)),e),e=kp(n,e,r,t,s);break e}else if(r!==s){s=Pi(Error(W(424)),e),e=kp(n,e,r,t,s);break e}else for(Ft=Hr(e.stateNode.containerInfo.firstChild),Bt=e,Ie=!0,gn=null,t=Ty(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ci(),r===s){e=ur(n,e,t);break e}ft(n,e,r,t)}e=e.child}return e;case 5:return Ay(e),n===null&&Ud(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,Od(r,s)?o=null:i!==null&&Od(r,i)&&(e.flags|=32),Qy(n,e),ft(n,e,o,t),e.child;case 6:return n===null&&Ud(e),null;case 13:return Zy(n,e,t);case 4:return vh(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ki(e,null,r,t):ft(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:dn(r,s),Ip(n,e,r,s,t);case 7:return ft(n,e,e.pendingProps,t),e.child;case 8:return ft(n,e,e.pendingProps.children,t),e.child;case 12:return ft(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ee(Bl,r._currentValue),r._currentValue=o,i!==null)if(En(i.value,o)){if(i.children===s.children&&!It.current){e=ur(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=or(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),jd(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(W(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),jd(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ft(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ci(e,t),s=Zt(s),r=r(s),e.flags|=1,ft(n,e,r,t),e.child;case 14:return r=e.type,s=dn(r,e.pendingProps),s=dn(r.type,s),Rp(n,e,r,s,t);case 15:return Yy(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:dn(r,s),ll(n,e),e.tag=1,Rt(r)?(n=!0,Ol(e)):n=!1,ci(e,t),Ky(e,r,s),Vd(e,r,s,t),Wd(null,e,r,!0,n,t);case 19:return Jy(n,e,t);case 22:return qy(n,e,t)}throw Error(W(156,e.tag))};function px(n,e){return Gv(n,e)}function Lw(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(n,e,t,r){return new Lw(n,e,t,r)}function Ph(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Iw(n){if(typeof n=="function")return Ph(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Xf)return 11;if(n===Zf)return 14}return 2}function Yr(n,e){var t=n.alternate;return t===null?(t=Qt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function dl(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")Ph(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case zs:return Ts(t.children,s,i,e);case Qf:o=8,s|=8;break;case hd:return n=Qt(12,t,e,s|2),n.elementType=hd,n.lanes=i,n;case md:return n=Qt(13,t,e,s),n.elementType=md,n.lanes=i,n;case pd:return n=Qt(19,t,e,s),n.elementType=pd,n.lanes=i,n;case Av:return wc(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case bv:o=10;break e;case wv:o=9;break e;case Xf:o=11;break e;case Zf:o=14;break e;case Ir:o=16,r=null;break e}throw Error(W(130,n==null?n:typeof n,""))}return e=Qt(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Ts(n,e,t,r){return n=Qt(7,n,r,e),n.lanes=t,n}function wc(n,e,t,r){return n=Qt(22,n,r,e),n.elementType=Av,n.lanes=t,n.stateNode={isHidden:!1},n}function Au(n,e,t){return n=Qt(6,n,null,e),n.lanes=t,n}function Lu(n,e,t){return e=Qt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Rw(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ou(0),this.expirationTimes=ou(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ou(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Dh(n,e,t,r,s,i,o,a,l){return n=new Rw(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Qt(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},gh(i),n}function Cw(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ws,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function gx(n){if(!n)return Qr;n=n._reactInternals;e:{if(Ds(n)!==n||n.tag!==1)throw Error(W(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Rt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(W(171))}if(n.tag===1){var t=n.type;if(Rt(t))return gy(n,t,e)}return e}function vx(n,e,t,r,s,i,o,a,l){return n=Dh(t,r,!0,n,s,i,o,a,l),n.context=gx(null),t=n.current,r=pt(),s=zr(t),i=or(r,s),i.callback=e??null,Kr(t,i,s),n.current.lanes=s,Zo(n,s,r),Ct(n,r),n}function Ac(n,e,t,r){var s=e.current,i=pt(),o=zr(s);return t=gx(t),e.context===null?e.context=t:e.pendingContext=t,e=or(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Kr(s,e,o),n!==null&&(xn(n,s,o,i),il(n,s,o)),o}function Yl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Up(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Nh(n,e){Up(n,e),(n=n.alternate)&&Up(n,e)}function kw(){return null}var yx=typeof reportError=="function"?reportError:function(n){console.error(n)};function Oh(n){this._internalRoot=n}Lc.prototype.render=Oh.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(W(409));Ac(n,e,null,null)};Lc.prototype.unmount=Oh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Rs(function(){Ac(null,n,null,null)}),e[lr]=null}};function Lc(n){this._internalRoot=n}Lc.prototype.unstable_scheduleHydration=function(n){if(n){var e=qv();n={blockedOn:null,target:n,priority:e};for(var t=0;t<_r.length&&e!==0&&e<_r[t].priority;t++);_r.splice(t,0,n),t===0&&Xv(n)}};function Mh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Ic(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function jp(){}function _w(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=Yl(o);i.call(c)}}var o=vx(e,r,n,0,null,!1,!1,"",jp);return n._reactRootContainer=o,n[lr]=o.current,Co(n.nodeType===8?n.parentNode:n),Rs(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=Yl(l);a.call(c)}}var l=Dh(n,0,!1,null,null,!1,!1,"",jp);return n._reactRootContainer=l,n[lr]=l.current,Co(n.nodeType===8?n.parentNode:n),Rs(function(){Ac(e,l,t,r)}),l}function Rc(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Yl(o);a.call(l)}}Ac(e,o,n,s)}else o=_w(t,e,n,s,r);return Yl(o)}zv=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=so(e.pendingLanes);t!==0&&(th(e,t|1),Ct(e,Be()),!(fe&6)&&(Di=Be()+500,rs()))}break;case 13:Rs(function(){var r=cr(n,1);if(r!==null){var s=pt();xn(r,n,1,s)}}),Nh(n,1)}};nh=function(n){if(n.tag===13){var e=cr(n,134217728);if(e!==null){var t=pt();xn(e,n,134217728,t)}Nh(n,134217728)}};Yv=function(n){if(n.tag===13){var e=zr(n),t=cr(n,e);if(t!==null){var r=pt();xn(t,n,e,r)}Nh(n,e)}};qv=function(){return pe};Qv=function(n,e){var t=pe;try{return pe=n,e()}finally{pe=t}};Ad=function(n,e,t){switch(e){case"input":if(yd(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=yc(r);if(!s)throw Error(W(90));Iv(r),yd(r,s)}}}break;case"textarea":Cv(n,t);break;case"select":e=t.value,e!=null&&ii(n,!!t.multiple,e,!1)}};Mv=Ch;Fv=Rs;var Pw={usingClientEntryPoint:!1,Events:[ea,Xs,yc,Nv,Ov,Ch]},Zi={findFiberByHostInstance:fs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Dw={bundleType:Zi.bundleType,version:Zi.version,rendererPackageName:Zi.rendererPackageName,rendererConfig:Zi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Uv(n),n===null?null:n.stateNode},findFiberByHostInstance:Zi.findFiberByHostInstance||kw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ca=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ca.isDisabled&&Ca.supportsFiber)try{mc=Ca.inject(Dw),Un=Ca}catch{}}Gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pw;Gt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Mh(e))throw Error(W(200));return Cw(n,e,null,t)};Gt.createRoot=function(n,e){if(!Mh(n))throw Error(W(299));var t=!1,r="",s=yx;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Dh(n,1,!1,null,null,t,!1,r,s),n[lr]=e.current,Co(n.nodeType===8?n.parentNode:n),new Oh(e)};Gt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(W(188)):(n=Object.keys(n).join(","),Error(W(268,n)));return n=Uv(e),n=n===null?null:n.stateNode,n};Gt.flushSync=function(n){return Rs(n)};Gt.hydrate=function(n,e,t){if(!Ic(e))throw Error(W(200));return Rc(null,n,e,!0,t)};Gt.hydrateRoot=function(n,e,t){if(!Mh(n))throw Error(W(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=yx;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=vx(e,null,n,1,t??null,s,!1,i,o),n[lr]=e.current,Co(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Lc(e)};Gt.render=function(n,e,t){if(!Ic(e))throw Error(W(200));return Rc(null,n,e,!1,t)};Gt.unmountComponentAtNode=function(n){if(!Ic(n))throw Error(W(40));return n._reactRootContainer?(Rs(function(){Rc(null,null,n,!1,function(){n._reactRootContainer=null,n[lr]=null})}),!0):!1};Gt.unstable_batchedUpdates=Ch;Gt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Ic(t))throw Error(W(200));if(n==null||n._reactInternals===void 0)throw Error(W(38));return Rc(n,e,t,!1,r)};Gt.version="18.3.1-next-f1338f8080-20240426";function xx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(xx)}catch(n){console.error(n)}}xx(),xv.exports=Gt;var na=xv.exports;const Ex=av(na);var Sx,Gp=na;Sx=Gp.createRoot,Gp.hydrateRoot;const Nw=1,Ow=1e6;let Iu=0;function Mw(){return Iu=(Iu+1)%Number.MAX_SAFE_INTEGER,Iu.toString()}const Ru=new Map,Vp=n=>{if(Ru.has(n))return;const e=setTimeout(()=>{Ru.delete(n),vo({type:"REMOVE_TOAST",toastId:n})},Ow);Ru.set(n,e)},Fw=(n,e)=>{switch(e.type){case"ADD_TOAST":return{...n,toasts:[e.toast,...n.toasts].slice(0,Nw)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?Vp(t):n.toasts.forEach(r=>{Vp(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==e.toastId)}}},fl=[];let hl={toasts:[]};function vo(n){hl=Fw(hl,n),fl.forEach(e=>{e(hl)})}function Bw({...n}){const e=Mw(),t=s=>vo({type:"UPDATE_TOAST",toast:{...s,id:e}}),r=()=>vo({type:"DISMISS_TOAST",toastId:e});return vo({type:"ADD_TOAST",toast:{...n,id:e,open:!0,onOpenChange:s=>{s||r()}}}),{id:e,dismiss:r,update:t}}function $w(){const[n,e]=w.useState(hl);return w.useEffect(()=>(fl.push(e),()=>{const t=fl.indexOf(e);t>-1&&fl.splice(t,1)}),[n]),{...n,toast:Bw,dismiss:t=>vo({type:"DISMISS_TOAST",toastId:t})}}function Re(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n==null||n(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function Hp(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Tx(...n){return e=>{let t=!1;const r=n.map(s=>{const i=Hp(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():Hp(n[s],null)}}}}function gt(...n){return w.useCallback(Tx(...n),n)}function Uw(n,e){const t=w.createContext(e),r=i=>{const{children:o,...a}=i,l=w.useMemo(()=>a,Object.values(a));return y.jsx(t.Provider,{value:l,children:o})};r.displayName=n+"Provider";function s(i){const o=w.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${n}\``)}return[r,s]}function ra(n,e=[]){let t=[];function r(i,o){const a=w.createContext(o),l=t.length;t=[...t,o];const c=d=>{var v;const{scope:f,children:h,...m}=d,p=((v=f==null?void 0:f[n])==null?void 0:v[l])||a,g=w.useMemo(()=>m,Object.values(m));return y.jsx(p.Provider,{value:g,children:h})};c.displayName=i+"Provider";function u(d,f){var p;const h=((p=f==null?void 0:f[n])==null?void 0:p[l])||a,m=w.useContext(h);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[c,u]}const s=()=>{const i=t.map(o=>w.createContext(o));return function(a){const l=(a==null?void 0:a[n])||i;return w.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return s.scopeName=n,[r,jw(s,...e)]}function jw(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return w.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Bo(n){const e=Vw(n),t=w.forwardRef((r,s)=>{const{children:i,...o}=r,a=w.Children.toArray(i),l=a.find(Kw);if(l){const c=l.props.children,u=a.map(d=>d===l?w.Children.count(c)>1?w.Children.only(null):w.isValidElement(c)?c.props.children:null:d);return y.jsx(e,{...o,ref:s,children:w.isValidElement(c)?w.cloneElement(c,void 0,u):null})}return y.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${n}.Slot`,t}var Gw=Bo("Slot");function Vw(n){const e=w.forwardRef((t,r)=>{const{children:s,...i}=t;if(w.isValidElement(s)){const o=zw(s),a=Ww(i,s.props);return s.type!==w.Fragment&&(a.ref=r?Tx(r,o):o),w.cloneElement(s,a)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var bx=Symbol("radix.slottable");function Hw(n){const e=({children:t})=>y.jsx(y.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=bx,e}function Kw(n){return w.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===bx}function Ww(n,e){const t={...e};for(const r in e){const s=n[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?t[r]=(...a)=>{const l=i(...a);return s(...a),l}:s&&(t[r]=s):r==="style"?t[r]={...s,...i}:r==="className"&&(t[r]=[s,i].filter(Boolean).join(" "))}return{...n,...t}}function zw(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Yw(n){const e=n+"CollectionProvider",[t,r]=ra(e),[s,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=p=>{const{scope:g,children:v}=p,x=z.useRef(null),E=z.useRef(new Map).current;return y.jsx(s,{scope:g,itemMap:E,collectionRef:x,children:v})};o.displayName=e;const a=n+"CollectionSlot",l=Bo(a),c=z.forwardRef((p,g)=>{const{scope:v,children:x}=p,E=i(a,v),T=gt(g,E.collectionRef);return y.jsx(l,{ref:T,children:x})});c.displayName=a;const u=n+"CollectionItemSlot",d="data-radix-collection-item",f=Bo(u),h=z.forwardRef((p,g)=>{const{scope:v,children:x,...E}=p,T=z.useRef(null),b=gt(g,T),L=i(u,v);return z.useEffect(()=>(L.itemMap.set(T,{ref:T,...E}),()=>void L.itemMap.delete(T))),y.jsx(f,{[d]:"",ref:b,children:x})});h.displayName=u;function m(p){const g=i(n+"CollectionConsumer",p);return z.useCallback(()=>{const x=g.collectionRef.current;if(!x)return[];const E=Array.from(x.querySelectorAll(`[${d}]`));return Array.from(g.itemMap.values()).sort((L,A)=>E.indexOf(L.ref.current)-E.indexOf(A.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},m,r]}var qw=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ge=qw.reduce((n,e)=>{const t=Bo(`Primitive.${e}`),r=w.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),y.jsx(l,{...a,ref:i})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function wx(n,e){n&&na.flushSync(()=>n.dispatchEvent(e))}function Vn(n){const e=w.useRef(n);return w.useEffect(()=>{e.current=n}),w.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function Qw(n,e=globalThis==null?void 0:globalThis.document){const t=Vn(n);w.useEffect(()=>{const r=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var Xw="DismissableLayer",sf="dismissableLayer.update",Zw="dismissableLayer.pointerDownOutside",Jw="dismissableLayer.focusOutside",Kp,Ax=w.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Cc=w.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=n,c=w.useContext(Ax),[u,d]=w.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,h]=w.useState({}),m=gt(e,A=>d(A)),p=Array.from(c.layers),[g]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),v=p.indexOf(g),x=u?p.indexOf(u):-1,E=c.layersWithOutsidePointerEventsDisabled.size>0,T=x>=v,b=tA(A=>{const I=A.target,C=[...c.branches].some(R=>R.contains(I));!T||C||(s==null||s(A),o==null||o(A),A.defaultPrevented||a==null||a())},f),L=nA(A=>{const I=A.target;[...c.branches].some(R=>R.contains(I))||(i==null||i(A),o==null||o(A),A.defaultPrevented||a==null||a())},f);return Qw(A=>{x===c.layers.size-1&&(r==null||r(A),!A.defaultPrevented&&a&&(A.preventDefault(),a()))},f),w.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Kp=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Wp(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Kp)}},[u,f,t,c]),w.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Wp())},[u,c]),w.useEffect(()=>{const A=()=>h({});return document.addEventListener(sf,A),()=>document.removeEventListener(sf,A)},[]),y.jsx(Ge.div,{...l,ref:m,style:{pointerEvents:E?T?"auto":"none":void 0,...n.style},onFocusCapture:Re(n.onFocusCapture,L.onFocusCapture),onBlurCapture:Re(n.onBlurCapture,L.onBlurCapture),onPointerDownCapture:Re(n.onPointerDownCapture,b.onPointerDownCapture)})});Cc.displayName=Xw;var eA="DismissableLayerBranch",Lx=w.forwardRef((n,e)=>{const t=w.useContext(Ax),r=w.useRef(null),s=gt(e,r);return w.useEffect(()=>{const i=r.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),y.jsx(Ge.div,{...n,ref:s})});Lx.displayName=eA;function tA(n,e=globalThis==null?void 0:globalThis.document){const t=Vn(n),r=w.useRef(!1),s=w.useRef(()=>{});return w.useEffect(()=>{const i=a=>{if(a.target&&!r.current){let l=function(){Ix(Zw,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function nA(n,e=globalThis==null?void 0:globalThis.document){const t=Vn(n),r=w.useRef(!1);return w.useEffect(()=>{const s=i=>{i.target&&!r.current&&Ix(Jw,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Wp(){const n=new CustomEvent(sf);document.dispatchEvent(n)}function Ix(n,e,t,{discrete:r}){const s=t.originalEvent.target,i=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?wx(s,i):s.dispatchEvent(i)}var rA=Cc,sA=Lx,dr=globalThis!=null&&globalThis.document?w.useLayoutEffect:()=>{},iA="Portal",Fh=w.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[s,i]=w.useState(!1);dr(()=>i(!0),[]);const o=t||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?Ex.createPortal(y.jsx(Ge.div,{...r,ref:e}),o):null});Fh.displayName=iA;function oA(n,e){return w.useReducer((t,r)=>e[t][r]??t,n)}var ji=n=>{const{present:e,children:t}=n,r=aA(e),s=typeof t=="function"?t({present:r.isPresent}):w.Children.only(t),i=gt(r.ref,lA(s));return typeof t=="function"||r.isPresent?w.cloneElement(s,{ref:i}):null};ji.displayName="Presence";function aA(n){const[e,t]=w.useState(),r=w.useRef(null),s=w.useRef(n),i=w.useRef("none"),o=n?"mounted":"unmounted",[a,l]=oA(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return w.useEffect(()=>{const c=ka(r.current);i.current=a==="mounted"?c:"none"},[a]),dr(()=>{const c=r.current,u=s.current;if(u!==n){const f=i.current,h=ka(c);n?l("MOUNT"):h==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&f!==h?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,l]),dr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=h=>{const p=ka(r.current).includes(h.animationName);if(h.target===e&&p&&(l("ANIMATION_END"),!s.current)){const g=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=g)})}},f=h=>{h.target===e&&(i.current=ka(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:w.useCallback(c=>{r.current=c?getComputedStyle(c):null,t(c)},[])}}function ka(n){return(n==null?void 0:n.animationName)||"none"}function lA(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var cA=Wf[" useInsertionEffect ".trim().toString()]||dr;function Rx({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[s,i,o]=uA({defaultProp:e,onChange:t}),a=n!==void 0,l=a?n:s;{const u=w.useRef(n!==void 0);w.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=w.useCallback(u=>{var d;if(a){const f=dA(u)?u(n):u;f!==n&&((d=o.current)==null||d.call(o,f))}else i(u)},[a,n,i,o]);return[l,c]}function uA({defaultProp:n,onChange:e}){const[t,r]=w.useState(n),s=w.useRef(t),i=w.useRef(e);return cA(()=>{i.current=e},[e]),w.useEffect(()=>{var o;s.current!==t&&((o=i.current)==null||o.call(i,t),s.current=t)},[t,s]),[t,r,i]}function dA(n){return typeof n=="function"}var fA=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),hA="VisuallyHidden",kc=w.forwardRef((n,e)=>y.jsx(Ge.span,{...n,ref:e,style:{...fA,...n.style}}));kc.displayName=hA;var mA=kc,Bh="ToastProvider",[$h,pA,gA]=Yw("Toast"),[Cx,$O]=ra("Toast",[gA]),[vA,_c]=Cx(Bh),kx=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:o}=n,[a,l]=w.useState(null),[c,u]=w.useState(0),d=w.useRef(!1),f=w.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${Bh}\`. Expected non-empty \`string\`.`),y.jsx($h.Provider,{scope:e,children:y.jsx(vA,{scope:e,label:t,duration:r,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:w.useCallback(()=>u(h=>h+1),[]),onToastRemove:w.useCallback(()=>u(h=>h-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:f,children:o})})};kx.displayName=Bh;var _x="ToastViewport",yA=["F8"],of="toast.viewportPause",af="toast.viewportResume",Px=w.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=yA,label:s="Notifications ({hotkey})",...i}=n,o=_c(_x,t),a=pA(t),l=w.useRef(null),c=w.useRef(null),u=w.useRef(null),d=w.useRef(null),f=gt(e,d,o.onViewportChange),h=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=o.toastCount>0;w.useEffect(()=>{const g=v=>{var E;r.length!==0&&r.every(T=>v[T]||v.code===T)&&((E=d.current)==null||E.focus())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[r]),w.useEffect(()=>{const g=l.current,v=d.current;if(m&&g&&v){const x=()=>{if(!o.isClosePausedRef.current){const L=new CustomEvent(of);v.dispatchEvent(L),o.isClosePausedRef.current=!0}},E=()=>{if(o.isClosePausedRef.current){const L=new CustomEvent(af);v.dispatchEvent(L),o.isClosePausedRef.current=!1}},T=L=>{!g.contains(L.relatedTarget)&&E()},b=()=>{g.contains(document.activeElement)||E()};return g.addEventListener("focusin",x),g.addEventListener("focusout",T),g.addEventListener("pointermove",x),g.addEventListener("pointerleave",b),window.addEventListener("blur",x),window.addEventListener("focus",E),()=>{g.removeEventListener("focusin",x),g.removeEventListener("focusout",T),g.removeEventListener("pointermove",x),g.removeEventListener("pointerleave",b),window.removeEventListener("blur",x),window.removeEventListener("focus",E)}}},[m,o.isClosePausedRef]);const p=w.useCallback(({tabbingDirection:g})=>{const x=a().map(E=>{const T=E.ref.current,b=[T,..._A(T)];return g==="forwards"?b:b.reverse()});return(g==="forwards"?x.reverse():x).flat()},[a]);return w.useEffect(()=>{const g=d.current;if(g){const v=x=>{var b,L,A;const E=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!E){const I=document.activeElement,C=x.shiftKey;if(x.target===g&&C){(b=c.current)==null||b.focus();return}const O=p({tabbingDirection:C?"backwards":"forwards"}),V=O.findIndex(M=>M===I);Cu(O.slice(V+1))?x.preventDefault():C?(L=c.current)==null||L.focus():(A=u.current)==null||A.focus()}};return g.addEventListener("keydown",v),()=>g.removeEventListener("keydown",v)}},[a,p]),y.jsxs(sA,{ref:l,role:"region","aria-label":s.replace("{hotkey}",h),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&y.jsx(lf,{ref:c,onFocusFromOutsideViewport:()=>{const g=p({tabbingDirection:"forwards"});Cu(g)}}),y.jsx($h.Slot,{scope:t,children:y.jsx(Ge.ol,{tabIndex:-1,...i,ref:f})}),m&&y.jsx(lf,{ref:u,onFocusFromOutsideViewport:()=>{const g=p({tabbingDirection:"backwards"});Cu(g)}})]})});Px.displayName=_x;var Dx="ToastFocusProxy",lf=w.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...s}=n,i=_c(Dx,t);return y.jsx(kc,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&r()}})});lf.displayName=Dx;var sa="Toast",xA="toast.swipeStart",EA="toast.swipeMove",SA="toast.swipeCancel",TA="toast.swipeEnd",Nx=w.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:s,onOpenChange:i,...o}=n,[a,l]=Rx({prop:r,defaultProp:s??!0,onChange:i,caller:sa});return y.jsx(ji,{present:t||a,children:y.jsx(AA,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:Vn(n.onPause),onResume:Vn(n.onResume),onSwipeStart:Re(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Re(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Re(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Re(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});Nx.displayName=sa;var[bA,wA]=Cx(sa,{onClose(){}}),AA=w.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:s,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:f,onSwipeEnd:h,...m}=n,p=_c(sa,t),[g,v]=w.useState(null),x=gt(e,M=>v(M)),E=w.useRef(null),T=w.useRef(null),b=s||p.duration,L=w.useRef(0),A=w.useRef(b),I=w.useRef(0),{onToastAdd:C,onToastRemove:R}=p,_=Vn(()=>{var K;(g==null?void 0:g.contains(document.activeElement))&&((K=p.viewport)==null||K.focus()),o()}),O=w.useCallback(M=>{!M||M===1/0||(window.clearTimeout(I.current),L.current=new Date().getTime(),I.current=window.setTimeout(_,M))},[_]);w.useEffect(()=>{const M=p.viewport;if(M){const K=()=>{O(A.current),c==null||c()},B=()=>{const H=new Date().getTime()-L.current;A.current=A.current-H,window.clearTimeout(I.current),l==null||l()};return M.addEventListener(of,B),M.addEventListener(af,K),()=>{M.removeEventListener(of,B),M.removeEventListener(af,K)}}},[p.viewport,b,l,c,O]),w.useEffect(()=>{i&&!p.isClosePausedRef.current&&O(b)},[i,b,p.isClosePausedRef,O]),w.useEffect(()=>(C(),()=>R()),[C,R]);const V=w.useMemo(()=>g?jx(g):null,[g]);return p.viewport?y.jsxs(y.Fragment,{children:[V&&y.jsx(LA,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:V}),y.jsx(bA,{scope:t,onClose:_,children:na.createPortal(y.jsx($h.ItemSlot,{scope:t,children:y.jsx(rA,{asChild:!0,onEscapeKeyDown:Re(a,()=>{p.isFocusedToastEscapeKeyDownRef.current||_(),p.isFocusedToastEscapeKeyDownRef.current=!1}),children:y.jsx(Ge.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":p.swipeDirection,...m,ref:x,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:Re(n.onKeyDown,M=>{M.key==="Escape"&&(a==null||a(M.nativeEvent),M.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,_()))}),onPointerDown:Re(n.onPointerDown,M=>{M.button===0&&(E.current={x:M.clientX,y:M.clientY})}),onPointerMove:Re(n.onPointerMove,M=>{if(!E.current)return;const K=M.clientX-E.current.x,B=M.clientY-E.current.y,H=!!T.current,k=["left","right"].includes(p.swipeDirection),D=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,j=k?D(0,K):0,$=k?0:D(0,B),F=M.pointerType==="touch"?10:2,Y={x:j,y:$},Q={originalEvent:M,delta:Y};H?(T.current=Y,_a(EA,d,Q,{discrete:!1})):zp(Y,p.swipeDirection,F)?(T.current=Y,_a(xA,u,Q,{discrete:!1}),M.target.setPointerCapture(M.pointerId)):(Math.abs(K)>F||Math.abs(B)>F)&&(E.current=null)}),onPointerUp:Re(n.onPointerUp,M=>{const K=T.current,B=M.target;if(B.hasPointerCapture(M.pointerId)&&B.releasePointerCapture(M.pointerId),T.current=null,E.current=null,K){const H=M.currentTarget,k={originalEvent:M,delta:K};zp(K,p.swipeDirection,p.swipeThreshold)?_a(TA,h,k,{discrete:!0}):_a(SA,f,k,{discrete:!0}),H.addEventListener("click",D=>D.preventDefault(),{once:!0})}})})})}),p.viewport)})]}):null}),LA=n=>{const{__scopeToast:e,children:t,...r}=n,s=_c(sa,e),[i,o]=w.useState(!1),[a,l]=w.useState(!1);return CA(()=>o(!0)),w.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:y.jsx(Fh,{asChild:!0,children:y.jsx(kc,{...r,children:i&&y.jsxs(y.Fragment,{children:[s.label," ",t]})})})},IA="ToastTitle",Ox=w.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return y.jsx(Ge.div,{...r,ref:e})});Ox.displayName=IA;var RA="ToastDescription",Mx=w.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return y.jsx(Ge.div,{...r,ref:e})});Mx.displayName=RA;var Fx="ToastAction",Bx=w.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?y.jsx(Ux,{altText:t,asChild:!0,children:y.jsx(Uh,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Fx}\`. Expected non-empty \`string\`.`),null)});Bx.displayName=Fx;var $x="ToastClose",Uh=w.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,s=wA($x,t);return y.jsx(Ux,{asChild:!0,children:y.jsx(Ge.button,{type:"button",...r,ref:e,onClick:Re(n.onClick,s.onClose)})})});Uh.displayName=$x;var Ux=w.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...s}=n;return y.jsx(Ge.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...s,ref:e})});function jx(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),kA(r)){const s=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const o=r.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...jx(r))}}),e}function _a(n,e,t,{discrete:r}){const s=t.originalEvent.currentTarget,i=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?wx(s,i):s.dispatchEvent(i)}var zp=(n,e,t=0)=>{const r=Math.abs(n.x),s=Math.abs(n.y),i=r>s;return e==="left"||e==="right"?i&&r>t:!i&&s>t};function CA(n=()=>{}){const e=Vn(n);dr(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function kA(n){return n.nodeType===n.ELEMENT_NODE}function _A(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Cu(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var PA=kx,Gx=Px,Vx=Nx,Hx=Ox,Kx=Mx,Wx=Bx,zx=Uh;function Yx(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=Yx(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function qx(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=Yx(n))&&(r&&(r+=" "),r+=e);return r}const Yp=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,qp=qx,jh=(n,e)=>t=>{var r;if((e==null?void 0:e.variants)==null)return qp(n,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],d=i==null?void 0:i[c];if(u===null)return null;const f=Yp(u)||Yp(d);return s[c][f]}),a=t&&Object.entries(t).reduce((c,u)=>{let[d,f]=u;return f===void 0||(c[d]=f),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:d,className:f,...h}=u;return Object.entries(h).every(m=>{let[p,g]=m;return Array.isArray(g)?g.includes({...i,...a}[p]):{...i,...a}[p]===g})?[...c,d,f]:c},[]);return qp(n,o,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DA=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Qx=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var NA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OA=w.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:o,...a},l)=>w.createElement("svg",{ref:l,...NA,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Qx("lucide",s),...a},[...o.map(([c,u])=>w.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=(n,e)=>{const t=w.forwardRef(({className:r,...s},i)=>w.createElement(OA,{ref:i,iconNode:e,className:Qx(`lucide-${DA(n)}`,r),...s}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MA=_t("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FA=_t("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=_t("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $A=_t("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UA=_t("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jA=_t("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GA=_t("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=_t("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HA=_t("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KA=_t("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=_t("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=_t("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zA=_t("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=_t("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Gh="-",YA=n=>{const e=QA(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const a=o.split(Gh);return a[0]===""&&a.length!==1&&a.shift(),Xx(a,e)||qA(o)},getConflictingClassGroupIds:(o,a)=>{const l=t[o]||[];return a&&r[o]?[...l,...r[o]]:l}}},Xx=(n,e)=>{var o;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?Xx(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const i=n.join(Gh);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},Xp=/^\[(.+)\]$/,qA=n=>{if(Xp.test(n)){const e=Xp.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},QA=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return ZA(Object.entries(n.classGroups),t).forEach(([i,o])=>{cf(o,r,i,e)}),r},cf=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Zp(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(XA(s)){cf(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,o])=>{cf(o,Zp(e,i),t,r)})})},Zp=(n,e)=>{let t=n;return e.split(Gh).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},XA=n=>n.isThemeGetter,ZA=(n,e)=>e?n.map(([t,r])=>{const s=r.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[t,s]}):n,JA=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(i,o)=>{t.set(i,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(i){let o=t.get(i);if(o!==void 0)return o;if((o=r.get(i))!==void 0)return s(i,o),o},set(i,o){t.has(i)?t.set(i,o):s(i,o)}}},Zx="!",eL=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,s=e[0],i=e.length,o=a=>{const l=[];let c=0,u=0,d;for(let g=0;g<a.length;g++){let v=a[g];if(c===0){if(v===s&&(r||a.slice(g,g+i)===e)){l.push(a.slice(u,g)),u=g+i;continue}if(v==="/"){d=g;continue}}v==="["?c++:v==="]"&&c--}const f=l.length===0?a:a.substring(u),h=f.startsWith(Zx),m=h?f.substring(1):f,p=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:h,baseClassName:m,maybePostfixModifierPosition:p}};return t?a=>t({className:a,parseClassName:o}):o},tL=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},nL=n=>({cache:JA(n.cacheSize),parseClassName:eL(n),...YA(n)}),rL=/\s+/,sL=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s}=e,i=[],o=n.trim().split(rL);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:h}=t(c);let m=!!h,p=r(m?f.substring(0,h):f);if(!p){if(!m){a=c+(a.length>0?" "+a:a);continue}if(p=r(f),!p){a=c+(a.length>0?" "+a:a);continue}m=!1}const g=tL(u).join(":"),v=d?g+Zx:g,x=v+p;if(i.includes(x))continue;i.push(x);const E=s(p,m);for(let T=0;T<E.length;++T){const b=E[T];i.push(v+b)}a=c+(a.length>0?" "+a:a)}return a};function iL(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=Jx(e))&&(r&&(r+=" "),r+=t);return r}const Jx=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=Jx(n[r]))&&(t&&(t+=" "),t+=e);return t};function oL(n,...e){let t,r,s,i=o;function o(l){const c=e.reduce((u,d)=>d(u),n());return t=nL(c),r=t.cache.get,s=t.cache.set,i=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=sL(l,t);return s(l,u),u}return function(){return i(iL.apply(null,arguments))}}const Se=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},eE=/^\[(?:([a-z-]+):)?(.+)\]$/i,aL=/^\d+\/\d+$/,lL=new Set(["px","full","screen"]),cL=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,uL=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,dL=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,fL=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,hL=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,qn=n=>di(n)||lL.has(n)||aL.test(n),Sr=n=>Gi(n,"length",SL),di=n=>!!n&&!Number.isNaN(Number(n)),ku=n=>Gi(n,"number",di),Ji=n=>!!n&&Number.isInteger(Number(n)),mL=n=>n.endsWith("%")&&di(n.slice(0,-1)),ae=n=>eE.test(n),Tr=n=>cL.test(n),pL=new Set(["length","size","percentage"]),gL=n=>Gi(n,pL,tE),vL=n=>Gi(n,"position",tE),yL=new Set(["image","url"]),xL=n=>Gi(n,yL,bL),EL=n=>Gi(n,"",TL),eo=()=>!0,Gi=(n,e,t)=>{const r=eE.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},SL=n=>uL.test(n)&&!dL.test(n),tE=()=>!1,TL=n=>fL.test(n),bL=n=>hL.test(n),wL=()=>{const n=Se("colors"),e=Se("spacing"),t=Se("blur"),r=Se("brightness"),s=Se("borderColor"),i=Se("borderRadius"),o=Se("borderSpacing"),a=Se("borderWidth"),l=Se("contrast"),c=Se("grayscale"),u=Se("hueRotate"),d=Se("invert"),f=Se("gap"),h=Se("gradientColorStops"),m=Se("gradientColorStopPositions"),p=Se("inset"),g=Se("margin"),v=Se("opacity"),x=Se("padding"),E=Se("saturate"),T=Se("scale"),b=Se("sepia"),L=Se("skew"),A=Se("space"),I=Se("translate"),C=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],_=()=>["auto",ae,e],O=()=>[ae,e],V=()=>["",qn,Sr],M=()=>["auto",di,ae],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],B=()=>["solid","dashed","dotted","double","none"],H=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],k=()=>["start","end","center","between","around","evenly","stretch"],D=()=>["","0",ae],j=()=>["auto","avoid","all","avoid-page","page","left","right","column"],$=()=>[di,ae];return{cacheSize:500,separator:":",theme:{colors:[eo],spacing:[qn,Sr],blur:["none","",Tr,ae],brightness:$(),borderColor:[n],borderRadius:["none","","full",Tr,ae],borderSpacing:O(),borderWidth:V(),contrast:$(),grayscale:D(),hueRotate:$(),invert:D(),gap:O(),gradientColorStops:[n],gradientColorStopPositions:[mL,Sr],inset:_(),margin:_(),opacity:$(),padding:O(),saturate:$(),scale:$(),sepia:D(),skew:$(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",ae]}],container:["container"],columns:[{columns:[Tr]}],"break-after":[{"break-after":j()}],"break-before":[{"break-before":j()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),ae]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ji,ae]}],basis:[{basis:_()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ae]}],grow:[{grow:D()}],shrink:[{shrink:D()}],order:[{order:["first","last","none",Ji,ae]}],"grid-cols":[{"grid-cols":[eo]}],"col-start-end":[{col:["auto",{span:["full",Ji,ae]},ae]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[eo]}],"row-start-end":[{row:["auto",{span:[Ji,ae]},ae]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ae]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ae]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...k()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...k(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...k(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[A]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[A]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ae,e]}],"min-w":[{"min-w":[ae,e,"min","max","fit"]}],"max-w":[{"max-w":[ae,e,"none","full","min","max","fit","prose",{screen:[Tr]},Tr]}],h:[{h:[ae,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ae,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ae,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ae,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Tr,Sr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ku]}],"font-family":[{font:[eo]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ae]}],"line-clamp":[{"line-clamp":["none",di,ku]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",qn,ae]}],"list-image":[{"list-image":["none",ae]}],"list-style-type":[{list:["none","disc","decimal",ae]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...B(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",qn,Sr]}],"underline-offset":[{"underline-offset":["auto",qn,ae]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ae]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ae]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),vL]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",gL]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},xL]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...B(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:B()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...B()]}],"outline-offset":[{"outline-offset":[qn,ae]}],"outline-w":[{outline:[qn,Sr]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:V()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[qn,Sr]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Tr,EL]}],"shadow-color":[{shadow:[eo]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...H(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":H()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Tr,ae]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[E]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[E]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ae]}],duration:[{duration:$()}],ease:[{ease:["linear","in","out","in-out",ae]}],delay:[{delay:$()}],animate:[{animate:["none","spin","ping","pulse","bounce",ae]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[T]}],"scale-x":[{"scale-x":[T]}],"scale-y":[{"scale-y":[T]}],rotate:[{rotate:[Ji,ae]}],"translate-x":[{"translate-x":[I]}],"translate-y":[{"translate-y":[I]}],"skew-x":[{"skew-x":[L]}],"skew-y":[{"skew-y":[L]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ae]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ae]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ae]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[qn,Sr,ku]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},AL=oL(wL);function Ve(...n){return AL(qx(n))}const LL=PA,nE=w.forwardRef(({className:n,...e},t)=>y.jsx(Gx,{ref:t,className:Ve("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...e}));nE.displayName=Gx.displayName;const IL=jh("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),rE=w.forwardRef(({className:n,variant:e,...t},r)=>y.jsx(Vx,{ref:r,className:Ve(IL({variant:e}),n),...t}));rE.displayName=Vx.displayName;const RL=w.forwardRef(({className:n,...e},t)=>y.jsx(Wx,{ref:t,className:Ve("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...e}));RL.displayName=Wx.displayName;const sE=w.forwardRef(({className:n,...e},t)=>y.jsx(zx,{ref:t,className:Ve("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...e,children:y.jsx(ia,{className:"h-4 w-4"})}));sE.displayName=zx.displayName;const iE=w.forwardRef(({className:n,...e},t)=>y.jsx(Hx,{ref:t,className:Ve("text-sm font-semibold",n),...e}));iE.displayName=Hx.displayName;const oE=w.forwardRef(({className:n,...e},t)=>y.jsx(Kx,{ref:t,className:Ve("text-sm opacity-90",n),...e}));oE.displayName=Kx.displayName;function CL(){const{toasts:n}=$w();return y.jsxs(LL,{children:[n.map(function({id:e,title:t,description:r,action:s,...i}){return y.jsxs(rE,{...i,children:[y.jsxs("div",{className:"grid gap-1",children:[t&&y.jsx(iE,{children:t}),r&&y.jsx(oE,{children:r})]}),s,y.jsx(sE,{})]},e)}),y.jsx(nE,{})]})}var Jp=["light","dark"],kL="(prefers-color-scheme: dark)",_L=w.createContext(void 0),PL={setTheme:n=>{},themes:[]},DL=()=>{var n;return(n=w.useContext(_L))!=null?n:PL};w.memo(({forcedTheme:n,storageKey:e,attribute:t,enableSystem:r,enableColorScheme:s,defaultTheme:i,value:o,attrs:a,nonce:l})=>{let c=i==="system",u=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(m=>`'${m}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,d=s?Jp.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",f=(m,p=!1,g=!0)=>{let v=o?o[m]:m,x=p?m+"|| ''":`'${v}'`,E="";return s&&g&&!p&&Jp.includes(m)&&(E+=`d.style.colorScheme = '${m}';`),t==="class"?p||v?E+=`c.add(${x})`:E+="null":v&&(E+=`d[s](n,${x})`),E},h=n?`!function(){${u}${f(n)}}()`:r?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${kL}',m=window.matchMedia(t);if(m.media!==t||m.matches){${f("dark")}}else{${f("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${f(o?"x[e]":"e",!0)}}${c?"":"else{"+f(i,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${f(o?"x[e]":"e",!0)}}else{${f(i,!1,!1)};}${d}}catch(t){}}();`;return w.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:h}})});var NL=n=>{switch(n){case"success":return FL;case"info":return $L;case"warning":return BL;case"error":return UL;default:return null}},OL=Array(12).fill(0),ML=({visible:n,className:e})=>z.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},z.createElement("div",{className:"sonner-spinner"},OL.map((t,r)=>z.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),FL=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),BL=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),$L=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),UL=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),jL=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},z.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),z.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),GL=()=>{let[n,e]=z.useState(document.hidden);return z.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n},uf=1,VL=class{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{let e=this.subscribers.indexOf(n);this.subscribers.splice(e,1)}),this.publish=n=>{this.subscribers.forEach(e=>e(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var e;let{message:t,...r}=n,s=typeof(n==null?void 0:n.id)=="number"||((e=n.id)==null?void 0:e.length)>0?n.id:uf++,i=this.toasts.find(a=>a.id===s),o=n.dismissible===void 0?!0:n.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(a=>a.id===s?(this.publish({...a,...n,id:s,title:t}),{...a,...n,id:s,dismissible:o,title:t}):a):this.addToast({title:t,...r,dismissible:o,id:s}),s},this.dismiss=n=>(this.dismissedToasts.add(n),n||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:n,dismiss:!0})),n),this.message=(n,e)=>this.create({...e,message:n}),this.error=(n,e)=>this.create({...e,message:n,type:"error"}),this.success=(n,e)=>this.create({...e,type:"success",message:n}),this.info=(n,e)=>this.create({...e,type:"info",message:n}),this.warning=(n,e)=>this.create({...e,type:"warning",message:n}),this.loading=(n,e)=>this.create({...e,type:"loading",message:n}),this.promise=(n,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:n,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let r=n instanceof Promise?n:n(),s=t!==void 0,i,o=r.then(async l=>{if(i=["resolve",l],z.isValidElement(l))s=!1,this.create({id:t,type:"default",message:l});else if(KL(l)&&!l.ok){s=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,u=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:t,type:"error",message:c,description:u})}else if(e.success!==void 0){s=!1;let c=typeof e.success=="function"?await e.success(l):e.success,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"success",message:c,description:u})}}).catch(async l=>{if(i=["reject",l],e.error!==void 0){s=!1;let c=typeof e.error=="function"?await e.error(l):e.error,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"error",message:c,description:u})}}).finally(()=>{var l;s&&(this.dismiss(t),t=void 0),(l=e.finally)==null||l.call(e)}),a=()=>new Promise((l,c)=>o.then(()=>i[0]==="reject"?c(i[1]):l(i[1])).catch(c));return typeof t!="string"&&typeof t!="number"?{unwrap:a}:Object.assign(t,{unwrap:a})},this.custom=(n,e)=>{let t=(e==null?void 0:e.id)||uf++;return this.create({jsx:n(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(n=>!this.dismissedToasts.has(n.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Tt=new VL,HL=(n,e)=>{let t=(e==null?void 0:e.id)||uf++;return Tt.addToast({title:n,...e,id:t}),t},KL=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",WL=HL,zL=()=>Tt.toasts,YL=()=>Tt.getActiveToasts();Object.assign(WL,{success:Tt.success,info:Tt.info,warning:Tt.warning,error:Tt.error,custom:Tt.custom,message:Tt.message,promise:Tt.promise,dismiss:Tt.dismiss,loading:Tt.loading},{getHistory:zL,getToasts:YL});function qL(n,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}qL(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Pa(n){return n.label!==void 0}var QL=3,XL="32px",ZL="16px",eg=4e3,JL=356,eI=14,tI=20,nI=200;function an(...n){return n.filter(Boolean).join(" ")}function rI(n){let[e,t]=n.split("-"),r=[];return e&&r.push(e),t&&r.push(t),r}var sI=n=>{var e,t,r,s,i,o,a,l,c,u,d;let{invert:f,toast:h,unstyled:m,interacting:p,setHeights:g,visibleToasts:v,heights:x,index:E,toasts:T,expanded:b,removeToast:L,defaultRichColors:A,closeButton:I,style:C,cancelButtonStyle:R,actionButtonStyle:_,className:O="",descriptionClassName:V="",duration:M,position:K,gap:B,loadingIcon:H,expandByDefault:k,classNames:D,icons:j,closeButtonAriaLabel:$="Close toast",pauseWhenPageIsHidden:F}=n,[Y,Q]=z.useState(null),[ee,te]=z.useState(null),[ne,Ae]=z.useState(!1),[Fe,Ye]=z.useState(!1),[st,pr]=z.useState(!1),[Ht,gr]=z.useState(!1),[ca,ue]=z.useState(!1),[$e,qe]=z.useState(0),[xt,Et]=z.useState(0),Kt=z.useRef(h.duration||M||eg),wn=z.useRef(null),An=z.useRef(null),Ns=E===0,ua=E+1<=v,Qe=h.type,Yn=h.dismissible!==!1,Xc=h.className||"",da=h.descriptionClassName||"",ss=z.useMemo(()=>x.findIndex(ie=>ie.toastId===h.id)||0,[x,h.id]),is=z.useMemo(()=>{var ie;return(ie=h.closeButton)!=null?ie:I},[h.closeButton,I]),Cm=z.useMemo(()=>h.duration||M||eg,[h.duration,M]),Zc=z.useRef(0),Os=z.useRef(0),km=z.useRef(0),Ms=z.useRef(null),[s1,i1]=K.split("-"),_m=z.useMemo(()=>x.reduce((ie,ge,Le)=>Le>=ss?ie:ie+ge.height,0),[x,ss]),Pm=GL(),o1=h.invert||f,Jc=Qe==="loading";Os.current=z.useMemo(()=>ss*B+_m,[ss,_m]),z.useEffect(()=>{Kt.current=Cm},[Cm]),z.useEffect(()=>{Ae(!0)},[]),z.useEffect(()=>{let ie=An.current;if(ie){let ge=ie.getBoundingClientRect().height;return Et(ge),g(Le=>[{toastId:h.id,height:ge,position:h.position},...Le]),()=>g(Le=>Le.filter(nn=>nn.toastId!==h.id))}},[g,h.id]),z.useLayoutEffect(()=>{if(!ne)return;let ie=An.current,ge=ie.style.height;ie.style.height="auto";let Le=ie.getBoundingClientRect().height;ie.style.height=ge,Et(Le),g(nn=>nn.find(rn=>rn.toastId===h.id)?nn.map(rn=>rn.toastId===h.id?{...rn,height:Le}:rn):[{toastId:h.id,height:Le,position:h.position},...nn])},[ne,h.title,h.description,g,h.id]);let vr=z.useCallback(()=>{Ye(!0),qe(Os.current),g(ie=>ie.filter(ge=>ge.toastId!==h.id)),setTimeout(()=>{L(h)},nI)},[h,L,g,Os]);z.useEffect(()=>{if(h.promise&&Qe==="loading"||h.duration===1/0||h.type==="loading")return;let ie;return b||p||F&&Pm?(()=>{if(km.current<Zc.current){let ge=new Date().getTime()-Zc.current;Kt.current=Kt.current-ge}km.current=new Date().getTime()})():Kt.current!==1/0&&(Zc.current=new Date().getTime(),ie=setTimeout(()=>{var ge;(ge=h.onAutoClose)==null||ge.call(h,h),vr()},Kt.current)),()=>clearTimeout(ie)},[b,p,h,Qe,F,Pm,vr]),z.useEffect(()=>{h.delete&&vr()},[vr,h.delete]);function a1(){var ie,ge,Le;return j!=null&&j.loading?z.createElement("div",{className:an(D==null?void 0:D.loader,(ie=h==null?void 0:h.classNames)==null?void 0:ie.loader,"sonner-loader"),"data-visible":Qe==="loading"},j.loading):H?z.createElement("div",{className:an(D==null?void 0:D.loader,(ge=h==null?void 0:h.classNames)==null?void 0:ge.loader,"sonner-loader"),"data-visible":Qe==="loading"},H):z.createElement(ML,{className:an(D==null?void 0:D.loader,(Le=h==null?void 0:h.classNames)==null?void 0:Le.loader),visible:Qe==="loading"})}return z.createElement("li",{tabIndex:0,ref:An,className:an(O,Xc,D==null?void 0:D.toast,(e=h==null?void 0:h.classNames)==null?void 0:e.toast,D==null?void 0:D.default,D==null?void 0:D[Qe],(t=h==null?void 0:h.classNames)==null?void 0:t[Qe]),"data-sonner-toast":"","data-rich-colors":(r=h.richColors)!=null?r:A,"data-styled":!(h.jsx||h.unstyled||m),"data-mounted":ne,"data-promise":!!h.promise,"data-swiped":ca,"data-removed":Fe,"data-visible":ua,"data-y-position":s1,"data-x-position":i1,"data-index":E,"data-front":Ns,"data-swiping":st,"data-dismissible":Yn,"data-type":Qe,"data-invert":o1,"data-swipe-out":Ht,"data-swipe-direction":ee,"data-expanded":!!(b||k&&ne),style:{"--index":E,"--toasts-before":E,"--z-index":T.length-E,"--offset":`${Fe?$e:Os.current}px`,"--initial-height":k?"auto":`${xt}px`,...C,...h.style},onDragEnd:()=>{pr(!1),Q(null),Ms.current=null},onPointerDown:ie=>{Jc||!Yn||(wn.current=new Date,qe(Os.current),ie.target.setPointerCapture(ie.pointerId),ie.target.tagName!=="BUTTON"&&(pr(!0),Ms.current={x:ie.clientX,y:ie.clientY}))},onPointerUp:()=>{var ie,ge,Le,nn;if(Ht||!Yn)return;Ms.current=null;let rn=Number(((ie=An.current)==null?void 0:ie.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),yr=Number(((ge=An.current)==null?void 0:ge.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),os=new Date().getTime()-((Le=wn.current)==null?void 0:Le.getTime()),sn=Y==="x"?rn:yr,xr=Math.abs(sn)/os;if(Math.abs(sn)>=tI||xr>.11){qe(Os.current),(nn=h.onDismiss)==null||nn.call(h,h),te(Y==="x"?rn>0?"right":"left":yr>0?"down":"up"),vr(),gr(!0),ue(!1);return}pr(!1),Q(null)},onPointerMove:ie=>{var ge,Le,nn,rn;if(!Ms.current||!Yn||((ge=window.getSelection())==null?void 0:ge.toString().length)>0)return;let yr=ie.clientY-Ms.current.y,os=ie.clientX-Ms.current.x,sn=(Le=n.swipeDirections)!=null?Le:rI(K);!Y&&(Math.abs(os)>1||Math.abs(yr)>1)&&Q(Math.abs(os)>Math.abs(yr)?"x":"y");let xr={x:0,y:0};Y==="y"?(sn.includes("top")||sn.includes("bottom"))&&(sn.includes("top")&&yr<0||sn.includes("bottom")&&yr>0)&&(xr.y=yr):Y==="x"&&(sn.includes("left")||sn.includes("right"))&&(sn.includes("left")&&os<0||sn.includes("right")&&os>0)&&(xr.x=os),(Math.abs(xr.x)>0||Math.abs(xr.y)>0)&&ue(!0),(nn=An.current)==null||nn.style.setProperty("--swipe-amount-x",`${xr.x}px`),(rn=An.current)==null||rn.style.setProperty("--swipe-amount-y",`${xr.y}px`)}},is&&!h.jsx?z.createElement("button",{"aria-label":$,"data-disabled":Jc,"data-close-button":!0,onClick:Jc||!Yn?()=>{}:()=>{var ie;vr(),(ie=h.onDismiss)==null||ie.call(h,h)},className:an(D==null?void 0:D.closeButton,(s=h==null?void 0:h.classNames)==null?void 0:s.closeButton)},(i=j==null?void 0:j.close)!=null?i:jL):null,h.jsx||w.isValidElement(h.title)?h.jsx?h.jsx:typeof h.title=="function"?h.title():h.title:z.createElement(z.Fragment,null,Qe||h.icon||h.promise?z.createElement("div",{"data-icon":"",className:an(D==null?void 0:D.icon,(o=h==null?void 0:h.classNames)==null?void 0:o.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||a1():null,h.type!=="loading"?h.icon||(j==null?void 0:j[Qe])||NL(Qe):null):null,z.createElement("div",{"data-content":"",className:an(D==null?void 0:D.content,(a=h==null?void 0:h.classNames)==null?void 0:a.content)},z.createElement("div",{"data-title":"",className:an(D==null?void 0:D.title,(l=h==null?void 0:h.classNames)==null?void 0:l.title)},typeof h.title=="function"?h.title():h.title),h.description?z.createElement("div",{"data-description":"",className:an(V,da,D==null?void 0:D.description,(c=h==null?void 0:h.classNames)==null?void 0:c.description)},typeof h.description=="function"?h.description():h.description):null),w.isValidElement(h.cancel)?h.cancel:h.cancel&&Pa(h.cancel)?z.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||R,onClick:ie=>{var ge,Le;Pa(h.cancel)&&Yn&&((Le=(ge=h.cancel).onClick)==null||Le.call(ge,ie),vr())},className:an(D==null?void 0:D.cancelButton,(u=h==null?void 0:h.classNames)==null?void 0:u.cancelButton)},h.cancel.label):null,w.isValidElement(h.action)?h.action:h.action&&Pa(h.action)?z.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||_,onClick:ie=>{var ge,Le;Pa(h.action)&&((Le=(ge=h.action).onClick)==null||Le.call(ge,ie),!ie.defaultPrevented&&vr())},className:an(D==null?void 0:D.actionButton,(d=h==null?void 0:h.classNames)==null?void 0:d.actionButton)},h.action.label):null))};function tg(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function iI(n,e){let t={};return[n,e].forEach((r,s)=>{let i=s===1,o=i?"--mobile-offset":"--offset",a=i?ZL:XL;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${o}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?t[`${o}-${c}`]=a:t[`${o}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):l(a)}),t}var oI=w.forwardRef(function(n,e){let{invert:t,position:r="bottom-right",hotkey:s=["altKey","KeyT"],expand:i,closeButton:o,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:f,style:h,visibleToasts:m=QL,toastOptions:p,dir:g=tg(),gap:v=eI,loadingIcon:x,icons:E,containerAriaLabel:T="Notifications",pauseWhenPageIsHidden:b}=n,[L,A]=z.useState([]),I=z.useMemo(()=>Array.from(new Set([r].concat(L.filter(F=>F.position).map(F=>F.position)))),[L,r]),[C,R]=z.useState([]),[_,O]=z.useState(!1),[V,M]=z.useState(!1),[K,B]=z.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),H=z.useRef(null),k=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),D=z.useRef(null),j=z.useRef(!1),$=z.useCallback(F=>{A(Y=>{var Q;return(Q=Y.find(ee=>ee.id===F.id))!=null&&Q.delete||Tt.dismiss(F.id),Y.filter(({id:ee})=>ee!==F.id)})},[]);return z.useEffect(()=>Tt.subscribe(F=>{if(F.dismiss){A(Y=>Y.map(Q=>Q.id===F.id?{...Q,delete:!0}:Q));return}setTimeout(()=>{Ex.flushSync(()=>{A(Y=>{let Q=Y.findIndex(ee=>ee.id===F.id);return Q!==-1?[...Y.slice(0,Q),{...Y[Q],...F},...Y.slice(Q+1)]:[F,...Y]})})})}),[]),z.useEffect(()=>{if(u!=="system"){B(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?B("dark"):B("light")),typeof window>"u")return;let F=window.matchMedia("(prefers-color-scheme: dark)");try{F.addEventListener("change",({matches:Y})=>{B(Y?"dark":"light")})}catch{F.addListener(({matches:Q})=>{try{B(Q?"dark":"light")}catch(ee){console.error(ee)}})}},[u]),z.useEffect(()=>{L.length<=1&&O(!1)},[L]),z.useEffect(()=>{let F=Y=>{var Q,ee;s.every(te=>Y[te]||Y.code===te)&&(O(!0),(Q=H.current)==null||Q.focus()),Y.code==="Escape"&&(document.activeElement===H.current||(ee=H.current)!=null&&ee.contains(document.activeElement))&&O(!1)};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[s]),z.useEffect(()=>{if(H.current)return()=>{D.current&&(D.current.focus({preventScroll:!0}),D.current=null,j.current=!1)}},[H.current]),z.createElement("section",{ref:e,"aria-label":`${T} ${k}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},I.map((F,Y)=>{var Q;let[ee,te]=F.split("-");return L.length?z.createElement("ol",{key:F,dir:g==="auto"?tg():g,tabIndex:-1,ref:H,className:a,"data-sonner-toaster":!0,"data-theme":K,"data-y-position":ee,"data-lifted":_&&L.length>1&&!i,"data-x-position":te,style:{"--front-toast-height":`${((Q=C[0])==null?void 0:Q.height)||0}px`,"--width":`${JL}px`,"--gap":`${v}px`,...h,...iI(l,c)},onBlur:ne=>{j.current&&!ne.currentTarget.contains(ne.relatedTarget)&&(j.current=!1,D.current&&(D.current.focus({preventScroll:!0}),D.current=null))},onFocus:ne=>{ne.target instanceof HTMLElement&&ne.target.dataset.dismissible==="false"||j.current||(j.current=!0,D.current=ne.relatedTarget)},onMouseEnter:()=>O(!0),onMouseMove:()=>O(!0),onMouseLeave:()=>{V||O(!1)},onDragEnd:()=>O(!1),onPointerDown:ne=>{ne.target instanceof HTMLElement&&ne.target.dataset.dismissible==="false"||M(!0)},onPointerUp:()=>M(!1)},L.filter(ne=>!ne.position&&Y===0||ne.position===F).map((ne,Ae)=>{var Fe,Ye;return z.createElement(sI,{key:ne.id,icons:E,index:Ae,toast:ne,defaultRichColors:d,duration:(Fe=p==null?void 0:p.duration)!=null?Fe:f,className:p==null?void 0:p.className,descriptionClassName:p==null?void 0:p.descriptionClassName,invert:t,visibleToasts:m,closeButton:(Ye=p==null?void 0:p.closeButton)!=null?Ye:o,interacting:V,position:F,style:p==null?void 0:p.style,unstyled:p==null?void 0:p.unstyled,classNames:p==null?void 0:p.classNames,cancelButtonStyle:p==null?void 0:p.cancelButtonStyle,actionButtonStyle:p==null?void 0:p.actionButtonStyle,removeToast:$,toasts:L.filter(st=>st.position==ne.position),heights:C.filter(st=>st.position==ne.position),setHeights:R,expandByDefault:i,gap:v,loadingIcon:x,expanded:_,pauseWhenPageIsHidden:b,swipeDirections:n.swipeDirections})})):null}))});const aI=({...n})=>{const{theme:e="system"}=DL();return y.jsx(oI,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...n})};var lI=Wf[" useId ".trim().toString()]||(()=>{}),cI=0;function _u(n){const[e,t]=w.useState(lI());return dr(()=>{n||t(r=>r??String(cI++))},[n]),n||(e?`radix-${e}`:"")}const uI=["top","right","bottom","left"],Xr=Math.min,Ot=Math.max,ql=Math.round,Da=Math.floor,Gn=n=>({x:n,y:n}),dI={left:"right",right:"left",bottom:"top",top:"bottom"},fI={start:"end",end:"start"};function df(n,e,t){return Ot(n,Xr(e,t))}function fr(n,e){return typeof n=="function"?n(e):n}function hr(n){return n.split("-")[0]}function Vi(n){return n.split("-")[1]}function Vh(n){return n==="x"?"y":"x"}function Hh(n){return n==="y"?"height":"width"}const hI=new Set(["top","bottom"]);function Fn(n){return hI.has(hr(n))?"y":"x"}function Kh(n){return Vh(Fn(n))}function mI(n,e,t){t===void 0&&(t=!1);const r=Vi(n),s=Kh(n),i=Hh(s);let o=s==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Ql(o)),[o,Ql(o)]}function pI(n){const e=Ql(n);return[ff(n),e,ff(e)]}function ff(n){return n.replace(/start|end/g,e=>fI[e])}const ng=["left","right"],rg=["right","left"],gI=["top","bottom"],vI=["bottom","top"];function yI(n,e,t){switch(n){case"top":case"bottom":return t?e?rg:ng:e?ng:rg;case"left":case"right":return e?gI:vI;default:return[]}}function xI(n,e,t,r){const s=Vi(n);let i=yI(hr(n),t==="start",r);return s&&(i=i.map(o=>o+"-"+s),e&&(i=i.concat(i.map(ff)))),i}function Ql(n){return n.replace(/left|right|bottom|top/g,e=>dI[e])}function EI(n){return{top:0,right:0,bottom:0,left:0,...n}}function aE(n){return typeof n!="number"?EI(n):{top:n,right:n,bottom:n,left:n}}function Xl(n){const{x:e,y:t,width:r,height:s}=n;return{width:r,height:s,top:t,left:e,right:e+r,bottom:t+s,x:e,y:t}}function sg(n,e,t){let{reference:r,floating:s}=n;const i=Fn(e),o=Kh(e),a=Hh(o),l=hr(e),c=i==="y",u=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,f=r[a]/2-s[a]/2;let h;switch(l){case"top":h={x:u,y:r.y-s.height};break;case"bottom":h={x:u,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:d};break;case"left":h={x:r.x-s.width,y:d};break;default:h={x:r.x,y:r.y}}switch(Vi(e)){case"start":h[o]-=f*(t&&c?-1:1);break;case"end":h[o]+=f*(t&&c?-1:1);break}return h}const SI=async(n,e,t)=>{const{placement:r="bottom",strategy:s="absolute",middleware:i=[],platform:o}=t,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:n,floating:e,strategy:s}),{x:u,y:d}=sg(c,r,l),f=r,h={},m=0;for(let p=0;p<a.length;p++){const{name:g,fn:v}=a[p],{x,y:E,data:T,reset:b}=await v({x:u,y:d,initialPlacement:r,placement:f,strategy:s,middlewareData:h,rects:c,platform:o,elements:{reference:n,floating:e}});u=x??u,d=E??d,h={...h,[g]:{...h[g],...T}},b&&m<=50&&(m++,typeof b=="object"&&(b.placement&&(f=b.placement),b.rects&&(c=b.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:s}):b.rects),{x:u,y:d}=sg(c,f,l)),p=-1)}return{x:u,y:d,placement:f,strategy:s,middlewareData:h}};async function $o(n,e){var t;e===void 0&&(e={});const{x:r,y:s,platform:i,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=fr(e,n),m=aE(h),g=a[f?d==="floating"?"reference":"floating":d],v=Xl(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(g)))==null||t?g:g.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=d==="floating"?{x:r,y:s,width:o.floating.width,height:o.floating.height}:o.reference,E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),T=await(i.isElement==null?void 0:i.isElement(E))?await(i.getScale==null?void 0:i.getScale(E))||{x:1,y:1}:{x:1,y:1},b=Xl(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:E,strategy:l}):x);return{top:(v.top-b.top+m.top)/T.y,bottom:(b.bottom-v.bottom+m.bottom)/T.y,left:(v.left-b.left+m.left)/T.x,right:(b.right-v.right+m.right)/T.x}}const TI=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:s,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=fr(n,e)||{};if(c==null)return{};const d=aE(u),f={x:t,y:r},h=Kh(s),m=Hh(h),p=await o.getDimensions(c),g=h==="y",v=g?"top":"left",x=g?"bottom":"right",E=g?"clientHeight":"clientWidth",T=i.reference[m]+i.reference[h]-f[h]-i.floating[m],b=f[h]-i.reference[h],L=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let A=L?L[E]:0;(!A||!await(o.isElement==null?void 0:o.isElement(L)))&&(A=a.floating[E]||i.floating[m]);const I=T/2-b/2,C=A/2-p[m]/2-1,R=Xr(d[v],C),_=Xr(d[x],C),O=R,V=A-p[m]-_,M=A/2-p[m]/2+I,K=df(O,M,V),B=!l.arrow&&Vi(s)!=null&&M!==K&&i.reference[m]/2-(M<O?R:_)-p[m]/2<0,H=B?M<O?M-O:M-V:0;return{[h]:f[h]+H,data:{[h]:K,centerOffset:M-K-H,...B&&{alignmentOffset:H}},reset:B}}}),bI=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=fr(n,e);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const v=hr(s),x=Fn(a),E=hr(a)===a,T=await(l.isRTL==null?void 0:l.isRTL(c.floating)),b=f||(E||!p?[Ql(a)]:pI(a)),L=m!=="none";!f&&L&&b.push(...xI(a,p,m,T));const A=[a,...b],I=await $o(e,g),C=[];let R=((r=i.flip)==null?void 0:r.overflows)||[];if(u&&C.push(I[v]),d){const M=mI(s,o,T);C.push(I[M[0]],I[M[1]])}if(R=[...R,{placement:s,overflows:C}],!C.every(M=>M<=0)){var _,O;const M=(((_=i.flip)==null?void 0:_.index)||0)+1,K=A[M];if(K&&(!(d==="alignment"?x!==Fn(K):!1)||R.every(k=>k.overflows[0]>0&&Fn(k.placement)===x)))return{data:{index:M,overflows:R},reset:{placement:K}};let B=(O=R.filter(H=>H.overflows[0]<=0).sort((H,k)=>H.overflows[1]-k.overflows[1])[0])==null?void 0:O.placement;if(!B)switch(h){case"bestFit":{var V;const H=(V=R.filter(k=>{if(L){const D=Fn(k.placement);return D===x||D==="y"}return!0}).map(k=>[k.placement,k.overflows.filter(D=>D>0).reduce((D,j)=>D+j,0)]).sort((k,D)=>k[1]-D[1])[0])==null?void 0:V[0];H&&(B=H);break}case"initialPlacement":B=a;break}if(s!==B)return{reset:{placement:B}}}return{}}}};function ig(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function og(n){return uI.some(e=>n[e]>=0)}const wI=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...s}=fr(n,e);switch(r){case"referenceHidden":{const i=await $o(e,{...s,elementContext:"reference"}),o=ig(i,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:og(o)}}}case"escaped":{const i=await $o(e,{...s,altBoundary:!0}),o=ig(i,t.floating);return{data:{escapedOffsets:o,escaped:og(o)}}}default:return{}}}}},lE=new Set(["left","top"]);async function AI(n,e){const{placement:t,platform:r,elements:s}=n,i=await(r.isRTL==null?void 0:r.isRTL(s.floating)),o=hr(t),a=Vi(t),l=Fn(t)==="y",c=lE.has(o)?-1:1,u=i&&l?-1:1,d=fr(e,n);let{mainAxis:f,crossAxis:h,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof m=="number"&&(h=a==="end"?m*-1:m),l?{x:h*u,y:f*c}:{x:f*c,y:h*u}}const LI=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:s,y:i,placement:o,middlewareData:a}=e,l=await AI(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:s+l.x,y:i+l.y,data:{...l,placement:o}}}}},II=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:s}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:v,y:x}=g;return{x:v,y:x}}},...l}=fr(n,e),c={x:t,y:r},u=await $o(e,l),d=Fn(hr(s)),f=Vh(d);let h=c[f],m=c[d];if(i){const g=f==="y"?"top":"left",v=f==="y"?"bottom":"right",x=h+u[g],E=h-u[v];h=df(x,h,E)}if(o){const g=d==="y"?"top":"left",v=d==="y"?"bottom":"right",x=m+u[g],E=m-u[v];m=df(x,m,E)}const p=a.fn({...e,[f]:h,[d]:m});return{...p,data:{x:p.x-t,y:p.y-r,enabled:{[f]:i,[d]:o}}}}}},RI=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:s,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=fr(n,e),u={x:t,y:r},d=Fn(s),f=Vh(d);let h=u[f],m=u[d];const p=fr(a,e),g=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(l){const E=f==="y"?"height":"width",T=i.reference[f]-i.floating[E]+g.mainAxis,b=i.reference[f]+i.reference[E]-g.mainAxis;h<T?h=T:h>b&&(h=b)}if(c){var v,x;const E=f==="y"?"width":"height",T=lE.has(hr(s)),b=i.reference[d]-i.floating[E]+(T&&((v=o.offset)==null?void 0:v[d])||0)+(T?0:g.crossAxis),L=i.reference[d]+i.reference[E]+(T?0:((x=o.offset)==null?void 0:x[d])||0)-(T?g.crossAxis:0);m<b?m=b:m>L&&(m=L)}return{[f]:h,[d]:m}}}},CI=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:s,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=fr(n,e),u=await $o(e,c),d=hr(s),f=Vi(s),h=Fn(s)==="y",{width:m,height:p}=i.floating;let g,v;d==="top"||d==="bottom"?(g=d,v=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(v=d,g=f==="end"?"top":"bottom");const x=p-u.top-u.bottom,E=m-u.left-u.right,T=Xr(p-u[g],x),b=Xr(m-u[v],E),L=!e.middlewareData.shift;let A=T,I=b;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(I=E),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(A=x),L&&!f){const R=Ot(u.left,0),_=Ot(u.right,0),O=Ot(u.top,0),V=Ot(u.bottom,0);h?I=m-2*(R!==0||_!==0?R+_:Ot(u.left,u.right)):A=p-2*(O!==0||V!==0?O+V:Ot(u.top,u.bottom))}await l({...e,availableWidth:I,availableHeight:A});const C=await o.getDimensions(a.floating);return m!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}};function Pc(){return typeof window<"u"}function Hi(n){return cE(n)?(n.nodeName||"").toLowerCase():"#document"}function $t(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function zn(n){var e;return(e=(cE(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function cE(n){return Pc()?n instanceof Node||n instanceof $t(n).Node:!1}function Sn(n){return Pc()?n instanceof Element||n instanceof $t(n).Element:!1}function Hn(n){return Pc()?n instanceof HTMLElement||n instanceof $t(n).HTMLElement:!1}function ag(n){return!Pc()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof $t(n).ShadowRoot}const kI=new Set(["inline","contents"]);function oa(n){const{overflow:e,overflowX:t,overflowY:r,display:s}=Tn(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!kI.has(s)}const _I=new Set(["table","td","th"]);function PI(n){return _I.has(Hi(n))}const DI=[":popover-open",":modal"];function Dc(n){return DI.some(e=>{try{return n.matches(e)}catch{return!1}})}const NI=["transform","translate","scale","rotate","perspective"],OI=["transform","translate","scale","rotate","perspective","filter"],MI=["paint","layout","strict","content"];function Wh(n){const e=zh(),t=Sn(n)?Tn(n):n;return NI.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||OI.some(r=>(t.willChange||"").includes(r))||MI.some(r=>(t.contain||"").includes(r))}function FI(n){let e=Zr(n);for(;Hn(e)&&!Ni(e);){if(Wh(e))return e;if(Dc(e))return null;e=Zr(e)}return null}function zh(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const BI=new Set(["html","body","#document"]);function Ni(n){return BI.has(Hi(n))}function Tn(n){return $t(n).getComputedStyle(n)}function Nc(n){return Sn(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Zr(n){if(Hi(n)==="html")return n;const e=n.assignedSlot||n.parentNode||ag(n)&&n.host||zn(n);return ag(e)?e.host:e}function uE(n){const e=Zr(n);return Ni(e)?n.ownerDocument?n.ownerDocument.body:n.body:Hn(e)&&oa(e)?e:uE(e)}function Uo(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=uE(n),i=s===((r=n.ownerDocument)==null?void 0:r.body),o=$t(s);if(i){const a=hf(o);return e.concat(o,o.visualViewport||[],oa(s)?s:[],a&&t?Uo(a):[])}return e.concat(s,Uo(s,[],t))}function hf(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function dE(n){const e=Tn(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=Hn(n),i=s?n.offsetWidth:t,o=s?n.offsetHeight:r,a=ql(t)!==i||ql(r)!==o;return a&&(t=i,r=o),{width:t,height:r,$:a}}function Yh(n){return Sn(n)?n:n.contextElement}function fi(n){const e=Yh(n);if(!Hn(e))return Gn(1);const t=e.getBoundingClientRect(),{width:r,height:s,$:i}=dE(e);let o=(i?ql(t.width):t.width)/r,a=(i?ql(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const $I=Gn(0);function fE(n){const e=$t(n);return!zh()||!e.visualViewport?$I:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function UI(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==$t(n)?!1:e}function Cs(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=n.getBoundingClientRect(),i=Yh(n);let o=Gn(1);e&&(r?Sn(r)&&(o=fi(r)):o=fi(n));const a=UI(i,t,r)?fE(i):Gn(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,u=s.width/o.x,d=s.height/o.y;if(i){const f=$t(i),h=r&&Sn(r)?$t(r):r;let m=f,p=hf(m);for(;p&&r&&h!==m;){const g=fi(p),v=p.getBoundingClientRect(),x=Tn(p),E=v.left+(p.clientLeft+parseFloat(x.paddingLeft))*g.x,T=v.top+(p.clientTop+parseFloat(x.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,d*=g.y,l+=E,c+=T,m=$t(p),p=hf(m)}}return Xl({width:u,height:d,x:l,y:c})}function qh(n,e){const t=Nc(n).scrollLeft;return e?e.left+t:Cs(zn(n)).left+t}function hE(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),s=r.left+e.scrollLeft-(t?0:qh(n,r)),i=r.top+e.scrollTop;return{x:s,y:i}}function jI(n){let{elements:e,rect:t,offsetParent:r,strategy:s}=n;const i=s==="fixed",o=zn(r),a=e?Dc(e.floating):!1;if(r===o||a&&i)return t;let l={scrollLeft:0,scrollTop:0},c=Gn(1);const u=Gn(0),d=Hn(r);if((d||!d&&!i)&&((Hi(r)!=="body"||oa(o))&&(l=Nc(r)),Hn(r))){const h=Cs(r);c=fi(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}const f=o&&!d&&!i?hE(o,l,!0):Gn(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:t.y*c.y-l.scrollTop*c.y+u.y+f.y}}function GI(n){return Array.from(n.getClientRects())}function VI(n){const e=zn(n),t=Nc(n),r=n.ownerDocument.body,s=Ot(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=Ot(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+qh(n);const a=-t.scrollTop;return Tn(r).direction==="rtl"&&(o+=Ot(e.clientWidth,r.clientWidth)-s),{width:s,height:i,x:o,y:a}}function HI(n,e){const t=$t(n),r=zn(n),s=t.visualViewport;let i=r.clientWidth,o=r.clientHeight,a=0,l=0;if(s){i=s.width,o=s.height;const c=zh();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:i,height:o,x:a,y:l}}const KI=new Set(["absolute","fixed"]);function WI(n,e){const t=Cs(n,!0,e==="fixed"),r=t.top+n.clientTop,s=t.left+n.clientLeft,i=Hn(n)?fi(n):Gn(1),o=n.clientWidth*i.x,a=n.clientHeight*i.y,l=s*i.x,c=r*i.y;return{width:o,height:a,x:l,y:c}}function lg(n,e,t){let r;if(e==="viewport")r=HI(n,t);else if(e==="document")r=VI(zn(n));else if(Sn(e))r=WI(e,t);else{const s=fE(n);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Xl(r)}function mE(n,e){const t=Zr(n);return t===e||!Sn(t)||Ni(t)?!1:Tn(t).position==="fixed"||mE(t,e)}function zI(n,e){const t=e.get(n);if(t)return t;let r=Uo(n,[],!1).filter(a=>Sn(a)&&Hi(a)!=="body"),s=null;const i=Tn(n).position==="fixed";let o=i?Zr(n):n;for(;Sn(o)&&!Ni(o);){const a=Tn(o),l=Wh(o);!l&&a.position==="fixed"&&(s=null),(i?!l&&!s:!l&&a.position==="static"&&!!s&&KI.has(s.position)||oa(o)&&!l&&mE(n,o))?r=r.filter(u=>u!==o):s=a,o=Zr(o)}return e.set(n,r),r}function YI(n){let{element:e,boundary:t,rootBoundary:r,strategy:s}=n;const o=[...t==="clippingAncestors"?Dc(e)?[]:zI(e,this._c):[].concat(t),r],a=o[0],l=o.reduce((c,u)=>{const d=lg(e,u,s);return c.top=Ot(d.top,c.top),c.right=Xr(d.right,c.right),c.bottom=Xr(d.bottom,c.bottom),c.left=Ot(d.left,c.left),c},lg(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function qI(n){const{width:e,height:t}=dE(n);return{width:e,height:t}}function QI(n,e,t){const r=Hn(e),s=zn(e),i=t==="fixed",o=Cs(n,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=Gn(0);function c(){l.x=qh(s)}if(r||!r&&!i)if((Hi(e)!=="body"||oa(s))&&(a=Nc(e)),r){const h=Cs(e,!0,i,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else s&&c();i&&!r&&s&&c();const u=s&&!r&&!i?hE(s,a):Gn(0),d=o.left+a.scrollLeft-l.x-u.x,f=o.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function Pu(n){return Tn(n).position==="static"}function cg(n,e){if(!Hn(n)||Tn(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return zn(n)===t&&(t=t.ownerDocument.body),t}function pE(n,e){const t=$t(n);if(Dc(n))return t;if(!Hn(n)){let s=Zr(n);for(;s&&!Ni(s);){if(Sn(s)&&!Pu(s))return s;s=Zr(s)}return t}let r=cg(n,e);for(;r&&PI(r)&&Pu(r);)r=cg(r,e);return r&&Ni(r)&&Pu(r)&&!Wh(r)?t:r||FI(n)||t}const XI=async function(n){const e=this.getOffsetParent||pE,t=this.getDimensions,r=await t(n.floating);return{reference:QI(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function ZI(n){return Tn(n).direction==="rtl"}const JI={convertOffsetParentRelativeRectToViewportRelativeRect:jI,getDocumentElement:zn,getClippingRect:YI,getOffsetParent:pE,getElementRects:XI,getClientRects:GI,getDimensions:qI,getScale:fi,isElement:Sn,isRTL:ZI};function gE(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function eR(n,e){let t=null,r;const s=zn(n);function i(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=n.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=c;if(a||e(),!f||!h)return;const m=Da(d),p=Da(s.clientWidth-(u+f)),g=Da(s.clientHeight-(d+h)),v=Da(u),E={rootMargin:-m+"px "+-p+"px "+-g+"px "+-v+"px",threshold:Ot(0,Xr(1,l))||1};let T=!0;function b(L){const A=L[0].intersectionRatio;if(A!==l){if(!T)return o();A?o(!1,A):r=setTimeout(()=>{o(!1,1e-7)},1e3)}A===1&&!gE(c,n.getBoundingClientRect())&&o(),T=!1}try{t=new IntersectionObserver(b,{...E,root:s.ownerDocument})}catch{t=new IntersectionObserver(b,E)}t.observe(n)}return o(!0),i}function tR(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=Yh(n),u=s||i?[...c?Uo(c):[],...Uo(e)]:[];u.forEach(v=>{s&&v.addEventListener("scroll",t,{passive:!0}),i&&v.addEventListener("resize",t)});const d=c&&a?eR(c,t):null;let f=-1,h=null;o&&(h=new ResizeObserver(v=>{let[x]=v;x&&x.target===c&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var E;(E=h)==null||E.observe(e)})),t()}),c&&!l&&h.observe(c),h.observe(e));let m,p=l?Cs(n):null;l&&g();function g(){const v=Cs(n);p&&!gE(p,v)&&t(),p=v,m=requestAnimationFrame(g)}return t(),()=>{var v;u.forEach(x=>{s&&x.removeEventListener("scroll",t),i&&x.removeEventListener("resize",t)}),d==null||d(),(v=h)==null||v.disconnect(),h=null,l&&cancelAnimationFrame(m)}}const nR=LI,rR=II,sR=bI,iR=CI,oR=wI,ug=TI,aR=RI,lR=(n,e,t)=>{const r=new Map,s={platform:JI,...t},i={...s.platform,_c:r};return SI(n,e,{...s,platform:i})};var cR=typeof document<"u",uR=function(){},ml=cR?w.useLayoutEffect:uR;function Zl(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,s;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Zl(n[r],e[r]))return!1;return!0}if(s=Object.keys(n),t=s.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,s[r]))return!1;for(r=t;r--!==0;){const i=s[r];if(!(i==="_owner"&&n.$$typeof)&&!Zl(n[i],e[i]))return!1}return!0}return n!==n&&e!==e}function vE(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function dg(n,e){const t=vE(n);return Math.round(e*t)/t}function Du(n){const e=w.useRef(n);return ml(()=>{e.current=n}),e}function dR(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:s,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,d]=w.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,h]=w.useState(r);Zl(f,r)||h(r);const[m,p]=w.useState(null),[g,v]=w.useState(null),x=w.useCallback(k=>{k!==L.current&&(L.current=k,p(k))},[]),E=w.useCallback(k=>{k!==A.current&&(A.current=k,v(k))},[]),T=i||m,b=o||g,L=w.useRef(null),A=w.useRef(null),I=w.useRef(u),C=l!=null,R=Du(l),_=Du(s),O=Du(c),V=w.useCallback(()=>{if(!L.current||!A.current)return;const k={placement:e,strategy:t,middleware:f};_.current&&(k.platform=_.current),lR(L.current,A.current,k).then(D=>{const j={...D,isPositioned:O.current!==!1};M.current&&!Zl(I.current,j)&&(I.current=j,na.flushSync(()=>{d(j)}))})},[f,e,t,_,O]);ml(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(k=>({...k,isPositioned:!1})))},[c]);const M=w.useRef(!1);ml(()=>(M.current=!0,()=>{M.current=!1}),[]),ml(()=>{if(T&&(L.current=T),b&&(A.current=b),T&&b){if(R.current)return R.current(T,b,V);V()}},[T,b,V,R,C]);const K=w.useMemo(()=>({reference:L,floating:A,setReference:x,setFloating:E}),[x,E]),B=w.useMemo(()=>({reference:T,floating:b}),[T,b]),H=w.useMemo(()=>{const k={position:t,left:0,top:0};if(!B.floating)return k;const D=dg(B.floating,u.x),j=dg(B.floating,u.y);return a?{...k,transform:"translate("+D+"px, "+j+"px)",...vE(B.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:D,top:j}},[t,a,B.floating,u.x,u.y]);return w.useMemo(()=>({...u,update:V,refs:K,elements:B,floatingStyles:H}),[u,V,K,B,H])}const fR=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:s}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?ug({element:r.current,padding:s}).fn(t):{}:r?ug({element:r,padding:s}).fn(t):{}}}},hR=(n,e)=>({...nR(n),options:[n,e]}),mR=(n,e)=>({...rR(n),options:[n,e]}),pR=(n,e)=>({...aR(n),options:[n,e]}),gR=(n,e)=>({...sR(n),options:[n,e]}),vR=(n,e)=>({...iR(n),options:[n,e]}),yR=(n,e)=>({...oR(n),options:[n,e]}),xR=(n,e)=>({...fR(n),options:[n,e]});var ER="Arrow",yE=w.forwardRef((n,e)=>{const{children:t,width:r=10,height:s=5,...i}=n;return y.jsx(Ge.svg,{...i,ref:e,width:r,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:y.jsx("polygon",{points:"0,0 30,0 15,10"})})});yE.displayName=ER;var SR=yE;function TR(n){const[e,t]=w.useState(void 0);return dr(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var xE="Popper",[EE,SE]=ra(xE),[UO,TE]=EE(xE),bE="PopperAnchor",wE=w.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...s}=n,i=TE(bE,t),o=w.useRef(null),a=gt(e,o);return w.useEffect(()=>{i.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:y.jsx(Ge.div,{...s,ref:a})});wE.displayName=bE;var Qh="PopperContent",[bR,wR]=EE(Qh),AE=w.forwardRef((n,e)=>{var ne,Ae,Fe,Ye,st,pr;const{__scopePopper:t,side:r="bottom",sideOffset:s=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:h="optimized",onPlaced:m,...p}=n,g=TE(Qh,t),[v,x]=w.useState(null),E=gt(e,Ht=>x(Ht)),[T,b]=w.useState(null),L=TR(T),A=(L==null?void 0:L.width)??0,I=(L==null?void 0:L.height)??0,C=r+(i!=="center"?"-"+i:""),R=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},_=Array.isArray(c)?c:[c],O=_.length>0,V={padding:R,boundary:_.filter(LR),altBoundary:O},{refs:M,floatingStyles:K,placement:B,isPositioned:H,middlewareData:k}=dR({strategy:"fixed",placement:C,whileElementsMounted:(...Ht)=>tR(...Ht,{animationFrame:h==="always"}),elements:{reference:g.anchor},middleware:[hR({mainAxis:s+I,alignmentAxis:o}),l&&mR({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?pR():void 0,...V}),l&&gR({...V}),vR({...V,apply:({elements:Ht,rects:gr,availableWidth:ca,availableHeight:ue})=>{const{width:$e,height:qe}=gr.reference,xt=Ht.floating.style;xt.setProperty("--radix-popper-available-width",`${ca}px`),xt.setProperty("--radix-popper-available-height",`${ue}px`),xt.setProperty("--radix-popper-anchor-width",`${$e}px`),xt.setProperty("--radix-popper-anchor-height",`${qe}px`)}}),T&&xR({element:T,padding:a}),IR({arrowWidth:A,arrowHeight:I}),f&&yR({strategy:"referenceHidden",...V})]}),[D,j]=RE(B),$=Vn(m);dr(()=>{H&&($==null||$())},[H,$]);const F=(ne=k.arrow)==null?void 0:ne.x,Y=(Ae=k.arrow)==null?void 0:Ae.y,Q=((Fe=k.arrow)==null?void 0:Fe.centerOffset)!==0,[ee,te]=w.useState();return dr(()=>{v&&te(window.getComputedStyle(v).zIndex)},[v]),y.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:H?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ee,"--radix-popper-transform-origin":[(Ye=k.transformOrigin)==null?void 0:Ye.x,(st=k.transformOrigin)==null?void 0:st.y].join(" "),...((pr=k.hide)==null?void 0:pr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:y.jsx(bR,{scope:t,placedSide:D,onArrowChange:b,arrowX:F,arrowY:Y,shouldHideArrow:Q,children:y.jsx(Ge.div,{"data-side":D,"data-align":j,...p,ref:E,style:{...p.style,animation:H?void 0:"none"}})})})});AE.displayName=Qh;var LE="PopperArrow",AR={top:"bottom",right:"left",bottom:"top",left:"right"},IE=w.forwardRef(function(e,t){const{__scopePopper:r,...s}=e,i=wR(LE,r),o=AR[i.placedSide];return y.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:y.jsx(SR,{...s,ref:t,style:{...s.style,display:"block"}})})});IE.displayName=LE;function LR(n){return n!==null}var IR=n=>({name:"transformOrigin",options:n,fn(e){var g,v,x;const{placement:t,rects:r,middlewareData:s}=e,o=((g=s.arrow)==null?void 0:g.centerOffset)!==0,a=o?0:n.arrowWidth,l=o?0:n.arrowHeight,[c,u]=RE(t),d={start:"0%",center:"50%",end:"100%"}[u],f=(((v=s.arrow)==null?void 0:v.x)??0)+a/2,h=(((x=s.arrow)==null?void 0:x.y)??0)+l/2;let m="",p="";return c==="bottom"?(m=o?d:`${f}px`,p=`${-l}px`):c==="top"?(m=o?d:`${f}px`,p=`${r.floating.height+l}px`):c==="right"?(m=`${-l}px`,p=o?d:`${h}px`):c==="left"&&(m=`${r.floating.width+l}px`,p=o?d:`${h}px`),{data:{x:m,y:p}}}});function RE(n){const[e,t="center"]=n.split("-");return[e,t]}var RR=wE,CR=AE,kR=IE,[Oc,jO]=ra("Tooltip",[SE]),Xh=SE(),CE="TooltipProvider",_R=700,fg="tooltip.open",[PR,kE]=Oc(CE),_E=n=>{const{__scopeTooltip:e,delayDuration:t=_R,skipDelayDuration:r=300,disableHoverableContent:s=!1,children:i}=n,o=w.useRef(!0),a=w.useRef(!1),l=w.useRef(0);return w.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),y.jsx(PR,{scope:e,isOpenDelayedRef:o,delayDuration:t,onOpen:w.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:w.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:w.useCallback(c=>{a.current=c},[]),disableHoverableContent:s,children:i})};_E.displayName=CE;var PE="Tooltip",[GO,Mc]=Oc(PE),mf="TooltipTrigger",DR=w.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=Mc(mf,t),i=kE(mf,t),o=Xh(t),a=w.useRef(null),l=gt(e,a,s.onTriggerChange),c=w.useRef(!1),u=w.useRef(!1),d=w.useCallback(()=>c.current=!1,[]);return w.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),y.jsx(RR,{asChild:!0,...o,children:y.jsx(Ge.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...r,ref:l,onPointerMove:Re(n.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:Re(n.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:Re(n.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Re(n.onFocus,()=>{c.current||s.onOpen()}),onBlur:Re(n.onBlur,s.onClose),onClick:Re(n.onClick,s.onClose)})})});DR.displayName=mf;var NR="TooltipPortal",[VO,OR]=Oc(NR,{forceMount:void 0}),Oi="TooltipContent",DE=w.forwardRef((n,e)=>{const t=OR(Oi,n.__scopeTooltip),{forceMount:r=t.forceMount,side:s="top",...i}=n,o=Mc(Oi,n.__scopeTooltip);return y.jsx(ji,{present:r||o.open,children:o.disableHoverableContent?y.jsx(NE,{side:s,...i,ref:e}):y.jsx(MR,{side:s,...i,ref:e})})}),MR=w.forwardRef((n,e)=>{const t=Mc(Oi,n.__scopeTooltip),r=kE(Oi,n.__scopeTooltip),s=w.useRef(null),i=gt(e,s),[o,a]=w.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:d}=r,f=w.useCallback(()=>{a(null),d(!1)},[d]),h=w.useCallback((m,p)=>{const g=m.currentTarget,v={x:m.clientX,y:m.clientY},x=jR(v,g.getBoundingClientRect()),E=GR(v,x),T=VR(p.getBoundingClientRect()),b=KR([...E,...T]);a(b),d(!0)},[d]);return w.useEffect(()=>()=>f(),[f]),w.useEffect(()=>{if(l&&u){const m=g=>h(g,u),p=g=>h(g,l);return l.addEventListener("pointerleave",m),u.addEventListener("pointerleave",p),()=>{l.removeEventListener("pointerleave",m),u.removeEventListener("pointerleave",p)}}},[l,u,h,f]),w.useEffect(()=>{if(o){const m=p=>{const g=p.target,v={x:p.clientX,y:p.clientY},x=(l==null?void 0:l.contains(g))||(u==null?void 0:u.contains(g)),E=!HR(v,o);x?f():E&&(f(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,u,o,c,f]),y.jsx(NE,{...n,ref:i})}),[FR,BR]=Oc(PE,{isInside:!1}),$R=Hw("TooltipContent"),NE=w.forwardRef((n,e)=>{const{__scopeTooltip:t,children:r,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=n,l=Mc(Oi,t),c=Xh(t),{onClose:u}=l;return w.useEffect(()=>(document.addEventListener(fg,u),()=>document.removeEventListener(fg,u)),[u]),w.useEffect(()=>{if(l.trigger){const d=f=>{const h=f.target;h!=null&&h.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),y.jsx(Cc,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:y.jsxs(CR,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[y.jsx($R,{children:r}),y.jsx(FR,{scope:t,isInside:!0,children:y.jsx(mA,{id:l.contentId,role:"tooltip",children:s||r})})]})})});DE.displayName=Oi;var OE="TooltipArrow",UR=w.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=Xh(t);return BR(OE,t).isInside?null:y.jsx(kR,{...s,...r,ref:e})});UR.displayName=OE;function jR(n,e){const t=Math.abs(e.top-n.y),r=Math.abs(e.bottom-n.y),s=Math.abs(e.right-n.x),i=Math.abs(e.left-n.x);switch(Math.min(t,r,s,i)){case i:return"left";case s:return"right";case t:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function GR(n,e,t=5){const r=[];switch(e){case"top":r.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":r.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":r.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":r.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return r}function VR(n){const{top:e,right:t,bottom:r,left:s}=n;return[{x:s,y:e},{x:t,y:e},{x:t,y:r},{x:s,y:r}]}function HR(n,e){const{x:t,y:r}=n;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,d=l.x,f=l.y;u>r!=f>r&&t<(d-c)*(r-u)/(f-u)+c&&(s=!s)}return s}function KR(n){const e=n.slice();return e.sort((t,r)=>t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0),WR(e)}function WR(n){if(n.length<=1)return n.slice();const e=[];for(let r=0;r<n.length;r++){const s=n[r];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let r=n.length-1;r>=0;r--){const s=n[r];for(;t.length>=2;){const i=t[t.length-1],o=t[t.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var zR=_E,ME=DE;const YR=zR,qR=w.forwardRef(({className:n,sideOffset:e=4,...t},r)=>y.jsx(ME,{ref:r,sideOffset:e,className:Ve("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t}));qR.displayName=ME.displayName;var Fc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Bc=typeof window>"u"||"Deno"in globalThis;function fn(){}function QR(n,e){return typeof n=="function"?n(e):n}function XR(n){return typeof n=="number"&&n>=0&&n!==1/0}function ZR(n,e){return Math.max(n+(e||0)-Date.now(),0)}function pf(n,e){return typeof n=="function"?n(e):n}function JR(n,e){return typeof n=="function"?n(e):n}function hg(n,e){const{type:t="all",exact:r,fetchStatus:s,predicate:i,queryKey:o,stale:a}=n;if(o){if(r){if(e.queryHash!==Zh(o,e.options))return!1}else if(!Go(e.queryKey,o))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||s&&s!==e.state.fetchStatus||i&&!i(e))}function mg(n,e){const{exact:t,status:r,predicate:s,mutationKey:i}=n;if(i){if(!e.options.mutationKey)return!1;if(t){if(jo(e.options.mutationKey)!==jo(i))return!1}else if(!Go(e.options.mutationKey,i))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function Zh(n,e){return((e==null?void 0:e.queryKeyHashFn)||jo)(n)}function jo(n){return JSON.stringify(n,(e,t)=>gf(t)?Object.keys(t).sort().reduce((r,s)=>(r[s]=t[s],r),{}):t)}function Go(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>Go(n[t],e[t])):!1}function FE(n,e){if(n===e)return n;const t=pg(n)&&pg(e);if(t||gf(n)&&gf(e)){const r=t?n:Object.keys(n),s=r.length,i=t?e:Object.keys(e),o=i.length,a=t?[]:{},l=new Set(r);let c=0;for(let u=0;u<o;u++){const d=t?u:i[u];(!t&&l.has(d)||t)&&n[d]===void 0&&e[d]===void 0?(a[d]=void 0,c++):(a[d]=FE(n[d],e[d]),a[d]===n[d]&&n[d]!==void 0&&c++)}return s===o&&c===s?n:a}return e}function pg(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function gf(n){if(!gg(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!gg(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function gg(n){return Object.prototype.toString.call(n)==="[object Object]"}function eC(n){return new Promise(e=>{setTimeout(e,n)})}function tC(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?FE(n,e):e}function nC(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function rC(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var Jh=Symbol();function BE(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===Jh?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var ps,Dr,xi,J0,sC=(J0=class extends Fc{constructor(){super();he(this,ps);he(this,Dr);he(this,xi);oe(this,xi,e=>{if(!Bc&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){G(this,Dr)||this.setEventListener(G(this,xi))}onUnsubscribe(){var e;this.hasListeners()||((e=G(this,Dr))==null||e.call(this),oe(this,Dr,void 0))}setEventListener(e){var t;oe(this,xi,e),(t=G(this,Dr))==null||t.call(this),oe(this,Dr,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){G(this,ps)!==e&&(oe(this,ps,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof G(this,ps)=="boolean"?G(this,ps):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},ps=new WeakMap,Dr=new WeakMap,xi=new WeakMap,J0),$E=new sC,Ei,Nr,Si,ev,iC=(ev=class extends Fc{constructor(){super();he(this,Ei,!0);he(this,Nr);he(this,Si);oe(this,Si,e=>{if(!Bc&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){G(this,Nr)||this.setEventListener(G(this,Si))}onUnsubscribe(){var e;this.hasListeners()||((e=G(this,Nr))==null||e.call(this),oe(this,Nr,void 0))}setEventListener(e){var t;oe(this,Si,e),(t=G(this,Nr))==null||t.call(this),oe(this,Nr,e(this.setOnline.bind(this)))}setOnline(e){G(this,Ei)!==e&&(oe(this,Ei,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return G(this,Ei)}},Ei=new WeakMap,Nr=new WeakMap,Si=new WeakMap,ev),Jl=new iC;function oC(){let n,e;const t=new Promise((s,i)=>{n=s,e=i});t.status="pending",t.catch(()=>{});function r(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{r({status:"fulfilled",value:s}),n(s)},t.reject=s=>{r({status:"rejected",reason:s}),e(s)},t}function aC(n){return Math.min(1e3*2**n,3e4)}function UE(n){return(n??"online")==="online"?Jl.isOnline():!0}var jE=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function Nu(n){return n instanceof jE}function GE(n){let e=!1,t=0,r=!1,s;const i=oC(),o=p=>{var g;r||(f(new jE(p)),(g=n.abort)==null||g.call(n))},a=()=>{e=!0},l=()=>{e=!1},c=()=>$E.isFocused()&&(n.networkMode==="always"||Jl.isOnline())&&n.canRun(),u=()=>UE(n.networkMode)&&n.canRun(),d=p=>{var g;r||(r=!0,(g=n.onSuccess)==null||g.call(n,p),s==null||s(),i.resolve(p))},f=p=>{var g;r||(r=!0,(g=n.onError)==null||g.call(n,p),s==null||s(),i.reject(p))},h=()=>new Promise(p=>{var g;s=v=>{(r||c())&&p(v)},(g=n.onPause)==null||g.call(n)}).then(()=>{var p;s=void 0,r||(p=n.onContinue)==null||p.call(n)}),m=()=>{if(r)return;let p;const g=t===0?n.initialPromise:void 0;try{p=g??n.fn()}catch(v){p=Promise.reject(v)}Promise.resolve(p).then(d).catch(v=>{var L;if(r)return;const x=n.retry??(Bc?0:3),E=n.retryDelay??aC,T=typeof E=="function"?E(t,v):E,b=x===!0||typeof x=="number"&&t<x||typeof x=="function"&&x(t,v);if(e||!b){f(v);return}t++,(L=n.onFail)==null||L.call(n,t,v),eC(T).then(()=>c()?void 0:h()).then(()=>{e?f(v):m()})})};return{promise:i,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?m():h().then(m),i)}}var lC=n=>setTimeout(n,0);function cC(){let n=[],e=0,t=a=>{a()},r=a=>{a()},s=lC;const i=a=>{e?n.push(a):s(()=>{t(a)})},o=()=>{const a=n;n=[],a.length&&s(()=>{r(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{r=a},setScheduler:a=>{s=a}}}var ht=cC(),gs,tv,VE=(tv=class{constructor(){he(this,gs)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),XR(this.gcTime)&&oe(this,gs,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Bc?1/0:5*60*1e3))}clearGcTimeout(){G(this,gs)&&(clearTimeout(G(this,gs)),oe(this,gs,void 0))}},gs=new WeakMap,tv),Ti,vs,Wt,ys,lt,qo,xs,hn,Zn,nv,uC=(nv=class extends VE{constructor(e){super();he(this,hn);he(this,Ti);he(this,vs);he(this,Wt);he(this,ys);he(this,lt);he(this,qo);he(this,xs);oe(this,xs,!1),oe(this,qo,e.defaultOptions),this.setOptions(e.options),this.observers=[],oe(this,ys,e.client),oe(this,Wt,G(this,ys).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,oe(this,Ti,fC(this.options)),this.state=e.state??G(this,Ti),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=G(this,lt))==null?void 0:e.promise}setOptions(e){this.options={...G(this,qo),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&G(this,Wt).remove(this)}setData(e,t){const r=tC(this.state.data,e,this.options);return it(this,hn,Zn).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){it(this,hn,Zn).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,s;const t=(r=G(this,lt))==null?void 0:r.promise;return(s=G(this,lt))==null||s.cancel(e),t?t.then(fn).catch(fn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(G(this,Ti))}isActive(){return this.observers.some(e=>JR(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Jh||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>pf(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ZR(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=G(this,lt))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=G(this,lt))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),G(this,Wt).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(G(this,lt)&&(G(this,xs)?G(this,lt).cancel({revert:!0}):G(this,lt).cancelRetry()),this.scheduleGc()),G(this,Wt).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||it(this,hn,Zn).call(this,{type:"invalidate"})}fetch(e,t){var c,u,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(G(this,lt))return G(this,lt).continueRetry(),G(this,lt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(h=>h.options.queryFn);f&&this.setOptions(f.options)}const r=new AbortController,s=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(oe(this,xs,!0),r.signal)})},i=()=>{const f=BE(this.options,t),m=(()=>{const p={client:G(this,ys),queryKey:this.queryKey,meta:this.meta};return s(p),p})();return oe(this,xs,!1),this.options.persister?this.options.persister(f,m,this):f(m)},a=(()=>{const f={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:G(this,ys),state:this.state,fetchFn:i};return s(f),f})();(c=this.options.behavior)==null||c.onFetch(a,this),oe(this,vs,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&it(this,hn,Zn).call(this,{type:"fetch",meta:(d=a.fetchOptions)==null?void 0:d.meta});const l=f=>{var h,m,p,g;Nu(f)&&f.silent||it(this,hn,Zn).call(this,{type:"error",error:f}),Nu(f)||((m=(h=G(this,Wt).config).onError)==null||m.call(h,f,this),(g=(p=G(this,Wt).config).onSettled)==null||g.call(p,this.state.data,f,this)),this.scheduleGc()};return oe(this,lt,GE({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:f=>{var h,m,p,g;if(f===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(f)}catch(v){l(v);return}(m=(h=G(this,Wt).config).onSuccess)==null||m.call(h,f,this),(g=(p=G(this,Wt).config).onSettled)==null||g.call(p,f,this.state.error,this),this.scheduleGc()},onError:l,onFail:(f,h)=>{it(this,hn,Zn).call(this,{type:"failed",failureCount:f,error:h})},onPause:()=>{it(this,hn,Zn).call(this,{type:"pause"})},onContinue:()=>{it(this,hn,Zn).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),G(this,lt).start()}},Ti=new WeakMap,vs=new WeakMap,Wt=new WeakMap,ys=new WeakMap,lt=new WeakMap,qo=new WeakMap,xs=new WeakMap,hn=new WeakSet,Zn=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...dC(r.data,this.options),fetchMeta:e.meta??null};case"success":return oe(this,vs,void 0),{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return Nu(s)&&s.revert&&G(this,vs)?{...G(this,vs),fetchStatus:"idle"}:{...r,error:s,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),ht.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),G(this,Wt).notify({query:this,type:"updated",action:e})})},nv);function dC(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:UE(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function fC(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var _n,rv,hC=(rv=class extends Fc{constructor(e={}){super();he(this,_n);this.config=e,oe(this,_n,new Map)}build(e,t,r){const s=t.queryKey,i=t.queryHash??Zh(s,t);let o=this.get(i);return o||(o=new uC({client:e,queryKey:s,queryHash:i,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){G(this,_n).has(e.queryHash)||(G(this,_n).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=G(this,_n).get(e.queryHash);t&&(e.destroy(),t===e&&G(this,_n).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ht.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return G(this,_n).get(e)}getAll(){return[...G(this,_n).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>hg(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>hg(e,r)):t}notify(e){ht.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){ht.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ht.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},_n=new WeakMap,rv),Pn,dt,Es,Dn,Ar,sv,mC=(sv=class extends VE{constructor(e){super();he(this,Dn);he(this,Pn);he(this,dt);he(this,Es);this.mutationId=e.mutationId,oe(this,dt,e.mutationCache),oe(this,Pn,[]),this.state=e.state||pC(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){G(this,Pn).includes(e)||(G(this,Pn).push(e),this.clearGcTimeout(),G(this,dt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){oe(this,Pn,G(this,Pn).filter(t=>t!==e)),this.scheduleGc(),G(this,dt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){G(this,Pn).length||(this.state.status==="pending"?this.scheduleGc():G(this,dt).remove(this))}continue(){var e;return((e=G(this,Es))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,o,a,l,c,u,d,f,h,m,p,g,v,x,E,T,b,L,A,I;const t=()=>{it(this,Dn,Ar).call(this,{type:"continue"})};oe(this,Es,GE({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(C,R)=>{it(this,Dn,Ar).call(this,{type:"failed",failureCount:C,error:R})},onPause:()=>{it(this,Dn,Ar).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>G(this,dt).canRun(this)}));const r=this.state.status==="pending",s=!G(this,Es).canStart();try{if(r)t();else{it(this,Dn,Ar).call(this,{type:"pending",variables:e,isPaused:s}),await((o=(i=G(this,dt).config).onMutate)==null?void 0:o.call(i,e,this));const R=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,e));R!==this.state.context&&it(this,Dn,Ar).call(this,{type:"pending",context:R,variables:e,isPaused:s})}const C=await G(this,Es).start();return await((u=(c=G(this,dt).config).onSuccess)==null?void 0:u.call(c,C,e,this.state.context,this)),await((f=(d=this.options).onSuccess)==null?void 0:f.call(d,C,e,this.state.context)),await((m=(h=G(this,dt).config).onSettled)==null?void 0:m.call(h,C,null,this.state.variables,this.state.context,this)),await((g=(p=this.options).onSettled)==null?void 0:g.call(p,C,null,e,this.state.context)),it(this,Dn,Ar).call(this,{type:"success",data:C}),C}catch(C){try{throw await((x=(v=G(this,dt).config).onError)==null?void 0:x.call(v,C,e,this.state.context,this)),await((T=(E=this.options).onError)==null?void 0:T.call(E,C,e,this.state.context)),await((L=(b=G(this,dt).config).onSettled)==null?void 0:L.call(b,void 0,C,this.state.variables,this.state.context,this)),await((I=(A=this.options).onSettled)==null?void 0:I.call(A,void 0,C,e,this.state.context)),C}finally{it(this,Dn,Ar).call(this,{type:"error",error:C})}}finally{G(this,dt).runNext(this)}}},Pn=new WeakMap,dt=new WeakMap,Es=new WeakMap,Dn=new WeakSet,Ar=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),ht.batch(()=>{G(this,Pn).forEach(r=>{r.onMutationUpdate(e)}),G(this,dt).notify({mutation:this,type:"updated",action:e})})},sv);function pC(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rr,mn,Qo,iv,gC=(iv=class extends Fc{constructor(e={}){super();he(this,rr);he(this,mn);he(this,Qo);this.config=e,oe(this,rr,new Set),oe(this,mn,new Map),oe(this,Qo,0)}build(e,t,r){const s=new mC({mutationCache:this,mutationId:++fa(this,Qo)._,options:e.defaultMutationOptions(t),state:r});return this.add(s),s}add(e){G(this,rr).add(e);const t=Na(e);if(typeof t=="string"){const r=G(this,mn).get(t);r?r.push(e):G(this,mn).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(G(this,rr).delete(e)){const t=Na(e);if(typeof t=="string"){const r=G(this,mn).get(t);if(r)if(r.length>1){const s=r.indexOf(e);s!==-1&&r.splice(s,1)}else r[0]===e&&G(this,mn).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Na(e);if(typeof t=="string"){const r=G(this,mn).get(t),s=r==null?void 0:r.find(i=>i.state.status==="pending");return!s||s===e}else return!0}runNext(e){var r;const t=Na(e);if(typeof t=="string"){const s=(r=G(this,mn).get(t))==null?void 0:r.find(i=>i!==e&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ht.batch(()=>{G(this,rr).forEach(e=>{this.notify({type:"removed",mutation:e})}),G(this,rr).clear(),G(this,mn).clear()})}getAll(){return Array.from(G(this,rr))}find(e){const t={exact:!0,...e};return this.getAll().find(r=>mg(t,r))}findAll(e={}){return this.getAll().filter(t=>mg(e,t))}notify(e){ht.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return ht.batch(()=>Promise.all(e.map(t=>t.continue().catch(fn))))}},rr=new WeakMap,mn=new WeakMap,Qo=new WeakMap,iv);function Na(n){var e;return(e=n.options.scope)==null?void 0:e.id}function vg(n){return{onFetch:(e,t)=>{var u,d,f,h,m;const r=e.options,s=(f=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,i=((h=e.state.data)==null?void 0:h.pages)||[],o=((m=e.state.data)==null?void 0:m.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let p=!1;const g=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},v=BE(e.options,e.fetchOptions),x=async(E,T,b)=>{if(p)return Promise.reject();if(T==null&&E.pages.length)return Promise.resolve(E);const A=(()=>{const _={client:e.client,queryKey:e.queryKey,pageParam:T,direction:b?"backward":"forward",meta:e.options.meta};return g(_),_})(),I=await v(A),{maxPages:C}=e.options,R=b?rC:nC;return{pages:R(E.pages,I,C),pageParams:R(E.pageParams,T,C)}};if(s&&i.length){const E=s==="backward",T=E?vC:yg,b={pages:i,pageParams:o},L=T(r,b);a=await x(b,L,E)}else{const E=n??i.length;do{const T=l===0?o[0]??r.initialPageParam:yg(r,a);if(l>0&&T==null)break;a=await x(a,T),l++}while(l<E)}return a};e.options.persister?e.fetchFn=()=>{var p,g;return(g=(p=e.options).persister)==null?void 0:g.call(p,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function yg(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function vC(n,{pages:e,pageParams:t}){var r;return e.length>0?(r=n.getPreviousPageParam)==null?void 0:r.call(n,e[0],e,t[0],t):void 0}var Ne,Or,Mr,bi,wi,Fr,Ai,Li,ov,yC=(ov=class{constructor(n={}){he(this,Ne);he(this,Or);he(this,Mr);he(this,bi);he(this,wi);he(this,Fr);he(this,Ai);he(this,Li);oe(this,Ne,n.queryCache||new hC),oe(this,Or,n.mutationCache||new gC),oe(this,Mr,n.defaultOptions||{}),oe(this,bi,new Map),oe(this,wi,new Map),oe(this,Fr,0)}mount(){fa(this,Fr)._++,G(this,Fr)===1&&(oe(this,Ai,$E.subscribe(async n=>{n&&(await this.resumePausedMutations(),G(this,Ne).onFocus())})),oe(this,Li,Jl.subscribe(async n=>{n&&(await this.resumePausedMutations(),G(this,Ne).onOnline())})))}unmount(){var n,e;fa(this,Fr)._--,G(this,Fr)===0&&((n=G(this,Ai))==null||n.call(this),oe(this,Ai,void 0),(e=G(this,Li))==null||e.call(this),oe(this,Li,void 0))}isFetching(n){return G(this,Ne).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return G(this,Or).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=G(this,Ne).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=G(this,Ne).build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(pf(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return G(this,Ne).findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),s=G(this,Ne).get(r.queryHash),i=s==null?void 0:s.state.data,o=QR(e,i);if(o!==void 0)return G(this,Ne).build(this,r).setData(o,{...t,manual:!0})}setQueriesData(n,e,t){return ht.batch(()=>G(this,Ne).findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=G(this,Ne).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=G(this,Ne);ht.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=G(this,Ne);return ht.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=ht.batch(()=>G(this,Ne).findAll(n).map(s=>s.cancel(t)));return Promise.all(r).then(fn).catch(fn)}invalidateQueries(n,e={}){return ht.batch(()=>(G(this,Ne).findAll(n).forEach(t=>{t.invalidate()}),(n==null?void 0:n.refetchType)==="none"?Promise.resolve():this.refetchQueries({...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=ht.batch(()=>G(this,Ne).findAll(n).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(fn)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(fn)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=G(this,Ne).build(this,e);return t.isStaleByTime(pf(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(fn).catch(fn)}fetchInfiniteQuery(n){return n.behavior=vg(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(fn).catch(fn)}ensureInfiniteQueryData(n){return n.behavior=vg(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Jl.isOnline()?G(this,Or).resumePausedMutations():Promise.resolve()}getQueryCache(){return G(this,Ne)}getMutationCache(){return G(this,Or)}getDefaultOptions(){return G(this,Mr)}setDefaultOptions(n){oe(this,Mr,n)}setQueryDefaults(n,e){G(this,bi).set(jo(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...G(this,bi).values()],t={};return e.forEach(r=>{Go(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){G(this,wi).set(jo(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...G(this,wi).values()],t={};return e.forEach(r=>{Go(n,r.mutationKey)&&Object.assign(t,r.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...G(this,Mr).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=Zh(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Jh&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...G(this,Mr).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){G(this,Ne).clear(),G(this,Or).clear()}},Ne=new WeakMap,Or=new WeakMap,Mr=new WeakMap,bi=new WeakMap,wi=new WeakMap,Fr=new WeakMap,Ai=new WeakMap,Li=new WeakMap,ov),xC=w.createContext(void 0),EC=({client:n,children:e})=>(w.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),y.jsx(xC.Provider,{value:n,children:e}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ec(){return ec=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ec.apply(this,arguments)}var Ur;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Ur||(Ur={}));const xg="popstate";function SC(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return vf("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:KE(s)}return bC(e,t,null,n)}function kt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function HE(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function TC(){return Math.random().toString(36).substr(2,8)}function Eg(n,e){return{usr:n.state,key:n.key,idx:e}}function vf(n,e,t,r){return t===void 0&&(t=null),ec({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?$c(e):e,{state:t,key:e&&e.key||r||TC()})}function KE(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function $c(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function bC(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=Ur.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(ec({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Ur.Pop;let g=u(),v=g==null?null:g-c;c=g,l&&l({action:a,location:p.location,delta:v})}function f(g,v){a=Ur.Push;let x=vf(p.location,g,v);c=u()+1;let E=Eg(x,c),T=p.createHref(x);try{o.pushState(E,"",T)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;s.location.assign(T)}i&&l&&l({action:a,location:p.location,delta:1})}function h(g,v){a=Ur.Replace;let x=vf(p.location,g,v);c=u();let E=Eg(x,c),T=p.createHref(x);o.replaceState(E,"",T),i&&l&&l({action:a,location:p.location,delta:0})}function m(g){let v=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof g=="string"?g:KE(g);return x=x.replace(/ $/,"%20"),kt(v,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,v)}let p={get action(){return a},get location(){return n(s,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(xg,d),l=g,()=>{s.removeEventListener(xg,d),l=null}},createHref(g){return e(s,g)},createURL:m,encodeLocation(g){let v=m(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:f,replace:h,go(g){return o.go(g)}};return p}var Sg;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Sg||(Sg={}));function wC(n,e,t){return t===void 0&&(t="/"),AC(n,e,t,!1)}function AC(n,e,t,r){let s=typeof e=="string"?$c(e):e,i=YE(s.pathname||"/",t);if(i==null)return null;let o=WE(n);LC(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=FC(i);a=OC(o[l],c,r)}return a}function WE(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(kt(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=hi([r,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(kt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),WE(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:DC(c,i.index),routesMeta:u})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of zE(i.path))s(i,o,l)}),e}function zE(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=zE(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function LC(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:NC(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const IC=/^:[\w-]+$/,RC=3,CC=2,kC=1,_C=10,PC=-2,Tg=n=>n==="*";function DC(n,e){let t=n.split("/"),r=t.length;return t.some(Tg)&&(r+=PC),e&&(r+=CC),t.filter(s=>!Tg(s)).reduce((s,i)=>s+(IC.test(i)?RC:i===""?kC:_C),r)}function NC(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function OC(n,e,t){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=bg({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d&&c&&t&&!r[r.length-1].route.index&&(d=bg({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:hi([i,d.pathname]),pathnameBase:BC(hi([i,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(i=hi([i,d.pathnameBase]))}return o}function bg(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=MC(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,u,d)=>{let{paramName:f,isOptional:h}=u;if(f==="*"){let p=a[d]||"";o=i.slice(0,i.length-p.length).replace(/(.)\/+$/,"$1")}const m=a[d];return h&&!m?c[f]=void 0:c[f]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:n}}function MC(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),HE(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function FC(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return HE(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function YE(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const hi=n=>n.join("/").replace(/\/\/+/g,"/"),BC=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/");function $C(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const qE=["post","put","patch","delete"];new Set(qE);const UC=["get",...qE];new Set(UC);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tc(){return tc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tc.apply(this,arguments)}const jC=w.createContext(null),GC=w.createContext(null),QE=w.createContext(null),Uc=w.createContext(null),jc=w.createContext({outlet:null,matches:[],isDataRoute:!1}),XE=w.createContext(null);function em(){return w.useContext(Uc)!=null}function ZE(){return em()||kt(!1),w.useContext(Uc).location}function VC(n,e){return HC(n,e)}function HC(n,e,t,r){em()||kt(!1);let{navigator:s}=w.useContext(QE),{matches:i}=w.useContext(jc),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=ZE(),u;if(e){var d;let g=typeof e=="string"?$c(e):e;l==="/"||(d=g.pathname)!=null&&d.startsWith(l)||kt(!1),u=g}else u=c;let f=u.pathname||"/",h=f;if(l!=="/"){let g=l.replace(/^\//,"").split("/");h="/"+f.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=wC(n,{pathname:h}),p=qC(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},a,g.params),pathname:hi([l,s.encodeLocation?s.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:hi([l,s.encodeLocation?s.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,t,r);return e&&p?w.createElement(Uc.Provider,{value:{location:tc({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ur.Pop}},p):p}function KC(){let n=JC(),e=$C(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),t?w.createElement("pre",{style:s},t):null,null)}const WC=w.createElement(KC,null);class zC extends w.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?w.createElement(jc.Provider,{value:this.props.routeContext},w.createElement(XE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function YC(n){let{routeContext:e,match:t,children:r}=n,s=w.useContext(jC);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),w.createElement(jc.Provider,{value:e},r)}function qC(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||kt(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:f,errors:h}=t,m=d.route.loader&&f[d.route.id]===void 0&&(!h||h[d.route.id]===void 0);if(d.route.lazy||m){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,f)=>{let h,m=!1,p=null,g=null;t&&(h=a&&d.route.id?a[d.route.id]:void 0,p=d.route.errorElement||WC,l&&(c<0&&f===0?(m=!0,g=null):c===f&&(m=!0,g=d.route.hydrateFallbackElement||null)));let v=e.concat(o.slice(0,f+1)),x=()=>{let E;return h?E=p:m?E=g:d.route.Component?E=w.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=u,w.createElement(YC,{match:d,routeContext:{outlet:u,matches:v,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?w.createElement(zC,{location:t.location,revalidation:t.revalidation,component:p,error:h,children:x(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):x()},null)}var yf=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(yf||{});function QC(n){let e=w.useContext(GC);return e||kt(!1),e}function XC(n){let e=w.useContext(jc);return e||kt(!1),e}function ZC(n){let e=XC(),t=e.matches[e.matches.length-1];return t.route.id||kt(!1),t.route.id}function JC(){var n;let e=w.useContext(XE),t=QC(yf.UseRouteError),r=ZC(yf.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function ek(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function xf(n){kt(!1)}function tk(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Ur.Pop,navigator:i,static:o=!1,future:a}=n;em()&&kt(!1);let l=e.replace(/^\/*/,"/"),c=w.useMemo(()=>({basename:l,navigator:i,static:o,future:tc({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=$c(r));let{pathname:u="/",search:d="",hash:f="",state:h=null,key:m="default"}=r,p=w.useMemo(()=>{let g=YE(u,l);return g==null?null:{location:{pathname:g,search:d,hash:f,state:h,key:m},navigationType:s}},[l,u,d,f,h,m,s]);return p==null?null:w.createElement(QE.Provider,{value:c},w.createElement(Uc.Provider,{children:t,value:p}))}function nk(n){let{children:e,location:t}=n;return VC(Ef(e),t)}new Promise(()=>{});function Ef(n,e){e===void 0&&(e=[]);let t=[];return w.Children.forEach(n,(r,s)=>{if(!w.isValidElement(r))return;let i=[...e,s];if(r.type===w.Fragment){t.push.apply(t,Ef(r.props.children,i));return}r.type!==xf&&kt(!1),!r.props.index||!r.props.children||kt(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Ef(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const rk="6";try{window.__reactRouterVersion=rk}catch{}const sk="startTransition",wg=Wf[sk];function ik(n){let{basename:e,children:t,future:r,window:s}=n,i=w.useRef();i.current==null&&(i.current=SC({window:s,v5Compat:!0}));let o=i.current,[a,l]=w.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},u=w.useCallback(d=>{c&&wg?wg(()=>l(d)):l(d)},[l,c]);return w.useLayoutEffect(()=>o.listen(u),[o,u]),w.useEffect(()=>ek(r),[r]),w.createElement(tk,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}var Ag;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Ag||(Ag={}));var Lg;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Lg||(Lg={}));const ok=jh("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Gc=w.forwardRef(({className:n,variant:e,size:t,asChild:r=!1,...s},i)=>{const o=r?Gw:"button";return y.jsx(o,{className:Ve(ok({variant:e,size:t,className:n})),ref:i,...s})});Gc.displayName="Button";const q=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},ak=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=lk},lk=Number.MAX_SAFE_INTEGER||9007199254740991;let J=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),N=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),S=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var ce={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Z={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Bs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class ck{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Bs(e),this.fast_=new Bs(t),this.defaultTTFB_=s,this.ttfb_=new Bs(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Bs(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Bs(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Bs(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function uk(n,e,t){return(e=fk(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ye(){return ye=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ye.apply(null,arguments)}function Ig(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function ve(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ig(Object(t),!0).forEach(function(r){uk(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ig(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function dk(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function fk(n){var e=dk(n,"string");return typeof e=="symbol"?e:e+""}class tn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Cr,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Cr=function(){},hk={trace:Cr,debug:Cr,log:Cr,warn:Cr,info:Cr,error:Cr};function Sf(){return ye({},hk)}function mk(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Cr}function Rg(n,e,t){return e[n]?e[n].bind(e):mk(n,t)}const Tf=Sf();function pk(n,e,t){const r=Sf();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Rg(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.11`)}catch{return Sf()}s.forEach(i=>{Tf[i]=Rg(i,n)})}else ye(Tf,r);return r}const me=Tf;function Jr(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function gk(n){return typeof self<"u"&&n===self.ManagedMediaSource}function JE(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function Ut(n,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",a=0;for(;a<t;){if(r=n[a++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[a++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[a++],i=n[a++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function Nt(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function eS(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function vk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ou={exports:{}},Cg;function yk(){return Cg||(Cg=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var m=s.exec(h.path);h.netLoc=m[1],h.path=m[2]}h.netLoc&&!h.path&&(h.path="/");var p={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(p.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)p.path=h.path,f.params||(p.params=h.params,f.query||(p.query=h.query));else{var g=h.path,v=g.substring(0,g.lastIndexOf("/")+1)+f.path;p.path=a.normalizePath(v)}return p.path===null&&(p.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(p)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(Ou)),Ou.exports}var tm=yk();class nm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var xe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class tS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Ek(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[xe.AUDIO]:null,[xe.VIDEO]:null,[xe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new nm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=tm.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[xe.AUDIO]=null,e[xe.VIDEO]=null,e[xe.AUDIOVIDEO]=null}}function Ue(n){return n.sn!=="initSegment"}class Mu extends tS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(q(e)&&q(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1){const s=this._decryptdata=this.levelkeys[r[0]]||null;if(s)return s.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=q(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!q(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ue(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class xk extends tS{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function nS(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||nS(t,e)}}function Ek(n,e){const t=nS(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const kg=Math.pow(2,32)-1,Sk=[].push,rS={video:1,audio:2,id3:3,text:4};function He(n){return String.fromCharCode.apply(null,n)}function sS(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function re(n,e){const t=iS(n,e);return t<0?4294967296+t:t}function _g(n,e){let t=re(n,e);return t*=Math.pow(2,32),t+=re(n,e+4),t}function iS(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Tk(n){const e=n.byteLength;for(let t=0;t<e;){const r=re(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function le(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=re(n,s),o=He(n.subarray(s+4,s+8)),a=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,a));else{const l=le(n.subarray(s+8,a),e.slice(1));l.length&&Sk.apply(t,l)}s=a}return t}function bk(n){const e=[],t=n[0];let r=8;const s=re(n,r);r+=4;let i=0,o=0;t===0?(i=re(n,r),o=re(n,r+4),r+=8):(i=_g(n,r),o=_g(n,r+8),r+=16),r+=2;let a=n.length+o;const l=sS(n,r);r+=2;for(let c=0;c<l;c++){let u=r;const d=re(n,u);u+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return me.warn("SIDX has hierarchical references (not supported)"),null;const m=re(n,u);u+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/s,start:a,end:a+f-1}}),a+=f,u+=4,r=u}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function oS(n){const e=[],t=le(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=le(i,["tkhd"])[0];if(o){let a=o[0];const l=re(o,a===0?12:20),c=le(i,["mdia","mdhd"])[0];if(c){a=c[0];const u=re(c,a===0?12:20),d=le(i,["mdia","hdlr"])[0];if(d){const f=He(d.subarray(8,12)),h={soun:xe.AUDIO,vide:xe.VIDEO}[f],m=le(i,["mdia","minf","stbl","stsd"])[0],p=wk(m);h?(e[l]={timescale:u,type:h,stsd:p},e[h]=ve({timescale:u,id:l},p)):e[l]={timescale:u,type:f,stsd:p}}}}}return le(n,["moov","mvex","trex"]).forEach(s=>{const i=re(s,4),o=e[i];o&&(o.default={duration:re(s,12),flags:re(s,20)})}),e}function wk(n){const e=n.subarray(8),t=e.subarray(86),r=He(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const c=le(e,[r])[0].subarray(r==="enca"?28:78);le(c,["sinf"]).forEach(d=>{const f=le(d,["schm"])[0];if(f){const h=He(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const m=le(d,["frma"])[0];m&&(s=He(m))}}})}const a=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=le(t,["avcC"])[0];l&&l.length>3&&(s+="."+Ma(l[1])+Ma(l[2])+Ma(l[3]),i=Oa(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=le(e,[r])[0],c=le(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Fu(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=Fu(c,u);const f=c[u++];if(f===64)s+="."+Ma(f);else break;if(u+=12,c[u++]!==5)break;u=Fu(c,u);const h=c[u++];let m=(h&248)>>3;m===31&&(m+=1+((h&7)<<3)+((c[u]&224)>>5)),s+="."+m}break}case"hvc1":case"hev1":{const l=le(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,f=re(l,2),h=(c&32)>>5?"H":"L",m=l[12],p=l.subarray(6,12);s+="."+u+d,s+="."+Ak(f).toString(16).toUpperCase(),s+="."+h+m;let g="";for(let v=p.length;v--;){const x=p[v];(x||g)&&(g="."+x.toString(16).toUpperCase()+g)}s+=g}i=Oa(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Oa(s,t)||s;break}case"vp09":{const l=le(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;s+="."+kn(c)+"."+kn(u)+"."+kn(d)}break}case"av01":{const l=le(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,h=(l[2]&32)>>5,m=c===2&&f?h?12:10:f?10:8,p=(l[2]&16)>>4,g=(l[2]&8)>>3,v=(l[2]&4)>>2,x=l[2]&3;s+="."+c+"."+kn(u)+d+"."+kn(m)+"."+p+"."+g+v+x+"."+kn(1)+"."+kn(1)+"."+kn(1)+"."+0,i=Oa("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function Oa(n,e){const t=le(e,["dvvC"]),r=t.length?t[0]:le(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+kn(s)+"."+kn(i)}}function Ak(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Fu(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Ma(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function kn(n){return(n<10?"0":"")+n}function Lk(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&le(n,["moov","trak"]).forEach(s=>{const o=le(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=le(o,["enca"]);const l=a.length>0;l||(a=le(o,["encv"])),a.forEach(c=>{const u=l?c.subarray(28):c.subarray(78);le(u,["sinf"]).forEach(f=>{const h=aS(f);if(h){const m=h.subarray(8,24);m.some(p=>p!==0)||(me.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Nt(m)} -> ${Nt(t)}`),h.set(t,8))}})})})}function aS(n){const e=le(n,["schm"])[0];if(e){const t=He(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return le(n,["schi","tenc"])[0]}return null}function Ik(n,e,t){const r={},s=le(n,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],a=le(o,["tfhd"])[0],l=re(a,4),c=e[l];if(!c)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=r[l],d=le(o,["tfdt"])[0];if(d){const E=d[0];let T=re(d,4);E===1&&(T===kg?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=kg+1,T+=re(d,8))),q(T)&&(!q(u.start)||T<u.start)&&(u.start=T)}const f=c.default,h=re(a,0)|(f==null?void 0:f.flags);let m=(f==null?void 0:f.duration)||0;h&8&&(h&2?m=re(a,12):m=re(a,8));const p=le(o,["trun"]);let g=u.start||0,v=0,x=m;for(let E=0;E<p.length;E++){const T=p[E],b=re(T,4),L=u.sampleCount;u.sampleCount+=b;const A=T[3]&1,I=T[3]&4,C=T[2]&1,R=T[2]&2,_=T[2]&4,O=T[2]&8;let V=8,M=b;for(A&&(V+=4),I&&b&&(!(T[V+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=L),V+=4,C?(x=re(T,V),V+=4):x=m,R&&(V+=4),O&&(V+=4),g+=x,v+=x,M--);M--;)C?(x=re(T,V),V+=4):x=m,R&&(V+=4),_&&(T[V+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(M+1),u.keyFrameStart=g),V+=4),O&&(V+=4),g+=x,v+=x;!v&&m&&(v+=m*b)}u.duration+=v}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const a=le(n,["sidx"]);for(let l=0;l<a.length;l++){const c=bk(a[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,f)=>d+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&q(o)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=o*r[l].timescale-r[l].start)})}return r}function Rk(n){const e={valid:null,remainder:null},t=le(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function en(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Pg(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return le(r,["moof"]).map(l=>{const c=l.byteOffset-8;le(l,["traf"]).map(d=>{const f=le(d,["tfdt"]).map(h=>{const m=h[0];let p=re(h,4);return m===1&&(p*=Math.pow(2,32),p+=re(h,8)),p/s})[0];return f!==void 0&&(n=f),le(d,["tfhd"]).map(h=>{const m=re(h,4),p=re(h,0)&16777215,g=(p&1)!==0,v=(p&2)!==0,x=(p&8)!==0;let E=0;const T=(p&16)!==0;let b=0;const L=(p&32)!==0;let A=8;m===i&&(g&&(A+=8),v&&(A+=4),x&&(E=re(h,A),A+=4),T&&(b=re(h,A),A+=4),L&&(A+=4),e.type==="video"&&(o=Vc(e.codec)),le(d,["trun"]).map(I=>{const C=I[0],R=re(I,0)&16777215,_=(R&1)!==0;let O=0;const V=(R&4)!==0,M=(R&256)!==0;let K=0;const B=(R&512)!==0;let H=0;const k=(R&1024)!==0,D=(R&2048)!==0;let j=0;const $=re(I,4);let F=8;_&&(O=re(I,F),F+=4),V&&(F+=4);let Y=O+c;for(let Q=0;Q<$;Q++){if(M?(K=re(I,F),F+=4):K=E,B?(H=re(I,F),F+=4):H=b,k&&(F+=4),D&&(C===0?j=re(I,F):j=iS(I,F),F+=4),e.type===xe.VIDEO){let ee=0;for(;ee<H;){const te=re(r,Y);if(Y+=4,Ck(o,r[Y])){const ne=r.subarray(Y,Y+te);rm(ne,o?2:1,n+j/s,t)}Y+=te,ee+=te+4}}n+=K/s}}))})})}),t}function Vc(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Ck(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function rm(n,e,t,r){const s=lS(n);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const c=s.length-i;let u=i;if(a<c)i+=a;else if(a>c){me.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(s[u++]===181){const f=sS(s,u);if(u+=2,f===49){const h=re(s,u);if(u+=4,h===1195456820){const m=s[u++];if(m===3){const p=s[u++],g=31&p,v=64&p,x=v?2+g*3:0,E=new Uint8Array(x);if(v){E[0]=p;for(let T=1;T<x;T++)E[T]=s[u++]}r.push({type:m,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let m=0;m<16;m++){const p=s[u++].toString(16);d.push(p.length==1?"0"+p:p),(m===3||m===5||m===7||m===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let m=0;m<f;m++)h[m]=s[u++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Ut(h),userDataBytes:h})}}}function lS(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function kk(n){const e=n[0];let t="",r="",s=0,i=0,o=0,a=0,l=0,c=0;if(e===0){for(;He(n.subarray(c,c+1))!=="\0";)t+=He(n.subarray(c,c+1)),c+=1;for(t+=He(n.subarray(c,c+1)),c+=1;He(n.subarray(c,c+1))!=="\0";)r+=He(n.subarray(c,c+1)),c+=1;r+=He(n.subarray(c,c+1)),c+=1,s=re(n,12),i=re(n,16),a=re(n,20),l=re(n,24),c=28}else if(e===1){c+=4,s=re(n,c),c+=4;const d=re(n,c);c+=4;const f=re(n,c);for(c+=4,o=2**32*d+f,ak(o)||(o=Number.MAX_SAFE_INTEGER,me.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=re(n,c),c+=4,l=re(n,c),c+=4;He(n.subarray(c,c+1))!=="\0";)t+=He(n.subarray(c,c+1)),c+=1;for(t+=He(n.subarray(c,c+1)),c+=1;He(n.subarray(c,c+1))!=="\0";)r+=He(n.subarray(c,c+1)),c+=1;r+=He(n.subarray(c,c+1)),c+=1}const u=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:u}}function _k(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function Pk(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),_k([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t)}const cS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Mi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function sm(n,e){const t=Mi[e];return!!t&&!!t[n.slice(0,4)]}function bf(n,e,t=!0){return!n.split(",").some(r=>!im(r,e,t))}function im(n,e,t=!0){var r;const s=Jr(t);return(r=s==null?void 0:s.isTypeSupported(Vo(n,e)))!=null?r:!1}function Vo(n,e){return`${e}/mp4;codecs=${n}`}function Dg(n){if(n){const e=n.substring(0,4);return Mi.video[e]}return 2}function nc(n){const e=cS();return n.split(",").reduce((t,r)=>{const i=e&&Vc(r)?9:Mi.video[r];return i?(i*2+t)/(t?3:2):(Mi.audio[r]+t)/(t?2:1)},0)}const Bu={};function Dk(n,e=!0){if(Bu[n])return Bu[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(im(t[s],"audio",e))return Bu[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Jr(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const Nk=/flac|opus|mp4a\.40\.34/i;function rc(n,e=!0){return n.replace(Nk,t=>Dk(t.toLowerCase(),e))}function Ok(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)sm(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function pl(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(Ng(n,"audio")||Ng(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function Ng(n,e){return sm(n,e)&&im(n,e)}function Mk(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Fk(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function Og(n){const e=Jr(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function wf(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Bk={supported:!0,powerEfficient:!0,smooth:!0},$k={supported:!1,smooth:!1,powerEfficient:!1},uS={supported:!0,configurations:[],decodingInfoResults:[Bk]};function dS(n,e){return{supported:!1,configurations:e,decodingInfoResults:[$k],error:n}}function Uk(n,e,t,r,s,i){const o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((f,h)=>{if(h){const m=e.groups[h];if(!m)throw new Error(`Audio track group ${h} not found`);Object.keys(m.channels).forEach(p=>{f[p]=(f[p]||0)+m.channels[p]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>Vc(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!d&&q(u)&&Object.keys(d).some(f=>parseInt(f)>u)}function fS(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(uS);const i=[],o=jk(n),a=o.length,l=Gk(n,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const d={type:"media-source"};if(a&&(d.video=o[u%a]),c){d.audio=l[u%c];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}i.push(d)}if(s){const u=navigator.userAgent;if(s.split(",").some(d=>Vc(d))&&cS())return Promise.resolve(dS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),i))}return Promise.all(i.map(u=>{const d=Hk(u);return r[d]||(r[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:i,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:i,decodingInfoResults:[],error:u}))}function jk(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=hS(n),s=n.width||640,i=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Vo(Fk(l),"video"),width:s,height:i,bitrate:r,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function Gk(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=hS(n);return s&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===a){const f=parseFloat(d.channels||"");s.forEach(h=>{const m={contentType:Vo(h,"audio"),bitrate:t?Vk(h,i):i};f&&(m.channels=""+f),u.push(m)})}return u},o):o},[]):[]}function Vk(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function hS(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Hk(n){let e="";const{audio:t,video:r}=n;if(r){const s=wf(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=wf(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const Af=["NONE","TYPE-0","TYPE-1",null];function Kk(n){return Af.indexOf(n)>-1}const sc=["SDR","PQ","HLG"];function Wk(n){return!!n&&sc.indexOf(n)>-1}var gl={No:"",Yes:"YES",v2:"v2"};function Mg(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?gl.v2:gl.Yes:gl.No}class Fg{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ho{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Bg(this._audioGroups,e)}hasSubtitleGroup(e){return Bg(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Bg(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function zk(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Yk(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||sc.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&zk(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const qk=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},we=(n,e)=>JSON.stringify(n,qk(e));function Qk(n,e,t,r,s){const i=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=s==null?void 0:s.videoCodec,c=o&&parseInt(o)===2;let u=!1,d=!1,f=1/0,h=1/0,m=1/0,p=1/0,g=0,v=[];const{preferHDR:x,allowedVideoRanges:E}=Yk(e,s);for(let I=i.length;I--;){const C=n[i[I]];u||(u=C.channels[2]>0),f=Math.min(f,C.minHeight),h=Math.min(h,C.minFramerate),m=Math.min(m,C.minBitrate),E.filter(_=>C.videoRanges[_]>0).length>0&&(d=!0)}f=q(f)?f:0,h=q(h)?h:0;const T=Math.max(1080,f),b=Math.max(30,h);m=q(m)?m:t,t=Math.max(m,t),d||(e=void 0);const L=i.length>1;return{codecSet:i.reduce((I,C)=>{const R=n[C];if(C===I)return I;if(v=d?E.filter(_=>R.videoRanges[_]>0):[],L){if(R.minBitrate>t)return In(C,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),I;if(!R.hasDefaultAudio)return In(C,"no renditions with default or auto-select sound found"),I;if(a&&C.indexOf(a.substring(0,4))%5!==0)return In(C,`audio codec preference "${a}" not found`),I;if(o&&!c){if(!R.channels[o])return In(C,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),I}else if((!a||c)&&u&&R.channels[2]===0)return In(C,"no renditions with stereo sound found"),I;if(R.minHeight>T)return In(C,`min resolution of ${R.minHeight} > maximum of ${T}`),I;if(R.minFramerate>b)return In(C,`min framerate of ${R.minFramerate} > maximum of ${b}`),I;if(!v.some(_=>R.videoRanges[_]>0))return In(C,`no variants with VIDEO-RANGE of ${we(v)} found`),I;if(l&&C.indexOf(l.substring(0,4))%5!==0)return In(C,`video codec preference "${l}" not found`),I;if(R.maxScore<g)return In(C,`max score of ${R.maxScore} < selected max of ${g}`),I}return I&&(nc(C)>=nc(I)||R.fragmentError>n[I].fragmentError)?I:(p=R.minIndex,g=R.maxScore,C)},void 0),videoRanges:v,preferHDR:x,minFramerate:h,minBitrate:m,minIndex:p}}function In(n,e){me.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function mS(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Xk(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const a=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),s},{})}function $g(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function Bn(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(bs(n,s,t))return r}return-1}function bs(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||Zk(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||Jk(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function Zk(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function Jk(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function ds(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function e_(n,e,t,r,s){const i=e[r],a=e.reduce((f,h,m)=>{const p=h.uri;return(f[p]||(f[p]=[])).push(m),f},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=i.videoRange,c=i.frameRate,u=i.codecSet.substring(0,4),d=Ug(e,r,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const h=f.audioGroups,m=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Bn(n,m,s)>-1});return d>-1?d:Ug(e,r,f=>{const h=f.audioGroups,m=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Bn(n,m,s)>-1})}function Ug(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function ic(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class t_ extends tn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!s||!l)return;const c=performance.now(),u=i?i.stats:s.stats,d=i?i.duration:s.duration,f=c-u.loading.start,h=o.minAutoLevel,m=s.level,p=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const g=p>-1&&p!==m,v=!!t||g;if(!v&&(l.paused||!l.playbackRate||!l.readyState))return;const x=o.mainForwardBufferInfo;if(!v&&x===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(f<=Math.max(E,1e3*(d/(T*2))))return;const b=x?x.len/T:0,L=u.loading.first?u.loading.first-u.loading.start:-1,A=u.loaded&&L>-1,I=this.getBwEstimate(),C=o.levels,R=C[m],_=Math.max(u.loaded,Math.round(d*(s.bitrate||R.averageBitrate)/8));let O=A?f-L:f;O<1&&A&&(O=Math.min(f,u.loaded*8/I));const V=A?u.loaded*1e3/O:0,M=E/1e3,K=V?(_-u.loaded)/V:_*8/I+M;if(K<=b)return;const B=V?V*8:I,H=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,k=this.hls.config.abrBandWidthUpFactor;let D=Number.POSITIVE_INFINITY,j;for(j=m-1;j>h;j--){const Q=C[j].maxBitrate,ee=!C[j].details||H;if(D=this.getTimeToLoadFrag(M,B,d*Q,ee),D<Math.min(b,d+M))break}if(D>=K||D>d*10)return;A?this.bwEstimator.sample(f-Math.min(E,L),u.loaded):this.bwEstimator.sampleTTFB(f);const $=C[j].maxBitrate;this.getBwEstimate()*k>$&&this.resetEstimator($);const F=this.findBestLevel($,h,j,0,b,1,1);F>-1&&(j=F),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${b.toFixed(3)} s
      Estimated load time for current fragment: ${K.toFixed(3)} s
      Estimated load time for down switch fragment: ${D.toFixed(3)} s
      TTFB estimate: ${L|0} ms
      Current BW estimate: ${q(I)?I|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${j} @ ${$|0} bps`),o.nextLoadLevel=o.nextAutoLevel=j,this.clearTimer();const Y=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===j&&j>0){const Q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${j>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Q.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,j>h){let ee=this.findBestLevel(this.hls.levels[h].bitrate,h,j,0,Q,1,1);ee===-1&&(ee=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ee,this.resetEstimator(this.hls.levels[ee].bitrate)}}};g||K>D*2?Y():this.timer=self.setInterval(Y,D*1e3),o.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new ck(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case N.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),a=i?i.stats:r.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;q(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===Z.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Z.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,o,s,c,0,u,d);if(g>=0)return this.rebufferNotice=-1,g}let f=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(f=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=d=1)}const h=this.findBestLevel(l,o,s,c,f,u,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const m=r.levels[o],p=r.loadLevelObj;return p&&(m==null?void 0:m.bitrate)<p.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,a){var l;const c=s+i,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:h}=this,{levels:m,allAudioTracks:p,loadLevel:g,config:v}=this.hls;if(m.length===1)return 0;const x=m[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=g===-1||u===-1;let b,L="SDR",A=(x==null?void 0:x.frameRate)||0;const{audioPreference:I,videoPreference:C}=v,R=this.audioTracksByGroup||(this.audioTracksByGroup=mS(p));let _=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=Xk(m,R,t,r)),H=Qk(B,L,e,I,C),{codecSet:k,videoRanges:D,minFramerate:j,minBitrate:$,minIndex:F,preferHDR:Y}=H;_=F,b=k,L=Y?D[D.length-1]:D[0],A=j,e=Math.max(e,$),this.log(`picked start tier ${we(H)}`)}else b=x==null?void 0:x.codecSet,L=x==null?void 0:x.videoRange;const O=h?h.duration:f?f.duration:0,V=this.bwEstimator.getEstimateTTFB()/1e3,M=[];for(let B=r;B>=t;B--){var K;const H=m[B],k=B>d;if(!H)continue;if(v.useMediaCapabilities&&!H.supportedResult&&!H.supportedPromise){const ee=navigator.mediaCapabilities;typeof(ee==null?void 0:ee.decodingInfo)=="function"&&Uk(H,R,L,A,e,I)?(H.supportedPromise=fS(H,R,ee,this.supportedCache),H.supportedPromise.then(te=>{if(!this.hls)return;H.supportedResult=te;const ne=this.hls.levels,Ae=ne.indexOf(H);te.error?this.warn(`MediaCapabilities decodingInfo error: "${te.error}" for level ${Ae} ${we(te)}`):te.supported?te.decodingInfoResults.some(Fe=>Fe.smooth===!1||Fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ae} not smooth or powerEfficient: ${we(te)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${we(te)}`),Ae>-1&&ne.length>1&&(this.log(`Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(te=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${te}`)})):H.supportedResult=uS}if((b&&H.codecSet!==b||L&&H.videoRange!==L||k&&A>H.frameRate||!k&&A>0&&A<H.frameRate||(K=H.supportedResult)!=null&&(K=K.decodingInfoResults)!=null&&K.some(ee=>ee.smooth===!1))&&(!T||B!==_)){M.push(B);continue}const D=H.details,j=(h?D==null?void 0:D.partTarget:D==null?void 0:D.averagetargetduration)||O;let $;k?$=a*e:$=o*e;const F=O&&s>=O*2&&i===0?H.averageBitrate:H.maxBitrate,Y=this.getTimeToLoadFrag(V,$,F*j,D===void 0);if($>=F&&(B===u||H.loadError===0&&H.fragmentError===0)&&(Y<=V||!q(Y)||E&&!this.bitrateTestDelay||Y<c)){const ee=this.forcedAutoLevel;return B!==g&&(ee===-1||ee!==g)&&(M.length&&this.trace(`Skipped level(s) ${M.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${m[M[0]].codecs}" ${m[M[0]].videoRange}; not compatible with "${b}" ${L}`),this.info(`switch candidate:${d}->${B} adjustedbw(${Math.round($)})-bitrate=${Math.round($-F)} ttfb:${V.toFixed(1)} avgDuration:${j.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${Y.toFixed(1)} firstSelection:${T} codecSet:${H.codecSet} videoRange:${H.videoRange} hls.loadLevel:${g}`)),T&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const pS={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function n_(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!q(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(s_(e,t,o))return o}return null}function ks(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&jg(t,r,i)===0||r_(i,n,Math.min(s,r))))return i;const o=pS.search(e,jg.bind(null,t,r));return o&&(o!==n||!i)?o:i}function r_(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function jg(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function s_(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function gS(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return pS.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function oc(n){switch(n.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Gg(n,e){const t=oc(e);return n.default[`${t?"timeout":"error"}Retry`]}function om(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Vg(n){return ve(ve({},n),{errorRetry:null,timeoutRetry:null})}function ac(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(i_(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function i_(n){return Lf(n)||!!n&&(n<400||n>499)}function Lf(n){return n===0&&navigator.onLine===!1}var tt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Pt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class o_ extends tn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Z.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case N.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=mi();return}case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=tt.SendAlternateToPenaltyBox;return}case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:{var o;const l=t.parent===Z.MAIN?t.level:s.loadLevel;t.details===N.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===ce.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===ce.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=tt.SendAlternateToPenaltyBox,t.errorAction.flags=Pt.MoveAllAlternatesMatchingHost;return}}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:tt.SendAlternateToPenaltyBox,flags:Pt.MoveAllAlternatesMatchingHDCP};return;case N.KEY_SYSTEM_SESSION_UPDATE_FAILED:case N.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case N.KEY_SYSTEM_NO_SESSION:t.errorAction={action:tt.SendAlternateToPenaltyBox,flags:Pt.MoveAllAlternatesMatchingKey};return;case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:case N.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:s.loadLevel)}return;case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:t.errorAction=mi();return}t.type===J.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=mi())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Gg(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(ac(s,i,oc(e),e.response))return{action:tt.RetryRequest,flags:Pt.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=Gg(e.details.startsWith("key")?o:i,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(s&&(e.details!==N.FRAG_GAP&&s.fragmentError++,ac(a,l,oc(e),e.response)))return{action:tt.RetryRequest,flags:Pt.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,r);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const c=e.details;s.loadError++,c===N.BUFFER_APPEND_ERROR&&s.fragmentError++;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:m}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const p=(i=e.frag)==null?void 0:i.type,v=(p===Z.AUDIO&&c===N.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===N.BUFFER_ADD_CODEC_ERROR||c===N.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:L})=>s.audioCodec!==L),E=e.sourceBufferName==="video"&&(c===N.BUFFER_ADD_CODEC_ERROR||c===N.BUFFER_APPEND_ERROR)&&d.some(({codecSet:L,audioCodec:A})=>s.codecSet!==L&&s.audioCodec===A),{type:T,groupId:b}=(o=e.context)!=null?o:{};for(let L=d.length;L--;){const A=(L+f)%d.length;if(A!==f&&A>=h&&A<=m&&d[A].loadError===0){var a,l;const I=d[A];if(c===N.FRAG_GAP&&p===Z.MAIN&&e.frag){const C=d[A].details;if(C){const R=ks(e.frag,C.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(T===ce.AUDIO_TRACK&&I.hasAudioGroup(b)||T===ce.SUBTITLE_TRACK&&I.hasSubtitleGroup(b))continue;if(p===Z.AUDIO&&(a=s.audioGroups)!=null&&a.some(C=>I.hasAudioGroup(C))||p===Z.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(C=>I.hasSubtitleGroup(C))||v&&s.audioCodec===I.audioCodec||E&&s.codecSet===I.codecSet||!v&&s.codecSet!==I.codecSet)continue}u=A;break}}if(u>-1&&r.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:tt.SendAlternateToPenaltyBox,flags:Pt.None,nextAutoLevel:u}}return{action:tt.SendAlternateToPenaltyBox,flags:Pt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case tt.DoNothing:break;case tt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==N.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Pt.None:this.switchLevel(e,i);break;case Pt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(r.hdcpLevel=u,u){t.maxHdcpLevel=Af[Af.indexOf(u)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Pt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels;for(let u=c.length;u--;)if(this.variantHasKey(c[u],l)){var o,a;this.log(`Banned key found in level ${u} (${c[u].bitrate}bps) or audio group "${(o=c[u].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Nt(l.keyId||[])}`),c[u].fragmentError++,c[u].loadError++,this.log(`Removing level ${u} with key error (${e.error})`),this.hls.removeLevel(u)}c.length&&(r.resolved=!0)}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===N.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=wf(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function mi(n){const e={action:tt.DoNothing,flags:Pt.None};return n&&(e.resolved=!0),e}var We={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class a_{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const a=s[i[o]];if((a==null?void 0:a.body.type)===t&&(!r||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=$s(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(a=>{const l=r.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;i.range[a]=this.getBufferedTimes(r,e.part,u,c)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=r.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),Fa(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Hg(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=$s(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<s.length;u++){const d=s.start(u)-this.bufferPadding,f=s.end(u)+this.bufferPadding;if(c>=d&&l<=f){i.time.push({startPTS:Math.max(o,s.start(u)),endPTS:Math.min(a,s.end(u))});break}else if(o<f&&a>d){const h=Math.max(o,s.start(u)),m=Math.min(a,s.end(u));m>h&&(i.partial=!0,i.time.push({startPTS:h,endPTS:m}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&Fa(u)&&(s=u.body.start-a,i=u.body.end+a,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=u.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Fa(t))}getState(e){const t=$s(e),r=this.fragments[t];return r?r.buffered?Fa(r)?We.PARTIAL:We.OK:We.APPENDING:We.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=$s(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(s){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(s)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=$s(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=$s(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=Hg(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function Fa(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function $s(n){return`${n.type}_${n.level}_${n.sn}`}function Hg(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var es={cbc:0,ctr:1};class l_{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case es.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case es.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function c_(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class u_{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],a=r[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let m=0,p=0,g=0;for(g=0;g<256;g++)g<128?h[g]=g<<1:h[g]=g<<1^283;for(g=0;g<256;g++){let v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^v&255^99,e[m]=v,t[v]=m;const x=h[m],E=h[x],T=h[E];let b=h[v]*257^v*16843008;s[m]=b<<24|b>>>8,i[m]=b<<16|b>>>16,o[m]=b<<8|b>>>24,a[m]=b,b=T*16843009^E*65537^x*257^m*16843008,c[v]=b<<24|b>>>8,u[v]=b<<16|b>>>16,d[v]=b<<8|b>>>24,f[v]=b,m?(m=x^h[h[h[T^x]]],p^=h[h[p]]):m=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,m=h[0],p=h[1],g=h[2],v=h[3];let x,E;for(a=0;a<o;a++){if(a<i){x=c[a]=t[a];continue}E=x,a%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[a/i|0]<<24):i>6&&a%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),c[a]=x=(c[a-i]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=c[a]:E=c[a-4],l<4||a<=4?u[l]=E:u[l]=m[d[E>>>24]]^p[d[E>>>16&255]]^g[d[E>>>8&255]]^v[d[E&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],m=f[1],p=f[2],g=f[3];const v=new Int32Array(e),x=new Int32Array(v.length);let E,T,b,L,A,I,C,R,_,O,V,M,K,B;const H=this.networkToHostOrderSwap;for(;t<v.length;){for(_=H(v[t]),O=H(v[t+1]),V=H(v[t+2]),M=H(v[t+3]),A=_^i[0],I=M^i[1],C=V^i[2],R=O^i[3],K=4,B=1;B<s;B++)E=l[A>>>24]^c[I>>16&255]^u[C>>8&255]^d[R&255]^i[K],T=l[I>>>24]^c[C>>16&255]^u[R>>8&255]^d[A&255]^i[K+1],b=l[C>>>24]^c[R>>16&255]^u[A>>8&255]^d[I&255]^i[K+2],L=l[R>>>24]^c[A>>16&255]^u[I>>8&255]^d[C&255]^i[K+3],A=E,I=T,C=b,R=L,K=K+4;E=o[A>>>24]<<24^o[I>>16&255]<<16^o[C>>8&255]<<8^o[R&255]^i[K],T=o[I>>>24]<<24^o[C>>16&255]<<16^o[R>>8&255]<<8^o[A&255]^i[K+1],b=o[C>>>24]<<24^o[R>>16&255]<<16^o[A>>8&255]<<8^o[I&255]^i[K+2],L=o[R>>>24]<<24^o[A>>16&255]<<16^o[I>>8&255]<<8^o[C&255]^i[K+3],x[t]=H(E^h),x[t+1]=H(L^m),x[t+2]=H(b^p),x[t+3]=H(T^g),h=_,m=O,p=V,g=M,t=t+4}return x.buffer}}class d_{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=f_(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function f_(n){switch(n){case es.cbc:return"AES-CBC";case es.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const h_=16;class am{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?c_(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,s);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:a}=this;if(s!==es.cbc||t.byteLength!==16)return me.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=en(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new u_),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new d_(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new l_(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(me.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%h_;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(me.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Kg=Math.pow(2,17);class m_{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new er({type:J.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(zg(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new o(s),u=Wg(e);e.loader=c;const d=Vg(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Kg};e.stats=c.stats;const h={onSuccess:(m,p,g,v)=>{this.resetLoader(e,c);let x=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(x.slice(0,16)),x=x.slice(16)),a({frag:e,part:null,payload:x,networkDetails:v})},onError:(m,p,g,v)=>{this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ve({url:r,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:v}))},onAbort:(m,p,g)=>{this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,p,g)=>{this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}};t&&(h.onProgress=(m,p,g,v)=>t({frag:e,part:null,payload:g,networkDetails:v})),c.load(u,f,h)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(zg(e,t));return}const c=this.loader=i?new i(s):new o(s),u=Wg(e,t);e.loader=c;const d=Vg(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Kg};t.stats=c.stats,c.load(u,f,{onSuccess:(h,m,p,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:h.data,networkDetails:g};r(v),a(v)},onError:(h,m,p,g)=>{this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ve({url:u.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:p,stats:g}))},onAbort:(h,m,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:h}))},onTimeout:(h,m,p)=>{this.resetLoader(e,c),l(new er({type:J.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/i),l),d=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Wg(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(q(s)&&q(i)){var o;let a=s,l=i;if(n.sn==="initSegment"&&p_((o=n.decryptdata)==null?void 0:o.method)){const c=i-s;c%16&&(l=i+(16-c%16)),s!==0&&(r.resetIV=!0,a=s-16)}r.rangeStart=a,r.rangeEnd=l}return r}function zg(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:J.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new er(r)}function p_(n){return n==="AES-128"||n==="AES-256"}class er extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class vS extends tn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class lm{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ba(),this.buffering={audio:Ba(),video:Ba(),audiovideo:Ba()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function Ba(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Yg={length:0,start:()=>0,end:()=>0};class se{static isBuffered(e,t){if(e){const r=se.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=se.getBuffered(e);return se.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=se.bufferedRanges(e);if(s.length)return se.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let s=-1,i=[];if(r)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(s=u);const d=i.length;if(d){const f=i[d-1].end;e[u].start-f<r?e[u].end>f&&(i[d-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let o=0,a,l=t,c=t;for(let u=0;u<i.length;u++){const d=i[u].start,f=i[u].end;if(s===-1&&t>=d&&t<=f&&(s=u),t+r>=d&&t<f)l=d,c=f,o=c-t;else if(t+r<d){a=d;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Yg}catch(t){return me.log("failed to get media.buffered",t),Yg}}}const yS=/\{\$([a-zA-Z0-9-_]+)\}/g;function qg(n){return yS.test(n)}function If(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(yS,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function Qg(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function g_(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const v_=/^(\d+)x(\d+)$/,Xg=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ce{constructor(e,t){typeof e=="string"&&(e=Ce.parseAttrList(e,t)),ye(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=v_.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={},i='"';for(Xg.lastIndex=0;(r=Xg.exec(e))!==null;){const o=r[1].trim();let a=r[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=If(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":me.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=a}return s}}const y_="com.apple.hls.interstitial";function x_(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function E_(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class xS{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){me.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ye(new Ce({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);q(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(me.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(q(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===y_}get isValid(){return!!this.id&&!this._badValueForSameId&&q(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const S_=10;class T_{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?q(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||S_}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ES(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function Zg(n,e){return!n&&!e?!0:!n||!e?!1:ES(n,e)}function pi(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function cm(n){switch(n){case"AES-128":case"AES-256":return es.cbc;case"AES-256-CTR":return es.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function um(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Rf(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function b_(n){const e=Rf(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function w_(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function A_(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=um(o)):t=b_(o)}}return t}const lc=typeof self<"u"?self:void 0;var Me={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},wt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vl(n){switch(n){case wt.FAIRPLAY:return Me.FAIRPLAY;case wt.PLAYREADY:return Me.PLAYREADY;case wt.WIDEVINE:return Me.WIDEVINE;case wt.CLEARKEY:return Me.CLEARKEY}}function $u(n){switch(n){case Me.FAIRPLAY:return wt.FAIRPLAY;case Me.PLAYREADY:return wt.PLAYREADY;case Me.WIDEVINE:return wt.WIDEVINE;case Me.CLEARKEY:return wt.CLEARKEY}}function oo(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[Me.FAIRPLAY,Me.WIDEVINE,Me.PLAYREADY,Me.CLEARKEY].filter(s=>!!e[s]):[];return!r[Me.WIDEVINE]&&t&&r.push(Me.WIDEVINE),r}const SS=function(n){return lc!=null&&(n=lc.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function L_(n,e,t,r){let s;switch(n){case Me.FAIRPLAY:s=["cenc","sinf"];break;case Me.WIDEVINE:case Me.PLAYREADY:s=["cenc"];break;case Me.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return I_(s,e,t,r)}function I_(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function R_(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function C_(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=um(a).subarray(0,16);return w_(l),l}}return null}let $a={};class Hc{static clearKeyUriToKeyIdMap(){$a={}}constructor(e,t,r,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!pi(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(eS(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ES(e.keyFormatVersions,this.keyFormatVersions)&&Zg(e.iv,this.iv)&&Zg(e.keyId,this.keyId)}isSupported(){if(this.method){if(pi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case wt.FAIRPLAY:case wt.WIDEVINE:case wt.PLAYREADY:case wt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(pi(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(me.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=k_(e);return new Hc(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.pssh&&this.keyId)return this;const t=A_(this.uri);if(t)switch(this.keyFormat){case wt.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const r=t.length-22;this.keyId=t.subarray(r,r+16)}break;case wt.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Pk(r,null,t),this.keyId=C_(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=$a[this.uri];if(!r){const s=Object.keys($a).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),$a[this.uri]=r}this.keyId=r}return this}}function k_(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Jg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,e0=/#EXT-X-MEDIA:(.*)/g,__=/^#EXT(?:INF|-X-TARGETDURATION):/m,Uu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),P_=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class $n{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return tm.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return __.test(e)}static parseMasterPlaylist(e,t){const r=qg(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];Jg.lastIndex=0;let o;for(;(o=Jg.exec(e))!=null;)if(o[1]){var a;const c=new Ce(o[1],s),u=If(s,o[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:$n.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),r0(c.CODECS,d);const h=c["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},r0(h,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const d=new Ce(u,s),f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=t0(u,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):me.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new Ce(u,s);Qg(s,d,t)}break}case"CONTENT-STEERING":{const d=new Ce(u,s);s.contentSteering={uri:$n.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=n0(u);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(e0.lastIndex=0;(s=e0.exec(e))!==null;){const c=new Ce(s[1],r),u=c.TYPE;if(u){const d=a[u],f=i[u]||[];i[u]=f;const h=c.LANGUAGE,m=c["ASSOC-LANGUAGE"],p=c.CHANNELS,g=c.CHARACTERISTICS,v=c["INSTREAM-ID"],x={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||h||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:h,url:c.URI?$n.resolve(c.URI,t):""};if(m&&(x.assocLang=m),p&&(x.channels=p),g&&(x.characteristics=g),v&&(x.instreamId=v),d!=null&&d.length){const E=$n.findGroup(d,x.groupId)||d[0];s0(x,E,"audioCodec"),s0(x,E,"textCodec")}f.push(x)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var a;const l={url:t},c=new T_(t),u=c.fragments,d=[];let f=null,h=0,m=0,p=0,g=0,v=0,x=null,E=new Mu(s,l),T,b,L,A=-1,I=!1,C=null,R;if(Uu.lastIndex=0,c.m3u8=e,c.hasVariableRefs=qg(e),((a=Uu.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(T=Uu.exec(e))!==null;){I&&(I=!1,E=new Mu(s,l),E.playlistOffset=p,E.setStart(p),E.sn=h,E.cc=g,v&&(E.bitrate=v),E.level=r,f&&(E.initSegment=f,f.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),C&&(E.setByteRange(C),C=null)));const M=T[1];if(M){E.duration=parseFloat(M);const K=(" "+T[2]).slice(1);E.title=K||null,E.tagList.push(K?["INF",M,K]:["INF",M])}else if(T[3]){if(q(E.duration)){E.playlistOffset=p,E.setStart(p),L&&o0(E,L,c),E.sn=h,E.level=r,E.cc=g,u.push(E);const K=(" "+T[3]).slice(1);E.relurl=If(c,K),Cf(E,x,d),x=E,p+=E.duration,h++,m=0,I=!0}}else{if(T=T[0].match(P_),!T){me.warn("No matches on slow regex match for level playlist!");continue}for(b=1;b<T.length&&T[b]===void 0;b++);const K=(" "+T[b]).slice(1),B=(" "+T[b+1]).slice(1),H=T[b+2]?(" "+T[b+2]).slice(1):null;switch(K){case"BYTERANGE":x?E.setByteRange(B,x):E.setByteRange(B);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=B,E.tagList.push(["PROGRAM-DATE-TIME",B]),A===-1&&(A=u.length);break;case"PLAYLIST-TYPE":c.type&&Qn(c,K,T),c.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Qn(c,K,T):u.length>0&&a0(c,K,T),h=c.startSN=parseInt(B);break;case"SKIP":{c.skippedSegments&&Qn(c,K,T);const k=new Ce(B,c),D=k.decimalInteger("SKIPPED-SEGMENTS");if(q(D)){c.skippedSegments+=D;for(let $=D;$--;)u.push(null);h+=D}const j=k.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(j.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Qn(c,K,T),c.targetduration=Math.max(parseInt(B),1);break;case"VERSION":c.version!==null&&Qn(c,K,T),c.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Qn(c,K,T),c.live=!1;break;case"#":(B||H)&&E.tagList.push(H?[B,H]:[B]);break;case"DISCONTINUITY":g++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([K]);break;case"BITRATE":E.tagList.push([K,B]),v=parseInt(B)*1e3,q(v)?E.bitrate=v:v=0;break;case"DATERANGE":{const k=new Ce(B,c),D=new xS(k,c.dateRanges[k.ID],c.dateRangeTagCount);c.dateRangeTagCount++,D.isValid||c.skippedSegments?c.dateRanges[D.id]=D:me.warn(`Ignoring invalid DATERANGE tag: "${B}"`),E.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const k=new Ce(B,c);"IMPORT"in k?g_(c,k,o):Qg(c,k,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Qn(c,K,T):u.length>0&&a0(c,K,T),c.startCC=g=parseInt(B);break;case"KEY":{const k=t0(B,t,c);if(k.isSupported()){if(k.method==="NONE"){L=void 0;break}L||(L={});const D=L[k.keyFormat];D!=null&&D.matches(k)||(D&&(L=ye({},L)),L[k.keyFormat]=k)}else me.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${B}"`);break}case"START":c.startTimeOffset=n0(B);break;case"MAP":{const k=new Ce(B,c);if(E.duration){const D=new Mu(s,l);i0(D,k,r,L),f=D,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{const D=E.byteRangeEndOffset;if(D){const j=E.byteRangeStartOffset;C=`${D-j}@${j}`}else C=null;i0(E,k,r,L),f=E,I=!0}f.cc=g;break}case"SERVER-CONTROL":{R&&Qn(c,K,T),R=new Ce(B),c.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),c.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Qn(c,K,T);const k=new Ce(B);c.partTarget=k.decimalFloatingPoint("PART-TARGET");break}case"PART":{let k=c.partList;k||(k=c.partList=[]);const D=m>0?k[k.length-1]:void 0,j=m++,$=new Ce(B,c),F=new xk($,E,l,j,D);k.push(F),E.duration+=F.duration;break}case"PRELOAD-HINT":{const k=new Ce(B,c);c.preloadHint=k;break}case"RENDITION-REPORT":{const k=new Ce(B,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(k);break}default:me.warn(`line parsed but not handled: ${T}`);break}}}x&&!x.relurl?(u.pop(),p-=x.duration,c.partList&&(c.fragmentHint=x)):c.partList&&(Cf(E,x,d),E.cc=g,c.fragmentHint=E,L&&o0(E,L,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const _=u.length,O=u[0],V=u[_-1];if(p+=c.skippedSegments*c.targetduration,p>0&&_&&V){c.averagetargetduration=p/_;const M=V.sn;c.endSN=M!=="initSegment"?M:0,c.live||(V.endList=!0),A>0&&(N_(u,A),O&&d.unshift(O))}return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,d.length&&c.dateRangeTagCount&&O&&TS(d,c),c.endCC=g,c}}function TS(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let u=t;u--;){var o;if(((o=n[u])==null?void 0:o.sn)<e.startSN)break;const d=D_(e,c,n,u,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function D_(n,e,t,r,s){const i=t[r];if(i){const a=i.programDateTime;if(e>=a||r===0){var o;const l=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=a+l*1e3){const c=t[r].sn-n.startSN;if(c<0)return-1;const u=n.fragments;if(u.length>t.length){const f=(t[r+1]||u[u.length-1]).sn-n.startSN;for(let h=f;h>c;h--){const m=u[h].programDateTime;if(e>=m&&e<m+u[h].duration*1e3)return h}}return c}}}return-1}function t0(n,e,t){var r,s;const i=new Ce(n,t),o=(r=i.METHOD)!=null?r:"",a=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&me.error(`Invalid IV: ${i.IV}`);const d=a?$n.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Hc(o,d,u,f,l,i.KEYID)}function n0(n){const t=new Ce(n).decimalFloatingPoint("TIME-OFFSET");return q(t)?t:null}function r0(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>sm(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function s0(n,e,t){const r=e[t];r&&(n[t]=r)}function N_(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Cf(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function i0(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function o0(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function Qn(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function a0(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ju(n,e){const t=e.startPTS;if(q(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function bS(n,e,t,r,s,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let l=t,c=r;const u=e.startPTS,d=e.endPTS;if(q(u)){const v=Math.abs(u-t);n&&v>n.totalduration?o.warn(`media timestamps and playlist times differ by ${v}s for level ${e.level} ${n.url}`):q(e.deltaPTS)?e.deltaPTS=Math.max(v,e.deltaPTS):e.deltaPTS=v,l=Math.max(t,u),t=Math.min(t,u),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(r,d),r=Math.max(r,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=r,e.minEndPTS=c,e.endDTS=i;const h=e.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let m;const p=h-n.startSN,g=n.fragments;for(g[p]=e,m=p;m>0;m--)ju(g[m],g[m-1]);for(m=p;m<g.length-1;m++)ju(g[m],g[m+1]);return n.fragmentHint&&ju(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function O_(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let u=s.length-1;u>=0;u--){const d=s[u].initSegment;if(d){r=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;B_(n,e,(u,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const m=u.cc-d.cc;for(let p=f;p<h.length;p++)h[p].cc+=m;e.endCC=h[h.length-1].cc}q(u.startPTS)&&q(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,r=u.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&a.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(u.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=M_(n.dateRanges,e,t));const u=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&Cf(a[d],a[d-1],u);TS(u,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const u=LS(n,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:o[0].cc}F_(n.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),i?bS(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):wS(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function M_(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=ye({},n);s&&s.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(r).forEach(l=>{const c=i[l],u=new xS(r[l].attr,c);u.isValid?(i[l]=u,c||(u.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${we(r[l].attr)}"`)}),i):r}function F_(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],a=e[s+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function B_(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=s;c<=i;c++){const u=l[o+c];let d=a[c];if(r&&!d&&u&&(d=e.fragments[c]=u),u&&d){t(u,d,c,a);const f=u.relurl,h=d.relurl;if(f&&$_(f,h)){e.playlistParsingError=l0(`media sequence mismatch ${d.sn}:`,n,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=l0(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,n,e,u,d);return}}}}function l0(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function wS(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;kf(e,o)}function kf(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function AS(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function LS(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function c0(n,e,t){return n?IS(n.partList,e,t):null}function IS(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function RS(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function $_(n,e){return n!==e&&e?u0(n)!==u0(e):!1}function u0(n){return n.replace(/\?[^?]*$/,"")}function yo(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function U_(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function d0(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function CS(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)d0(t[r],n);e.fragmentHint&&d0(e.fragmentHint,n),e.alignedSliding=!0}function j_(n,e){n&&(kS(e,n),e.alignedSliding||cc(e,n),!e.alignedSliding&&!e.skippedSegments&&wS(n,e,!1))}function kS(n,e){if(!U_(e,n))return;const t=Math.min(e.endCC,n.endCC),r=yo(e.fragments,t),s=yo(n.fragments,t);if(!r||!s)return;me.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;CS(i,n)}function cc(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=yo(r,o),i=yo(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=yo(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(i.start-s.start);CS(c,n)}function mt(n,e,t){Lt(n,e,t),n.addEventListener(e,t)}function Lt(n,e,t){n.removeEventListener(e,t)}const G_={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},U={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class dm extends vS{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=U.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,f=se.bufferInfo(c||l,d,o.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${q(d)?d.toFixed(3):d}, state: ${u}, ${h?"out of":"in"} buffer`),this.state===U.ENDED)this.resetLoadingState();else if(a){const m=o.maxFragLookUpTolerance,p=a.start-m,g=a.start+a.duration+m;if(h||g<f.start||p>f.end){const v=d>g;(d<p||v)&&(v&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(d>m&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(f.end,d),g=this.shouldLoadParts(this.getLevelDetails(),p);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===U.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new m_(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new am(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===U.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=U.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=se.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return se.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;mt(r,"seeking",this.onMediaSeeking),mt(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===U.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Lt(s,"seeking",this.onMediaSeeking),Lt(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=U.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===U.FRAG_LOADING||!this.fragCurrent&&o===U.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=U.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(S.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===We.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===We.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(S.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&pi(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,cm(a.method)).catch(c=>{throw s.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const u=self.performance.now();return s.trigger(S.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:u}}),r.payload=c,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==U.STOPPED&&(this.state=U.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?G_.toString(se.getBuffered(r)):"(detached)"})`),Ue(e)){var s;if(e.type!==Z.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=U.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=U.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new lm(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=U.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(S.KEY_LOADED,f),this.state===U.KEY_LOADING&&(this.state=U.IDLE),f}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ue(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(r=Math.max(e.start,r||0),this.loadingParts&&Ue(e)){const f=o.partList;if(f&&s){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const h=this.getNextPart(f,e,r);if(h>-1){const m=f[h];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=U.FRAG_LOADING;let p;return a?p=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,m,t,s)).catch(g=>this.handleFragLoadError(g)):p=this.doFragPartsLoad(e,m,t,s).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:m,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}if(Ue(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),q(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=U.FRAG_LOADING;const u=this.config.progressive;let d;return u&&a?d=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,u?s:void 0),a]).then(([f])=>(!u&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var a;const l=[],c=(a=r.details)==null?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(S.FRAG_LOADED,f);const m=c0(r.details,e.sn,d.index+1)||IS(c,e.sn,d.index+1);if(m)u(m);else return i({frag:e,part:h,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===J.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==U.PARSING){!this.fragCurrent&&this.state!==U.STOPPED&&this.state!==U.ERROR&&(this.state=U.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===Z.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=a.details,c=o>-1?c0(l,i,o):null,u=c?c.fragment:LS(l,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==U.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=en(o,a)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:s,offset:u,parent:t.type,data:l};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!se.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=se.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!q(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=se.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,s);return se.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=Z.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=o?f:h)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=o&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===We.OK||r===We.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(a!==null&&r.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(f0(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(f0(this.config)&&e.type!==Z.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,s>-1&&r<c.start)break;const u=c.loaded;u?s=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${c.start}`),s=a),i=u}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=n_(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=gS(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:c}=s,u=r.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var h;const p=e<this.lastCurrentTime||e>t-c||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:c;f=ks(i,o,e,p)}else f=o[o.length-1];if(f){const m=f.sn-r.startSN,p=this.fragmentTracker.getState(f);if((p===We.OK||p===We.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||u[0].fragment.sn>f.sn||!r.live)&&f.level===i.level){const v=o[m+1];f.sn<a&&this.fragmentTracker.getState(v)!==We.OK?f=v:f=null}}return f}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&q(i);if(o||!a&&!i){j_(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&q(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ue(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==U.FRAG_LOADING_WAITING_RETRY)&&(this.state=U.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const v=this.getCurrentContext(t.chunkMeta);v&&(t.frag=v.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===N.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction;if(!a){this.state=U.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:d}=a,f=!!d,h=f&&l===tt.RetryRequest,m=f&&!a.resolved&&c===Pt.MoveAllAlternatesMatchingHost,p=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!h&&m&&Ue(s)&&!s.endList&&p)this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((h||m)&&u<d.maxNumRetry){var g;const v=Lf((g=t.response)==null?void 0:g.code),x=om(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+x,this.state=U.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,v){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${x}ms`)}else if(d)if(this.resetFragmentErrors(e),u<d.maxNumRetry)!o&&l!==tt.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===tt.SendAlternateToPenaltyBox?this.state=U.WAITING_LEVEL:this.state=U.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Lf(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=U.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===U.PARSING||this.state===U.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Z.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==U.STOPPED&&(this.state=U.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=se.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===U.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==U.STOPPED&&(this.state=U.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const f=s?0:bS(i,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:i,level:r,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;if(r.fragmentError===0&&this.treatAsGap(e,r),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=U.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Z.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function f0(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class _S{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=V_(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function V_(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var Gu={exports:{}},h0;function H_(){return h0||(h0=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new s(u,d||l,f),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],h]:l._events[m].push(h):(l._events[m]=h,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,m=new Array(h);f<h;f++)m[f]=d[f].fn;return m},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,f,h,m){var p=t?t+c:c;if(!this._events[p])return!1;var g=this._events[p],v=arguments.length,x,E;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,f),!0;case 5:return g.fn.call(g.context,u,d,f,h),!0;case 6:return g.fn.call(g.context,u,d,f,h,m),!0}for(E=1,x=new Array(v-1);E<v;E++)x[E-1]=arguments[E];g.fn.apply(g.context,x)}else{var T=g.length,b;for(E=0;E<T;E++)switch(g[E].once&&this.removeListener(c,g[E].fn,void 0,!0),v){case 1:g[E].fn.call(g[E].context);break;case 2:g[E].fn.call(g[E].context,u);break;case 3:g[E].fn.call(g[E].context,u,d);break;case 4:g[E].fn.call(g[E].context,u,d,f);break;default:if(!x)for(b=1,x=new Array(v-1);b<v;b++)x[b-1]=arguments[b];g[E].fn.apply(g[E].context,x)}}return!0},a.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,f){var h=t?t+c:c;if(!this._events[h])return this;if(!u)return o(this,h),this;var m=this._events[h];if(m.fn)m.fn===u&&(!f||m.once)&&(!d||m.context===d)&&o(this,h);else{for(var p=0,g=[],v=m.length;p<v;p++)(m[p].fn!==u||f&&!m[p].once||d&&m[p].context!==d)&&g.push(m[p]);g.length?this._events[h]=g.length===1?g[0]:g:o(this,h)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(Gu)),Gu.exports}var K_=H_(),fm=vk(K_);const Ko="1.6.11",Fi={};function W_(){return typeof __HLS_WORKER_BUNDLE__=="function"}function z_(){const n=Fi[Ko];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Fi[Ko]=s,s}function Y_(n){const e=Fi[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Fi[n]=s,s}function q_(n){const e=Fi[n||Ko];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Fi[n||Ko],s&&self.URL.revokeObjectURL(s),r.terminate()}}function PS(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function hm(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Kc(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Wo(n,e){const t=e;let r=0;for(;hm(n,e);){r+=10;const s=Kc(n,e+6);r+=s,PS(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function Q_(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);n.emit(S.ERROR,S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+a,u=s[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return me.log(`manifest codec:${r}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:r}}function DS(n,e){return n[e]===255&&(n[e+1]&246)===240}function NS(n,e){return n[e+1]&1?7:9}function mm(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function X_(n,e){return e+5<n.length}function uc(n,e){return e+1<n.length&&DS(n,e)}function Z_(n,e){return X_(n,e)&&DS(n,e)&&mm(n,e)<=n.length-e}function J_(n,e){if(uc(n,e)){const t=NS(n,e);if(e+t>=n.length)return!1;const r=mm(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||uc(n,s)}return!1}function OS(n,e,t,r,s){if(!n.samplerate){const i=Q_(e,t,r,s);if(!i)return;ye(n,i)}}function MS(n){return 1024*9e4/n}function eP(n,e){const t=NS(n,e);if(e+t<=n.length){const r=mm(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function FS(n,e,t,r,s){const i=MS(n.samplerate),o=r+s*i,a=eP(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,m=Math.max(0,t+h-e.length);m?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const p={unit:l,pts:o};return m||n.samples.push(p),{sample:p,length:h,missing:m}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function tP(n,e){return hm(n,e)&&Kc(n,e+6)+10<=n.length-e}function nP(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Vu(n,e=0,t=1/0){return rP(n,e,t,Uint8Array)}function rP(n,e,t,r){const s=sP(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=iP(n)?n.byteOffset:0,a=(o+n.byteLength)/i,l=(o+e)/i,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new r(s,c,u-c)}function sP(n){return n instanceof ArrayBuffer?n:n.buffer}function iP(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function oP(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Ut(Vu(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const a=Ut(Vu(n.data,3+r,o));let l;return s==="-->"?l=Ut(Vu(n.data,4+r+o)):l=nP(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=a,e.data=l,e}function aP(n){if(n.size<2)return;const e=Ut(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function lP(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Ut(n.data.subarray(t),!0);t+=r.length+1;const s=Ut(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Ut(n.data.subarray(1));return{key:n.type,info:"",data:e}}function cP(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Ut(n.data.subarray(t),!0);t+=r.length+1;const s=Ut(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Ut(n.data);return{key:n.type,info:"",data:e}}function uP(n){return n.type==="PRIV"?aP(n):n.type[0]==="W"?cP(n):n.type==="APIC"?oP(n):lP(n)}function dP(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Kc(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Ua=10,fP=10;function BS(n){let e=0;const t=[];for(;hm(n,e);){const r=Kc(n,e+6);n[e+5]>>6&1&&(e+=Ua),e+=Ua;const s=e+r;for(;e+fP<s;){const i=dP(n.subarray(e)),o=uP(i);o&&t.push(o),e+=i.size+Ua}PS(n,e)&&(e+=Ua)}return t}function $S(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function hP(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function pm(n){const e=BS(n);for(let t=0;t<e.length;t++){const r=e[t];if($S(r))return hP(r)}}let Mt=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Nn(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class gm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=en(this.cachedData,e),this.cachedData=null);let r=Wo(e,0),s=r?r.length:0,i;const o=this._audioTrack,a=this._id3Track,l=r?pm(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&q(l))&&(this.basePTS=mP(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mt.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const u=this.appendFrame(o,e,s);u?(this.frameIndex++,this.lastPTS=u.sample.pts,s+=u.length,i=s):s=c}else tP(e,s)?(r=Wo(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Mt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===c&&i!==c){const u=e.slice(i);this.cachedData?this.cachedData=en(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:Nn(),id3Track:a,textTrack:Nn()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Nn(),id3Track:this._id3Track,textTrack:Nn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const mP=(n,e,t)=>{if(q(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let ja=null;const pP=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],gP=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],yP=[0,1,1,4];function US(n,e,t,r,s){if(t+24>e.length)return;const i=jS(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=r+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function jS(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,c=pP[l*14+s-1]*1e3,d=gP[(t===3?0:t===2?1:2)*3+i],f=a===3?1:2,h=vP[t][r],m=yP[r],p=h*8*m,g=Math.floor(h*c/d+o)*m;if(ja===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ja=E?parseInt(E[1]):0}return!!ja&&ja<=87&&r===2&&c>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:g,samplesPerFrame:p}}}function vm(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function GS(n,e){return e+1<n.length&&vm(n,e)}function xP(n,e){return vm(n,e)&&4<=n.length-e}function VS(n,e){if(e+1<n.length&&vm(n,e)){const r=jS(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||GS(n,i)}return!1}class EP extends gm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Wo(e,0);let s=(r==null?void 0:r.length)||0;if(VS(e,s))return!1;for(let i=e.length;s<i;s++)if(J_(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Z_(e,t)}appendFrame(e,t,r){OS(e,this.observer,t,r,e.manifestCodec);const s=FS(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const HS=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,r-=a}return t};class SP extends gm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=KS(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Wo(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&pm(t)!==void 0&&HS(e,r)<16}}function KS(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,p=[2,1,2,3,3,4,4,5][d]+h,g=e[t+5]>>3,v=e[t+5]&7,x=new Uint8Array([i<<6|g<<1|v>>2,(v&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),E=1536/a*9e4,T=r+s*E,b=e.subarray(t,t+u);return n.config=x,n.channelCount=p,n.samplerate=a,n.samples.push({unit:b,pts:T}),u}class TP extends gm{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wo(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&pm(t)!==void 0&&HS(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(VS(e,r))return me.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return xP(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return US(e,t,r,this.basePTS,this.frameIndex)}}const bP=/\/emsg[-/]ID3/i;class wP{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=Nn("video",1),o=this.audioTrack=Nn("audio",1),a=this.txtTrack=Nn("text",1);if(this.id3Track=Nn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=oS(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:f}=l.video;i.id=c,i.timescale=a.timescale=u,i.codec=d,i.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=rS.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return Tk(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=en(this.remainderData,e));const a=Rk(r);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=Pg(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Pg(e,t),{videoTrack:t,audioTrack:Nn(),id3Track:s,textTrack:Nn()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=le(e.samples,["emsg"]);s&&s.forEach(i=>{const o=kk(i);if(bP.test(o.schemeIdUri)){const a=m0(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;r.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Mt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=m0(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Mt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function m0(n,e){return q(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class AP{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new am(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,es.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=lS(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class WS{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,c,u,d,f=-1,h=0;for(i===-1&&(f=0,h=this.getNALuType(t,0),i=0,l=1);l<s;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(u=l-i-1,f>=0){const m={data:t.subarray(f,u),type:h};a.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(o&&l<=4-o&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-o)),u>0&&(m.data=en(m.data,t.subarray(0,u)),m.state=0))}l<s?(d=this.getNALuType(t,l),f=l,h=d,i=0):i=-1}else i=0}if(f>=0&&i>=0){const m={data:t.subarray(f,s),type:h,state:i};a.push(m)}if(a.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=en(m.data,t))}return e.naluState=i,a}}class xo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&me.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class LP extends WS{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 1:{let p=!1;a=!0;const g=c.data;if(l&&g.length>4){const v=this.readSliceType(g);(v===2||v===4||v===7||v===9)&&(p=!0)}if(p){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=p;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,rm(c.data,1,r.pts,t.samples);break}case 7:{var h,m;a=!0,l=!0;const p=c.data,g=this.readSPS(p);if(!e.sps||e.width!==g.width||e.height!==g.height||((h=e.pixelRatio)==null?void 0:h[0])!==g.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[p];const v=p.subarray(1,4);let x="avc1.";for(let E=0;E<3;E++){let T=v[E].toString(16);T.length<2&&(T="0"+T),x+=T}e.codec=x}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new xo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new xo(e);let r=0,s=0,i=0,o=0,a,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),m=t.skipBits.bind(t),p=t.skipEG.bind(t),g=t.skipUEG.bind(t),v=this.skipScalingList.bind(this);u();const x=u();if(d(5),m(3),u(),g(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){const I=f();if(I===3&&m(1),g(),g(),m(1),h())for(l=I!==3?8:12,c=0;c<l;c++)h()&&(c<6?v(16,t):v(64,t))}g();const E=f();if(E===0)f();else if(E===1)for(m(1),p(),p(),a=f(),c=0;c<a;c++)p();g(),m(1);const T=f(),b=f(),L=d(1);L===0&&m(1),m(1),h()&&(r=f(),s=f(),i=f(),o=f());let A=[1,1];if(h()&&h())switch(u()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((T+1)*16-r*2-s*2),height:(2-L)*(b+1)*16-(L?2:4)*(i+o),pixelRatio:A}}}class IP extends WS{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,rm(c.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ye(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(c.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in h.params)e.params[m]=h.params[m]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(c.data);for(const m in h)e.params[m]=h[m]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new xo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new xo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),m=t.readUByte(),p=t.readUByte(),g=t.readUByte(),v=t.readUByte(),x=[],E=[];for(let ue=0;ue<r;ue++)x.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let ue=r;ue<8;ue++)t.readBits(2);for(let ue=0;ue<r;ue++)x[ue]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[ue]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const b=t.readUEG(),L=t.readUEG(),A=t.readBoolean();let I=0,C=0,R=0,_=0;A&&(I+=t.readUEG(),C+=t.readUEG(),R+=t.readUEG(),_+=t.readUEG());const O=t.readUEG(),V=t.readUEG(),M=t.readUEG(),K=t.readBoolean();for(let ue=K?0:r;ue<=r;ue++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let $e=0;$e<4;$e++)for(let qe=0;qe<($e===3?2:6);qe++)if(!t.readBoolean())t.readUEG();else{const Et=Math.min(64,1<<4+($e<<1));$e>1&&t.readEG();for(let Kt=0;Kt<Et;Kt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const k=t.readUEG();let D=0;for(let ue=0;ue<k;ue++){let $e=!1;if(ue!==0&&($e=t.readBoolean()),$e){ue===k&&t.readUEG(),t.readBoolean(),t.readUEG();let qe=0;for(let xt=0;xt<=D;xt++){const Et=t.readBoolean();let Kt=!1;Et||(Kt=t.readBoolean()),(Et||Kt)&&qe++}D=qe}else{const qe=t.readUEG(),xt=t.readUEG();D=qe+xt;for(let Et=0;Et<qe;Et++)t.readUEG(),t.readBoolean();for(let Et=0;Et<xt;Et++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ue=t.readUEG();for(let $e=0;$e<ue;$e++){for(let qe=0;qe<M+4;qe++)t.readBits(1);t.readBits(1)}}let $=0,F=1,Y=1,Q=!0,ee=1,te=0;t.readBoolean(),t.readBoolean();let ne=!1;if(t.readBoolean()){if(t.readBoolean()){const wn=t.readUByte(),An=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ns=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];wn>0&&wn<16?(F=An[wn-1],Y=Ns[wn-1]):wn===255&&(F=t.readBits(16),Y=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ne=t.readBoolean(),ne&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ee=t.readBits(32),te=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ns=t.readBoolean(),ua=t.readBoolean();let Qe=!1;(Ns||ua)&&(Qe=t.readBoolean(),Qe&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Qe&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Yn=0;Yn<=r;Yn++){Q=t.readBoolean();const Xc=Q||t.readBoolean();let da=!1;Xc?t.readEG():da=t.readBoolean();const ss=da?1:t.readUEG()+1;if(Ns)for(let is=0;is<ss;is++)t.readUEG(),t.readUEG(),Qe&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ua)for(let is=0;is<ss;is++)t.readUEG(),t.readUEG(),Qe&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),$=t.readUEG())}let Fe=b,Ye=L;if(A){let ue=1,$e=1;T===1?ue=$e=2:T==2&&(ue=2),Fe=b-ue*C-ue*I,Ye=L-$e*_-$e*R}const st=s?["A","B","C"][s]:"",pr=a<<24|l<<16|c<<8|u;let Ht=0;for(let ue=0;ue<32;ue++)Ht=(Ht|(pr>>ue&1)<<31-ue)>>>0;let gr=Ht.toString(16);return o===1&&gr==="2"&&(gr="6"),{codecString:`hvc1.${st}${o}.${gr}.${i?"H":"L"}${v}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[d,f,h,m,p,g],general_level_idc:v,bit_depth:O+8,bit_depth_luma_minus8:O,bit_depth_chroma_minus8:V,min_spatial_segmentation_idc:$,chroma_format_idc:T,frame_rate:{fixed:Q,fps:te/ee}},width:Fe,height:Ye,pixelRatio:[F,Y]}}readPPS(e){const t=new xo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Xe=188;class kr{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=kr.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Xe*5,t-Xe)+1,s=0;for(;s<r;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=Xe)if(e[l]===71&&(t-l===Xe||e[l+Xe]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+Xe*99,e.length-Xe)+1)),i||(i=_f(e,l)===0),i&&a>1&&(o===0&&a>2||l+Xe>r))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:rS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=kr.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=kr.createTrack("audio",s),this._id3Track=kr.createTrack("id3"),this._txtTrack=kr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,f=a.pid,h=l.pid,m=a.pesData,p=l.pesData,g=null,v=this.pmtParsed,x=this._pmtId,E=e.length;if(this.remainderData&&(e=en(this.remainderData,e),E=e.length,this.remainderData=null),E<Xe&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const T=Math.max(0,kr.syncOffset(e));E-=(E-T)%Xe,E<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let b=0;for(let A=T;A<E;A+=Xe)if(e[A]===71){const I=!!(e[A+1]&64),C=_f(e,A),R=(e[A+3]&48)>>4;let _;if(R>1){if(_=A+5+e[A+4],_===A+Xe)continue}else _=A+4;switch(C){case u:I&&(d&&(i=Us(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(_,A+Xe)),d.size+=A+Xe-_);break;case f:if(I){if(m&&(i=Us(m,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(_,A+Xe)),m.size+=A+Xe-_);break;case h:I&&(p&&(i=Us(p,this.logger))&&this.parseID3PES(l,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(_,A+Xe)),p.size+=A+Xe-_);break;case 0:I&&(_+=e[_]+1),x=this._pmtId=RP(e,_);break;case x:{I&&(_+=e[_]+1);const O=CP(e,_,this.typeSupported,r,this.observer,this.logger);u=O.videoPid,u>0&&(o.pid=u,o.segmentCodec=O.segmentVideoCodec),f=O.audioPid,f>0&&(a.pid=f,a.segmentCodec=O.segmentAudioCodec),h=O.id3Pid,h>0&&(l.pid=h),g!==null&&!v&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${g}'. Backtracking to sync byte @${T} to parse all TS packets.`),g=null,A=T-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=C;break}}else b++;b>0&&Pf(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=m,l.pesData=p;const L={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(L),L}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,a=t.pesData,l=s.pesData;let c;if(o&&(c=Us(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,c,!0),r.pesData=null)):r.pesData=o,a&&(c=Us(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Us(l,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new AP(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new LP:e==="hevc"&&(this.videoParser=new IP))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)i=en(s.sample.unit,i);else{const h=f-d;s.sample.unit.set(i.subarray(0,d),h),e.samples.push(s.sample),r=s.missing}}let o,a;for(o=r,a=i.length;o<a-1&&!uc(i,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",Pf(this.observer,new Error(d),f,this.logger),!f)return}OS(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=MS(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=FS(e,i,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!uc(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(GS(r,o)){const l=US(e,r,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,a=0,l;for(;a<i&&(l=KS(e,r,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=ye({},t,{type:this._videoTrack?Mt.emsg:Mt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function _f(n,e){return((n[e+1]&31)<<8)+n[e+2]}function RP(n,e){return(n[e+10]&31)<<8|n[e+11]}function CP(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,c=(n[e+10]&15)<<8|n[e+11];for(e+=12+c;e<l;){const u=_f(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Hu("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!r){Hu("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!r){Hu("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(n[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const p=n[f+1]+2;f+=p,h-=p}}break;case 194:case 135:return Pf(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return o}function Pf(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(S.ERROR,S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Hu(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Us(n,e){let t=0,r,s,i,o,a;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=en(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const u=r[7];u&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,u&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=r[8];let d=i+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let h=0,m=l.length;h<m;h++){r=l[h];let p=r.byteLength;if(d)if(d>p){d-=p;continue}else r=r.subarray(d),p-=d,d=0;f.set(r,t),t+=p}return s&&(s-=i+3),{data:f,pts:o,dts:a,len:s}}return null}class kP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const br=Math.pow(2,32)-1;class P{static init(){P.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in P.types)P.types.hasOwnProperty(e)&&(P.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=i,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,o,l,o,a),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return P.box(P.types.hdlr,P.HDLR_TYPES[e])}static mdat(e){return P.box(P.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(br+1)),s=Math.floor(t%(br+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return P.box(P.types.mdia,P.mdhd(e.timescale||0,e.duration||0),P.hdlr(e.type),P.minf(e))}static mfhd(e){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(e)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(e))}static moof(e,t,r){return P.box(P.types.moof,P.mfhd(e),P.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trak(e[t]);return P.box.apply(null,[P.types.moov,P.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(P.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trex(e[t]);return P.box.apply(null,[P.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(br+1)),s=Math.floor(t%(br+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return P.box(P.types.sdtp,r)}static stbl(e){return P.box(P.types.stbl,P.stsd(e),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const a=P.box(P.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return P.box(P.types.mp4a,P.audioStsd(e),P.box(P.types.esds,P.esds(e)))}static mp3(e){return P.box(P.types[".mp3"],P.audioStsd(e))}static ac3(e){return P.box(P.types["ac-3"],P.audioStsd(e),P.box(P.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return P.box(P.types.stsd,P.STSD,P.mp4a(e));if(t==="ac3"&&e.config)return P.box(P.types.stsd,P.STSD,P.ac3(e));if(t==="mp3"&&e.codec==="mp3")return P.box(P.types.stsd,P.STSD,P.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return P.box(P.types.stsd,P.STSD,P.avc1(e));if(t==="hevc"&&e.vps)return P.box(P.types.stsd,P.STSD,P.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(br+1)),a=Math.floor(r%(br+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=P.sdtp(e),s=e.id,i=Math.floor(t/(br+1)),o=Math.floor(t%(br+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),P.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,P.box(P.types.trak,P.tkhd(e),P.mdia(e))}static trex(e){const t=e.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let a,l,c,u,d,f;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=r[a],c=l.duration,u=l.size,d=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return P.box(P.types.trun,o)}static initSegment(e){P.types||P.init();const t=P.moov(e);return en(P.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let m=0;m<r.length;m+=1){o+=3;for(let p=0;p<r[m].length;p+=1)o+=2+r[m][p].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=r.length-1;for(let m=0;m<r.length;m+=1){a.set(new Uint8Array([32+m|(m===l?128:0),0,r[m].length]),o),o+=3;for(let p=0;p<r[m].length;p+=1)a.set(new Uint8Array([r[m][p].length>>8,r[m][p].length&255]),o),o+=2,a.set(r[m][p],o),o+=r[m][p].length}const c=P.box(P.types.hvcC,a),u=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return P.box(P.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}P.types=void 0;P.HDLR_TYPES=void 0;P.STTS=void 0;P.STSC=void 0;P.STCO=void 0;P.STSZ=void 0;P.VMHD=void 0;P.SMHD=void 0;P.STSD=void 0;P.FTYP=void 0;P.DINF=void 0;const zS=9e4;function ym(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function _P(n,e,t=1,r=!1){return ym(n,e,1/t,r)}function to(n,e=!1){return ym(n,1e3,1/zS,e)}function PP(n,e=1){return ym(n,zS,1/e)}const DP=10*1e3,NP=1024,OP=1152,MP=1536;let js=null,Ku=null;function p0(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class yl extends tn{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,js===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);js=o?parseInt(o[1]):0}if(Ku===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Ku=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=zt(a,r),l=a-i),l>0?i:a},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,a,l){let c,u,d,f,h,m,p=i,g=i;const v=e.pid>-1,x=t.pid>-1,E=t.samples.length,T=e.samples.length>0,b=a&&E>0||E>1;if((!v||T)&&(!x||b)||this.ISGenerated||a){if(this.ISGenerated){var A,I,C,R;const M=this.videoTrackConfig;(M&&(t.width!==M.width||t.height!==M.height||((A=t.pixelRatio)==null?void 0:A[0])!==((I=M.pixelRatio)==null?void 0:I[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((R=M.pixelRatio)==null?void 0:R[1]))||!M&&b||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,o));const _=this.isVideoContiguous;let O=-1,V;if(b&&(O=FP(t.samples),!_&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,O>0){this.warn(`Dropped ${O} out of ${E} video samples due to a missing keyframe`);const M=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,g+=(t.samples[0].pts-M)/t.inputTimeScale,V=g}else O===-1&&(this.warn(`No keyframe found out of ${E} video samples`),m=!1);if(this.ISGenerated){if(T&&b){const M=this.getVideoStartPts(t.samples),B=(zt(e.samples[0].pts,M)-M)/t.inputTimeScale;p+=Math.max(0,B),g+=Math.max(0,-B)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),u=this.remuxAudio(e,p,this.isAudioContiguous,o,x||b||l===Z.AUDIO?g:void 0),b){const M=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,g,_,M)}}else b&&(c=this.remuxVideo(t,g,_,0));c&&(c.firstKeyFrame=O,c.independent=O!==-1,c.firstKeyFramePTS=V)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=YS(r,i,this._initPTS,this._initDTS)),s.samples.length&&(f=qS(s,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:m,text:f,id3:h}}generateIS(e,t,r,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||s,d="audio/mp4",f,h,m,p=-1;if(u&&(f=h=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):P.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.id,m=e.inputTimeScale,!c||m!==c.timescale?f=h=i[0].pts-Math.round(m*r):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:P.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(p=t.id,m=t.inputTimeScale,!c||m!==c.timescale){const g=this.getVideoStartPts(o),v=Math.round(m*r);h=Math.min(h,zt(o[0].dts,g)-v),f=Math.min(f,g-v)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${f/m} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${f/m} (${f}/${m}) trackId: ${p}`),this._initPTS={baseTime:f,timescale:m,trackId:p},this._initDTS={baseTime:h,timescale:m,trackId:p}):f=m=void 0,{tracks:l,initPTS:f,timescale:m,trackId:p}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*i/c.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,m,p,g=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=!1;if(!r||d===null){const $=u+t*i,F=o[0].pts-zt(o[0].dts,o[0].pts);js&&d!==null&&Math.abs($-F-(d+u))<15e3?r=!0:d=$-F-u}const E=d+u;for(let $=0;$<l;$++){const F=o[$];F.pts=zt(F.pts,E),F.dts=zt(F.dts,E),F.dts<o[$>0?$-1:$].dts&&(x=!0)}x&&o.sort(function($,F){const Y=$.dts-F.dts,Q=$.pts-F.pts;return Y||Q}),m=o[0].dts,p=o[o.length-1].dts;const T=p-m,b=T?Math.round(T/(l-1)):h||e.inputTimeScale/30;if(r){const $=m-E,F=$>b,Y=$<-1;if((F||Y)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${to($,!0)} ms (${$}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${to(-$,!0)} ms (${$}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Y||E>=o[0].pts||js)){m=E;const Q=o[0].pts-$;if(F)o[0].dts=m,o[0].pts=Q;else{let ee=!0;for(let te=0;te<o.length&&!(o[te].dts>Q&&ee);te++){const ne=o[te].pts;if(o[te].dts-=$,o[te].pts-=$,te<o.length-1){const Ae=o[te+1].pts,Fe=o[te].pts,Ye=Ae<=Fe,st=Ae<=ne;ee=Ye==st}}}this.log(`Video: Initial PTS/DTS adjusted: ${to(Q,!0)}/${to(m,!0)}, delta: ${to($,!0)} ms`)}}m=Math.max(0,m);let L=0,A=0,I=m;for(let $=0;$<l;$++){const F=o[$],Y=F.units,Q=Y.length;let ee=0;for(let te=0;te<Q;te++)ee+=Y[te].data.length;A+=ee,L+=Q,F.length=ee,F.dts<I?(F.dts=I,I+=b/4|0||1):I=F.dts,g=Math.min(F.pts,g),v=Math.max(F.pts,v)}p=o[l-1].dts;const C=A+4*L+8;let R;try{R=new Uint8Array(C)}catch($){this.observer.emit(S.ERROR,S.ERROR,{type:J.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:C,reason:`fail allocating video mdat ${C}`});return}const _=new DataView(R.buffer);_.setUint32(0,C),R.set(P.types.mdat,4);let O=!1,V=Number.POSITIVE_INFINITY,M=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let $=0;$<l;$++){const F=o[$],Y=F.units;let Q=0;for(let ne=0,Ae=Y.length;ne<Ae;ne++){const Fe=Y[ne],Ye=Fe.data,st=Fe.data.byteLength;_.setUint32(f,st),f+=4,R.set(Ye,f),f+=st,Q+=4+st}let ee;if($<l-1)h=o[$+1].dts-F.dts,ee=o[$+1].pts-F.pts;else{const ne=this.config,Ae=$>0?F.dts-o[$-1].dts:b;if(ee=$>0?F.pts-o[$-1].pts:b,ne.stretchShortVideoTrack&&this.nextAudioTs!==null){const Fe=Math.floor(ne.maxBufferHole*i),Ye=(s?g+s*i:this.nextAudioTs+u)-F.pts;Ye>Fe?(h=Ye-Ae,h<0?h=Ae:O=!0,this.log(`It is approximately ${Ye/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Ae}else h=Ae}const te=Math.round(F.pts-F.dts);V=Math.min(V,h),K=Math.max(K,h),M=Math.min(M,ee),B=Math.max(B,ee),a.push(p0(F.key,h,Q,te))}if(a.length){if(js){if(js<70){const $=a[0].flags;$.dependsOn=2,$.isNonSync=0}}else if(Ku&&B-M<K-V&&b/K<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let $=m;for(let F=0,Y=a.length;F<Y;F++){const Q=$+a[F].duration,ee=$+a[F].cts;if(F<Y-1){const te=Q+a[F+1].cts;a[F].duration=te-ee}else a[F].duration=F?a[F-1].duration:b;a[F].cts=0,$=Q}}}h=O||!h?b:h;const H=p+h;this.nextVideoTs=d=H-u,this.videoSampleDuration=h,this.isVideoContiguous=!0;const j={data1:P.moof(e.sequenceNumber++,m,ye(e,{samples:a})),data2:R,startPTS:(g-u)/i,endPTS:(v+h-u)/i,startDTS:(m-u)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,j}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return OP;case"ac3":return MP;default:return NP}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],m=i!==void 0;let p=e.samples,g=f?0:8,v=this.nextAudioTs||-1;const x=d.baseTime*o/d.timescale,E=x+t*o;if(this.isAudioContiguous=r=r||p.length&&v>0&&(s&&Math.abs(E-(v+x))<9e3||Math.abs(zt(p[0].pts,E)-(v+x))<20*u),p.forEach(function(B){B.pts=zt(B.pts,E)}),!r||v<0){if(p=p.filter(B=>B.pts>=0),!p.length)return;i===0?v=0:s&&!m?v=Math.max(0,E-x):v=p[0].pts-x}if(e.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let H=0,k=v+x;H<p.length;H++){const D=p[H],j=D.pts,$=j-k,F=Math.abs(1e3*$/o);if($<=-B*u&&m)H===0&&(this.warn(`Audio frame @ ${(j/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*$/o)} ms.`),this.nextAudioTs=v=j-x,k=j);else if($>=B*u&&F<DP&&m){let Y=Math.round($/u);for(k=j-Y*u;k<0&&Y&&u;)Y--,k+=u;H===0&&(this.nextAudioTs=v=k-x),this.warn(`Injecting ${Y} audio frames @ ${((k-x)/o).toFixed(3)}s due to ${Math.round(1e3*$/o)} ms gap.`);for(let Q=0;Q<Y;Q++){let ee=kP.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ee||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ee=D.unit.subarray()),p.splice(H,0,{unit:ee,pts:k}),k+=u,H++}}D.pts=k,k+=u}}let T=null,b=null,L,A=0,I=p.length;for(;I--;)A+=p[I].unit.byteLength;for(let B=0,H=p.length;B<H;B++){const k=p[B],D=k.unit;let j=k.pts;if(b!==null){const F=h[B-1];F.duration=Math.round((j-b)/l)}else if(r&&e.segmentCodec==="aac"&&(j=v+x),T=j,A>0){A+=g;try{L=new Uint8Array(A)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:J.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(L.buffer).setUint32(0,A),L.set(P.types.mdat,4))}else return;L.set(D,g);const $=D.byteLength;g+=$,h.push(p0(!0,c,$,0)),b=j}const C=h.length;if(!C)return;const R=h[h.length-1];v=b-x,this.nextAudioTs=v+l*R.duration;const _=f?new Uint8Array(0):P.moof(e.sequenceNumber++,T/l,ye({},e,{samples:h}));e.samples=[];const O=(T-x)/o,V=v/o,K={data1:_,data2:L,startPTS:O,endPTS:V,startDTS:O,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,K}}function zt(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function FP(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function YS(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=zt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=zt(l.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function qS(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=zt(a.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class BP extends tn{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=oS(e);if(t)Lk(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(r=g0(i,xe.AUDIO,this)),o&&(s=g0(o,xe.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,r,s,i,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};q(u)||(u=this.lastEndTime=i||0);const f=t.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=Ik(f,m,this),g=m.audio?p[m.audio.id]:null,v=m.video?p[m.video.id]:null,x=Ga(v,1/0),E=Ga(g,1/0),T=Ga(v,0,!0),b=Ga(g,0,!0);let L=i,A=0;const I=g&&(!v||!c&&E<x||c&&c.trackId===m.audio.id),C=I?g:v;if(C){const k=C.timescale,D=C.start-i*k,j=I?m.audio.id:m.video.id;L=C.start/k,A=I?b-E:T-x,(o||!c)&&($P(c,L,i,A)||k!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${D/k} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${L-i} (${D}/${k}) trackId: ${j}`),c=null,h.initPTS=D,h.timescale=k,h.trackId=j)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(h.initPTS=c.baseTime,h.timescale=c.timescale,h.trackId=c.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=L,h.timescale=1,h.trackId=-1),this.initPTS=c={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const R=L-c.baseTime/c.timescale,_=R+A;A>0?this.lastEndTime=_:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const O=!!m.audio,V=!!m.video;let M="";O&&(M+="audio"),V&&(M+="video");const K=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),B={data1:f,startPTS:R,startDTS:R,endPTS:_,endDTS:_,type:M,hasAudio:O,hasVideo:V,nb:1,dropped:0,encrypted:K};d.audio=O&&!V?B:void 0,d.video=V?B:void 0;const H=v==null?void 0:v.sampleCount;if(H){const k=v.keyFrameIndex,D=k!==-1;B.nb=H,B.dropped=k===0||this.isVideoContiguous?0:D?k:H,B.independent=D,B.firstKeyFrame=k,D&&v.keyFrameStart&&(B.firstKeyFramePTS=(v.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=D),this.isVideoContiguous||(this.isVideoContiguous=D),B.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${k}/${H} dropped: ${B.dropped} start: ${B.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=YS(r,i,c,c),s.samples.length&&(d.text=qS(s,i,c)),d}}function Ga(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function $P(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function g0(n,e,t){const r=n.codec;return r&&r.length>4?r:e===xe.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?rc(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let tr;try{tr=self.performance.now.bind(self.performance)}catch{tr=Date.now}const xl=[{demux:wP,remux:BP},{demux:kr,remux:yl},{demux:EP,remux:yl},{demux:TP,remux:yl}];xl.splice(2,0,{demux:SP,remux:yl});class v0{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=tr();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:m}=s||a,{audioCodec:p,videoCodec:g,defaultInitPts:v,duration:x,initSegmentData:E}=l,T=UP(o,t);if(T&&pi(T.method)){const I=this.getDecrypter(),C=cm(T.method);if(I.isSync()){let R=I.softwareDecrypt(o,T.key.buffer,T.iv.buffer,C);if(r.part>-1){const O=I.flush();R=O&&O.buffer}if(!R)return i.executeEnd=tr(),Wu(r);o=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=I.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer,C).then(R=>{const _=this.push(R,null,r);return this.decryptionPromise=null,_}),this.decryptionPromise}const b=this.needsProbing(u,d);if(b){const I=this.configureTransmuxer(o);if(I)return this.logger.warn(`[transmuxer] ${I.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),i.executeEnd=tr(),Wu(r)}(u||d||m||b)&&this.resetInitSegment(E,p,g,x,t),(u||m||b)&&this.resetInitialTimestamp(v),c||this.resetContiguity();const L=this.transmux(o,T,h,f,r);this.asyncResult=zo(L);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,i.executeEnd=tr(),L}flush(e){const t=e.transmuxing;t.executeStart=tr();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(r){const d=r.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=tr();const d=[Wu(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(a);return zo(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Z.MAIN?"level":"track"} ${r.level}`);const u=this.remuxer.remux(s,i,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=tr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let d=0,f=xl.length;d<f;d++){var o;if((o=xl[d].demux)!=null&&o.probe(e,this.logger)){i=xl[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=i.remux,u=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(r,t,s,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(r,t,s,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new am(this.config)),e}}function UP(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Wu=n=>({remuxResult:{},chunkMeta:n});function zo(n){return"then"in n&&n.then instanceof Function}class jP{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class GP{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let y0=0;class QS{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=y0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===S.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new fm,this.observer.on(S.FRAG_DECRYPTED,o),this.observer.on(S.ERROR,o);const a=Og(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||W_()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=Y_(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=z_());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:we(i)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new v0(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new v0(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=y0++;const t=this.hls.config,r=Og(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:we(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),q_(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,a,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:m}=this,p=o?o.start:i.start,g=i.decryptdata,v=this.frag,x=!(v&&i.cc===v.cc),E=!(v&&c.level===v.level),T=v?c.sn-v.sn:-1,b=this.part?c.part-this.part.index:-1,L=T===0&&c.id>1&&c.id===(v==null?void 0:v.stats.chunkCount),A=!E&&(T===1||T===0&&(b===1||L&&b<=0)),I=self.performance.now();(E||T||i.stats.parsing.start===0)&&(i.stats.parsing.start=I),o&&(b||!A)&&(o.stats.parsing.start=I);const C=!(v&&((d=i.initSegment)==null?void 0:d.url)===((f=v.initSegment)==null?void 0:f.url)),R=new GP(x,A,l,E,p,C);if(!A||x||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Z.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${x}
        trackSwitch: ${E}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${C}`);const _=new jP(r,s,t,a,u);this.configureTransmuxer(_)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:R},e instanceof ArrayBuffer?[e]:[]);else if(m){const _=m.push(e,g,c,R);zo(_)?_.then(O=>{this.handleTransmuxComplete(O)}).catch(O=>{this.transmuxerError(O,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(_)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);zo(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const x0=100;class VP extends dm{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Z.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){if(r===Z.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===U.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===U.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=gS(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===U.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=U.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(x0),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=U.IDLE):this.state=U.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case U.IDLE:this.doTickIdle();break;case U.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=U.WAITING_INIT_PTS}break}case U.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case U.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=U.FRAG_LOADING;const a=s.flush().buffer,l={frag:t,part:r,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=U.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const a=r[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=U.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,xe.AUDIO,Z.AUDIO));const u=this.getFwdBufferInfo(c,Z.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=U.ENDED;return}const d=u.len,f=t.maxBufferLength,h=l.fragments,m=h[0].start,p=this.getLoadPosition(),g=this.flushing?p:u.end;if(this.switchingTrack&&s){const E=p;l.PTSKnown&&E<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=m+.05)}if(d>=f&&!this.switchingTrack&&g<h[h.length-1].start)return;let v=this.getNextFragment(g,l);if(v&&this.isLoopLoading(v,g)&&(v=this.getNextFragmentLoopLoading(v,l,u,Z.MAIN,f)),!v){this.bufferFlushed=!0;return}let x=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&x&&Ue(v)&&!v.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(x)===We.OK&&(this.mainFragLoading=x=null),x&&Ue(x))){if(v.start>x.end){const T=this.fragmentTracker.getFragAtPos(g,Z.MAIN);T&&T.end>x.end&&(x=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(v.start>x.end)return}this.loadFragment(v,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Ho(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==U.STOPPED&&(this.setInterval(x0),this.state=U.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:a,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==U.STOPPED&&(this.state=U.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=s[o];let d=0;if(i.live||(r=u.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(u.details){var f;d=this.alignPlaylists(i,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(kS(i,c),i.alignedSliding||cc(i,c),d=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===U.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=U.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new QS(this.hls,Z.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],m=(t=r.initSegment)==null?void 0:t.data;if(h!==void 0){const g=s?s.index:-1,v=g!==-1,x=new lm(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,v);f.push(i,m,d,"",r,s,u.totalduration,!1,x,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new _S,complete:!1};p.push(new Uint8Array(i)),this.state!==U.STOPPED&&(this.state=U.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Z.MAIN&&Ue(t.frag)&&(this.mainFragLoading=t,this.state===U.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==Z.AUDIO){!this.audioOnly&&r.type===Z.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ue(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,ve({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.AUDIO,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ce.AUDIO_TRACK&&(this.state=U.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==xe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==xe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===U.ENDED&&(this.state=U.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Z.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:f,text:h,id3:m,initSegment:p}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=U.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(p,l))return;this._bufferInitSegment(u,p.tracks,g,o),s.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:p.tracks})}if(f){const{startPTS:g,endPTS:v,startDTS:x,endDTS:E}=f;c&&(c.elementaryStreams[xe.AUDIO]={startPTS:g,endPTS:v,startDTS:x,endDTS:E}),l.setElementaryStreamInfo(xe.AUDIO,g,v,x,E),this.bufferFragmentData(f,l,c,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const g=ye({id:r,frag:l,details:d},m);s.trigger(S.FRAG_PARSING_METADATA,g)}if(h){const g=ye({id:r,frag:l,details:d},h);s.trigger(S.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,r,s){if(this.state!==U.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=Z.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(S.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:a};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===We.NOT_LOADED||s===We.PARTIAL){var i;if(!Ue(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=U.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&cc(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;bs({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a},e,ds)||(ic(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,ve({},e))}}class xm extends tn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=r&&Mg(r);return new Fg(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const u=Math.max(l||0,0);s.appliedTimelineOffset=u,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(s.live||r!=null&&r.live){const u="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){O_(r,s,this);const x=s.playlistParsingError;if(x){this.warn(x);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var c;const{networkDetails:T}=t;E.trigger(S.ERROR,{type:J.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:x,reason:x.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:T,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(s.edge-f)*1e3,m=AS(s,h);if(s.requestScheduled+m<o?s.requestScheduled=o:s.requestScheduled+=m,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let p,g,v;if(s.canBlockReload&&s.endSN&&s.advanced){const x=this.hls.config.lowLatencyMode,E=s.lastPartSn,T=s.endSN,b=s.lastPartIndex,L=b!==-1,A=E===T;L?A?(g=T+1,v=x?0:b):(g=E,v=x?b+1:s.maxPartIndex):g=T+1;const I=s.age,C=I+s.ageHeader;let R=Math.min(C-s.partTarget,s.targetduration*1.5);if(R>0){if(C>s.targetduration*3)this.log(`Playlist last advanced ${I.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,v=void 0;else if(r!=null&&r.tuneInGoal&&C-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${R} with playlist age: ${s.age}`),R=0;else{const _=Math.floor(R/s.targetduration);if(g+=_,v!==void 0){const O=Math.round(R%s.targetduration/s.partTarget);v+=O}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${I.toFixed(2)}s goal: ${R} skip sn ${_} to part ${v}`)}s.tuneInGoal=R}if(p=this.getDeliveryDirectives(s,t.deliveryDirectives,g,v),x||!A){s.requestScheduled=o,this.loadingPlaylist(u,p);return}}else(s.canBlockReload||s.canSkipUntil)&&(p=this.getDeliveryDirectives(s,t.deliveryDirectives,g,v));p&&g!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(m-a*2,m/2)),this.scheduleLoading(u,p,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,s){let i=Mg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=gl.No),new Fg(r,s,i)}checkRetry(e){const t=e.details,r=oc(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===tt.RetryRequest||!s.resolved&&i===tt.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=om(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function XS(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Yo(n[t].attrs,e[t].attrs))return!1;return!0}function Yo(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Df(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class HP extends xm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const f=Bn(l,a,ds);if(f>-1)i=a[f];else{const h=Bn(l,this.tracks);i=this.tracks[h]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ce.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&bs(e,s,ds))return s;const i=Bn(e,this.tracksInGroup,ds);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=e_(e,t.levels,r,o,ds);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Bn(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,ve({},s)),i))return;const o=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||bs(e,s,ds)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(bs({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},u,ds))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Yo(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Yo(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&ic(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class KP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const E0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ZS="HlsJsTrackRemovedError";class WP extends Error{constructor(e){super(e),this.name=ZS}}class zP extends tn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=gk(Jr(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?ye(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=ye({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Jr(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,S0(r),YP(r,a),r.load()}catch{r.src=a}else r.src=a}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${we(r,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${we(s,(l,c)=>l==="initSegment"?void 0:c)}}`),!JE(s,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,i.forEach(l=>{const c=l,u=s[c];if(u){const d=u.buffer;if(d){const f=this.fragmentTracker,h=u.id;if(f.hasFragments(h)||f.hasParts(h)){const g=se.getBuffered(d);f.detectEvictedFragments(c,g,h,null,!0)}const m=zu(c),p=[c,d];this.sourceBuffers[m]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),i.removeSourceBuffer(l[c]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&S0(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[zu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new KP(this.tracks)}onBufferCodecs(e,t){const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const i="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!i&&this.sourceBufferCount&&this.media&&s.some(a=>!r[a]);if(i||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(a=>{var l,c;const u=t[a],{id:d,codec:f,levelCodec:h,container:m,metadata:p,supplemental:g}=u;let v=r[a];const x=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[a],E=x!=null&&x.buffer?x:v,T=(E==null?void 0:E.pendingCodec)||(E==null?void 0:E.codec),b=E==null?void 0:E.levelCodec;v||(v=r[a]={buffer:void 0,listeners:[],codec:f,supplemental:g,container:m,levelCodec:h,metadata:p,id:d});const L=pl(T,b),A=L==null?void 0:L.replace(E0,"$1");let I=pl(f,h);const C=(c=I)==null?void 0:c.replace(E0,"$1");I&&L&&A!==C&&(a.slice(0,5)==="audio"&&(I=rc(I,this.appendSource)),this.log(`switching codec ${T} to ${I}`),I!==(v.pendingCodec||v.codec)&&(v.pendingCodec=I),v.container=m,this.appendChangeType(a,m,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),a.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,Z.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&se.isBuffered(l.buffer,s)||((a=this.fragmentTracker.getAppendedFrag(s,Z.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[i],{sn:f,cc:h}=a,m=self.performance.now();d.start=m;const p=a.stats.buffering,g=l?l.stats.buffering:null;p.start===0&&(p.start=m),g&&g.start===0&&(g.start=m);const v=r.audio;let x=!1;i==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const E=r.video,T=E==null?void 0:E.buffer;if(T&&f!=="initSegment"){const A=l||a,I=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const R=A.start+A.duration*.05,_=T.buffered,O=this.currentOp("video");!_.length&&!O?this.blockAudio(A):!O&&!se.isBuffered(T,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(A)}else if(i==="video"){const C=A.end;if(I){const R=I.frag.start;(C>R||C<this.lastVideoAppendEnd||se.isBuffered(T,R))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}const b=(l||a).start,L={label:`append-${i}`,execute:()=>{var A;d.executeStart=self.performance.now();const I=(A=this.tracks[i])==null?void 0:A.buffer;I&&(x?this.updateTimestampOffset(I,b,.1,i,f,h):u!==void 0&&q(u)&&this.updateTimestampOffset(I,u,1e-6,i,f,h)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();d.executeEnd=d.end=A,p.first===0&&(p.first=A),g&&g.first===0&&(g.first=A);const I={};this.sourceBuffers.forEach(([C,R])=>{C&&(I[C]=se.getBuffered(R))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:I})},onError:A=>{var I;const C={type:J.MEDIA_ERROR,parent:a.type,details:N.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:c,error:A,err:A,fatal:!1},R=(I=this.media)==null?void 0:I.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)C.details=N.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)C.errorAction=mi(!0);else if(A.name===ZS&&this.sourceBufferCount===0)C.errorAction=mi(!0);else{const _=++this.appendErrors[i];this.warn(`Failed ${_}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${R||"no media error"})`),(_>=this.hls.config.appendErrorMaxRetry||R)&&(C.fatal=!0)}this.hls.trigger(S.ERROR,C)}};this.append(L,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[xe.AUDIOVIDEO]?i.push("audiovideo"):(o[xe.AUDIO]&&i.push("audio"),o[xe.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:r.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:r,part:s,stats:c,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===N.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;q(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,a=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(q(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,u)}const l=s.frontBufferFlushThreshold;if(q(l)&&l>0){const c=Math.max(s.maxBufferLength,l),u=Math.max(c,o),d=Math.floor(i/o)*o+u;this.flushFrontBuffer(i,o,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=se.getBuffered(i);if(a.length>0&&r>a.start(0)){var o;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=se.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(r>l||e>=l&&e<=c)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,s);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return q(i)?{duration:i}:null;const o=this.media.duration,a=q(r.duration)?r.duration:0;return s>a&&s>o||!q(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(q(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${we(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${we(a)}`);try{const u=r.addSourceBuffer(c),d=zu(o),f=[o,u];t[d]=f,a.buffer=u}catch(u){var s;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&bf(r,"video")&&(s=Ok(s,r));const i=pl(s,e.levelCodec);return i?t.slice(0,5)==="audio"?rc(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,o){const a=t-e.timestampOffset;Math.abs(a)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!s||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=q(s.duration)?s.duration:1/0,c=q(i.duration)?i.duration:1/0,u=Math.max(0,t),d=Math.min(r,l,c);d>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),a.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new WP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function S0(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function YP(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function zu(n){return n==="audio"?1:0}class Em{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&q(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Em.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}const qP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},St=qP,QP={HLS:"h"},XP=QP;class Kn{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Kn?r:new Kn(r))),this.value=e,this.params=t}}const ZP="Dict";function JP(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function eD(n,e,t,r){return new Error(`failed to ${n} "${JP(e)}" as ${t}`,{cause:r})}function Wn(n,e,t){return eD("serialize",n,e,t)}class JS{constructor(e){this.description=e}}const T0="Bare Item",tD="Boolean";function nD(n){if(typeof n!="boolean")throw Wn(n,tD);return n?"?1":"?0"}function rD(n){return btoa(String.fromCharCode(...n))}const sD="Byte Sequence";function iD(n){if(ArrayBuffer.isView(n)===!1)throw Wn(n,sD);return`:${rD(n)}:`}const oD="Integer";function aD(n){return n<-999999999999999||999999999999999<n}function eT(n){if(aD(n))throw Wn(n,oD);return n.toString()}function lD(n){return`@${eT(n.getTime()/1e3)}`}function tT(n,e){if(n<0)return-tT(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const cD="Decimal";function uD(n){const e=tT(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Wn(n,cD);const t=e.toString();return t.includes(".")?t:`${t}.0`}const dD="String",fD=/[\x00-\x1f\x7f]+/;function hD(n){if(fD.test(n))throw Wn(n,dD);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function mD(n){return n.description||n.toString().slice(7,-1)}const pD="Token";function b0(n){const e=mD(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Wn(e,pD);return e}function Nf(n){switch(typeof n){case"number":if(!q(n))throw Wn(n,T0);return Number.isInteger(n)?eT(n):uD(n);case"string":return hD(n);case"symbol":return b0(n);case"boolean":return nD(n);case"object":if(n instanceof Date)return lD(n);if(n instanceof Uint8Array)return iD(n);if(n instanceof JS)return b0(n);default:throw Wn(n,T0)}}const gD="Key";function Of(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Wn(n,gD);return n}function Sm(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Of(e)}`:`;${Of(e)}=${Nf(t)}`).join("")}function nT(n){return n instanceof Kn?`${Nf(n.value)}${Sm(n.params)}`:Nf(n)}function vD(n){return`(${n.value.map(nT).join(" ")})${Sm(n.params)}`}function yD(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Wn(n,ZP);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Kn||(i=new Kn(i));let o=Of(s);return i.value===!0?o+=Sm(i.params):(o+="=",Array.isArray(i.value)?o+=vD(i):o+=nT(i)),o}).join(`,${r}`)}function rT(n,e){return yD(n,e)}const Rn="CMCD-Object",De="CMCD-Request",as="CMCD-Session",wr="CMCD-Status",xD={br:Rn,ab:Rn,d:Rn,ot:Rn,tb:Rn,tpb:Rn,lb:Rn,tab:Rn,lab:Rn,url:Rn,pb:De,bl:De,tbl:De,dl:De,ltc:De,mtp:De,nor:De,nrr:De,rc:De,sn:De,sta:De,su:De,ttfb:De,ttfbb:De,ttlb:De,cmsdd:De,cmsds:De,smrt:De,df:De,cs:De,ts:De,cid:as,pr:as,sf:as,sid:as,st:as,v:as,msd:as,bs:wr,bsd:wr,cdn:wr,rtp:wr,bg:wr,pt:wr,ec:wr,e:wr},ED={REQUEST:De};function SD(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function TD(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?SD(e):{};return r.reduce((i,o)=>{var a;const l=xD[o]||s[o]||ED.REQUEST,c=(a=i[l])!==null&&a!==void 0?a:i[l]={};return c[o]=n[o],i},t)}function bD(n){return["ot","sf","st","e","sta"].includes(n)}function wD(n){return typeof n=="number"?q(n):n!=null&&n!==""&&n!==!1}const sT="event";function AD(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const El=n=>Math.round(n),Mf=(n,e)=>Array.isArray(n)?n.map(t=>Mf(t,e)):n instanceof Kn&&typeof n.value=="string"?new Kn(Mf(n.value,e),n.params):(e.baseUrl&&(n=AD(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Va=n=>El(n/100)*100,LD=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Kn&&typeof n.value=="string"?t=new Kn([n]):typeof n=="string"&&(t=[n])),Mf(t,e)},ID={br:El,d:El,bl:Va,dl:Va,mtp:Va,nor:LD,rtp:Va,tb:El},iT="request",oT="response",Tm=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],RD=["e"],CD=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Wc(n){return CD.test(n)}function kD(n){return Tm.includes(n)||RD.includes(n)||Wc(n)}const aT=["d","dl","nor","ot","rtp","su"];function _D(n){return Tm.includes(n)||aT.includes(n)||Wc(n)}const PD=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function DD(n){return Tm.includes(n)||aT.includes(n)||PD.includes(n)||Wc(n)}const ND=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function OD(n){return ND.includes(n)||Wc(n)}const MD={[oT]:DD,[sT]:kD,[iT]:_D};function lT(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||iT,i=r===1?OD:MD[s];let o=Object.keys(n).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=s===oT||s===sT;l&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const c=ye({},ID,e.formatters),u={version:r,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let f=n[d];const h=c[d];if(typeof h=="function"&&(f=h(f,u)),d==="v"){if(r===1)return;f=r}d=="pr"&&f===1||(l&&d==="ts"&&!q(f)&&(f=Date.now()),wD(f)&&(bD(d)&&typeof f=="string"&&(f=new JS(f)),t[d]=f))}),t}function FD(n,e={}){const t={};if(!n)return t;const r=lT(n,e),s=TD(r,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[o,a])=>{const l=rT(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function BD(n,e,t){return ye(n,FD(e,t))}const $D="CMCD";function UD(n,e={}){return n?rT(lT(n,e),{whitespace:!1}):""}function jD(n,e={}){if(!n)return"";const t=UD(n,e);return encodeURIComponent(t)}function GD(n,e={}){if(!n)return"";const t=jD(n,e);return`${$D}=${t}`}const w0=/CMCD=[^&#]+/;function VD(n,e,t){const r=GD(e,t);if(!r)return n;if(w0.test(n))return n.replace(w0,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class HD{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:St.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,a=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:l};(l===St.VIDEO||l===St.AUDIO||l==St.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(i);u!=null&&u.url&&u.url!==i.url&&(c.nor=u.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:XP.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ye(t,this.createData());const r=t.ot===St.INIT||t.ot===St.VIDEO||t.ot===St.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),BD(e.headers,t,i)):e.url=VD(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===r&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return St.TIMED_TEXT;if(e.sn==="initSegment")return St.INIT;if(t==="audio")return St.AUDIO;if(t==="main")return this.hls.audioTracks.length?St.VIDEO:St.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===St.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===St.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:se.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const KD=3e5;class WD extends tn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===tt.SendAlternateToPenaltyBox&&r.flags===Pt.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&s?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===N.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${we(i)} penalized: ${we(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>KD&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,RS(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===ce.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===ce.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=new Ce(u.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),h&&(s[d.SUBTITLES]=h,d.SUBTITLES=h);const m=cT(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Ho({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let g=1;g<u.audioGroups.length;g++)p.addGroupId("audio",`${u.audioGroups[g]}_clone_${o}`);if(u.subtitleGroups)for(let g=1;g<u.subtitleGroups.length;g++)p.addGroupId("text",`${u.subtitleGroups[g]}_clone_${o}`);return p});t.push(...c),A0(this.audioTracks,r,l,o),A0(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,f,h)=>{this.log(`Loaded steering manifest: "${s}"`);const m=u.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":v}=m;if(p)try{this.uri=new self.URL(p,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g);const x={steeringManifest:m,url:s.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,x),v&&this.updatePathwayPriority(v)},onError:(u,d,f,h)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const g=p.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function A0(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const a=ye({},o);return a.details=void 0,a.attrs=new Ce(a.attrs),a.url=a.attrs.URI=cT(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=r,a});n.push(...i)})}function cT(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class gi extends tn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=gi.CDMCleanupPromise?[gi.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=oo(this.config));const a=o.map($u).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=vl(o);if(r!=="sinf"||a!==Me.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}let l;try{const h=He(new Uint8Array(s)),m=um(JSON.parse(h).sinf),p=aS(m);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24))}catch(h){this.warn(`${i} Failed to parse sinf: ${h}`);return}const c=Nt(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let f=u[c];for(let h=0;h<d.length;h++){const m=d[h],p=m.decryptdata;if(!p.keyId)continue;const g=Nt(p.keyId);if(c===g||p.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[g],!f)continue;if(p.pssh)break;delete u[g],p.pssh=new Uint8Array(s),p.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,r,s,"encrypted-event-key-match")),f.catch(v=>this.handleError(v));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===Me.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,s,i).then(d=>o({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof cn?a(d):a(new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return SS===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=L_(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(s=o)==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${we(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Nt(e.keyId||[])}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Nt(e.keyId)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Nt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>$u(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=$u(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=oo(this.config),r=e.map(vl).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),s=this.bannedKeyIds[r];if(s){const a=L0(s,t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=a,a}return o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){this.hls&&(this.error(e.message),e instanceof cn?(t&&(e.data.frag=t),this.hls.trigger(S.ERROR,e.data)):this.hls.trigger(S.ERROR,{type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=vl(e.keyFormat),i=s?[s]:oo(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=oo(this.config)),e.length===0)throw new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${we({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const f=o.call(this.hls,t,r,e);if(!f)throw new Error("Invalid response from configured generateRequest filter");t=f.initDataType,r=f.initData?f.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const a=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${a} (init data type: ${t} length: ${r.byteLength})`);const l=new fm,c=e._onmessage=f=>{const h=e.mediaKeysSession;if(!h){l.emit("error",new Error("invalid state"));return}const{messageType:m,message:p}=f;this.log(`"${m}" message event for session "${h.sessionId}" message size: ${p.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,p).catch(g=>{l.eventNames().length?l.emit("error",g):this.handleError(g)}):m==="license-release"?e.keySystem===Me.FAIRPLAY&&(this.updateKeySession(e,Rf("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},u=e._onkeystatuseschange=f=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}const m=e.keyStatus;this.onKeyStatusChange(e);const p=e.keyStatus;p!==m&&(l.emit("keyStatus",p,e),p==="expired"&&(this.log(`${e.keySystem} expired for key ${a}`),this.renewKeySession(e)))};mt(e.mediaKeysSession,"message",c),mt(e.mediaKeysSession,"keystatuseschange",u);const d=new Promise((f,h)=>{l.on("error",h),l.on("keyStatus",(m,{decryptdata:p})=>{m.startsWith("usable")?f():m==="internal-error"||m==="output-restricted"?h(L0(m,p)):m==="expired"?h(new Error(`key expired while generating request (keyId: ${a})`)):this.warn(`unhandled key status change "${m}" (keyId: ${a})`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a}`)}).catch(f=>{throw new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:f,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${f}`)}).then(()=>d).catch(f=>{throw l.removeAllListeners(),this.removeSession(e),f}).then(()=>(l.removeAllListeners(),e))}onKeyStatusChange(e){const t=Nt(new Uint8Array(e.decryptdata.keyId||[]));e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const a=s;s=r,r=a}const i=Nt("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s));r==="internal-error"&&(this.bannedKeyIds[i]=r);const o=i===t;this.log(`${o?"":"un"}matched key status change "${r}" for keyStatuses keyId: ${i} session keyId: ${t} uri: ${e.decryptdata.uri}`),o&&(e.keyStatus=r)})}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,p)=>{o(f.data)},onError:(f,h,m,p)=>{a(new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:ve({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,m)=>{a(new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,h,m)=>{a(new Error("aborted"))}};s.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let u;for(let d=0,f=i.length;d<f;d++){var o,a;u=i[d];const h=(o=u.querySelector("name"))==null?void 0:o.textContent,m=(a=u.querySelector("value"))==null?void 0:a.textContent;h&&m&&e.setRequestHeader(h,m)}}const l=s.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Rf(atob(c))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}s(l)}else{const l=r.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)i(new cn({type:J.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Me.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,mt(r,"encrypted",this.onMediaEncrypted),mt(r,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Lt(e,"encrypted",this.onMediaEncrypted),Lt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Hc.clearKeyUriToKeyIdMap();const s=r.length;gi.CDMCleanupPromise=Promise.all(r.map(i=>this.removeSession(i)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(i=>{this.log(`Could not clear media keys: ${i}`),this.hls&&this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${i}`)})}))).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`),this.hls&&this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${i}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Nt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:o}=this.config;return(R_(o)?new Promise((l,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(l).catch(c)}):Promise.resolve()).catch(l=>{this.log(`Could not remove session: ${l}`),this.hls&&this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${l}`)})}).then(()=>t.close()).catch(l=>{this.log(`Could not close session: ${l}`),this.hls&&this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${l}`)})})}}}gi.CDMCleanupPromise=void 0;class cn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function L0(n,e){const t=n==="output-restricted",r=t?N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new cn({type:J.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class zD{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,c=this.hls;if(c.trigger(S.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function uT(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function dT(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){me.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){me.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function si(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Ff(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=qD(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function YD(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function qD(n,e,t){const r=[],s=YD(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function Sl(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class QD extends xm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Sl(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Sl(r.textTracks).forEach(o=>{si(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!r||r.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,d)=>{u.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const u=Bn(a,o);if(u>-1)i=o[u];else{const d=Bn(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||bs(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(Yo(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(Yo(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Df(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ce.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&bs(e,r))return r;const s=Bn(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=Bn(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Sl(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Df(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!q(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=s;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(d)}}function XD(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Eo(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const vi=.025;let dc=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function ZD(n,e,t){return`${n.identifier}-${t+1}-${Eo(e)}`}class JD{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Yu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Yu(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=q(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Yu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<vi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?dc.Range:dc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return eN(this)}}function Yu(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<vi)?e.start:e.start+e.duration}function fT(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function qu(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function eN(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ks(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class tN{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(S.LEVEL_LOADED,o),i.once(S.AUDIO_TRACK_LOADED,o),i.once(S.SUBTITLE_TRACK_LOADED,o),i.on(S.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(S.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,i.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=fT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=se.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=se.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ks(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const I0=.033;class nN extends tn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),a=Object.keys(s),l=i?i.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const d=c.cue.pre,f=c.cue.post,h=u.cue.pre,m=u.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!m)return 1;if(m&&!f)return-1;if(!d&&!h&&!f&&!m){const p=c.startTime,g=u.startTime;if(p!==g)return p-g}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(r||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new JD(l,t),this.eventMap[a]=c,r===!1&&(c.appendInPlace=r)),s.push(c)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const f=u.cue.pre,h=u.cue.post,m=e[d-1]||null,p=u.appendInPlace,g=h?i:u.startOffset,v=u.duration,x=u.timelineOccupancy===dc.Range?v:0,E=u.resumptionOffset,T=(m==null?void 0:m.startTime)===g,b=g+u.cumulativeDuration;let L=p?b+v:g+E;if(f||!h&&g<=0){const I=c;c+=x,u.timelineStart=b;const C=o;o+=v,r.push({event:u,start:b,end:L,playout:{start:C,end:o},integrated:{start:I,end:c}})}else if(g<=i){if(!T){const R=g-l;if(R>I0){const _=l,O=c;c+=R;const V=o;o+=R;const M={previousEvent:e[d-1]||null,nextEvent:u,start:_,end:_+R,playout:{start:V,end:o},integrated:{start:O,end:c}};r.push(M)}else R>0&&m&&(m.cumulativeDuration+=R,r[r.length-1].end=g)}h&&(L=b),u.timelineStart=b;const I=c;c+=x;const C=o;o+=v,r.push({event:u,start:b,end:L,playout:{start:C,end:o},integrated:{start:I,end:c}})}else return;const A=u.resumeTime;h||A>i?l=i:l=A}),l<i){var a;const u=l,d=c,f=i-l;c+=f;const h=o;o+=f,r.push({previousEvent:((a=r[r.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:h,end:o},integrated:{start:d,end:c}})}this.setDurations(i,o,c)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,d=c?0:u?s:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=i:(i=0,o=d),!u&&a.snapOptions.in&&(a.resumeAnchor=ks(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<I0&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=q(a.resumeOffset)?a.resumeOffset:a.duration;i+=h})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>vi?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${l}`),!1;const c=ks(null,a.fragments,r);if(!c)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-r)<vi+u||Math.abs(c.end-r)<vi+u?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+r;a.startOffset=r,a.timelineStart=l,s||(s=a.duration===null),i||(i=!!a.error);const c=a.error?0:a.duration||0;r+=c}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ln(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class rN{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=fT(r,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(S.ERROR,h);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,p)=>{const g=f.data,v=g==null?void 0:g.ASSETS;if(!Array.isArray(v)){const x=this.assignAssetListError(e,N.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,h,p);this.hls.trigger(S.ERROR,x);return}e.assetListResponse=g,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:p})},onError:(f,h,m,p)=>{const g=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,p,m);this.hls.trigger(S.ERROR,g)},onTimeout:(f,h,m)=>{const p=this.assignAssetListError(e,N.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,m);this.hls.trigger(S.ERROR,p)}};return a.load(l,u,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:J.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function R0(n){n==null||n.play().catch(()=>{})}function Ha(n,e){return`[${n}] Advancing timeline position to ${e}`}class sN extends tn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<a.start||r>=a.end){var l;const h=this.findItemIndex(a);let m=this.schedule.findItemIndexAtTime(r);if(m===-1&&(m=h+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${h} to ${m})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&m>h){const p=this.schedule.findJumpRestrictedIndex(h+1,m);if(p>h){this.setSchedulePosition(p);return}}this.setSchedulePosition(m);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const h=a.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,h))}return}const u=c.timelineStart,d=c.duration||0;if(o&&r<u||r>=u+d){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearInterstitial(a.event,a),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,c)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const a=this.findItemIndex(s);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],c=i.durations,u=r.map(p=>p.identifier),d=!!(a.length||u.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(p=>ln(p))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,h=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(h=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,h)?this.bufferingItem=h:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),r.forEach(p=>{p.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const g=p.assetItem.timelineStart,v=p.timelineOffset-g;if(v)try{p.timelineOffset=g}catch(x){Math.abs(v)>vi&&this.warn(`${x} ("${p.assetId}" ${p.timelineOffset}->${g})`)}}}),d||s){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),m&&h!==f&&this.trimInPlace(h,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new rN(e),this.schedule=new nN(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Lt(e,"play",this.onPlay),Lt(e,"pause",this.onPause),Lt(e,"seeking",this.onSeeking),Lt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;mt(r,"seeking",this.onSeeking),mt(r,"timeupdate",this.onTimeupdate),mt(r,"play",this.onPlay),mt(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),s=(d,f,h,m,p)=>{if(d){let g=d[f].start;const v=d.event;if(v){if(f==="playout"||v.timelineOccupancy!==dc.Point){const x=r(h);(x==null?void 0:x.interstitial)===v&&(g+=x.assetItem.startOffset+x[p])}}else{const x=m==="bufferedPos"?o():e[m];g+=x-d.start}return g}return 0},i=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var m;const p=e.schedule.findItemIndexAtTime(d),g=(m=e.schedule.items)==null?void 0:m[p];if(g){const v=g[f].start-g.start;return d+v}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},l=(d,f)=>{var h,m;const p=e.effectivePlayingItem;if(p!=null&&(h=p.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const g=e.effectivePlayingItem,v=e.schedule.findItemIndexAtTime(d,f),x=(m=e.schedule.items)==null?void 0:m[v],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,b=T==null?void 0:T.appendInPlace,L=g&&e.itemsMatch(g,x);if(g&&(b||L)){const A=r(e.playingAsset),I=(A==null?void 0:A.media)||e.primaryMedia;if(I){const C=f==="primary"?I.currentTime:s(g,f,e.playingAsset,"timelinePos","currentTime"),R=d-C,_=(b?C:I.currentTime)+R;if(_>=0&&(!A||b||_<=A.duration)){I.currentTime=_;return}}}if(x){let A=d;if(f!=="primary"){const C=x[f].start,R=d-C;A=x.start+R}const I=!e.isInterstitial(x);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(I||x.event.appendInPlace)){const C=e.media||(b?E==null?void 0:E.media:null);C&&(C.currentTime=A)}else if(g){const C=e.findItemIndex(g);if(v>C){const _=e.schedule.findJumpRestrictedIndex(C+1,v);if(_>C){e.setSchedulePosition(_);return}}let R=0;if(I)e.timelinePos=A,e.checkBuffer();else{const _=x.event.assetList,O=d-(x[f]||x).start;for(let V=_.length;V--;){const M=_[V];if(M.duration&&O>=M.startOffset&&O<M.startOffset+M.duration){R=V;break}}}e.setSchedulePosition(v,R)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var h;return s(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=c(),f=e.effectivePlayingItem;return f&&f===d?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=c(),h=e.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=c())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=c())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const m=d.playout.start+d.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!q(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${we(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(r=this.detachedData)==null?void 0:r.mediaSource;let u;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),u="Primary";else if(c){const m=this.getBufferingPlayer();m?(i=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${we(i)}`);else if(!this.detachedData||o.media===t){const m=this.playerQueue;m.length>1&&m.forEach(p=>{if(a&&p.interstitial.appendInPlace!==l){const g=p.interstitial;this.clearInterstitial(p.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",f=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(f===i&&h){const m=a&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!a||m,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Ha("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=qu(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,r){const s=qu(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Ha("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),a=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&ln(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(o,i)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${Ks(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:m,event:u,schedule:s.slice(0),scheduleIndex:e,player:h}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,i),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ln(o)}`),u.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:u,schedule:s.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const m=(c=this.schedule)==null?void 0:c.items;if(i&&m){const p=this.findItemIndex(i);this.advanceSchedule(p,m,t,o,a)}return}}this.advanceSchedule(e,s,t,o,a)}advanceSchedule(e,t,r,s,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,f=o.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(r===void 0){r=o.findAssetIndex(u,this.timelinePos);const m=qu(u,r-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,r);return}r=m}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(u,r);if(this.eventItemsMatch(a,d||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ln(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const h=u.assetList[r];if(!h){this.advanceAfterAssetEnded(u,e,r||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const m=u.assetList.length;this.warn(`asset ${r+1}/${m} player destroyed ${u}`),f=this.createAssetPlayer(u,h,r),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,r,t,e,l),this.shouldPlay&&R0(f.media)}else a?(this.resumePrimary(a,e,s),this.shouldPlay&&R0(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ln(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(Ha("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ln(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:se.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Ha("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level],s=ve(ve({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=ve(ve({},this.altSelection),{},{audio:r});return}const i=ve(ve({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=ve(ve({},this.altSelection),{},{subtitles:r});return}const i=ve(ve({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=$g(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=$g(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),a=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=se.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${ln(e)} (was ${ln(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=se.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(i),d=Math.min(u+1,t.length-1),f=t[d];if((l===-1&&i&&e>=i.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(i)){const h=i.event;if(d-a>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ln(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const f=this.getAssetPlayer(u.identifier);f&&(d===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!o&&s){for(let c=t;c<s;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const a={parentIdentifier:e.identifier,identifier:ZD(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(o||a)&&(o=ye({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const b=t.duration;b&&T<b&&(u=T)}}const d=t.identifier,f=ve(ve({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=ye({},h,{contentId:Eo(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const m=new tN(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[r]=t;let p=!0;const g=T=>{if(T.live){var b;const I=new Error(`Interstitials MUST be VOD assets ${e}`),C={fatal:!0,type:J.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:I},R=((b=this.schedule)==null?void 0:b.findEventIndex(e.identifier))||-1;this.handleAssetItemError(C,e,R,r,I.message);return}const L=T.edge-T.fragmentStart,A=t.duration;(p||A===null||L>A)&&(p=!1,this.log(`Interstitial asset "${d}" duration change ${A} > ${L}`),t.duration=L,this.updateSchedule())};m.on(S.LEVEL_UPDATED,(T,{details:b})=>g(b)),m.on(S.LEVEL_PTS_UPDATED,(T,{details:b})=>g(b)),m.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const v=(T,b)=>{const L=this.getAssetPlayer(d);if(L&&b.tracks){L.off(S.BUFFER_CODECS,v),L.tracks=b.tracks;const A=this.primaryMedia;this.bufferingAsset===L.assetItem&&A&&!L.media&&this.bufferAssetPlayer(L,A)}};m.on(S.BUFFER_CODECS,v);const x=()=>{var T;const b=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${b}`),!b||!this.schedule)return;const L=this.schedule.findEventIndex(e.identifier),A=(T=this.schedule.items)==null?void 0:T[L];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};m.on(S.BUFFERED_TO_END,x);const E=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,T)};return m.once(S.MEDIA_ENDED,E(r)),m.once(S.PLAYOUT_LIMIT_REACHED,E(1/0)),m.on(S.ERROR,(T,b)=>{if(!this.schedule)return;const L=this.getAssetPlayer(d);if(b.details===N.BUFFER_STALLED_ERROR){if(L!=null&&L.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${b.error} ${e}`)}),m.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const b=new Error(`Asset player destroyed unexpectedly ${d}`),L={fatal:!0,type:J.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),r,b.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ks(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&ln(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,r[s]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Ks(a)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=i.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!JE(d,e.tracks)){const f=new Error(`Asset ${Ks(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:J.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=i.findAssetIndex(o);this.handleAssetItemError(h,i,a,m,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||s-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${s})`),l&&(c/r.playbackRate<.5||a.bufferedInPlaceToEnd(r))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===N.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Ks(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,d=ye({},e,{fatal:!1,errorAction:mi(!0),asset:o,assetListIndex:s,event:t,schedule:u,scheduleIndex:r,player:c});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,m=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=m),!t.assetList.some(p=>!p.error))t.error=m;else for(let p=s;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,r,s):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${ln(r)} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const i=this.updateItem(r,s);if(this.itemsMatch(r,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var r,s;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const l=i.timelineStart,c=i.duration;let u=0;a.forEach((p,g)=>{const v=parseFloat(p.DURATION);this.createAsset(i,g,u,l+u,v,p.URI),u+=v}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${i}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const h=(s=this.bufferingItem)==null?void 0:s.event;if(f){var m;const p=this.schedule.findEventIndex(o),g=(m=this.schedule.items)==null?void 0:m[p];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(g)}this.setSchedulePosition(p)}else if((h==null?void 0:h.identifier)===o){const p=i.assetList[0];if(p){const g=this.getAssetPlayer(p.identifier);if(h.appendInPlace){const v=this.primaryMedia;g&&v&&this.bufferAssetPlayer(g,v)}else g&&g.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case N.ASSET_LIST_PARSING_ERROR:case N.ASSET_LIST_LOAD_ERROR:case N.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case N.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const C0=500;class iN extends dm{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Z.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=U.IDLE,this.setInterval(C0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(Ue(r)&&(this.fragPrevious=r),this.state=U.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=r.start;for(let c=0;c<i.length;c++)if(a>=i[c].start&&a<=i[c].end){o=i[c];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,i,Z.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===Z.SUBTITLE&&(t.details===N.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==U.STOPPED&&(this.state=U.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&XS(this.levels,t)){this.levels=t.map(r=>new Ho(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Ho(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Z.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==U.STOPPED&&this.setInterval(C0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(r=l.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(cc(o,d),c=o.fragmentStart):f&&(c=f.start,kf(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,kf(o,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=o,this.levelLastLoaded=l,a===s&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===U.IDLE&&(ks(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&pi(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,cm(s.method)).catch(a=>{throw i.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(S.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=U.IDLE})}}doTick(){if(!this.media){this.state=U.IDLE;return}if(this.state===U.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=se.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,c=r.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,f=d.length,h=c.edge;let m=null;const p=this.fragPrevious;if(a<h){const x=s.maxFragLookUpTolerance,E=a>h-x?0:x;m=ks(p,d,Math.max(d[0].start,a),E),!m&&p&&p.start<d[0].start&&(m=d[0])}else m=d[f-1];if(m=this.filterReplacedPrimary(m,r.details),!m)return;const g=m.sn-c.startSN,v=d[g-1];if(v&&v.cc===m.cc&&this.fragmentTracker.getState(v)===We.NOT_LOADED&&(m=v),this.fragmentTracker.getState(m)===We.NOT_LOADED){const x=this.mapToInitFragWhenRequired(m);x&&this.loadFragment(x,r,a)}}}loadFragment(e,t,r){Ue(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new oN(this.tracksBuffered[this.currentTrackId]||[])}}class oN{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const aN={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},hT=n=>String.fromCharCode(aN[n]||n),un=15,Xn=100,lN={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},cN={17:2,18:4,21:6,22:8,23:10,19:13,20:15},uN={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},dN={25:2,26:4,29:6,30:8,31:10,27:13,28:15},fN=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class hN{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;me.log(`${this.time} [${e}] ${r}`)}}}const ls=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class mT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class mN{constructor(){this.uchar=" ",this.penState=new mT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class pN{constructor(e){this.chars=[],this.pos=0,this.currPenState=new mT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Xn;t++)this.chars.push(new mN);this.logger=e}equals(e){for(let t=0;t<Xn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Xn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Xn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Xn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Xn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=hT(e);if(this.pos>=Xn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Xn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Xn;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Qu{constructor(e){this.rows=[],this.currRow=un-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<un;t++)this.rows.push(new pN(e));this.logger=e}reset(){for(let e=0;e<un;e++)this.rows[e].clear();this.currRow=un-1}equals(e){let t=!0;for(let r=0;r<un;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<un;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<un;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+we(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<un;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+we(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<un;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class k0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Qu(r),this.nonDisplayedMemory=new Qu(r),this.lastOutputScreen=new Qu(r),this.currRollUpRow=this.displayedMemory.rows[un-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[un-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+we(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class _0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=vN(),this.logger=void 0;const s=this.logger=new hN;this.channels=[null,new k0(e,t,s),new k0(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+ls([t[r],t[r+1]])+"] -> ("+ls([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(gN(s,i,l)){Ka(null,null,l),this.logger.log(3,()=>"Repeated command ("+ls([s,i])+") is dropped");continue}Ka(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Ka(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ls([s,i])+" orig: "+ls([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ls([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?lN[e]:uN[e]:r=o===1?cN[e]:dN[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+hT(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+ls(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=fN[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ka(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ka(n,e,t){t.a=n,t.b=e}function gN(n,e,t){return t.a===n&&t.b===e}function vN(){return{a:null,b:null}}var bm=function(){if(lc!=null&&lc.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function r(a){return t(n,a)}function s(a){return t(e,a)}function i(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",h=!1,m=a,p=l,g=c,v=null,x="",E=!0,T="auto",b="start",L=50,A="middle",I=50,C="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return f},set:function(R){f=""+R}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return h},set:function(R){h=!!R}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return m},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");m=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return g},set:function(R){g=""+R,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return v},set:function(R){v=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return x},set:function(R){const _=r(R);if(_===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return E},set:function(R){E=!!R,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return T},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return b},set:function(R){const _=s(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");b=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return L},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");L=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return A},set:function(R){const _=s(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");A=_,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return I},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");I=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return C},set:function(R){const _=s(R);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");C=_,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class yN{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function pT(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class xN{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function gT(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const Bf=new bm(0,0,""),Wa=Bf.align==="middle"?"middle":"center";function EN(n,e,t){const r=n;function s(){const a=pT(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const c=new xN;gT(a,function(f,h){let m;switch(f){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===h){c.set(f,t[p].region);break}break;case"vertical":c.alt(f,h,["rl","lr"]);break;case"line":m=h.split(","),c.integer(f,m[0]),c.percent(f,m[0])&&c.set("snapToLines",!1),c.alt(f,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",Wa,"end"]);break;case"position":m=h.split(","),c.percent(f,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",Wa,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,h);break;case"align":c.alt(f,h,["start",Wa,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&Bf.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Wa);let d=c.get("position","auto");d==="auto"&&Bf.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function vT(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class SN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new yN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=vT(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){gT(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const a=i.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new bm(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{EN(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const TN=/\r\n|\n\r|\n|\r/g,Xu=function(e,t,r=0){return e.slice(r,r+t.length)===t},bN=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!q(t)||!q(r)||!q(s)||!q(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t};function wm(n,e,t){return Eo(n.toString())+Eo(e.toString())+Eo(t)}const wN=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function AN(n,e,t,r,s,i,o){const a=new SN,l=Ut(new Uint8Array(n)).trim().replace(TN,`
`).split(`
`),c=[],u=e?PP(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,m,p=!0;a.oncue=function(g){const v=t[r];let x=t.ccOffset;const E=(f-u)/9e4;if(v!=null&&v.new&&(h!==void 0?x=t.ccOffset=v.start:wN(t,r,E)),E){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}x=E-t.presentationOffset}const T=g.endTime-g.startTime,b=zt((g.startTime+x-h)*9e4,s*9e4)/9e4;g.startTime=Math.max(b,0),g.endTime=Math.max(b+T,0);const L=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(L)),g.id||(g.id=wm(g.startTime,g.endTime,L)),g.endTime>0&&c.push(g)},a.onparsingerror=function(g){m=g},a.onflush=function(){if(m){o(m);return}i(c)},l.forEach(g=>{if(p)if(Xu(g,"X-TIMESTAMP-MAP=")){p=!1,g.slice(16).split(",").forEach(v=>{Xu(v,"LOCAL:")?d=v.slice(6):Xu(v,"MPEGTS:")&&(f=parseInt(v.slice(7)))});try{h=bN(d)/1e3}catch(v){m=v}return}else g===""&&(p=!1);a.parse(g+`
`)}),a.flush()}const Zu="stpp.ttml.im1t",yT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,xT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,LN={left:"start",center:"center",right:"end",start:"start",end:"end"};function P0(n,e,t,r){const s=le(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>Ut(a)),o=_P(e.baseTime,1,e.timescale);try{i.forEach(a=>t(IN(a,o)))}catch(a){r(a)}}function IN(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),a=s.getAttribute("xml:space")!=="preserve",l=D0(Ju(s,"styling","style")),c=D0(Ju(s,"layout","region")),u=Ju(s,"body","[begin]");return[].map.call(u,d=>{const f=ET(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=td(d.getAttribute("begin"),o),m=td(d.getAttribute("dur"),o);let p=td(d.getAttribute("end"),o);if(h===null)throw N0(d);if(p===null){if(m===null)throw N0(d);p=h+m}const g=new bm(h-e,p-e,f);g.id=wm(g.startTime,g.endTime,g.text);const v=c[d.getAttribute("region")],x=l[d.getAttribute("style")],E=RN(v,x,l),{textAlign:T}=E;if(T){const b=LN[T];b&&(g.lineAlign=b),g.align=T}return ye(g,E),g}).filter(d=>d!==null)}function Ju(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function D0(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function ET(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?ET(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function RN(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const c=ed(e,r,l)||ed(n,r,l)||ed(s,r,l);return c&&(a[l]=c),a},{})}function ed(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function N0(n){return new Error(`Could not parse ttml timestamp ${n}`)}function td(n,e){if(!n)return null;let t=pT(n);return t===null&&(yT.test(n)?t=CN(n,e):xT.test(n)&&(t=kN(n,e))),t}function CN(n,e){const t=yT.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function kN(n,e){const t=xT.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class za{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class _N{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=M0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new za(this,"textTrack1"),t=new za(this,"textTrack2"),r=new za(this,"textTrack3"),s=new za(this,"textTrack4");this.cea608Parser1=new _0(1,e,t),this.cea608Parser2=new _0(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],c=PN(l[0],l[1],t,r);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,c/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,s)}else{const a=this.Cues.newCue(null,t,r,s);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;r===Z.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,l):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(O0(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)r[e]=a,si(r[e]),uT(r[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{si(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=M0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)si(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Zu);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(XS(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?Sl(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&O0(a[f],l)){d=a[f],a[f]=null;break}d&&(u=d)}if(u)si(u);else{const d=ST(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Z.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===Z.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Zu?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;P0(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[r.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=r.initSegment)!=null&&t.data?en(r.initSegment.data,new Uint8Array(s)).buffer:s;AN(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,u=>{this._appendCues(u,r.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,s),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&a>r.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:u})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||P0(t,this.initPTS[e.cc],()=>{r.textCodec=Zu,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>dT(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Z.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===Z.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,a[0]),this.cea608Parser2.addData(s[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Ff(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Ff(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function ST(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function O0(n,e){return!!n&&n.kind===ST(e)&&Df(e,n)}function PN(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function M0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const DN=/\s/,NN={newCue(n,e,t,r){const s=[];let i,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],a=!0,l=0,c="",!i.isEmpty()){var d;for(let p=0;p<i.chars.length;p++)DN.test(i.chars[p].uchar)&&a?l++:(c+=i.chars[p].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=vT(c.trim()),m=wm(e,t,h);n!=null&&(d=n.cues)!=null&&d.getCueById(m)||(o=new u(e,t,h),o.id=m,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),s.forEach(f=>dT(n,f))),s}};function ON(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const MN=/(\d+)-(\d+)\/(\d+)/;class F0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||UN,this.controller=new self.AbortController,this.stats=new nm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=FN(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&q(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(zo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(h-s.loading.start)),!d.ok){const{status:p,statusText:g}=d;throw new jN(g||"fetch, bad network response",p,d)}s.loading.first=h,s.total=$N(d.headers)||s.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&q(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,m):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=d[a];p&&(s.loaded=s.total=p);const g={url:m.url,data:d,code:m.status},v=(f=this.callbacks)==null?void 0:f.onProgress;v&&!q(t.highWaterMark)&&v(s,e,d,m),(h=this.callbacks)==null||h.onSuccess(g,s,e,m)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=d&&d.code||0,m=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:m},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new _S,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<s||o.dataLength?(o.push(u),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function FN(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ye({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function BN(n){const e=MN.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function $N(n){const e=n.get("Content-Range");if(e){const r=BN(e);if(q(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function UN(n,e){return new self.Request(n.url,e)}class jN extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const GN=/^age:\s*[\d.]+\s*$/im;class TT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new nm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&q(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const m=u??t.response;if(m!=null){var o,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const p=t.responseType==="arraybuffer"?m.byteLength:m.length;r.loaded=r.total=p,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const g=(o=this.callbacks)==null?void 0:o.onProgress;g&&g(r,e,m,t);const v={url:t.responseURL,data:m,code:c};(a=this.callbacks)==null||a.onSuccess(v,r,e,t);return}}const d=i.loadPolicy.errorRetry,f=r.retry,h={url:e.url,data:void 0,code:c};if(ac(d,f,!1,h))this.retry(d);else{var l;me.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(ac(e,t,!0))this.retry(e);else{var r;me.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=om(e,r.retry),r.retry++,me.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&GN.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const VN={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},HN=ve(ve({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:TT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:t_,bufferController:zP,capLevelController:Em,errorController:o_,fpsController:zD,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:SS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:VN},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},KN()),{},{subtitleStreamController:iN,subtitleTrackController:QD,timelineController:_N,audioStreamController:VP,audioTrackController:HP,emeController:gi,cmcdController:HD,contentSteeringController:WD,interstitialsController:sN});function KN(){return{cueHandler:NN,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function WN(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=$f(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];i.forEach(u=>{const d=`${o}Loading${u}`,f=e[d];if(f!==void 0&&l){c.push(d);const h=r[a].default;switch(e[a]={default:h},u){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${we(e[a])}`)}),ve(ve({},r),e)}function $f(n){return n&&typeof n=="object"?Array.isArray(n)?n.map($f):Object.keys(n).reduce((e,t)=>(e[t]=$f(n[t]),e),{}):n}function zN(n,e){const t=n.loader;t!==F0&&t!==TT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):ON()&&(n.loader=F0,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Tl=2,YN=.1,qN=.05,QN=100;class XN extends vS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(QN),this.mediaSource=t.mediaSource;const r=this.media=t.media;mt(r,"playing",this.onMediaPlaying),mt(r,"waiting",this.onMediaWaiting),mt(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Lt(r,"playing",this.onMediaPlaying),Lt(r,"waiting",this.onMediaWaiting),Lt(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!se.getBuffered(o).length){this.nudgeRetry=0;return}const d=se.bufferInfo(o,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const L=B0(this.hls.inFlightFragments,e),A=d.len>Tl,I=!f||L||f-e>Tl&&!h.getPartialFragment(e);if(A||I)return;this.moved=!1}const m=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const A=Math.max(f,d.start||0)-e,C=!!(m!=null&&m.live)?m.targetduration*2:Tl,R=Ya(e,h);if(A>0&&(A<=C||R)){o.paused||this._trySkipBufferHole(R);return}}const p=i.detectStallWithCurrentTimeMs,g=self.performance.now(),v=this.waiting;let x=this.stalled;if(x===null)if(v>0&&g-v<p)x=this.stalled=v;else{this.stalled=g;return}const E=g-x;if(!a&&(E>=p||v)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const b=se.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(b,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=se.bufferedInfo(se.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=se.timeRangesToArray(s),a=se.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=se.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Ya(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=se.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:o,media:a}=this,l=(s=this.hls)==null?void 0:s.config;if(!a||!o||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,u=Ya(r,o);if((u||c!=null&&c.live&&r<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,Z.MAIN),o=r.getFragAtPos(s,Z.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${we(e)})`);this.warn(o.message),t.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,a=se.bufferInfo(s,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=i.maxBufferHole,d=a.len>0&&a.len<1&&s.readyState<3,f=l-o;if(f>0&&(u||d)){if(f>i.maxBufferHole){let m=!1;if(o===0){const p=r.getAppendedFrag(0,Z.MAIN);p&&l<p.end&&(m=!0)}if(!m&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||B0(this.hls.inFlightFragments,l))return 0;let g=!1,v=e.end;for(;v<l;){const x=Ya(v,r);if(x)v+=x.duration;else{g=!0;break}}if(g)return 0}}const h=Math.max(l+qN,o+YN);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,s.currentTime=h,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`),p={type:J.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?p.part=e:p.frag=e),this.hls.trigger(S.ERROR,p)}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const a=o+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),r.currentTime=a,t.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function B0(n,e){const t=$0(n.main);if(t&&t.start<=e)return t;const r=$0(n.audio);return r&&r.start<=e?r:null}function $0(n){if(!n)return null;switch(n.state){case U.IDLE:case U.STOPPED:case U.ENDED:case U.ERROR:return null}return n.frag}function Ya(n,e){return e.getAppendedFrag(n,Z.MAIN)||e.getPartialFragment(n)}const ZN=.25;function Uf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function nd(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,we(s?ve({type:s},r):r))}return i}const qa=(()=>{const n=Uf();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class JN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&si(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return uT(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Uf();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Mt.emsg&&!r||!s)continue;const c=BS(i[a].data),u=i[a].pts;let d=u+i[a].duration;d>qa&&(d=qa),d-u<=0&&(d=u+ZN);for(let h=0;h<c.length;h++){const m=c[h];if(!$S(m)){this.updateId3CueEnds(u,l);const p=nd(o,u,d,m,l);p&&this.id3Track.addCue(p)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===qa&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let c;s==="audio"?c=u=>u.type===Mt.audioId3&&l:s==="video"?c=u=>u.type===Mt.emsg&&a:c=u=>u.type===Mt.audioId3&&l||u.type===Mt.emsg&&a,Ff(i,t,r,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=Uf();if(r&&s&&!o){const{fragmentStart:p,fragmentEnd:g}=e;let v=this.assetCue;v?(v.startTime=p,v.endTime=g):a&&(v=this.assetCue=nd(a,p,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),v&&(v.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(v),v.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const p=Object.keys(d).filter(g=>!u.includes(g));for(let g=p.length;g--;){var h;const v=p[g],x=(h=d[v])==null?void 0:h.cues;delete d[v],x&&Object.keys(x).forEach(E=>{const T=x[E];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!q(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let p=0;p<u.length;p++){const g=u[p],v=c[g],x=v.startTime,E=d[g],T=(E==null?void 0:E.cues)||{};let b=(E==null?void 0:E.durationKnown)||!1,L=qa;const{duration:A,endDate:I}=v;if(I&&A!==null)L=x+A,b=!0;else if(v.endOnNext&&!b){const R=u.reduce((_,O)=>{if(O!==v.id){const V=c[O];if(V.class===v.class&&V.startDate>v.startDate&&(!_||v.startDate<_.startDate))return V}return _},null);R&&(L=R.startTime,b=!0)}const C=Object.keys(v.attr);for(let R=0;R<C.length;R++){const _=C[R];if(!x_(_))continue;const O=T[_];if(O)b&&!(E!=null&&E.durationKnown)?O.endTime=L:Math.abs(O.startTime-x)>.01&&(O.startTime=x,O.endTime=L);else if(a){let V=v.attr[_];E_(_)&&(V=eS(V));const K=nd(a,x,L,{key:_,data:V},Mt.dateRange);K&&(K.id=g,this.id3Track.addCue(K),T[_]=K,o&&(_==="X-ASSET-LIST"||_==="X-ASSET-URL")&&K.addEventListener("enter",this.onEventCueEnter))}}d[g]={cues:T,dateRange:v,durationKnown:b}}}}}class e2{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const a=this.targetLatency;if(a===null)return;const l=s-a,c=Math.min(this.maxLatency,a+r.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*s);const u=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class t2 extends xm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:f,videoCodec:h}=u;f&&(u.audioCodec=f=rc(f,r)||void 0),h&&(h=u.videoCodec=Mk(h));const{width:m,height:p,unknownCodecs:g}=u;let v=g?g.length:0;if(g)for(let R=v;R--;){const _=g[R];this.isAudioSupported(_)?(u.audioCodec=f=f?`${f},${_}`:_,v--,Mi.audio[f.substring(0,4)]=2):this.isVideoSupported(_)&&(u.videoCodec=h=h?`${h},${_}`:_,v--,Mi.video[h.substring(0,4)]=2)}if(a||(a=!!(m&&p)),l||(l=!!h),c||(c=!!f),v||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:x,"FRAME-RATE":E,"HDCP-LEVEL":T,"PATHWAY-ID":b,RESOLUTION:L,"VIDEO-RANGE":A}=d,C=`${`${b||"."}-`}${u.bitrate}-${L}-${E}-${x}-${A}-${T}`;if(i[C])if(i[C].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const R=o[C]+=1;u.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const _=this.createLevel(u);i[C]=_,s.push(_)}else i[C].addGroupId("audio",d.AUDIO),i[C].addGroupId("text",d.SUBTITLES);else{const R=this.createLevel(u);i[C]=R,o[C]=1,s.push(R)}}),this.filterAndSortMediaOptions(s,t,a,l,c)}createLevel(e){const t=new Ho(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=dS(s,[])}return t}isAudioSupported(e){return bf(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return bf(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){let o=[],a=[],l=e;if((r||s)&&i&&(l=l.filter(({videoCodec:g,videoRange:v,width:x,height:E})=>(!!g||!!(x&&E))&&Wk(v))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let g="no level with compatible codecs found in manifest",v=g;t.levels.length&&(v=`one or more CODECS in variant not supported: ${we(t.levels.map(E=>E.attrs.CODECS).filter((E,T,b)=>b.indexOf(E)===T))}`,this.warn(v),g+=` (${v})`);const x=new Error(g);this.hls.trigger(S.ERROR,{type:J.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:x,reason:v})}});return}t.audioTracks&&(o=t.audioTracks.filter(g=>!g.audioCodec||this.isAudioSupported(g.audioCodec)),U0(o)),t.subtitles&&(a=t.subtitles,U0(a));const c=l.slice(0);l.sort((g,v)=>{if(g.attrs["HDCP-LEVEL"]!==v.attrs["HDCP-LEVEL"])return(g.attrs["HDCP-LEVEL"]||"")>(v.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&g.height!==v.height)return g.height-v.height;if(g.frameRate!==v.frameRate)return g.frameRate-v.frameRate;if(g.videoRange!==v.videoRange)return sc.indexOf(g.videoRange)-sc.indexOf(v.videoRange);if(g.videoCodec!==v.videoCodec){const x=Dg(g.videoCodec),E=Dg(v.videoCodec);if(x!==E)return E-x}if(g.uri===v.uri&&g.codecSet!==v.codecSet){const x=nc(g.codecSet),E=nc(v.codecSet);if(x!==E)return E-x}return g.averageBitrate!==v.averageBitrate?g.averageBitrate-v.averageBitrate:0});let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let g=0;g<c.length;g++)if(c[g].pathwayId===l[0].pathwayId){u=c[g];break}}this._levels=l;for(let g=0;g<l.length;g++)if(l[g]===u){var d;this._firstLevel=g;const v=u.bitrate,x=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${v}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const E=Math.min(v,this.hls.config.abrEwmaDefaultEstimateMax);E>x&&x===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const f=i&&!s,h=this.hls.config,m=!!(h.audioStreamController&&h.audioTrackController),p={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:m&&!f&&o.some(g=>!!g.url)};this.hls.trigger(S.MANIFEST_PARSED,p)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,s==null?void 0:s.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===ce.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Z.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(S.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));RS(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(S.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function U0(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function bT(){return self.SourceBuffer||self.WebKitSourceBuffer}function wT(){if(!Jr())return!1;const e=bT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function n2(){if(!wT())return!1;const n=Jr();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Vo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Vo(e,"audio"))))}function r2(){var n;const e=bT();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const s2=100;class i2 extends dm{constructor(e,t,r){super(e,t,r,"stream-controller",Z.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!q(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,Z.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(s2),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=U.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=U.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case U.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=U.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=U.IDLE;break}break}case U.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===U.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(S.BUFFER_EOS,p),this.state=U.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===U.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=U.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&h&&Ue(h)&&this.fragmentTracker.getState(h)!==We.OK){var m;const g=((m=this.backtrackFragment)!=null?m:h).sn-c.startSN,v=c.fragments[g-1];v&&h.cc===v.cc&&(h=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const g=this.audioOnly&&!this.altAudio?xe.AUDIO:xe.VIDEO,v=(g===xe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,g,Z.MAIN)}h=this.getNextFragmentLoopLoading(h,c,a,Z.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===We.NOT_LOADED||s===We.PARTIAL?Ue(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Z.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case U.KEY_LOADING:case U.FRAG_LOADING:case U.FRAG_LOADING_WAITING_RETRY:case U.PARSING:case U.PARSED:this.state=U.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;mt(r,"playing",this.onMediaPlaying),mt(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Lt(r,"playing",this.onMediaPlaying),Lt(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!r2(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==U.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=U.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===U.FRAG_LOADING||this.state===U.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(a.live||(r=c.details)!=null&&r.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,i||this.setStartPosition(a,d),this.hls.trigger(S.LEVEL_UPDATED,{details:a,level:o}),this.state===U.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=U.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&r.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||i<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=se.bufferInfo(r,s,0);if(!((c=d.buffered)!=null&&c.length)){r.currentTime=s;return}if(d.start<=i){r.currentTime=s;return}const{nextStart:h}=se.bufferedInfo(d.buffered,i,0);h&&(r.currentTime=h)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level];if(!a){this.warn(`Level ${r.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new QS(this.hls,Z.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,p=m!==-1,g=new lm(r.level,r.sn,r.stats.chunkCount,i.byteLength,m,p),v=this.initPTS[r.cc];h.push(i,d,f,c,r,s,l.totalduration,u,g,v)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio===2;if(ic(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),r.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),r.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=ic(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const c=r[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===Z.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===U.PARSED&&(this.state=U.IDLE);return}const a=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Ue(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&se.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=U.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z.MAIN,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===U.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ce.LEVEL&&(this.state=U.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=U.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==xe.AUDIO||!this.altAudio){const r=(t===xe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,Z.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=se.getBuffered(e),a=o.length?o.start(0):0,l=a-r,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=U.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(S.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===U.STOPPED||this.state===U.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:c}=o,{video:u,text:d,id3:f,initSegment:h}=s,{details:m}=c,p=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=U.PARSING,h){const g=h.tracks;if(g){const T=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(c,g,T,i),r.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:g})}const v=h.initPTS,x=h.timescale,E=this.initPTS[a.cc];if(q(v)&&(!E||E.baseTime!==v||E.timescale!==x)){const T=h.trackId;this.initPTS[a.cc]={baseTime:v,timescale:x,trackId:T},r.trigger(S.INIT_PTS_FOUND,{frag:a,id:t,initPTS:v,timescale:x,trackId:T})}}if(u&&m){p&&u.type==="audiovideo"&&this.logMuxedErr(a);const g=m.fragments[a.sn-1-m.startSN],v=a.sn===m.startSN,x=!g||a.cc>g.cc;if(s.independent!==!1){const{startPTS:E,endPTS:T,startDTS:b,endDTS:L}=u;if(l)l.elementaryStreams[u.type]={startPTS:E,endPTS:T,startDTS:b,endDTS:L};else if(u.firstKeyFrame&&u.independent&&i.id===1&&!x&&(this.couldBacktrack=!0),u.dropped&&u.independent){const A=this.getMainFwdBufferInfo(),I=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,C=u.firstKeyFramePTS?u.firstKeyFramePTS:E;if(!v&&I<C-this.config.maxBufferHole&&!x){this.backtrack(a);return}else x&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,T,a.start,L,!0)}else v&&E-(m.appliedTimelineOffset||0)>Tl&&(a.gap=!0);a.setElementaryStreamInfo(u.type,E,T,b,L),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,i,v||x)}else if(v||x)a.gap=!0;else{this.backtrack(a);return}}if(p){const{startPTS:g,endPTS:v,startDTS:x,endDTS:E}=p;l&&(l.elementaryStreams[xe.AUDIO]={startPTS:g,endPTS:v,startDTS:x,endDTS:E}),a.setElementaryStreamInfo(xe.AUDIO,g,v,x,E),this.bufferFragmentData(p,a,l,i)}if(m&&f!=null&&f.samples.length){const g={id:t,frag:a,details:m,samples:f.samples};r.trigger(S.FRAG_PARSING_METADATA,g)}if(m&&d){const g={id:t,frag:a,details:m,samples:d.samples};r.trigger(S.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${Ue(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==U.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:a}=t;if(i){const c=e.audioCodec;let u=pl(i.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=i.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),i.levelCodec=u,i.id=Z.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Z.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:c,data:d,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Z.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=U.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(se.isBuffered(e,r)?t=this.getAppendedFrag(r):se.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return q(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(q(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?ks(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class o2 extends tn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=N.KEY_LOAD_ERROR,r,s,i){return new er({type:J.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Ue(e)||!Ue(o)||e.sn<o.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=vl(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=oo(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,u))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=rd(i);let l=this.keyIdToKeyInfo[a];if((r=l)!=null&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if((s=l)!=null&&s.keyLoadPromise){var c;switch((c=l.mediaKeySessionContext)==null?void 0:c.keyStatus){case"usable":case"usable-in-future":return l.keyLoadPromise.then(d=>{const{keyInfo:f}=d;return i.key=f.decryptdata.key,{frag:e,keyInfo:f}})}}switch(this.log(`Loading key ${Nt(i.keyId||[])} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);return(e.keyLoadPromise=s.then(i=>(e.mediaKeySessionContext=i,r))).catch(i=>{throw e.keyLoadPromise=null,i.data&&(i.data.frag=t),i})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,p)=>{const{frag:g,keyInfo:v,url:x}=m,E=rd(v.decryptdata)||x;if(!g.decryptdata||v!==this.keyIdToKeyInfo[E])return a(this.createKeyLoadError(g,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));v.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,v.loader=null,o({frag:g,keyInfo:v})},onError:(f,h,m,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,ve({url:l.url,data:void 0},f)))},onTimeout:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};i.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=rd(r.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function rd(n){const e=n.keyId;return e?Nt(e):n.uri}function j0(n){const{type:e}=n;switch(e){case ce.AUDIO_TRACK:return Z.AUDIO;case ce.SUBTITLE_TRACK:return Z.SUBTITLE;default:return Z.MAIN}}function sd(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class a2{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ce.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:ce.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ce.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ce.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[ce.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[ce.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===ce.MANIFEST?i=r.manifestLoadPolicy.default:i=ye({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),q((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ce.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ce.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ce.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=Math.max(u*3,d*.8)*1e3;i=ye({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=c.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),f||null,u);return}u.parsing.start=performance.now(),$n.isMediaPlaylist(m)||d.type!==ce.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,f||null,h):this.handleMasterPlaylist(c,u,d,f)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};s.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,a=sd(e,r),l=$n.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m}=l;this.variableList=m;const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=$n.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(E=>!E.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ce({}),bitrate:0,url:""})),i.trigger(S.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:g,captions:v,contentSteering:c,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:a,level:l,type:c}=r,u=sd(e,r),d=q(l)?l:q(a)?a:0,f=j0(r),h=$n.parseLevelPlaylist(e.data,u,d,f,0,this.variableList);if(c===ce.MANIFEST){const m={attrs:new Ce({}),bitrate:0,details:h,name:"",url:u};h.requestScheduled=t.loading.start+AS(h,0),o.trigger(S.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(S.ERROR,{type:J.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===ce.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ce.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ce.AUDIO_TRACK||e.type===ce.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=N.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case ce.MANIFEST:l=r?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,c=!0;break;case ce.LEVEL:l=r?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,c=!1;break;case ce.AUDIO_TRACK:l=r?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ce.SUBTITLE_TRACK:l=r?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:J.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:i};if(s){const f=(t==null?void 0:t.url)||e.url;d.response=ve({url:f,data:void 0},s)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,o){const a=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:f}=s,h=sd(t,s),m=j0(s),p=typeof s.level=="number"&&m===Z.MAIN?c:void 0;if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(S.ERROR,{type:J.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:s,level:p,parent:m,networkDetails:i,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){if(this.hls.logger.warn(`${g} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(S.ERROR,{type:J.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:g,reason:g.message,response:t,context:s,level:p,parent:m,networkDetails:i,stats:r});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ce.MANIFEST:case ce.LEVEL:a.trigger(S.LEVEL_LOADED,{details:e,levelInfo:s.levelOrTrack||a.levels[0],level:p||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:l===ce.MANIFEST});break;case ce.AUDIO_TRACK:a.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:u||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case ce.SUBTITLE_TRACK:a.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:u||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break}}}class vn{static get version(){return Ko}static isMSESupported(){return wT()}static isSupported(){return n2()}static getMediaSource(){return Jr()}static get Events(){return S}static get MetadataSchema(){return Mt}static get ErrorTypes(){return J}static get ErrorDetails(){return N}static get DefaultConfig(){return vn.defaultConfig?vn.defaultConfig:HN}static set DefaultConfig(e){vn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new fm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=pk(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=WN(vn.DefaultConfig,e,t);this.userConfig=e,r.progressive&&zN(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=r,c=new a(this),u=this.abrController=new s(this),d=new a_(this),f=r.interstitialsController,h=f?this.interstitialsController=new f(this,vn):null,m=this.bufferController=new i(this,d),p=this.capLevelController=new o(this),g=new l(this),v=new a2(this),x=r.contentSteeringController,E=x?new x(this):null,T=this.levelController=new t2(this,E),b=new JN(this),L=new o2(this.config,this.logger),A=this.streamController=new i2(this,d,L),I=this.gapController=new XN(this,d);p.setStreamController(A),g.setStreamController(A);const C=[v,T,A];h&&C.splice(1,0,h),E&&C.splice(1,0,E),this.networkControllers=C;const R=[u,m,I,p,g,b,d];this.audioTrackController=this.createController(r.audioTrackController,C);const _=r.audioStreamController;_&&C.push(this.audioStreamController=new _(this,d,L)),this.subtitleTrackController=this.createController(r.subtitleTrackController,C);const O=r.subtitleStreamController;O&&C.push(this.subtititleStreamController=new O(this,d,L)),this.createController(r.timelineController,R),L.emeController=this.emeController=this.createController(r.emeController,R),this.cmcdController=this.createController(r.cmcdController,R),this.latencyController=this.createController(e2,R),this.coreComponents=R,C.push(c);const V=c.onErrorOut;typeof V=="function"&&this.on(S.ERROR,V,c),this.on(S.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===S.ERROR;this.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:J.OTHER_ERROR,details:N.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(S.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=tm.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Z.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Z.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Z.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=XD()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Kk(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=mS(t);return fS(e,r,navigator.mediaCapabilities)}}vn.defaultConfig=void 0;const Am=w.forwardRef(({videoUrl:n,autoPlay:e=!1,showControls:t=!0,showUnmuteButton:r=!0,onVideoReady:s,onError:i,className:o="w-full h-full object-cover",containerClassName:a="relative w-full h-full",unmuteButtonPosition:l="center",componentName:c="HLSVideoPlayer"},u)=>{const d=w.useRef(null),f=w.useRef(null),[h,m]=w.useState(!0),[p,g]=w.useState(!1),[v,x]=w.useState(!1);w.useImperativeHandle(u,()=>({play:async()=>d.current?d.current.play():Promise.reject("Video not available"),pause:()=>{d.current&&d.current.pause()},reset:()=>{d.current&&(d.current.currentTime=0,d.current.muted=!0,m(!0),g(!1))},setMuted:b=>{d.current&&(d.current.muted=b,m(b))},getCurrentTime:()=>{var b;return((b=d.current)==null?void 0:b.currentTime)||0},setCurrentTime:b=>{d.current&&(d.current.currentTime=b)},isPlaying:()=>d.current?!d.current.paused:!1,isMuted:()=>d.current?d.current.muted:!0})),w.useEffect(()=>{if(d.current&&n){const b=d.current;if(console.log(`${c}: Starting video initialization`),console.log(`${c}: Video element available:`,!!b),console.log(`${c}: Video URL:`,n),b.currentTime=0,b.muted=!0,m(!0),g(!1),x(!1),f.current&&(console.log(`${c}: Cleaning up existing HLS instance`),f.current.destroy(),f.current=null),vn.isSupported()){console.log(`${c}: Using HLS.js for video playback`);const L=new vn({startLevel:-1,capLevelToPlayerSize:!0,maxBufferLength:30,maxMaxBufferLength:60});f.current=L,L.on(vn.Events.ERROR,(A,I)=>{I.fatal&&(console.error(`${c}: Fatal HLS Error:`,A,I),i==null||i(I))}),L.on(vn.Events.MANIFEST_PARSED,()=>{console.log(`${c}: Manifest parsed, video ready`),x(!0),s==null||s(),e&&b.play().catch(A=>{console.error(`${c}: Error auto-playing video:`,A)})}),L.loadSource(n),L.attachMedia(b)}else if(b.canPlayType("application/vnd.apple.mpegurl")){console.log(`${c}: Using native HLS support`),b.src=n;const L=()=>{console.log(`${c}: Video data loaded, ready for playback`),x(!0),s==null||s(),e&&b.play().catch(A=>{console.error(`${c}: Error auto-playing video:`,A)})};return b.addEventListener("loadeddata",L),()=>{b.removeEventListener("loadeddata",L)}}else console.error(`${c}: HLS not supported`),i==null||i({message:"HLS not supported in this browser"})}return()=>{f.current&&(console.log(`${c}: Cleaning up HLS`),f.current.destroy(),f.current=null)}},[n,e,c,s,i]);const E=()=>{if(d.current){const b=h,L=d.current.muted;m(L),b&&!L&&!p&&(g(!0),d.current.currentTime=0)}},T=()=>{d.current&&(d.current.muted=!1,m(!1),p||(g(!0),d.current.currentTime=0))};return y.jsxs("div",{className:a,children:[y.jsx("video",{ref:d,className:o,controls:t&&!h,muted:!0,loop:!0,playsInline:!0,onVolumeChange:E,children:"Your browser does not support HLS video streaming."}),r&&h&&v&&y.jsx("div",{className:`absolute cursor-pointer z-20 ${l==="center"?"top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2":"bottom-6 left-6 right-6"}`,onClick:T,children:y.jsxs("div",{className:"flex flex-col items-center",children:[y.jsx(zA,{size:l==="center"?48:32,className:"text-white drop-shadow-2xl mb-2 animate-pulse"}),y.jsxs("div",{className:"relative",children:[y.jsxs("div",{className:"relative bg-black/80 backdrop-blur-sm px-6 py-3 rounded-full border-2 border-white",style:{boxShadow:"0 0 0 1.5px rgba(0, 0, 0, 0.08)"},children:[y.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{animation:"pulse-shadow 1.5s infinite ease-out",animationName:"pulse-shadow",animationDuration:"1.5s",animationIterationCount:"infinite",animationTimingFunction:"ease-out"}}),y.jsx("span",{className:"relative text-white font-bold text-lg z-10",children:"🔊 Turn On Sound"})]}),y.jsx("style",{dangerouslySetInnerHTML:{__html:`
                  @keyframes pulse-shadow {
                    0% {
                      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
                    }
                    70% {
                      box-shadow: 0 0 0 20px rgba(255, 255, 255, 0);
                    }
                    100% {
                      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
                    }
                  }
                `}})]})]})})]})});Am.displayName="HLSVideoPlayer";const l2=({isOpen:n,onClose:e})=>(w.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),n?y.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:y.jsxs("div",{className:"relative bg-background rounded-2xl shadow-2xl w-full max-w-4xl h-[90vh] overflow-hidden",children:[y.jsx("button",{onClick:e,className:"absolute top-4 right-4 z-10 p-2 bg-background/90 hover:bg-muted rounded-full transition-colors shadow-lg",children:y.jsx(ia,{className:"w-6 h-6"})}),y.jsxs("div",{className:"p-6 border-b bg-gradient-primary text-white",children:[y.jsx("h2",{className:"text-2xl font-bold",children:"Book Your Consultation"}),y.jsx("p",{className:"text-white/90 mt-2",children:"Let's discuss your construction project"})]}),y.jsx("div",{className:"w-full h-[calc(100%-120px)]",children:y.jsx("iframe",{src:"https://multiculturemortgage.com/consultation",className:"w-full h-full border-none",title:"Book Your Consultation",allow:"fullscreen"})})]})}):null),c2=({isOpen:n,onClose:e})=>{const[t,r]=w.useState(!1),s=w.useRef(null);if(console.log("ExitIntentModal render - isOpen:",n,"showModal:",t),w.useEffect(()=>(n?(r(!0),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),w.useEffect(()=>{var o;n&&t&&(console.log("ExitIntentModal: Modal opened, resetting video player"),(o=s.current)==null||o.reset())},[n,t]),!t)return null;const i=()=>{r(!1),setTimeout(e,300)};return y.jsx("div",{className:`fixed inset-0 bg-black/90 backdrop-blur-md z-50 flex items-center justify-center p-4 transition-opacity duration-300 ${n?"opacity-100":"opacity-0"}`,children:y.jsxs("div",{className:`relative bg-gradient-primary rounded-3xl shadow-2xl w-full max-w-6xl transform transition-all duration-300 ${n?"scale-100":"scale-95"}`,children:[y.jsx("button",{onClick:i,className:"absolute top-6 right-6 z-10 p-3 bg-white/20 hover:bg-white/30 rounded-full transition-colors shadow-lg backdrop-blur-sm",children:y.jsx(ia,{className:"w-8 h-8 text-white"})}),y.jsxs("div",{className:"p-8 lg:p-12",children:[y.jsxs("div",{className:"text-center mb-8",children:[y.jsxs("h1",{className:"text-4xl lg:text-7xl font-black text-white leading-tight mb-4",children:["WAIT!",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"WATCH THIS"}),y.jsx("span",{className:"block bg-gradient-to-r from-white to-highlight bg-clip-text text-transparent",children:"BEFORE YOU LEAVE"})]}),y.jsx("p",{className:"text-xl lg:text-2xl text-white/90 font-semibold",children:"See how we transform empty lots into profitable developments in just 90 seconds"})]}),y.jsx("div",{className:"relative bg-black rounded-2xl overflow-hidden shadow-2xl aspect-video max-w-4xl mx-auto",children:y.jsx(Am,{ref:s,videoUrl:"https://vz-447b6532-fd2.b-cdn.net/114d20b4-b152-48e8-b8d1-0a0e12470326/playlist.m3u8",autoPlay:n&&t,showControls:!0,showUnmuteButton:!0,unmuteButtonPosition:"center",componentName:"ExitIntentModal",className:"w-full h-full object-cover",containerClassName:"w-full h-full"})}),y.jsxs("div",{className:"text-center mt-8",children:[y.jsx("button",{onClick:()=>{i();const o=new CustomEvent("openConsultation");window.dispatchEvent(o)},className:"bg-white text-primary hover:bg-accent hover:text-white px-12 py-6 rounded-2xl text-2xl font-bold shadow-2xl transform hover:scale-105 transition-all duration-300",children:"📞 Book Your Free Consultation Now"}),y.jsx("p",{className:"text-white/80 mt-4 text-lg",children:"Limited spots available this month"})]})]})]})})},u2=()=>{const[n,e]=w.useState(!1),[t,r]=w.useState(!1);return w.useEffect(()=>{let o;const a=c=>{console.log("Mouse leave detected:",c.clientY),c.clientY<=0&&!t&&(console.log("Exit intent triggered! Starting timeout..."),o=setTimeout(()=>{console.log("Exit intent modal opening!"),e(!0),r(!0)},100))},l=()=>{o&&(console.log("Mouse re-entered, canceling exit intent"),clearTimeout(o))};return console.log("Exit intent listeners attached"),document.addEventListener("mouseleave",a),document.addEventListener("mouseenter",l),()=>{console.log("Exit intent listeners removed"),document.removeEventListener("mouseleave",a),document.removeEventListener("mouseenter",l),o&&clearTimeout(o)}},[t]),{showExitIntent:n,closeExitIntent:()=>{e(!1)},resetExitIntent:()=>{r(!1),e(!1)},hasShownExitIntent:t}},d2=()=>{const[n,e]=w.useState(!0),[t,r]=w.useState(!1),s=w.useRef(null),{showExitIntent:i,closeExitIntent:o}=u2();w.useEffect(()=>{const c=()=>{r(!0)};return window.addEventListener("openConsultation",c),()=>window.removeEventListener("openConsultation",c)},[]);const a=()=>{e(!0)},l=()=>{var c;e(!1),(c=s.current)==null||c.reset()};return y.jsxs("section",{className:"relative min-h-screen bg-gradient-primary overflow-hidden",children:[y.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[y.jsxs("div",{className:"absolute right-0 top-0 w-3/5 h-full opacity-40",children:[y.jsx("img",{src:"/lovable-uploads/099d43ed-30ee-447a-8302-8f31d970c7b5.png",alt:"TurnKey Development founder and consultant",className:"w-full h-full object-cover object-center"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-l from-primary/80 via-primary/60 to-primary"})]}),y.jsxs("div",{className:"absolute left-0 bottom-0 w-2/5 h-2/3 opacity-20",children:[y.jsx("img",{src:"/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png",alt:"Construction project by TurnKey Development",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary to-transparent"})]})]}),y.jsx("div",{className:"hidden lg:block absolute top-20 left-8 w-64 h-64 rounded-2xl overflow-hidden shadow-xl border-4 border-accent/60 rotate-6 transform hover:rotate-3 transition-all duration-500",children:y.jsx("img",{src:"/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png",alt:"Construction project by TurnKey Development",className:"w-full h-full object-cover hover:scale-110 transition-all duration-500"})}),y.jsxs("div",{className:"hidden lg:block absolute bottom-40 left-16 w-72 h-48 rounded-3xl overflow-hidden shadow-2xl border-6 border-white/40 -rotate-3 transform hover:-rotate-1 transition-all duration-700",children:[y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Architectural project showcase",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-accent/30"})]}),y.jsxs("div",{className:"hidden lg:block absolute top-16 right-16 w-80 h-80 rounded-3xl overflow-hidden shadow-2xl border-8 border-white/40 rotate-3 transform hover:rotate-1 transition-all duration-700",children:[y.jsx("img",{src:"/lovable-uploads/993aef6a-33f5-465f-8eba-159acc3d0dd8.png",alt:"TurnKey Development business consultant",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-primary/30"})]}),y.jsx("div",{className:"hidden lg:block absolute bottom-32 right-8 w-56 h-56 rounded-2xl overflow-hidden shadow-xl border-4 border-accent/60 -rotate-6 transform hover:-rotate-3 transition-all duration-500",children:y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Architectural project showcase",className:"w-full h-full object-cover hover:scale-110 transition-all duration-500"})}),y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute top-32 left-16 w-96 h-96 bg-accent/20 rounded-full blur-3xl animate-pulse"}),y.jsx("div",{className:"absolute bottom-16 left-32 w-80 h-80 bg-white/10 rounded-full blur-2xl"}),y.jsx("div",{className:"absolute top-1/2 left-1/3 w-[500px] h-[500px] bg-secondary/15 rounded-full blur-3xl"}),y.jsx("div",{className:"absolute inset-0 opacity-5",children:y.jsx("div",{className:"w-full h-full bg-gradient-to-br from-amber-800/30 via-amber-600/20 to-amber-900/30"})}),y.jsx("div",{className:"absolute inset-0 opacity-10",children:y.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(0deg, rgba(255,255,255,0.1) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)
            `,backgroundSize:"60px 60px"}})})]}),y.jsxs("div",{className:"container mx-auto px-4 py-20 relative z-10",children:[y.jsx("div",{className:"lg:hidden mb-12",children:y.jsxs("h2",{className:"text-5xl sm:text-6xl font-black leading-none text-white text-center",children:["TURN KEY DEVELOPMENT,",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"WE WILL DO"}),y.jsx("span",{className:"block bg-gradient-to-r from-white to-highlight bg-clip-text text-transparent",children:"ALL THE WORK!"})]})}),y.jsxs("div",{className:"lg:hidden mb-8 flex justify-center gap-4",children:[y.jsx("div",{className:"w-32 h-32 rounded-xl overflow-hidden shadow-lg border-2 border-accent/60 rotate-3",children:y.jsx("img",{src:"/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png",alt:"Construction project by TurnKey Development",className:"w-full h-full object-cover"})}),y.jsx("div",{className:"w-32 h-32 rounded-xl overflow-hidden shadow-lg border-2 border-white/40 -rotate-3",children:y.jsx("img",{src:"/lovable-uploads/993aef6a-33f5-465f-8eba-159acc3d0dd8.png",alt:"TurnKey Development business consultant",className:"w-full h-full object-cover"})})]}),y.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-2 gap-8 lg:gap-2 items-center max-w-7xl",children:[y.jsxs("div",{className:"space-y-12 order-2 lg:order-1 text-center lg:text-left",children:[y.jsxs("div",{className:"space-y-6",children:[y.jsx("div",{className:"hidden lg:block",children:y.jsxs("h3",{className:"text-3xl font-black leading-none text-white text-left mb-4",children:["TURN KEY DEVELOPMENT,",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"WE WILL DO"}),y.jsx("span",{className:"block bg-gradient-to-r from-white to-highlight bg-clip-text text-transparent",children:"ALL THE WORK!"})]})}),y.jsx("div",{className:"inline-block bg-accent/20 backdrop-blur-sm px-6 py-3 rounded-full border border-white/60",children:y.jsx("span",{className:"text-white drop-shadow-lg font-bold text-sm sm:text-lg",children:"🏗️ DONE-FOR-YOU NEW CONSTRUCTION"})}),y.jsxs("h1",{className:"text-6xl sm:text-5xl lg:text-8xl font-black leading-none text-white",children:["FROM EMPTY",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"LOT TO"}),y.jsx("span",{className:"block bg-gradient-to-r from-white to-highlight bg-clip-text text-transparent",children:"COMPLETED"}),y.jsx("span",{className:"block text-white",children:"PROJECT"})]}),y.jsx("div",{className:"bg-white/10 backdrop-blur-sm p-6 rounded-2xl border border-white/20 max-w-2xl mx-auto lg:mx-0",children:y.jsxs("p",{className:"text-lg sm:text-2xl text-white font-semibold leading-relaxed",children:["We guide investors, developers, and first-time builders through every step of the",y.jsx("span",{className:"text-highlight",children:" pre-construction and construction process 🏗️"}),"— from land search to permits to builder selection."]})})]}),y.jsxs("div",{className:"space-y-6",children:[y.jsx(Gc,{size:"lg",onClick:()=>r(!0),className:"text-lg sm:text-2xl px-8 sm:px-12 py-6 sm:py-8 bg-white text-primary hover:bg-accent hover:text-white shadow-2xl transform hover:scale-105 transition-all duration-300 font-bold",children:"📞 Book Your Consultation Today"}),y.jsxs("div",{className:"flex items-center justify-center lg:justify-start gap-4 text-white/90",children:[y.jsxs("div",{className:"flex -space-x-2",children:[y.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-white bg-accent"}),y.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-white bg-secondary"}),y.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-white bg-primary"})]}),y.jsx("span",{className:"text-lg",children:"Join 100+ successful developers"})]})]}),y.jsx("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-3xl border border-white/20",children:y.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("div",{className:"text-4xl font-black text-highlight",children:"500+"}),y.jsx("div",{className:"text-white/80 font-medium",children:"Projects Delivered"})]}),y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("div",{className:"text-4xl font-black text-highlight",children:"98%"}),y.jsx("div",{className:"text-white/80 font-medium",children:"Success Rate"})]}),y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("div",{className:"text-4xl font-black text-highlight",children:"40%"}),y.jsx("div",{className:"text-white/80 font-medium",children:"Revenue Boost"})]}),y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("div",{className:"text-4xl font-black text-highlight",children:"15+"}),y.jsx("div",{className:"text-white/80 font-medium",children:"Years Experience"})]})]})})]}),y.jsx("div",{className:"relative flex justify-center lg:justify-start lg:pl-24",children:y.jsxs("div",{className:"relative w-80 h-[600px] sm:w-80 sm:h-[600px] lg:w-96 lg:h-[800px]",children:[y.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-800 to-slate-900 rounded-[3rem] p-2 shadow-2xl",children:y.jsxs("div",{className:"w-full h-full bg-black rounded-[2.5rem] overflow-hidden relative",children:[y.jsx("div",{className:"absolute top-2 left-1/2 transform -translate-x-1/2 w-20 h-6 sm:w-24 sm:h-6 lg:w-32 lg:h-8 bg-black rounded-full z-20"}),y.jsx("div",{className:"w-full h-full rounded-[2.5rem] overflow-hidden relative",children:n?y.jsxs("div",{className:"w-full h-full bg-black relative",children:[y.jsx(Am,{ref:s,videoUrl:"https://vz-447b6532-fd2.b-cdn.net/c6b998b8-9763-4324-94ea-1b19b14c3dc1/playlist.m3u8",autoPlay:n,showControls:!0,showUnmuteButton:!0,unmuteButtonPosition:"bottom",componentName:"Hero",className:"w-full h-full object-cover",containerClassName:"w-full h-full"}),y.jsx("button",{onClick:l,className:"absolute top-4 right-4 px-4 py-2 bg-black/60 text-white rounded-lg hover:bg-black/80 transition-colors backdrop-blur-sm z-30",children:"✕ Close"})]}):y.jsxs(y.Fragment,{children:[y.jsx("img",{src:"/lovable-uploads/969dc144-8ea0-45cc-8375-b4bc44dc44c5.png",alt:"Business transformation expert introduction",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:y.jsx("button",{onClick:a,className:"w-28 h-28 bg-white/90 rounded-full flex items-center justify-center hover:bg-white transition-all duration-300 hover:scale-110 shadow-2xl",children:y.jsx(KA,{className:"w-12 h-12 text-primary ml-1",fill:"currentColor"})})}),y.jsxs("div",{className:"absolute bottom-6 left-6 right-6 bg-black/60 backdrop-blur-sm rounded-2xl p-6",children:[y.jsx("p",{className:"text-white font-semibold text-center text-lg",children:"👋 Your Construction Partner"}),y.jsx("p",{className:"text-white/80 text-base text-center mt-2",children:"Tap to see how we build together"})]})]})})]})}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-600/50 to-slate-900/50 rounded-[3rem] blur-xl scale-105 -z-10"})]})})]}),y.jsx("div",{className:"lg:hidden mt-20 flex justify-center",children:y.jsx("div",{className:"w-40 h-24 rounded-xl overflow-hidden shadow-lg border-2 border-accent/60 rotate-2",children:y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Architectural project showcase",className:"w-full h-full object-cover"})})})]}),y.jsx(l2,{isOpen:t,onClose:()=>r(!1)}),y.jsx(c2,{isOpen:i,onClose:o})]})},f2=()=>y.jsx("section",{className:"w-full bg-emerald-900 py-8",children:y.jsx("div",{className:"container mx-auto px-4",children:y.jsxs("div",{className:"flex items-center justify-center gap-4",children:[y.jsx("img",{src:"/lovable-uploads/4816903b-b6a4-4c11-984e-7832aca0c77c.png",alt:"Equity Builders Icon",className:"h-12 w-auto"}),y.jsx("img",{src:"/lovable-uploads/d9e364d3-b8e5-4fa9-aa0f-abb5fc4965a8.png",alt:"Equity Builders",className:"h-10 w-auto"})]})})}),aa=w.forwardRef(({className:n,...e},t)=>y.jsx("div",{ref:t,className:Ve("rounded-lg border bg-card text-card-foreground shadow-sm",n),...e}));aa.displayName="Card";const zc=w.forwardRef(({className:n,...e},t)=>y.jsx("div",{ref:t,className:Ve("flex flex-col space-y-1.5 p-6",n),...e}));zc.displayName="CardHeader";const Yc=w.forwardRef(({className:n,...e},t)=>y.jsx("h3",{ref:t,className:Ve("text-2xl font-semibold leading-none tracking-tight",n),...e}));Yc.displayName="CardTitle";const h2=w.forwardRef(({className:n,...e},t)=>y.jsx("p",{ref:t,className:Ve("text-sm text-muted-foreground",n),...e}));h2.displayName="CardDescription";const la=w.forwardRef(({className:n,...e},t)=>y.jsx("div",{ref:t,className:Ve("p-6 pt-0",n),...e}));la.displayName="CardContent";const m2=w.forwardRef(({className:n,...e},t)=>y.jsx("div",{ref:t,className:Ve("flex items-center p-6 pt-0",n),...e}));m2.displayName="CardFooter";const p2=()=>{const n=[{title:"Land Search & Vetting",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},{title:"Survey & Soil Reports",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{title:"Site Plan Design",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})})},{title:"Plat Design & Submission",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{title:"Civil Drainage Planning",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{title:"Architectural & Floor Plan Design",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})},{title:"Structural Engineer Plans",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M19 10a7 7 0 11-14 0 7 7 0 0114 0z"})})},{title:"Budget Creation & Material Selections",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})},{title:"Project Underwriting & Cashflow Projections",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})},{title:"Construction Loan Submission & Approval",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})},{title:"City Permit Submission & Approval",category:"Our Proven 11-Step Process",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}],e=[{title:"Land Search & Negotiations",category:"Services Included",icon:y.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})},{title:"Survey Review & Analysis",category:"Services Included",icon:y.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})},{title:"Site Plan & Plat Preparation",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})})},{title:"Construction Floor Plan Design & Development",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})},{title:"Budget Creation & Project Underwriting",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})},{title:"Builder Selection & Contract Review",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})},{title:"Full In-House Construction Services",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})},{title:"Entity Structuring & Setup",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})},{title:"Exit Strategy & Real Estate Tax Planning",category:"Services Included",icon:y.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6m3-3l3 3-3 3"})})}],t=[...n,...e];return y.jsxs("section",{className:"py-32 bg-gradient-secondary relative overflow-hidden",children:[y.jsxs("div",{className:"absolute inset-0",children:[y.jsxs("div",{className:"absolute left-0 top-0 w-2/5 h-full opacity-30",children:[y.jsx("img",{src:"/lovable-uploads/099d43ed-30ee-447a-8302-8f31d970c7b5.png",alt:"TurnKey Development strategic consultant",className:"w-full h-full object-cover object-center"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-secondary via-secondary/80 to-transparent"})]}),y.jsxs("div",{className:"absolute right-0 bottom-0 w-3/5 h-2/3 opacity-15",children:[y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Construction project showcasing expertise",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-l from-secondary/80 to-transparent"})]}),y.jsxs("div",{className:"absolute top-16 left-1/2 transform -translate-x-1/2 lg:left-20 lg:transform-none w-48 h-48 lg:w-80 lg:h-80 rounded-3xl overflow-hidden shadow-2xl border-4 lg:border-8 border-accent/50 -rotate-12 hover:-rotate-6 transition-all duration-700",children:[y.jsx("img",{src:"/lovable-uploads/993aef6a-33f5-465f-8eba-159acc3d0dd8.png",alt:"Business development and consulting expert",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-secondary/40"})]}),y.jsx("div",{className:"hidden lg:block absolute bottom-20 right-32 w-72 h-72 rounded-2xl overflow-hidden shadow-xl border-6 border-white/40 rotate-12",children:y.jsx("img",{src:"/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png",alt:"Architectural development project",className:"w-full h-full object-cover hover:scale-110 transition-all duration-500"})})]}),y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute top-20 right-20 w-96 h-96 bg-accent/20 rounded-full blur-3xl animate-pulse"}),y.jsx("div",{className:"absolute bottom-32 left-40 w-80 h-80 bg-white/10 rounded-full blur-2xl"}),y.jsx("div",{className:"absolute top-1/2 right-1/3 w-[500px] h-[500px] bg-primary/10 rounded-full blur-3xl"}),y.jsx("div",{className:"absolute inset-0 opacity-8",children:y.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(0deg, rgba(255,255,255,0.05) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px)
            `,backgroundSize:"40px 40px"}})}),y.jsx("div",{className:"absolute inset-0 opacity-3",children:y.jsx("div",{className:"w-full h-full bg-gradient-to-br from-amber-700/20 via-amber-500/10 to-amber-800/15"})})]}),y.jsxs("div",{className:"container mx-auto px-4 relative z-10",children:[y.jsxs("div",{className:"text-center mb-20 mt-48 lg:mt-0",children:[y.jsx("div",{className:"inline-block bg-white/10 backdrop-blur-sm px-8 py-4 rounded-full border border-white/30 mb-8",children:y.jsx("span",{className:"text-white font-bold text-xl",children:"💼 OUR EXPERT SERVICES"})}),y.jsxs("h2",{className:"text-5xl lg:text-6xl font-black mb-8 text-white",children:["WE WILL TAKE YOU",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"FROM A TO Z"})]}),y.jsx("p",{className:"text-2xl text-white/90 max-w-4xl mx-auto leading-relaxed",children:"Use our experience, our team, our vendors, relationships, and take all of our knowledge and processes around developing residential 1 to 4 family properties for a flat fee."})]}),y.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:t.map((r,s)=>y.jsxs(aa,{className:"group hover:shadow-2xl transition-all duration-500 hover:-translate-y-4 hover:scale-105 bg-white/95 hover:bg-gradient-accent hover:text-white border-0 backdrop-blur-sm",children:[y.jsxs(zc,{children:[y.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-2xl flex items-center justify-center text-primary mb-4 group-hover:bg-white/20 group-hover:text-white transition-all duration-300 group-hover:scale-110",children:r.icon}),y.jsx(Yc,{className:"text-lg group-hover:text-white font-bold",children:r.title}),r.category&&y.jsx("div",{className:"text-xs text-muted-foreground group-hover:text-white/70 bg-primary/5 group-hover:bg-white/10 px-2 py-1 rounded-full w-fit",children:r.category})]}),y.jsx(la,{children:r.description&&y.jsx("p",{className:"text-muted-foreground group-hover:text-white/90 text-sm leading-relaxed",children:r.description})})]},s))}),y.jsx("div",{className:"text-center mt-20",children:y.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-3xl border border-white/20 max-w-2xl mx-auto",children:[y.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:"Ready to Transform?"}),y.jsx("p",{className:"text-white/90 text-xl mb-6",children:"Let's discuss how these services can accelerate your growth"}),y.jsxs("div",{className:"flex items-center justify-center gap-4 text-accent text-lg font-semibold",children:[y.jsx("span",{children:"📞"})," Book Your Free Strategy Call Now"]})]})})]})]})},g2=()=>{const n=[{title:"Proven Track Record",description:"Over $1.2M in active construction and $5M+ in pre-construction pipeline.",icon:y.jsx(FA,{className:"w-8 h-8"}),stats:"$1.2M+",statsLabel:"Active Construction"},{title:"Experience",description:"From mortgage brokering to property management to development — we cover the full transaction.",icon:y.jsx(BA,{className:"w-8 h-8"}),stats:"Full Stack",statsLabel:"Real Estate Services"},{title:"Barrier Removal",description:"We help new developers overcome the toughest entry challenges, including financing and permitting.",icon:y.jsx(VA,{className:"w-8 h-8"}),stats:"100%",statsLabel:"Permit Success Rate"},{title:"Mentorship Included",description:"We will let you see behind the curtain and process full transparency of actual costs and process.",icon:y.jsx(jA,{className:"w-8 h-8"}),stats:"100%",statsLabel:"Transparency"}];return y.jsxs("section",{className:"py-32 bg-gradient-to-br from-primary via-primary-dark to-secondary relative overflow-hidden",children:[y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute top-20 left-20 w-96 h-96 bg-accent/20 rounded-full blur-3xl"}),y.jsx("div",{className:"absolute bottom-32 right-40 w-80 h-80 bg-white/10 rounded-full blur-2xl"}),y.jsx("div",{className:"absolute top-1/2 left-1/3 w-[400px] h-[400px] bg-white/5 rounded-full blur-3xl"})]}),y.jsxs("div",{className:"container mx-auto px-4 relative z-10",children:[y.jsxs("div",{className:"text-center mb-20",children:[y.jsx("div",{className:"inline-block bg-white/10 backdrop-blur-sm px-8 py-4 rounded-full border border-white/30 mb-8",children:y.jsx("span",{className:"text-white font-bold text-xl",children:"🏆 WHY CHOOSE US"})}),y.jsxs("h2",{className:"text-5xl lg:text-6xl font-black mb-8 text-white",children:["WHY WORK",y.jsx("span",{className:"block text-accent drop-shadow-2xl",children:"WITH US?"})]}),y.jsx("p",{className:"text-2xl text-white/90 max-w-4xl mx-auto leading-relaxed",children:"We don't just talk about results — we deliver them. We will teach you how to fish in this Real Estate development game for a fraction of your profit potential. Here's what sets us apart in the competitive world of real estate development."})]}),y.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:n.map((e,t)=>y.jsxs(aa,{className:"group hover:shadow-2xl transition-all duration-500 hover:-translate-y-6 hover:scale-105 bg-white/95 hover:bg-white border-0 backdrop-blur-sm text-center",children:[y.jsxs(zc,{className:"pb-4",children:[y.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center text-primary mb-6 group-hover:bg-primary group-hover:text-white transition-all duration-300 group-hover:scale-110 mx-auto",children:e.icon}),y.jsxs("div",{className:"mb-4",children:[y.jsx("div",{className:"text-3xl font-black text-primary group-hover:text-primary-dark",children:e.stats}),y.jsx("div",{className:"text-sm text-muted-foreground font-semibold",children:e.statsLabel})]}),y.jsx(Yc,{className:"text-xl group-hover:text-primary-dark font-bold",children:e.title})]}),y.jsx(la,{children:y.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:e.description})})]},t))}),y.jsx("div",{className:"text-center mt-20",children:y.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-12 rounded-3xl border border-white/20 max-w-4xl mx-auto",children:[y.jsx("h3",{className:"text-4xl font-bold text-white mb-6",children:"Ready to Get Started?"}),y.jsx("p",{className:"text-white/90 text-xl mb-8 leading-relaxed",children:"Join the ranks of successful developers by leveraging our experience and track record. Will do what it takes to get you across the finish line. Let's start building up your net-worth today."}),y.jsxs("div",{className:"flex items-center justify-center gap-4 text-yellow-400 text-2xl font-bold",children:[y.jsx("span",{children:"💰"})," Let's start building up your net-worth today."]})]})})]})]})},v2=jh("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function G0({className:n,variant:e,...t}){return y.jsx("div",{className:Ve(v2({variant:e}),n),...t})}var id="focusScope.autoFocusOnMount",od="focusScope.autoFocusOnUnmount",V0={bubbles:!1,cancelable:!0},y2="FocusScope",AT=w.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=n,[a,l]=w.useState(null),c=Vn(s),u=Vn(i),d=w.useRef(null),f=gt(e,p=>l(p)),h=w.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;w.useEffect(()=>{if(r){let p=function(E){if(h.paused||!a)return;const T=E.target;a.contains(T)?d.current=T:Lr(d.current,{select:!0})},g=function(E){if(h.paused||!a)return;const T=E.relatedTarget;T!==null&&(a.contains(T)||Lr(d.current,{select:!0}))},v=function(E){if(document.activeElement===document.body)for(const b of E)b.removedNodes.length>0&&Lr(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",g);const x=new MutationObserver(v);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",g),x.disconnect()}}},[r,a,h.paused]),w.useEffect(()=>{if(a){K0.add(h);const p=document.activeElement;if(!a.contains(p)){const v=new CustomEvent(id,V0);a.addEventListener(id,c),a.dispatchEvent(v),v.defaultPrevented||(x2(w2(LT(a)),{select:!0}),document.activeElement===p&&Lr(a))}return()=>{a.removeEventListener(id,c),setTimeout(()=>{const v=new CustomEvent(od,V0);a.addEventListener(od,u),a.dispatchEvent(v),v.defaultPrevented||Lr(p??document.body,{select:!0}),a.removeEventListener(od,u),K0.remove(h)},0)}}},[a,c,u,h]);const m=w.useCallback(p=>{if(!t&&!r||h.paused)return;const g=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,v=document.activeElement;if(g&&v){const x=p.currentTarget,[E,T]=E2(x);E&&T?!p.shiftKey&&v===T?(p.preventDefault(),t&&Lr(E,{select:!0})):p.shiftKey&&v===E&&(p.preventDefault(),t&&Lr(T,{select:!0})):v===x&&p.preventDefault()}},[t,r,h.paused]);return y.jsx(Ge.div,{tabIndex:-1,...o,ref:f,onKeyDown:m})});AT.displayName=y2;function x2(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Lr(r,{select:e}),document.activeElement!==t)return}function E2(n){const e=LT(n),t=H0(e,n),r=H0(e.reverse(),n);return[t,r]}function LT(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function H0(n,e){for(const t of n)if(!S2(t,{upTo:e}))return t}function S2(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function T2(n){return n instanceof HTMLInputElement&&"select"in n}function Lr(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&T2(n)&&e&&n.select()}}var K0=b2();function b2(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=W0(n,e),n.unshift(e)},remove(e){var t;n=W0(n,e),(t=n[0])==null||t.resume()}}}function W0(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function w2(n){return n.filter(e=>e.tagName!=="A")}var ad=0;function A2(){w.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??z0()),document.body.insertAdjacentElement("beforeend",n[1]??z0()),ad++,()=>{ad===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),ad--}},[])}function z0(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Mn=function(){return Mn=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Mn.apply(this,arguments)};function IT(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function L2(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var bl="right-scroll-bar-position",wl="width-before-scroll-bar",I2="with-scroll-bars-hidden",R2="--removed-body-scroll-bar-size";function ld(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function C2(n,e){var t=w.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var s=t.value;s!==r&&(t.value=r,t.callback(r,s))}}}})[0];return t.callback=e,t.facade}var k2=typeof window<"u"?w.useLayoutEffect:w.useEffect,Y0=new WeakMap;function _2(n,e){var t=C2(null,function(r){return n.forEach(function(s){return ld(s,r)})});return k2(function(){var r=Y0.get(t);if(r){var s=new Set(r),i=new Set(n),o=t.current;s.forEach(function(a){i.has(a)||ld(a,null)}),i.forEach(function(a){s.has(a)||ld(a,o)})}Y0.set(t,n)},[n]),t}function P2(n){return n}function D2(n,e){e===void 0&&(e=P2);var t=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(i){var o=e(i,r);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(r=!0;t.length;){var o=t;t=[],o.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){r=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(i),o=t}var l=function(){var u=o;o=[],u.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),t}}}};return s}function N2(n){n===void 0&&(n={});var e=D2(null);return e.options=Mn({async:!0,ssr:!1},n),e}var RT=function(n){var e=n.sideCar,t=IT(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return w.createElement(r,Mn({},t))};RT.isSideCarExport=!0;function O2(n,e){return n.useMedium(e),RT}var CT=N2(),cd=function(){},qc=w.forwardRef(function(n,e){var t=w.useRef(null),r=w.useState({onScrollCapture:cd,onWheelCapture:cd,onTouchMoveCapture:cd}),s=r[0],i=r[1],o=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,f=n.sideCar,h=n.noRelative,m=n.noIsolation,p=n.inert,g=n.allowPinchZoom,v=n.as,x=v===void 0?"div":v,E=n.gapMode,T=IT(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=f,L=_2([t,e]),A=Mn(Mn({},T),s);return w.createElement(w.Fragment,null,u&&w.createElement(b,{sideCar:CT,removeScrollBar:c,shards:d,noRelative:h,noIsolation:m,inert:p,setCallbacks:i,allowPinchZoom:!!g,lockRef:t,gapMode:E}),o?w.cloneElement(w.Children.only(a),Mn(Mn({},A),{ref:L})):w.createElement(x,Mn({},A,{className:l,ref:L}),a))});qc.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};qc.classNames={fullWidth:wl,zeroRight:bl};var M2=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function F2(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=M2();return e&&n.setAttribute("nonce",e),n}function B2(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function $2(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var U2=function(){var n=0,e=null;return{add:function(t){n==0&&(e=F2())&&(B2(e,t),$2(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},j2=function(){var n=U2();return function(e,t){w.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},kT=function(){var n=j2(),e=function(t){var r=t.styles,s=t.dynamic;return n(r,s),null};return e},G2={left:0,top:0,right:0,gap:0},ud=function(n){return parseInt(n||"",10)||0},V2=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],s=e[n==="padding"?"paddingRight":"marginRight"];return[ud(t),ud(r),ud(s)]},H2=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return G2;var e=V2(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},K2=kT(),yi="data-scroll-locked",W2=function(n,e,t,r){var s=n.left,i=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(I2,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(yi,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(bl,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(wl,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(bl," .").concat(bl,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(wl," .").concat(wl,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(yi,`] {
    `).concat(R2,": ").concat(a,`px;
  }
`)},q0=function(){var n=parseInt(document.body.getAttribute(yi)||"0",10);return isFinite(n)?n:0},z2=function(){w.useEffect(function(){return document.body.setAttribute(yi,(q0()+1).toString()),function(){var n=q0()-1;n<=0?document.body.removeAttribute(yi):document.body.setAttribute(yi,n.toString())}},[])},Y2=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,s=r===void 0?"margin":r;z2();var i=w.useMemo(function(){return H2(s)},[s]);return w.createElement(K2,{styles:W2(i,!e,s,t?"":"!important")})},jf=!1;if(typeof window<"u")try{var Qa=Object.defineProperty({},"passive",{get:function(){return jf=!0,!0}});window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{jf=!1}var Gs=jf?{passive:!1}:!1,q2=function(n){return n.tagName==="TEXTAREA"},_T=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!q2(n)&&t[e]==="visible")},Q2=function(n){return _T(n,"overflowY")},X2=function(n){return _T(n,"overflowX")},Q0=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var s=PT(n,r);if(s){var i=DT(n,r),o=i[1],a=i[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Z2=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},J2=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},PT=function(n,e){return n==="v"?Q2(e):X2(e)},DT=function(n,e){return n==="v"?Z2(e):J2(e)},eO=function(n,e){return n==="h"&&e==="rtl"?-1:1},tO=function(n,e,t,r,s){var i=eO(n,window.getComputedStyle(e).direction),o=i*r,a=t.target,l=e.contains(a),c=!1,u=o>0,d=0,f=0;do{if(!a)break;var h=DT(n,a),m=h[0],p=h[1],g=h[2],v=p-g-i*m;(m||v)&&PT(n,a)&&(d+=v,f+=m);var x=a.parentNode;a=x&&x.nodeType===Node.DOCUMENT_FRAGMENT_NODE?x.host:x}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!s)||!u&&(Math.abs(f)<1||!s))&&(c=!0),c},Xa=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},X0=function(n){return[n.deltaX,n.deltaY]},Z0=function(n){return n&&"current"in n?n.current:n},nO=function(n,e){return n[0]===e[0]&&n[1]===e[1]},rO=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},sO=0,Vs=[];function iO(n){var e=w.useRef([]),t=w.useRef([0,0]),r=w.useRef(),s=w.useState(sO++)[0],i=w.useState(kT)[0],o=w.useRef(n);w.useEffect(function(){o.current=n},[n]),w.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(s));var p=L2([n.lockRef.current],(n.shards||[]).map(Z0),!0).filter(Boolean);return p.forEach(function(g){return g.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),p.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(s))})}}},[n.inert,n.lockRef.current,n.shards]);var a=w.useCallback(function(p,g){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!o.current.allowPinchZoom;var v=Xa(p),x=t.current,E="deltaX"in p?p.deltaX:x[0]-v[0],T="deltaY"in p?p.deltaY:x[1]-v[1],b,L=p.target,A=Math.abs(E)>Math.abs(T)?"h":"v";if("touches"in p&&A==="h"&&L.type==="range")return!1;var I=Q0(A,L);if(!I)return!0;if(I?b=A:(b=A==="v"?"h":"v",I=Q0(A,L)),!I)return!1;if(!r.current&&"changedTouches"in p&&(E||T)&&(r.current=b),!b)return!0;var C=r.current||b;return tO(C,g,p,C==="h"?E:T,!0)},[]),l=w.useCallback(function(p){var g=p;if(!(!Vs.length||Vs[Vs.length-1]!==i)){var v="deltaY"in g?X0(g):Xa(g),x=e.current.filter(function(b){return b.name===g.type&&(b.target===g.target||g.target===b.shadowParent)&&nO(b.delta,v)})[0];if(x&&x.should){g.cancelable&&g.preventDefault();return}if(!x){var E=(o.current.shards||[]).map(Z0).filter(Boolean).filter(function(b){return b.contains(g.target)}),T=E.length>0?a(g,E[0]):!o.current.noIsolation;T&&g.cancelable&&g.preventDefault()}}},[]),c=w.useCallback(function(p,g,v,x){var E={name:p,delta:g,target:v,should:x,shadowParent:oO(v)};e.current.push(E),setTimeout(function(){e.current=e.current.filter(function(T){return T!==E})},1)},[]),u=w.useCallback(function(p){t.current=Xa(p),r.current=void 0},[]),d=w.useCallback(function(p){c(p.type,X0(p),p.target,a(p,n.lockRef.current))},[]),f=w.useCallback(function(p){c(p.type,Xa(p),p.target,a(p,n.lockRef.current))},[]);w.useEffect(function(){return Vs.push(i),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Gs),document.addEventListener("touchmove",l,Gs),document.addEventListener("touchstart",u,Gs),function(){Vs=Vs.filter(function(p){return p!==i}),document.removeEventListener("wheel",l,Gs),document.removeEventListener("touchmove",l,Gs),document.removeEventListener("touchstart",u,Gs)}},[]);var h=n.removeScrollBar,m=n.inert;return w.createElement(w.Fragment,null,m?w.createElement(i,{styles:rO(s)}):null,h?w.createElement(Y2,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function oO(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const aO=O2(CT,iO);var NT=w.forwardRef(function(n,e){return w.createElement(qc,Mn({},n,{ref:e,sideCar:aO}))});NT.classNames=qc.classNames;var lO=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Hs=new WeakMap,Za=new WeakMap,Ja={},dd=0,OT=function(n){return n&&(n.host||OT(n.parentNode))},cO=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=OT(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},uO=function(n,e,t,r){var s=cO(e,Array.isArray(n)?n:[n]);Ja[t]||(Ja[t]=new WeakMap);var i=Ja[t],o=[],a=new Set,l=new Set(s),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var h=f.getAttribute(r),m=h!==null&&h!=="false",p=(Hs.get(f)||0)+1,g=(i.get(f)||0)+1;Hs.set(f,p),i.set(f,g),o.push(f),p===1&&m&&Za.set(f,!0),g===1&&f.setAttribute(t,"true"),m||f.setAttribute(r,"true")}catch(v){console.error("aria-hidden: cannot operate on ",f,v)}})};return u(e),a.clear(),dd++,function(){o.forEach(function(d){var f=Hs.get(d)-1,h=i.get(d)-1;Hs.set(d,f),i.set(d,h),f||(Za.has(d)||d.removeAttribute(r),Za.delete(d)),h||d.removeAttribute(t)}),dd--,dd||(Hs=new WeakMap,Hs=new WeakMap,Za=new WeakMap,Ja={})}},dO=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),s=lO(n);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live]"))),uO(r,s,t,"aria-hidden")):function(){return null}},Qc="Dialog",[MT,WO]=ra(Qc),[fO,bn]=MT(Qc),FT=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:s,onOpenChange:i,modal:o=!0}=n,a=w.useRef(null),l=w.useRef(null),[c,u]=Rx({prop:r,defaultProp:s??!1,onChange:i,caller:Qc});return y.jsx(fO,{scope:e,triggerRef:a,contentRef:l,contentId:_u(),titleId:_u(),descriptionId:_u(),open:c,onOpenChange:u,onOpenToggle:w.useCallback(()=>u(d=>!d),[u]),modal:o,children:t})};FT.displayName=Qc;var BT="DialogTrigger",hO=w.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=bn(BT,t),i=gt(e,s.triggerRef);return y.jsx(Ge.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Rm(s.open),...r,ref:i,onClick:Re(n.onClick,s.onOpenToggle)})});hO.displayName=BT;var Lm="DialogPortal",[mO,$T]=MT(Lm,{forceMount:void 0}),UT=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:s}=n,i=bn(Lm,e);return y.jsx(mO,{scope:e,forceMount:t,children:w.Children.map(r,o=>y.jsx(ji,{present:t||i.open,children:y.jsx(Fh,{asChild:!0,container:s,children:o})}))})};UT.displayName=Lm;var fc="DialogOverlay",jT=w.forwardRef((n,e)=>{const t=$T(fc,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=bn(fc,n.__scopeDialog);return i.modal?y.jsx(ji,{present:r||i.open,children:y.jsx(gO,{...s,ref:e})}):null});jT.displayName=fc;var pO=Bo("DialogOverlay.RemoveScroll"),gO=w.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=bn(fc,t);return y.jsx(NT,{as:pO,allowPinchZoom:!0,shards:[s.contentRef],children:y.jsx(Ge.div,{"data-state":Rm(s.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),_s="DialogContent",GT=w.forwardRef((n,e)=>{const t=$T(_s,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=bn(_s,n.__scopeDialog);return y.jsx(ji,{present:r||i.open,children:i.modal?y.jsx(vO,{...s,ref:e}):y.jsx(yO,{...s,ref:e})})});GT.displayName=_s;var vO=w.forwardRef((n,e)=>{const t=bn(_s,n.__scopeDialog),r=w.useRef(null),s=gt(e,t.contentRef,r);return w.useEffect(()=>{const i=r.current;if(i)return dO(i)},[]),y.jsx(VT,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Re(n.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Re(n.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:Re(n.onFocusOutside,i=>i.preventDefault())})}),yO=w.forwardRef((n,e)=>{const t=bn(_s,n.__scopeDialog),r=w.useRef(!1),s=w.useRef(!1);return y.jsx(VT,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,i),i.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),i.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:i=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),VT=w.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,...o}=n,a=bn(_s,t),l=w.useRef(null),c=gt(e,l);return A2(),y.jsxs(y.Fragment,{children:[y.jsx(AT,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:i,children:y.jsx(Cc,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Rm(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),y.jsxs(y.Fragment,{children:[y.jsx(xO,{titleId:a.titleId}),y.jsx(SO,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Im="DialogTitle",HT=w.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=bn(Im,t);return y.jsx(Ge.h2,{id:s.titleId,...r,ref:e})});HT.displayName=Im;var KT="DialogDescription",WT=w.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=bn(KT,t);return y.jsx(Ge.p,{id:s.descriptionId,...r,ref:e})});WT.displayName=KT;var zT="DialogClose",YT=w.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=bn(zT,t);return y.jsx(Ge.button,{type:"button",...r,ref:e,onClick:Re(n.onClick,()=>s.onOpenChange(!1))})});YT.displayName=zT;function Rm(n){return n?"open":"closed"}var qT="DialogTitleWarning",[zO,QT]=Uw(qT,{contentName:_s,titleName:Im,docsSlug:"dialog"}),xO=({titleId:n})=>{const e=QT(qT),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return w.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},EO="DialogDescriptionWarning",SO=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${QT(EO).contentName}}.`;return w.useEffect(()=>{var i;const s=(i=n.current)==null?void 0:i.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},TO=FT,bO=UT,XT=jT,ZT=GT,JT=HT,e1=WT,wO=YT;const AO=TO,LO=bO,t1=w.forwardRef(({className:n,...e},t)=>y.jsx(XT,{ref:t,className:Ve("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));t1.displayName=XT.displayName;const n1=w.forwardRef(({className:n,children:e,...t},r)=>y.jsxs(LO,{children:[y.jsx(t1,{}),y.jsxs(ZT,{ref:r,className:Ve("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,y.jsxs(wO,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[y.jsx(ia,{className:"h-4 w-4"}),y.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));n1.displayName=ZT.displayName;const IO=w.forwardRef(({className:n,...e},t)=>y.jsx(JT,{ref:t,className:Ve("text-lg font-semibold leading-none tracking-tight",n),...e}));IO.displayName=JT.displayName;const RO=w.forwardRef(({className:n,...e},t)=>y.jsx(e1,{ref:t,className:Ve("text-sm text-muted-foreground",n),...e}));RO.displayName=e1.displayName;const CO=()=>{const[n,e]=w.useState(null),[t,r]=w.useState(!1),[s,i]=w.useState([]),[o,a]=w.useState(0),l=[{id:1,title:"Oakwood Residential Development",location:"Austin, TX",status:"Under Construction",value:"$1.2M",timeline:"8 months",team:"4 units",images:["/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png","/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png"],story:"From vacant lot to luxury 4-unit development. This project showcases our end-to-end process from land acquisition through final construction.",highlights:["Zoning Approval in 30 Days","15% Under Budget","Pre-sold 2 Units"]},{id:2,title:"Riverside Family Homes",location:"Houston, TX",status:"Planning Phase",value:"$2.1M",timeline:"12 months",team:"6 units",images:["/lovable-uploads/993aef6a-33f5-465f-8eba-159acc3d0dd8.png","/lovable-uploads/5df938db-8063-4672-9fdb-4bb75420dbc7.png"],story:"Transforming underutilized riverside property into modern family housing. Complex permitting and environmental considerations successfully navigated.",highlights:["Environmental Clearance","Community Support","Innovative Design"]},{id:3,title:"Downtown Infill Project",location:"Dallas, TX",status:"Completed",value:"$950K",timeline:"6 months",team:"3 units",images:["/lovable-uploads/d9e364d3-b8e5-4fa9-aa0f-abb5fc4965a8.png","/lovable-uploads/EB_Turnkey_LinkThumb.png"],story:"Urban infill success story. Maximized density while respecting neighborhood character. All units sold before completion.",highlights:["100% Pre-sold","Neighborhood Integration","ROI: 28%"]}],c=p=>{switch(p){case"Completed":return"bg-green-500";case"Under Construction":return"bg-yellow-500";case"Planning Phase":return"bg-blue-500";default:return"bg-gray-500"}},u=(p,g=0)=>{i(p),a(g),r(!0)},d=()=>{a(p=>(p+1)%s.length)},f=()=>{a(p=>(p-1+s.length)%s.length)},h=(p,g)=>{p.target.closest(".image-clickable")||e(n===g?null:g)},m=(p,g,v=0)=>{p.stopPropagation(),u(g,v)};return y.jsxs("section",{className:"py-32 bg-gradient-to-br from-background via-background/50 to-secondary/20 relative overflow-hidden",children:[y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute top-40 right-20 w-96 h-96 bg-primary/10 rounded-full blur-3xl"}),y.jsx("div",{className:"absolute bottom-20 left-40 w-80 h-80 bg-accent/10 rounded-full blur-2xl"})]}),y.jsxs("div",{className:"container mx-auto px-4 relative z-10",children:[y.jsxs("div",{className:"text-center mb-20",children:[y.jsx("div",{className:"inline-block bg-primary/10 backdrop-blur-sm px-8 py-4 rounded-full border border-primary/20 mb-8",children:y.jsx("span",{className:"text-primary font-bold text-xl",children:"📸 PROJECT GALLERY"})}),y.jsxs("h2",{className:"text-5xl lg:text-6xl font-black mb-8 text-foreground",children:["CLIENT",y.jsx("span",{className:"block text-primary drop-shadow-lg",children:"SHOWCASE"})]}),y.jsx("p",{className:"text-xl text-muted-foreground max-w-4xl mx-auto leading-relaxed",children:"Real projects, real results. See how we've transformed visions into reality for developers just like you."})]}),y.jsx("div",{className:"grid lg:grid-cols-3 gap-8",children:l.map((p,g)=>y.jsx(aa,{className:`group cursor-pointer transition-all duration-500 hover:shadow-2xl border-2 transform ${n===p.id?"border-green-500 shadow-2xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950 dark:to-green-900 -translate-y-6 scale-105":"hover:-translate-y-2 border-border hover:border-primary/50"}`,onClick:v=>h(v,p.id),children:y.jsxs(la,{className:"p-0",children:[y.jsxs("div",{className:"relative h-64 overflow-hidden rounded-t-lg image-clickable",children:[y.jsxs("div",{className:"flex transition-transform duration-500 ease-in-out cursor-pointer group/image",onClick:v=>m(v,p.images,0),children:[y.jsx("img",{src:p.images[0],alt:`${p.title} - Main view`,className:"w-full h-64 object-cover group-hover:scale-110 transition-transform duration-500"}),y.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover/image:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:y.jsx(Qp,{className:"w-12 h-12 text-white animate-pulse"})})]}),y.jsx("div",{className:"absolute top-4 left-4 pointer-events-none",children:y.jsx(G0,{className:`${c(p.status)} text-white font-semibold`,children:p.status})}),y.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm flex items-center gap-1 pointer-events-none",children:[y.jsx(GA,{size:14}),p.images.length]})]}),y.jsxs("div",{className:"p-6",children:[y.jsx("h3",{className:"text-xl font-bold mb-2 group-hover:text-primary transition-colors",children:p.title}),y.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 text-sm text-muted-foreground",children:[y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(HA,{size:14,className:"text-primary"}),p.location]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(UA,{size:14,className:"text-primary"}),p.value]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx($A,{size:14,className:"text-primary"}),p.timeline]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(WA,{size:14,className:"text-primary"}),p.team]})]}),n===p.id&&y.jsxs("div",{className:"mt-6 pt-6 border-t border-border animate-in slide-in-from-top-2 duration-300",children:[y.jsx("p",{className:"text-muted-foreground mb-4 leading-relaxed",children:p.story}),y.jsxs("div",{className:"mb-4",children:[y.jsx("h4",{className:"font-semibold mb-2 text-primary",children:"Key Highlights:"}),y.jsx("div",{className:"flex flex-wrap gap-2",children:p.highlights.map((v,x)=>y.jsx(G0,{variant:"secondary",className:"text-xs",children:v},x))})]}),p.images.length>1&&y.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.images.slice(1).map((v,x)=>y.jsxs("div",{className:"relative group/thumb cursor-pointer image-clickable",onClick:E=>m(E,p.images,x+1),children:[y.jsx("img",{src:v,alt:`${p.title} - Additional view ${x+1}`,className:"w-full h-24 object-cover rounded-lg hover:scale-105 transition-transform"}),y.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover/thumb:opacity-100 transition-opacity duration-300 flex items-center justify-center rounded-lg",children:y.jsx(Qp,{className:"w-6 h-6 text-white animate-pulse"})})]},x))})]}),y.jsx("div",{className:"mt-4 text-center",children:y.jsx("span",{className:"text-xs text-primary font-medium",children:n===p.id?"Click to collapse":"Click to view details"})})]})]})},p.id))}),y.jsx(AO,{open:t,onOpenChange:r,children:y.jsx(n1,{className:"max-w-4xl w-full p-0 bg-black/95 border-0",children:y.jsxs("div",{className:"relative",children:[y.jsx("button",{onClick:()=>r(!1),className:"absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors",children:y.jsx(ia,{size:24})}),y.jsxs("div",{className:"relative flex items-center justify-center min-h-[60vh]",children:[y.jsx("img",{src:s[o],alt:`Enlarged view ${o+1}`,className:"max-w-full max-h-[80vh] object-contain"}),s.length>1&&y.jsxs(y.Fragment,{children:[y.jsx("button",{onClick:f,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors",children:"←"}),y.jsx("button",{onClick:d,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors",children:"→"})]})]}),s.length>1&&y.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-2 rounded-full text-sm",children:[o+1," of ",s.length]})]})})})]})]})},kO=()=>y.jsxs("section",{className:"py-20 bg-gradient-to-br from-accent/20 via-background to-primary/10 relative overflow-hidden",children:[y.jsx("div",{className:"absolute inset-0",children:y.jsxs("div",{className:"absolute inset-0 opacity-30",children:[y.jsx("img",{src:"/lovable-uploads/5df938db-8063-4672-9fdb-4bb75420dbc7.png",alt:"Construction site plan and architectural drawing",className:"w-full h-full object-cover object-center"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background/20 via-transparent to-background/20"})]})}),y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute inset-0 opacity-5",children:y.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(45deg, rgba(120, 100, 25, 0.1) 25%, transparent 25%),
              linear-gradient(-45deg, rgba(120, 100, 25, 0.1) 25%, transparent 25%),
              linear-gradient(45deg, transparent 75%, rgba(120, 100, 25, 0.1) 75%),
              linear-gradient(-45deg, transparent 75%, rgba(120, 100, 25, 0.1) 75%)
            `,backgroundSize:"30px 30px",backgroundPosition:"0 0, 0 15px, 15px -15px, -15px 0px"}})}),y.jsx("div",{className:"absolute inset-0 opacity-8",children:y.jsx("div",{className:"w-full h-full bg-gradient-to-br from-amber-900/10 via-amber-700/5 to-amber-800/10"})})]}),y.jsx("div",{className:"container mx-auto px-4",children:y.jsxs("div",{className:"grid lg:grid-cols-2 gap-16 items-center",children:[y.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-white/20",children:y.jsxs("div",{className:"space-y-8",children:[y.jsxs("div",{className:"space-y-4",children:[y.jsx("h2",{className:"text-4xl font-bold",children:"Why Choose TurnKey Development?"}),y.jsx("p",{className:"text-xl text-muted-foreground",children:"With over 15 years of experience in business consulting, we've helped hundreds of organizations achieve their strategic objectives and overcome complex challenges."})]}),y.jsxs("div",{className:"space-y-6",children:[y.jsxs("div",{className:"flex items-start space-x-4",children:[y.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:y.jsx("svg",{className:"w-4 h-4 text-primary-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Proven Track Record"}),y.jsx("p",{className:"text-muted-foreground",children:"Successfully delivered 500+ projects with 98% client satisfaction rate."})]})]}),y.jsxs("div",{className:"flex items-start space-x-4",children:[y.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:y.jsx("svg",{className:"w-4 h-4 text-primary-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Industry Expertise"}),y.jsx("p",{className:"text-muted-foreground",children:"Deep knowledge across multiple industries including technology, healthcare, finance, and manufacturing."})]})]}),y.jsxs("div",{className:"flex items-start space-x-4",children:[y.jsx("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:y.jsx("svg",{className:"w-4 h-4 text-primary-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tailored Solutions"}),y.jsx("p",{className:"text-muted-foreground",children:"Custom strategies designed specifically for your unique business challenges and objectives."})]})]})]}),y.jsx(Gc,{size:"lg",className:"text-lg px-8 py-6",children:"Start Your Transformation"})]})}),y.jsx("div",{className:"relative",children:y.jsxs("div",{className:"aspect-[4/5] bg-gradient-primary rounded-2xl overflow-hidden shadow-2xl relative",children:[y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),y.jsxs("div",{className:"absolute inset-4 rounded-xl overflow-hidden",children:[y.jsx("img",{src:"/lovable-uploads/099d43ed-30ee-447a-8302-8f31d970c7b5.png",alt:"TurnKey Development founder and business consultant",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-primary/60 via-transparent to-transparent"})]}),y.jsx("div",{className:"absolute bottom-4 right-4 w-24 h-24 rounded-xl overflow-hidden border-4 border-white/30",children:y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Construction project showcase",className:"w-full h-full object-cover"})}),y.jsxs("div",{className:"relative z-10 h-full p-8 flex flex-col justify-between",children:[y.jsxs("div",{className:"space-y-4",children:[y.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center border border-white/30",children:y.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),y.jsx("h3",{className:"text-2xl font-bold text-white",children:"Growth-Focused Results"}),y.jsx("p",{className:"text-white/90",children:"Average 40% improvement in operational efficiency within the first 6 months."})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[y.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-4 text-center border border-white/30",children:[y.jsx("div",{className:"text-2xl font-bold text-accent",children:"40%"}),y.jsx("div",{className:"text-sm text-white/80",children:"Efficiency Gain"})]}),y.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-4 text-center border border-white/30",children:[y.jsx("div",{className:"text-2xl font-bold text-accent",children:"6mo"}),y.jsx("div",{className:"text-sm text-white/80",children:"Avg Timeline"})]})]})]})]})})]})})]}),r1=w.forwardRef(({className:n,type:e,...t},r)=>y.jsx("input",{type:e,className:Ve("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:r,...t}));r1.displayName="Input";const _O=()=>y.jsxs("section",{className:"py-32 bg-gradient-accent relative overflow-hidden",children:[y.jsxs("div",{className:"absolute inset-0",children:[y.jsxs("div",{className:"absolute right-0 top-0 w-1/2 h-full opacity-30",children:[y.jsx("img",{src:"/lovable-uploads/993aef6a-33f5-465f-8eba-159acc3d0dd8.png",alt:"Business transformation expert and consultant",className:"w-full h-full object-cover object-center"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-l from-accent via-accent/80 to-accent"})]}),y.jsxs("div",{className:"absolute left-0 bottom-0 w-3/5 h-2/3 opacity-20",children:[y.jsx("img",{src:"/lovable-uploads/f48a2dc0-af37-42d8-824b-fc482c4ceb7f.png",alt:"Quality construction and development projects",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-accent to-transparent"})]}),y.jsxs("div",{className:"absolute bottom-20 left-4 lg:left-16 w-48 h-48 lg:w-80 lg:h-80 rounded-2xl overflow-hidden shadow-2xl border-4 lg:border-6 border-white/50 rotate-6 hover:rotate-3 transition-all duration-700",children:[y.jsx("img",{src:"/lovable-uploads/099d43ed-30ee-447a-8302-8f31d970c7b5.png",alt:"Professional business growth expert",className:"w-full h-full object-cover"}),y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-accent/30"})]}),y.jsx("div",{className:"absolute top-16 left-1/2 transform -translate-x-1/2 lg:top-20 lg:left-auto lg:right-20 lg:transform-none w-48 h-48 lg:w-64 lg:h-64 rounded-full overflow-hidden shadow-xl border-4 border-accent/60 -rotate-12",children:y.jsx("img",{src:"/lovable-uploads/4a2cd88c-1e89-4f93-a9e5-ccb59cbce7a6.png",alt:"Architectural development expertise",className:"w-full h-full object-cover hover:scale-110 transition-all duration-500"})})]}),y.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[y.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse"}),y.jsx("div",{className:"absolute bottom-10 right-20 w-80 h-80 bg-secondary/20 rounded-full blur-2xl"}),y.jsx("div",{className:"absolute top-1/3 left-1/3 w-[600px] h-[600px] bg-primary/15 rounded-full blur-3xl"}),y.jsx("div",{className:"absolute inset-0 opacity-8",children:y.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(0deg, rgba(255,255,255,0.08) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px)
            `,backgroundSize:"50px 50px"}})}),y.jsx("div",{className:"absolute inset-0 opacity-5",children:y.jsx("div",{className:"w-full h-full bg-gradient-to-br from-amber-800/15 via-amber-600/10 to-amber-900/20"})})]}),y.jsx("div",{className:"container mx-auto px-4 relative z-10 mt-48 lg:mt-0",children:y.jsxs("div",{className:"max-w-5xl mx-auto",children:[y.jsxs("div",{className:"text-center mb-16",children:[y.jsx("div",{className:"inline-block bg-white/20 backdrop-blur-sm px-8 py-4 rounded-full border border-white/30 mb-8",children:y.jsx("span",{className:"text-white font-bold text-xl",children:"🚀 TAKE ACTION NOW"})}),y.jsxs("h2",{className:"text-5xl lg:text-7xl font-black mb-8 text-white leading-tight",children:["READY TO",y.jsx("span",{className:"block text-white drop-shadow-2xl",children:"DOMINATE YOUR"}),y.jsx("span",{className:"block bg-gradient-to-r from-white to-white/80 bg-clip-text text-transparent",children:"INDUSTRY?"})]}),y.jsxs("p",{className:"text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed mb-8",children:["Schedule a ",y.jsx("span",{className:"text-white font-bold",children:"FREE consultation"})," to discover how TurnKey Development can skyrocket your revenue and optimize your operations."]})]}),y.jsxs(aa,{className:"border-0 shadow-2xl bg-black/20 backdrop-blur-sm border border-white/20",children:[y.jsx(zc,{className:"text-center pb-8",children:y.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-8 rounded-2xl border border-white/20",children:[y.jsx(Yc,{className:"text-4xl font-black mb-6 text-white",children:"🎯 FREE STRATEGY SESSION"}),y.jsx("p",{className:"text-xl text-white/90 max-w-2xl mx-auto",children:"Get a custom roadmap to transform your business in just 30 minutes"})]})}),y.jsxs(la,{className:"space-y-10",children:[y.jsxs("div",{className:"grid md:grid-cols-3 gap-8 text-center",children:[y.jsxs("div",{className:"space-y-4 bg-white/10 backdrop-blur-sm p-6 rounded-2xl border border-white/20",children:[y.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto",children:y.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),y.jsx("h3",{className:"font-bold text-xl text-white",children:"30-Minute Call"}),y.jsx("p",{className:"text-white/80 text-lg",children:"Deep dive into your challenges and goals"})]}),y.jsxs("div",{className:"space-y-4 bg-white/10 backdrop-blur-sm p-6 rounded-2xl border border-white/20",children:[y.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto",children:y.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),y.jsx("h3",{className:"font-bold text-xl text-white",children:"Custom Strategy"}),y.jsx("p",{className:"text-white/80 text-lg",children:"Receive tailored growth recommendations"})]}),y.jsxs("div",{className:"space-y-4 bg-white/10 backdrop-blur-sm p-6 rounded-2xl border border-white/20",children:[y.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto",children:y.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),y.jsx("h3",{className:"font-bold text-xl text-white",children:"Rapid Results"}),y.jsx("p",{className:"text-white/80 text-lg",children:"See improvements within weeks"})]})]}),y.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-2xl p-8 space-y-6 border border-white/30",children:[y.jsx("h3",{className:"text-2xl font-bold text-center text-white",children:"⚡ CLAIM YOUR SPOT NOW"}),y.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[y.jsx(r1,{placeholder:"Enter your business email",type:"email",className:"flex-1 h-14 bg-white/90 border-white text-primary placeholder:text-primary/60 text-lg"}),y.jsx(Gc,{size:"lg",className:"h-14 px-12 bg-white text-primary hover:bg-white/90 font-bold text-lg transform hover:scale-105 transition-all duration-300",children:"🚀 GET FREE SESSION"})]}),y.jsxs("p",{className:"text-sm text-white/90 text-center",children:[y.jsx("span",{className:"font-semibold",children:"LIMITED TIME:"})," Free consultation includes detailed business assessment worth $500"]})]}),y.jsxs("div",{className:"text-center space-y-6",children:[y.jsxs("div",{className:"flex items-center justify-center flex-wrap gap-8",children:[y.jsxs("div",{className:"flex items-center space-x-3 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full",children:[y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),y.jsx("span",{className:"text-white font-medium",children:"No Obligation"})]}),y.jsxs("div",{className:"flex items-center space-x-3 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full",children:[y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),y.jsx("span",{className:"text-white font-medium",children:"100% Confidential"})]}),y.jsxs("div",{className:"flex items-center space-x-3 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full",children:[y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),y.jsx("span",{className:"text-white font-medium",children:"Instant Response"})]})]}),y.jsx("div",{className:"bg-black/30 backdrop-blur-sm p-6 rounded-2xl border border-white/20",children:y.jsxs("div",{className:"flex items-center justify-center gap-4 text-white/90 text-lg",children:[y.jsxs("div",{className:"flex -space-x-2",children:[y.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-white bg-accent"}),y.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-white bg-secondary"}),y.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-white bg-primary"})]}),y.jsx("span",{className:"font-semibold",children:"Join 500+ successful businesses that transformed with us"})]})})]})]})]})]})})]}),PO=()=>y.jsx("section",{className:"w-full bg-emerald-800 py-8 border-t border-emerald-700",children:y.jsx("div",{className:"container mx-auto px-4",children:y.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[y.jsxs("div",{className:"flex items-center gap-6",children:[y.jsx("h2",{className:"text-lg md:text-xl lg:text-2xl font-bold text-white",children:"Looking For Something More Passive?"}),y.jsx(MA,{className:"text-emerald-300",size:32})]}),y.jsxs("a",{href:"https://novalcapitalgroup.com/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-4 hover:opacity-80 transition-opacity duration-300 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg px-4 py-3",children:[y.jsx("img",{src:"/lovable-uploads/b840c248-e891-4529-bc14-29c4cf690268.png",alt:"Noval Capital Group Logo",className:"h-10 w-auto pr-8"}),y.jsx("div",{className:"text-white font-['Georgia',serif] whitespace-nowrap",children:y.jsx("div",{className:"text-xl font-bold tracking-wide",children:"NOVAL CAPITAL GROUP"})})]})]})})}),DO=()=>y.jsx("footer",{className:"w-full bg-emerald-900 border-t border-emerald-800 py-8",children:y.jsx("div",{className:"container mx-auto px-4",children:y.jsx("div",{className:"text-center",children:y.jsx("p",{className:"text-white text-sm md:text-base",children:"Copyright © 2025, Equity Builders Group LLC. All rights reserved."})})})}),NO=()=>y.jsxs("div",{className:"min-h-screen",children:[y.jsx(d2,{}),y.jsx(f2,{}),y.jsx(p2,{}),y.jsx(g2,{}),y.jsx(CO,{}),y.jsx(kO,{}),y.jsx(_O,{}),y.jsx(PO,{}),y.jsx(DO,{})]}),OO=()=>{const n=ZE();return w.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",n.pathname)},[n.pathname]),y.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:y.jsxs("div",{className:"text-center",children:[y.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),y.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),y.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},MO=new yC,FO=()=>y.jsx(EC,{client:MO,children:y.jsxs(YR,{children:[y.jsx(CL,{}),y.jsx(aI,{}),y.jsx(ik,{children:y.jsxs(nk,{children:[y.jsx(xf,{path:"/",element:y.jsx(NO,{})}),y.jsx(xf,{path:"*",element:y.jsx(OO,{})})]})})]})});Sx(document.getElementById("root")).render(y.jsx(FO,{}));
